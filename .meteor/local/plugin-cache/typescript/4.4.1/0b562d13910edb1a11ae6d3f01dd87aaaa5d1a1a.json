{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/server/modules/core-apps/nps.module.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"server/modules/core-apps/nps.module.ts","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/server/modules/core-apps/nps.module.ts","inputSourceMap":{"version":3,"file":"server/modules/core-apps/nps.module.ts","sourceRoot":"","sources":["server/modules/core-apps/nps.module.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,MAAM,EAAE,GAAG,EAAE,MAAM,WAAW,CAAC;AACxC,OAAO,EAAE,WAAW,EAAE,MAAM,mBAAmB,CAAC;AAEhD,MAAM,OAAO,GAAG;IACf,KAAK,GAAG,UAAU,CAAC;IAEnB,KAAK,CAAC,WAAW,CAAC,OAAY;QAC7B,MAAM,EACL,SAAS,EACT,QAAQ,EACR,SAAS,EAAE,EAAE,EAAE,EAAE,MAAM,EAAE,EACzB,OAAO,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,EACzC,IAAI,GACJ,GAAG,OAAO,CAAC;QAEZ,MAAM,QAAQ,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,KAAK,GAAG,EAAE,EAAE,CAAC,CAAC;QAEjD,OAAO,WAAW,CAAC;YAClB,IAAI,EAAE,QAAQ,KAAK,WAAW,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,YAAY;YAC9D,EAAE,EAAE,GAAG,KAAK,IAAI,QAAQ,EAAE;YAC1B,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,KAAK;YACL,SAAS;YACT,KAAK;YACL,IAAI;SACJ,CAAC,CAAC;IACJ,CAAC;IAED,KAAK,CAAC,UAAU,CAAC,OAAY;QAC5B,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE;YAClC,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;SACnC;QAED,MAAM,EACL,OAAO,EAAE,EACR,IAAI,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,MAAM,EAAE,GAC3B,EACD,IAAI,EAAE,EAAE,GAAG,EAAE,MAAM,EAAE,KAAK,EAAE,GAC5B,GAAG,OAAO,CAAC;QAEZ,MAAM,CAAC,KAAK,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAEnC,MAAM,QAAQ,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,KAAK,GAAG,EAAE,EAAE,CAAC,CAAC;QAEjD,MAAM,EACL,CAAC,KAAK,CAAC,EAAE,EAAE,WAAW,EAAE,KAAK,EAAE,OAAO,EAAE,GACxC,GAAG,KAAK,CAAC;QAEV,MAAM,GAAG,CAAC,IAAI,CAAC;YACd,KAAK;YACL,MAAM;YACN,OAAO;YACP,KAAK;YACL,KAAK;SACL,CAAC,CAAC;QAEH,MAAM,MAAM,CAAC,OAAO,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;QAEvC,OAAO,IAAI,CAAC;IACb,CAAC;CACD","sourcesContent":["import { IUiKitCoreApp } from '../../sdk/types/IUiKitCoreApp';\nimport { Banner, NPS } from '../../sdk';\nimport { createModal } from './nps/createModal';\n\nexport class Nps implements IUiKitCoreApp {\n\tappId = 'nps-core';\n\n\tasync blockAction(payload: any): Promise<any> {\n\t\tconst {\n\t\t\ttriggerId,\n\t\t\tactionId,\n\t\t\tcontainer: { id: viewId },\n\t\t\tpayload: { value: score, blockId: npsId },\n\t\t\tuser,\n\t\t} = payload;\n\n\t\tconst bannerId = viewId.replace(`${npsId}-`, '');\n\n\t\treturn createModal({\n\t\t\ttype: actionId === 'nps-score' ? 'modal.update' : 'modal.open',\n\t\t\tid: `${npsId}-${bannerId}`,\n\t\t\tappId: this.appId,\n\t\t\tnpsId,\n\t\t\ttriggerId,\n\t\t\tscore,\n\t\t\tuser,\n\t\t});\n\t}\n\n\tasync viewSubmit(payload: any): Promise<any> {\n\t\tif (!payload.payload?.view?.state) {\n\t\t\tthrow new Error('Invalid payload');\n\t\t}\n\n\t\tconst {\n\t\t\tpayload: {\n\t\t\t\tview: { state, id: viewId },\n\t\t\t},\n\t\t\tuser: { _id: userId, roles },\n\t\t} = payload;\n\n\t\tconst [npsId] = Object.keys(state);\n\n\t\tconst bannerId = viewId.replace(`${npsId}-`, '');\n\n\t\tconst {\n\t\t\t[npsId]: { 'nps-score': score, comment },\n\t\t} = state;\n\n\t\tawait NPS.vote({\n\t\t\tnpsId,\n\t\t\tuserId,\n\t\t\tcomment,\n\t\t\troles,\n\t\t\tscore,\n\t\t});\n\n\t\tawait Banner.dismiss(userId, bannerId);\n\n\t\treturn true;\n\t}\n}\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/server/modules/core-apps/nps.module.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"server/modules/core-apps/nps.module.ts"}},"code":"module.export({\n  Nps: () => Nps\n});\nlet Banner, NPS;\nmodule.link(\"../../sdk\", {\n  Banner(v) {\n    Banner = v;\n  },\n\n  NPS(v) {\n    NPS = v;\n  }\n\n}, 0);\nlet createModal;\nmodule.link(\"./nps/createModal\", {\n  createModal(v) {\n    createModal = v;\n  }\n\n}, 1);\n\nclass Nps {\n  constructor() {\n    this.appId = 'nps-core';\n  }\n\n  blockAction(payload) {\n    return Promise.asyncApply(() => {\n      const {\n        triggerId,\n        actionId,\n        container: {\n          id: viewId\n        },\n        payload: {\n          value: score,\n          blockId: npsId\n        },\n        user\n      } = payload;\n      const bannerId = viewId.replace(\"\".concat(npsId, \"-\"), '');\n      return createModal({\n        type: actionId === 'nps-score' ? 'modal.update' : 'modal.open',\n        id: \"\".concat(npsId, \"-\").concat(bannerId),\n        appId: this.appId,\n        npsId,\n        triggerId,\n        score,\n        user\n      });\n    });\n  }\n\n  viewSubmit(payload) {\n    return Promise.asyncApply(() => {\n      var _payload$payload, _payload$payload$view;\n\n      if (!((_payload$payload = payload.payload) !== null && _payload$payload !== void 0 && (_payload$payload$view = _payload$payload.view) !== null && _payload$payload$view !== void 0 && _payload$payload$view.state)) {\n        throw new Error('Invalid payload');\n      }\n\n      const {\n        payload: {\n          view: {\n            state,\n            id: viewId\n          }\n        },\n        user: {\n          _id: userId,\n          roles\n        }\n      } = payload;\n      const [npsId] = Object.keys(state);\n      const bannerId = viewId.replace(\"\".concat(npsId, \"-\"), '');\n      const {\n        [npsId]: {\n          'nps-score': score,\n          comment\n        }\n      } = state;\n      Promise.await(NPS.vote({\n        npsId,\n        userId,\n        comment,\n        roles,\n        score\n      }));\n      Promise.await(Banner.dismiss(userId, bannerId));\n      return true;\n    });\n  }\n\n}","map":{"version":3,"sources":["server/modules/core-apps/nps.module.ts"],"names":[],"mappings":"AACA,MAAA,CAAO,MAAP,CAAS;AAAM,EAAA,GAAE,EAAA,MAAK;AAAb,CAAT;AAA4B,IAAA,MAAA,EAAY,GAAZ;AAAY,MAAA,CAAA,IAAA,CAAA,WAAA,EAAA;AAAA,EAAA,MAAA,CAAA,CAAA,EAAA;AAAA,IAAA,MAAA,GAAA,CAAA;AAAA,GAAA;;AAAA,EAAA,GAAA,CAAA,CAAA,EAAA;AAAA,IAAA,GAAA,GAAA,CAAA;AAAA;;AAAA,CAAA,EAAA,CAAA;AAAA,IAAA,WAAA;AAAA,MAAA,CAAA,IAAA,CAAA,mBAAA,EAAA;AAAA,EAAA,WAAA,CAAA,CAAA,EAAA;AAAA,IAAA,WAAA,GAAA,CAAA;AAAA;;AAAA,CAAA,EAAA,CAAA;;AAGlC,MAAO,GAAP,CAAU;AAAA;AAAA,SACf,KADe,GACP,UADO;AAAA;;AAGT,EAAA,WAAW,CAAC,OAAD;AAAA,oCAAa;AAC7B,YAAM;AACL,QAAA,SADK;AAEL,QAAA,QAFK;AAGL,QAAA,SAAS,EAAE;AAAE,UAAA,EAAE,EAAE;AAAN,SAHN;AAIL,QAAA,OAAO,EAAE;AAAE,UAAA,KAAK,EAAE,KAAT;AAAgB,UAAA,OAAO,EAAE;AAAzB,SAJJ;AAKL,QAAA;AALK,UAMF,OANJ;AAQA,YAAM,QAAQ,GAAG,MAAM,CAAC,OAAP,WAAkB,KAAlB,QAA4B,EAA5B,CAAjB;AAEA,aAAO,WAAW,CAAC;AAClB,QAAA,IAAI,EAAE,QAAQ,KAAK,WAAb,GAA2B,cAA3B,GAA4C,YADhC;AAElB,QAAA,EAAE,YAAK,KAAL,cAAc,QAAd,CAFgB;AAGlB,QAAA,KAAK,EAAE,KAAK,KAHM;AAIlB,QAAA,KAJkB;AAKlB,QAAA,SALkB;AAMlB,QAAA,KANkB;AAOlB,QAAA;AAPkB,OAAD,CAAlB;AASA,KApBgB;AAAA;;AAsBX,EAAA,UAAU,CAAC,OAAD;AAAA,oCAAa;AAAA;;AAC5B,UAAI,sBAAC,OAAO,CAAC,OAAT,sEAAC,iBAAiB,IAAlB,kDAAC,sBAAuB,KAAxB,CAAJ,EAAmC;AAClC,cAAM,IAAI,KAAJ,CAAU,iBAAV,CAAN;AACA;;AAED,YAAM;AACL,QAAA,OAAO,EAAE;AACR,UAAA,IAAI,EAAE;AAAE,YAAA,KAAF;AAAS,YAAA,EAAE,EAAE;AAAb;AADE,SADJ;AAIL,QAAA,IAAI,EAAE;AAAE,UAAA,GAAG,EAAE,MAAP;AAAe,UAAA;AAAf;AAJD,UAKF,OALJ;AAOA,YAAM,CAAC,KAAD,IAAU,MAAM,CAAC,IAAP,CAAY,KAAZ,CAAhB;AAEA,YAAM,QAAQ,GAAG,MAAM,CAAC,OAAP,WAAkB,KAAlB,QAA4B,EAA5B,CAAjB;AAEA,YAAM;AACL,SAAC,KAAD,GAAS;AAAE,uBAAa,KAAf;AAAsB,UAAA;AAAtB;AADJ,UAEF,KAFJ;AAIA,oBAAM,GAAG,CAAC,IAAJ,CAAS;AACd,QAAA,KADc;AAEd,QAAA,MAFc;AAGd,QAAA,OAHc;AAId,QAAA,KAJc;AAKd,QAAA;AALc,OAAT,CAAN;AAQA,oBAAM,MAAM,CAAC,OAAP,CAAe,MAAf,EAAuB,QAAvB,CAAN;AAEA,aAAO,IAAP;AACA,KA/Be;AAAA;;AAzBD","sourcesContent":["import { IUiKitCoreApp } from '../../sdk/types/IUiKitCoreApp';\nimport { Banner, NPS } from '../../sdk';\nimport { createModal } from './nps/createModal';\n\nexport class Nps implements IUiKitCoreApp {\n\tappId = 'nps-core';\n\n\tasync blockAction(payload: any): Promise<any> {\n\t\tconst {\n\t\t\ttriggerId,\n\t\t\tactionId,\n\t\t\tcontainer: { id: viewId },\n\t\t\tpayload: { value: score, blockId: npsId },\n\t\t\tuser,\n\t\t} = payload;\n\n\t\tconst bannerId = viewId.replace(`${npsId}-`, '');\n\n\t\treturn createModal({\n\t\t\ttype: actionId === 'nps-score' ? 'modal.update' : 'modal.open',\n\t\t\tid: `${npsId}-${bannerId}`,\n\t\t\tappId: this.appId,\n\t\t\tnpsId,\n\t\t\ttriggerId,\n\t\t\tscore,\n\t\t\tuser,\n\t\t});\n\t}\n\n\tasync viewSubmit(payload: any): Promise<any> {\n\t\tif (!payload.payload?.view?.state) {\n\t\t\tthrow new Error('Invalid payload');\n\t\t}\n\n\t\tconst {\n\t\t\tpayload: {\n\t\t\t\tview: { state, id: viewId },\n\t\t\t},\n\t\t\tuser: { _id: userId, roles },\n\t\t} = payload;\n\n\t\tconst [npsId] = Object.keys(state);\n\n\t\tconst bannerId = viewId.replace(`${npsId}-`, '');\n\n\t\tconst {\n\t\t\t[npsId]: { 'nps-score': score, comment },\n\t\t} = state;\n\n\t\tawait NPS.vote({\n\t\t\tnpsId,\n\t\t\tuserId,\n\t\t\tcomment,\n\t\t\troles,\n\t\t\tscore,\n\t\t});\n\n\t\tawait Banner.dismiss(userId, bannerId);\n\n\t\treturn true;\n\t}\n}\n"],"sourceRoot":""},"sourceType":"module","hash":"0b562d13910edb1a11ae6d3f01dd87aaaa5d1a1a"}
