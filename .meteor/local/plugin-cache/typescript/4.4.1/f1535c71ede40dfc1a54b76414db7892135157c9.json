{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/file-upload/server/methods/sendFileMessage.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/file-upload/server/methods/sendFileMessage.ts","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/file-upload/server/methods/sendFileMessage.ts","inputSourceMap":{"version":3,"file":"app/file-upload/server/methods/sendFileMessage.ts","sourceRoot":"","sources":["app/file-upload/server/methods/sendFileMessage.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/camelcase */\nimport { Meteor } from 'meteor/meteor';\nimport { Match, check } from 'meteor/check';\nimport _ from 'underscore';\n\nimport { Rooms, Uploads } from '../../../models/server/raw';\nimport { callbacks } from '../../../../lib/callbacks';\nimport { FileUpload } from '../lib/FileUpload';\nimport { canAccessRoom } from '../../../authorization/server/functions/canAccessRoom';\nimport { MessageAttachment } from '../../../../definition/IMessage/MessageAttachment/MessageAttachment';\nimport { FileAttachmentProps } from '../../../../definition/IMessage/MessageAttachment/Files/FileAttachmentProps';\nimport { IUser } from '../../../../definition/IUser';\nimport { SystemLogger } from '../../../../server/lib/logger/system';\n\nMeteor.methods({\n\tasync sendFileMessage(roomId, _store, file, msgData = {}) {\n\t\tconst user = Meteor.user() as IUser | undefined;\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'sendFileMessage',\n\t\t\t} as any);\n\t\t}\n\n\t\tconst room = await Rooms.findOneById(roomId);\n\n\t\tif (user?.type !== 'app' && !canAccessRoom(room, user)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tcheck(msgData, {\n\t\t\tavatar: Match.Optional(String),\n\t\t\temoji: Match.Optional(String),\n\t\t\talias: Match.Optional(String),\n\t\t\tgroupable: Match.Optional(Boolean),\n\t\t\tmsg: Match.Optional(String),\n\t\t\ttmid: Match.Optional(String),\n\t\t});\n\n\t\tawait Uploads.updateFileComplete(file._id, user._id, _.omit(file, '_id'));\n\n\t\tconst fileUrl = FileUpload.getPath(`${file._id}/${encodeURI(file.name)}`);\n\n\t\tconst attachments: MessageAttachment[] = [];\n\n\t\tconst files = [\n\t\t\t{\n\t\t\t\t_id: file._id,\n\t\t\t\tname: file.name,\n\t\t\t\ttype: file.type,\n\t\t\t},\n\t\t];\n\n\t\tif (/^image\\/.+/.test(file.type)) {\n\t\t\tconst attachment: FileAttachmentProps = {\n\t\t\t\ttitle: file.name,\n\t\t\t\ttype: 'file',\n\t\t\t\tdescription: file.description,\n\t\t\t\ttitle_link: fileUrl,\n\t\t\t\ttitle_link_download: true,\n\t\t\t\timage_url: fileUrl,\n\t\t\t\timage_type: file.type,\n\t\t\t\timage_size: file.size,\n\t\t\t};\n\n\t\t\tif (file.identify && file.identify.size) {\n\t\t\t\tattachment.image_dimensions = file.identify.size;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tattachment.image_preview = await FileUpload.resizeImagePreview(file);\n\t\t\t\tconst thumbResult = await FileUpload.createImageThumbnail(file);\n\t\t\t\tif (thumbResult) {\n\t\t\t\t\tconst { data: thumbBuffer, width, height } = thumbResult;\n\t\t\t\t\tconst thumbnail = FileUpload.uploadImageThumbnail(file, thumbBuffer, roomId, user._id);\n\t\t\t\t\tconst thumbUrl = FileUpload.getPath(`${thumbnail._id}/${encodeURI(file.name)}`);\n\t\t\t\t\tattachment.image_url = thumbUrl;\n\t\t\t\t\tattachment.image_type = thumbnail.type;\n\t\t\t\t\tattachment.image_dimensions = {\n\t\t\t\t\t\twidth,\n\t\t\t\t\t\theight,\n\t\t\t\t\t};\n\t\t\t\t\tfiles.push({\n\t\t\t\t\t\t_id: thumbnail._id,\n\t\t\t\t\t\tname: file.name,\n\t\t\t\t\t\ttype: thumbnail.type,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tSystemLogger.error(e);\n\t\t\t}\n\t\t\tattachments.push(attachment);\n\t\t} else if (/^audio\\/.+/.test(file.type)) {\n\t\t\tconst attachment: FileAttachmentProps = {\n\t\t\t\ttitle: file.name,\n\t\t\t\ttype: 'file',\n\t\t\t\tdescription: file.description,\n\t\t\t\ttitle_link: fileUrl,\n\t\t\t\ttitle_link_download: true,\n\t\t\t\taudio_url: fileUrl,\n\t\t\t\taudio_type: file.type,\n\t\t\t\taudio_size: file.size,\n\t\t\t};\n\t\t\tattachments.push(attachment);\n\t\t} else if (/^video\\/.+/.test(file.type)) {\n\t\t\tconst attachment: FileAttachmentProps = {\n\t\t\t\ttitle: file.name,\n\t\t\t\ttype: 'file',\n\t\t\t\tdescription: file.description,\n\t\t\t\ttitle_link: fileUrl,\n\t\t\t\ttitle_link_download: true,\n\t\t\t\tvideo_url: fileUrl,\n\t\t\t\tvideo_type: file.type,\n\t\t\t\tvideo_size: file.size,\n\t\t\t};\n\t\t\tattachments.push(attachment);\n\t\t} else {\n\t\t\tconst attachment = {\n\t\t\t\ttitle: file.name,\n\t\t\t\ttype: 'file',\n\t\t\t\tdescription: file.description,\n\t\t\t\ttitle_link: fileUrl,\n\t\t\t\ttitle_link_download: true,\n\t\t\t};\n\t\t\tattachments.push(attachment);\n\t\t}\n\n\t\tconst msg = Meteor.call('sendMessage', {\n\t\t\trid: roomId,\n\t\t\tts: new Date(),\n\t\t\tmsg: '',\n\t\t\tfile: files[0],\n\t\t\tfiles,\n\t\t\tgroupable: false,\n\t\t\tattachments,\n\t\t\t...msgData,\n\t\t});\n\n\t\tcallbacks.runAsync('afterFileUpload', { user, room, message: msg });\n\n\t\treturn msg;\n\t},\n});\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/file-upload/server/methods/sendFileMessage.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/file-upload/server/methods/sendFileMessage.ts"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Match, check;\nmodule.link(\"meteor/check\", {\n  Match(v) {\n    Match = v;\n  },\n\n  check(v) {\n    check = v;\n  }\n\n}, 1);\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 2);\nlet Rooms, Uploads;\nmodule.link(\"../../../models/server/raw\", {\n  Rooms(v) {\n    Rooms = v;\n  },\n\n  Uploads(v) {\n    Uploads = v;\n  }\n\n}, 3);\nlet callbacks;\nmodule.link(\"../../../../lib/callbacks\", {\n  callbacks(v) {\n    callbacks = v;\n  }\n\n}, 4);\nlet FileUpload;\nmodule.link(\"../lib/FileUpload\", {\n  FileUpload(v) {\n    FileUpload = v;\n  }\n\n}, 5);\nlet canAccessRoom;\nmodule.link(\"../../../authorization/server/functions/canAccessRoom\", {\n  canAccessRoom(v) {\n    canAccessRoom = v;\n  }\n\n}, 6);\nlet SystemLogger;\nmodule.link(\"../../../../server/lib/logger/system\", {\n  SystemLogger(v) {\n    SystemLogger = v;\n  }\n\n}, 7);\nMeteor.methods({\n  sendFileMessage(roomId, _store, file) {\n    return Promise.asyncApply(() => {\n      let msgData = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n      const user = Meteor.user();\n\n      if (!user) {\n        throw new Meteor.Error('error-invalid-user', 'Invalid user', {\n          method: 'sendFileMessage'\n        });\n      }\n\n      const room = Promise.await(Rooms.findOneById(roomId));\n\n      if ((user === null || user === void 0 ? void 0 : user.type) !== 'app' && !canAccessRoom(room, user)) {\n        return false;\n      }\n\n      check(msgData, {\n        avatar: Match.Optional(String),\n        emoji: Match.Optional(String),\n        alias: Match.Optional(String),\n        groupable: Match.Optional(Boolean),\n        msg: Match.Optional(String),\n        tmid: Match.Optional(String)\n      });\n      Promise.await(Uploads.updateFileComplete(file._id, user._id, _.omit(file, '_id')));\n      const fileUrl = FileUpload.getPath(\"\".concat(file._id, \"/\").concat(encodeURI(file.name)));\n      const attachments = [];\n      const files = [{\n        _id: file._id,\n        name: file.name,\n        type: file.type\n      }];\n\n      if (/^image\\/.+/.test(file.type)) {\n        const attachment = {\n          title: file.name,\n          type: 'file',\n          description: file.description,\n          title_link: fileUrl,\n          title_link_download: true,\n          image_url: fileUrl,\n          image_type: file.type,\n          image_size: file.size\n        };\n\n        if (file.identify && file.identify.size) {\n          attachment.image_dimensions = file.identify.size;\n        }\n\n        try {\n          attachment.image_preview = Promise.await(FileUpload.resizeImagePreview(file));\n          const thumbResult = Promise.await(FileUpload.createImageThumbnail(file));\n\n          if (thumbResult) {\n            const {\n              data: thumbBuffer,\n              width,\n              height\n            } = thumbResult;\n            const thumbnail = FileUpload.uploadImageThumbnail(file, thumbBuffer, roomId, user._id);\n            const thumbUrl = FileUpload.getPath(\"\".concat(thumbnail._id, \"/\").concat(encodeURI(file.name)));\n            attachment.image_url = thumbUrl;\n            attachment.image_type = thumbnail.type;\n            attachment.image_dimensions = {\n              width,\n              height\n            };\n            files.push({\n              _id: thumbnail._id,\n              name: file.name,\n              type: thumbnail.type\n            });\n          }\n        } catch (e) {\n          SystemLogger.error(e);\n        }\n\n        attachments.push(attachment);\n      } else if (/^audio\\/.+/.test(file.type)) {\n        const attachment = {\n          title: file.name,\n          type: 'file',\n          description: file.description,\n          title_link: fileUrl,\n          title_link_download: true,\n          audio_url: fileUrl,\n          audio_type: file.type,\n          audio_size: file.size\n        };\n        attachments.push(attachment);\n      } else if (/^video\\/.+/.test(file.type)) {\n        const attachment = {\n          title: file.name,\n          type: 'file',\n          description: file.description,\n          title_link: fileUrl,\n          title_link_download: true,\n          video_url: fileUrl,\n          video_type: file.type,\n          video_size: file.size\n        };\n        attachments.push(attachment);\n      } else {\n        const attachment = {\n          title: file.name,\n          type: 'file',\n          description: file.description,\n          title_link: fileUrl,\n          title_link_download: true\n        };\n        attachments.push(attachment);\n      }\n\n      const msg = Meteor.call('sendMessage', _objectSpread({\n        rid: roomId,\n        ts: new Date(),\n        msg: '',\n        file: files[0],\n        files,\n        groupable: false,\n        attachments\n      }, msgData));\n      callbacks.runAsync('afterFileUpload', {\n        user,\n        room,\n        message: msg\n      });\n      return msg;\n    });\n  }\n\n});","map":{"version":3,"sources":["app/file-upload/server/methods/sendFileMessage.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/camelcase */\nimport { Meteor } from 'meteor/meteor';\nimport { Match, check } from 'meteor/check';\nimport _ from 'underscore';\n\nimport { Rooms, Uploads } from '../../../models/server/raw';\nimport { callbacks } from '../../../../lib/callbacks';\nimport { FileUpload } from '../lib/FileUpload';\nimport { canAccessRoom } from '../../../authorization/server/functions/canAccessRoom';\nimport { MessageAttachment } from '../../../../definition/IMessage/MessageAttachment/MessageAttachment';\nimport { FileAttachmentProps } from '../../../../definition/IMessage/MessageAttachment/Files/FileAttachmentProps';\nimport { IUser } from '../../../../definition/IUser';\nimport { SystemLogger } from '../../../../server/lib/logger/system';\n\nMeteor.methods({\n\tasync sendFileMessage(roomId, _store, file, msgData = {}) {\n\t\tconst user = Meteor.user() as IUser | undefined;\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'sendFileMessage',\n\t\t\t} as any);\n\t\t}\n\n\t\tconst room = await Rooms.findOneById(roomId);\n\n\t\tif (user?.type !== 'app' && !canAccessRoom(room, user)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tcheck(msgData, {\n\t\t\tavatar: Match.Optional(String),\n\t\t\temoji: Match.Optional(String),\n\t\t\talias: Match.Optional(String),\n\t\t\tgroupable: Match.Optional(Boolean),\n\t\t\tmsg: Match.Optional(String),\n\t\t\ttmid: Match.Optional(String),\n\t\t});\n\n\t\tawait Uploads.updateFileComplete(file._id, user._id, _.omit(file, '_id'));\n\n\t\tconst fileUrl = FileUpload.getPath(`${file._id}/${encodeURI(file.name)}`);\n\n\t\tconst attachments: MessageAttachment[] = [];\n\n\t\tconst files = [\n\t\t\t{\n\t\t\t\t_id: file._id,\n\t\t\t\tname: file.name,\n\t\t\t\ttype: file.type,\n\t\t\t},\n\t\t];\n\n\t\tif (/^image\\/.+/.test(file.type)) {\n\t\t\tconst attachment: FileAttachmentProps = {\n\t\t\t\ttitle: file.name,\n\t\t\t\ttype: 'file',\n\t\t\t\tdescription: file.description,\n\t\t\t\ttitle_link: fileUrl,\n\t\t\t\ttitle_link_download: true,\n\t\t\t\timage_url: fileUrl,\n\t\t\t\timage_type: file.type,\n\t\t\t\timage_size: file.size,\n\t\t\t};\n\n\t\t\tif (file.identify && file.identify.size) {\n\t\t\t\tattachment.image_dimensions = file.identify.size;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tattachment.image_preview = await FileUpload.resizeImagePreview(file);\n\t\t\t\tconst thumbResult = await FileUpload.createImageThumbnail(file);\n\t\t\t\tif (thumbResult) {\n\t\t\t\t\tconst { data: thumbBuffer, width, height } = thumbResult;\n\t\t\t\t\tconst thumbnail = FileUpload.uploadImageThumbnail(file, thumbBuffer, roomId, user._id);\n\t\t\t\t\tconst thumbUrl = FileUpload.getPath(`${thumbnail._id}/${encodeURI(file.name)}`);\n\t\t\t\t\tattachment.image_url = thumbUrl;\n\t\t\t\t\tattachment.image_type = thumbnail.type;\n\t\t\t\t\tattachment.image_dimensions = {\n\t\t\t\t\t\twidth,\n\t\t\t\t\t\theight,\n\t\t\t\t\t};\n\t\t\t\t\tfiles.push({\n\t\t\t\t\t\t_id: thumbnail._id,\n\t\t\t\t\t\tname: file.name,\n\t\t\t\t\t\ttype: thumbnail.type,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tSystemLogger.error(e);\n\t\t\t}\n\t\t\tattachments.push(attachment);\n\t\t} else if (/^audio\\/.+/.test(file.type)) {\n\t\t\tconst attachment: FileAttachmentProps = {\n\t\t\t\ttitle: file.name,\n\t\t\t\ttype: 'file',\n\t\t\t\tdescription: file.description,\n\t\t\t\ttitle_link: fileUrl,\n\t\t\t\ttitle_link_download: true,\n\t\t\t\taudio_url: fileUrl,\n\t\t\t\taudio_type: file.type,\n\t\t\t\taudio_size: file.size,\n\t\t\t};\n\t\t\tattachments.push(attachment);\n\t\t} else if (/^video\\/.+/.test(file.type)) {\n\t\t\tconst attachment: FileAttachmentProps = {\n\t\t\t\ttitle: file.name,\n\t\t\t\ttype: 'file',\n\t\t\t\tdescription: file.description,\n\t\t\t\ttitle_link: fileUrl,\n\t\t\t\ttitle_link_download: true,\n\t\t\t\tvideo_url: fileUrl,\n\t\t\t\tvideo_type: file.type,\n\t\t\t\tvideo_size: file.size,\n\t\t\t};\n\t\t\tattachments.push(attachment);\n\t\t} else {\n\t\t\tconst attachment = {\n\t\t\t\ttitle: file.name,\n\t\t\t\ttype: 'file',\n\t\t\t\tdescription: file.description,\n\t\t\t\ttitle_link: fileUrl,\n\t\t\t\ttitle_link_download: true,\n\t\t\t};\n\t\t\tattachments.push(attachment);\n\t\t}\n\n\t\tconst msg = Meteor.call('sendMessage', {\n\t\t\trid: roomId,\n\t\t\tts: new Date(),\n\t\t\tmsg: '',\n\t\t\tfile: files[0],\n\t\t\tfiles,\n\t\t\tgroupable: false,\n\t\t\tattachments,\n\t\t\t...msgData,\n\t\t});\n\n\t\tcallbacks.runAsync('afterFileUpload', { user, room, message: msg });\n\n\t\treturn msg;\n\t},\n});\n"],"sourceRoot":""},"sourceType":"module","hash":"f1535c71ede40dfc1a54b76414db7892135157c9"}
