{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/apps/server/bridges/commands.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/apps/server/bridges/commands.ts","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/apps/server/bridges/commands.ts","inputSourceMap":{"version":3,"file":"app/apps/server/bridges/commands.ts","sourceRoot":"","sources":["app/apps/server/bridges/commands.ts"],"names":[],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { SlashCommandContext, ISlashCommand, ISlashCommandPreviewItem } from '@rocket.chat/apps-engine/definition/slashcommands';\nimport { CommandBridge } from '@rocket.chat/apps-engine/server/bridges/CommandBridge';\n\nimport { slashCommands } from '../../../utils/server';\nimport { Utilities } from '../../lib/misc/Utilities';\nimport { AppServerOrchestrator } from '../orchestrator';\nimport { IMessage } from '../../../../definition/IMessage';\n\nexport class AppCommandsBridge extends CommandBridge {\n\tdisabledCommands: Map<string, object>;\n\n\t// eslint-disable-next-line no-empty-function\n\tconstructor(private readonly orch: AppServerOrchestrator) {\n\t\tsuper();\n\t\tthis.disabledCommands = new Map();\n\t}\n\n\tprotected doesCommandExist(command: string, appId: string): boolean {\n\t\tthis.orch.debugLog(`The App ${appId} is checking if \"${command}\" command exists.`);\n\n\t\tif (typeof command !== 'string' || command.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\n\t\treturn typeof slashCommands.commands[cmd] === 'object' || this.disabledCommands.has(cmd);\n\t}\n\n\tprotected enableCommand(command: string, appId: string): void {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to enable the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tif (!this.disabledCommands.has(cmd)) {\n\t\t\tthrow new Error(`The command is not currently disabled: \"${cmd}\"`);\n\t\t}\n\n\t\tslashCommands.commands[cmd] = this.disabledCommands.get(cmd);\n\t\tthis.disabledCommands.delete(cmd);\n\n\t\tthis.orch.getNotifier().commandUpdated(cmd);\n\t}\n\n\tprotected disableCommand(command: string, appId: string): void {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to disable the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tif (this.disabledCommands.has(cmd)) {\n\t\t\t// The command is already disabled, no need to disable it yet again\n\t\t\treturn;\n\t\t}\n\n\t\tif (typeof slashCommands.commands[cmd] === 'undefined') {\n\t\t\tthrow new Error(`Command does not exist in the system currently: \"${cmd}\"`);\n\t\t}\n\n\t\tthis.disabledCommands.set(cmd, slashCommands.commands[cmd]);\n\t\tdelete slashCommands.commands[cmd];\n\n\t\tthis.orch.getNotifier().commandDisabled(cmd);\n\t}\n\n\t// command: { command, paramsExample, i18nDescription, executor: function }\n\tprotected modifyCommand(command: ISlashCommand, appId: string): void {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to modify the command: \"${command}\"`);\n\n\t\tthis._verifyCommand(command);\n\n\t\tconst cmd = command.command.toLowerCase();\n\t\tif (typeof slashCommands.commands[cmd] === 'undefined') {\n\t\t\tthrow new Error(`Command does not exist in the system currently (or it is disabled): \"${cmd}\"`);\n\t\t}\n\n\t\tconst item = slashCommands.commands[cmd];\n\n\t\titem.params = command.i18nParamsExample ? command.i18nParamsExample : item.params;\n\t\titem.description = command.i18nDescription ? command.i18nDescription : item.params;\n\t\titem.callback = this._appCommandExecutor.bind(this);\n\t\titem.providesPreview = command.providesPreview;\n\t\titem.previewer = command.previewer ? this._appCommandPreviewer.bind(this) : item.previewer;\n\t\titem.previewCallback = command.executePreviewItem ? this._appCommandPreviewExecutor.bind(this) : item.previewCallback;\n\n\t\tslashCommands.commands[cmd] = item;\n\t\tthis.orch.getNotifier().commandUpdated(cmd);\n\t}\n\n\tprotected registerCommand(command: ISlashCommand, appId: string): void {\n\t\tthis.orch.debugLog(`The App ${appId} is registering the command: \"${command.command}\"`);\n\n\t\tthis._verifyCommand(command);\n\n\t\tconst item = {\n\t\t\tappId,\n\t\t\tcommand: command.command.toLowerCase(),\n\t\t\tparams: Utilities.getI18nKeyForApp(command.i18nParamsExample, appId),\n\t\t\tdescription: Utilities.getI18nKeyForApp(command.i18nDescription, appId),\n\t\t\tpermission: command.permission,\n\t\t\tcallback: this._appCommandExecutor.bind(this),\n\t\t\tprovidesPreview: command.providesPreview,\n\t\t\tpreviewer: !command.previewer ? undefined : this._appCommandPreviewer.bind(this),\n\t\t\tpreviewCallback: !command.executePreviewItem ? undefined : this._appCommandPreviewExecutor.bind(this),\n\t\t};\n\n\t\tslashCommands.commands[command.command.toLowerCase()] = item;\n\t\tthis.orch.getNotifier().commandAdded(command.command.toLowerCase());\n\t}\n\n\tprotected unregisterCommand(command: string, appId: string): void {\n\t\tthis.orch.debugLog(`The App ${appId} is unregistering the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tthis.disabledCommands.delete(cmd);\n\t\tdelete slashCommands.commands[cmd];\n\n\t\tthis.orch.getNotifier().commandRemoved(cmd);\n\t}\n\n\tprivate _verifyCommand(command: ISlashCommand): void {\n\t\tif (typeof command !== 'object') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.command !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (command.i18nParamsExample && typeof command.i18nParamsExample !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (command.i18nDescription && typeof command.i18nDescription !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.providesPreview !== 'boolean') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.executor !== 'function') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\t}\n\n\tprivate _appCommandExecutor(command: string, parameters: any, message: IMessage, triggerId: string): void {\n\t\tconst user = this.orch.getConverters()?.get('users').convertById(Meteor.userId());\n\t\tconst room = this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst params = parameters.length === 0 || parameters === ' ' ? [] : parameters.split(' ');\n\n\t\tconst context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params), threadId, triggerId);\n\n\t\tPromise.await(this.orch.getManager()?.getCommandManager().executeCommand(command, context));\n\t}\n\n\tprivate _appCommandPreviewer(command: string, parameters: any, message: IMessage): any {\n\t\tconst user = this.orch.getConverters()?.get('users').convertById(Meteor.userId());\n\t\tconst room = this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst params = parameters.length === 0 || parameters === ' ' ? [] : parameters.split(' ');\n\n\t\tconst context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params), threadId);\n\t\treturn Promise.await(this.orch.getManager()?.getCommandManager().getPreviews(command, context));\n\t}\n\n\tprivate async _appCommandPreviewExecutor(\n\t\tcommand: string,\n\t\tparameters: any,\n\t\tmessage: IMessage,\n\t\tpreview: ISlashCommandPreviewItem,\n\t\ttriggerId: string,\n\t): Promise<void> {\n\t\tconst user = this.orch.getConverters()?.get('users').convertById(Meteor.userId());\n\t\tconst room = this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst params = parameters.length === 0 || parameters === ' ' ? [] : parameters.split(' ');\n\n\t\tconst context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params), threadId, triggerId);\n\n\t\tPromise.await(this.orch.getManager()?.getCommandManager().executePreview(command, preview, context));\n\t}\n}\n"]},"targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/apps/server/bridges/commands.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/apps/server/bridges/commands.ts"}},"code":"module.export({\n  AppCommandsBridge: () => AppCommandsBridge\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet SlashCommandContext;\nmodule.link(\"@rocket.chat/apps-engine/definition/slashcommands\", {\n  SlashCommandContext(v) {\n    SlashCommandContext = v;\n  }\n\n}, 1);\nlet CommandBridge;\nmodule.link(\"@rocket.chat/apps-engine/server/bridges/CommandBridge\", {\n  CommandBridge(v) {\n    CommandBridge = v;\n  }\n\n}, 2);\nlet slashCommands;\nmodule.link(\"../../../utils/server\", {\n  slashCommands(v) {\n    slashCommands = v;\n  }\n\n}, 3);\nlet Utilities;\nmodule.link(\"../../lib/misc/Utilities\", {\n  Utilities(v) {\n    Utilities = v;\n  }\n\n}, 4);\n\nclass AppCommandsBridge extends CommandBridge {\n  // eslint-disable-next-line no-empty-function\n  constructor(orch) {\n    super();\n    this.orch = void 0;\n    this.disabledCommands = void 0;\n    this.orch = orch;\n    this.disabledCommands = new Map();\n  }\n\n  doesCommandExist(command, appId) {\n    this.orch.debugLog(\"The App \".concat(appId, \" is checking if \\\"\").concat(command, \"\\\" command exists.\"));\n\n    if (typeof command !== 'string' || command.length === 0) {\n      return false;\n    }\n\n    const cmd = command.toLowerCase();\n    return typeof slashCommands.commands[cmd] === 'object' || this.disabledCommands.has(cmd);\n  }\n\n  enableCommand(command, appId) {\n    this.orch.debugLog(\"The App \".concat(appId, \" is attempting to enable the command: \\\"\").concat(command, \"\\\"\"));\n\n    if (typeof command !== 'string' || command.trim().length === 0) {\n      throw new Error('Invalid command parameter provided, must be a string.');\n    }\n\n    const cmd = command.toLowerCase();\n\n    if (!this.disabledCommands.has(cmd)) {\n      throw new Error(\"The command is not currently disabled: \\\"\".concat(cmd, \"\\\"\"));\n    }\n\n    slashCommands.commands[cmd] = this.disabledCommands.get(cmd);\n    this.disabledCommands.delete(cmd);\n    this.orch.getNotifier().commandUpdated(cmd);\n  }\n\n  disableCommand(command, appId) {\n    this.orch.debugLog(\"The App \".concat(appId, \" is attempting to disable the command: \\\"\").concat(command, \"\\\"\"));\n\n    if (typeof command !== 'string' || command.trim().length === 0) {\n      throw new Error('Invalid command parameter provided, must be a string.');\n    }\n\n    const cmd = command.toLowerCase();\n\n    if (this.disabledCommands.has(cmd)) {\n      // The command is already disabled, no need to disable it yet again\n      return;\n    }\n\n    if (typeof slashCommands.commands[cmd] === 'undefined') {\n      throw new Error(\"Command does not exist in the system currently: \\\"\".concat(cmd, \"\\\"\"));\n    }\n\n    this.disabledCommands.set(cmd, slashCommands.commands[cmd]);\n    delete slashCommands.commands[cmd];\n    this.orch.getNotifier().commandDisabled(cmd);\n  } // command: { command, paramsExample, i18nDescription, executor: function }\n\n\n  modifyCommand(command, appId) {\n    this.orch.debugLog(\"The App \".concat(appId, \" is attempting to modify the command: \\\"\").concat(command, \"\\\"\"));\n\n    this._verifyCommand(command);\n\n    const cmd = command.command.toLowerCase();\n\n    if (typeof slashCommands.commands[cmd] === 'undefined') {\n      throw new Error(\"Command does not exist in the system currently (or it is disabled): \\\"\".concat(cmd, \"\\\"\"));\n    }\n\n    const item = slashCommands.commands[cmd];\n    item.params = command.i18nParamsExample ? command.i18nParamsExample : item.params;\n    item.description = command.i18nDescription ? command.i18nDescription : item.params;\n    item.callback = this._appCommandExecutor.bind(this);\n    item.providesPreview = command.providesPreview;\n    item.previewer = command.previewer ? this._appCommandPreviewer.bind(this) : item.previewer;\n    item.previewCallback = command.executePreviewItem ? this._appCommandPreviewExecutor.bind(this) : item.previewCallback;\n    slashCommands.commands[cmd] = item;\n    this.orch.getNotifier().commandUpdated(cmd);\n  }\n\n  registerCommand(command, appId) {\n    this.orch.debugLog(\"The App \".concat(appId, \" is registering the command: \\\"\").concat(command.command, \"\\\"\"));\n\n    this._verifyCommand(command);\n\n    const item = {\n      appId,\n      command: command.command.toLowerCase(),\n      params: Utilities.getI18nKeyForApp(command.i18nParamsExample, appId),\n      description: Utilities.getI18nKeyForApp(command.i18nDescription, appId),\n      permission: command.permission,\n      callback: this._appCommandExecutor.bind(this),\n      providesPreview: command.providesPreview,\n      previewer: !command.previewer ? undefined : this._appCommandPreviewer.bind(this),\n      previewCallback: !command.executePreviewItem ? undefined : this._appCommandPreviewExecutor.bind(this)\n    };\n    slashCommands.commands[command.command.toLowerCase()] = item;\n    this.orch.getNotifier().commandAdded(command.command.toLowerCase());\n  }\n\n  unregisterCommand(command, appId) {\n    this.orch.debugLog(\"The App \".concat(appId, \" is unregistering the command: \\\"\").concat(command, \"\\\"\"));\n\n    if (typeof command !== 'string' || command.trim().length === 0) {\n      throw new Error('Invalid command parameter provided, must be a string.');\n    }\n\n    const cmd = command.toLowerCase();\n    this.disabledCommands.delete(cmd);\n    delete slashCommands.commands[cmd];\n    this.orch.getNotifier().commandRemoved(cmd);\n  }\n\n  _verifyCommand(command) {\n    if (typeof command !== 'object') {\n      throw new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n    }\n\n    if (typeof command.command !== 'string') {\n      throw new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n    }\n\n    if (command.i18nParamsExample && typeof command.i18nParamsExample !== 'string') {\n      throw new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n    }\n\n    if (command.i18nDescription && typeof command.i18nDescription !== 'string') {\n      throw new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n    }\n\n    if (typeof command.providesPreview !== 'boolean') {\n      throw new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n    }\n\n    if (typeof command.executor !== 'function') {\n      throw new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n    }\n  }\n\n  _appCommandExecutor(command, parameters, message, triggerId) {\n    var _this$orch$getConvert, _this$orch$getConvert2, _this$orch$getManager;\n\n    const user = (_this$orch$getConvert = this.orch.getConverters()) === null || _this$orch$getConvert === void 0 ? void 0 : _this$orch$getConvert.get('users').convertById(Meteor.userId());\n    const room = (_this$orch$getConvert2 = this.orch.getConverters()) === null || _this$orch$getConvert2 === void 0 ? void 0 : _this$orch$getConvert2.get('rooms').convertById(message.rid);\n    const threadId = message.tmid;\n    const params = parameters.length === 0 || parameters === ' ' ? [] : parameters.split(' ');\n    const context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params), threadId, triggerId);\n    Promise.await((_this$orch$getManager = this.orch.getManager()) === null || _this$orch$getManager === void 0 ? void 0 : _this$orch$getManager.getCommandManager().executeCommand(command, context));\n  }\n\n  _appCommandPreviewer(command, parameters, message) {\n    var _this$orch$getConvert3, _this$orch$getConvert4, _this$orch$getManager2;\n\n    const user = (_this$orch$getConvert3 = this.orch.getConverters()) === null || _this$orch$getConvert3 === void 0 ? void 0 : _this$orch$getConvert3.get('users').convertById(Meteor.userId());\n    const room = (_this$orch$getConvert4 = this.orch.getConverters()) === null || _this$orch$getConvert4 === void 0 ? void 0 : _this$orch$getConvert4.get('rooms').convertById(message.rid);\n    const threadId = message.tmid;\n    const params = parameters.length === 0 || parameters === ' ' ? [] : parameters.split(' ');\n    const context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params), threadId);\n    return Promise.await((_this$orch$getManager2 = this.orch.getManager()) === null || _this$orch$getManager2 === void 0 ? void 0 : _this$orch$getManager2.getCommandManager().getPreviews(command, context));\n  }\n\n  _appCommandPreviewExecutor(command, parameters, message, preview, triggerId) {\n    return Promise.asyncApply(() => {\n      var _this$orch$getConvert5, _this$orch$getConvert6, _this$orch$getManager3;\n\n      const user = (_this$orch$getConvert5 = this.orch.getConverters()) === null || _this$orch$getConvert5 === void 0 ? void 0 : _this$orch$getConvert5.get('users').convertById(Meteor.userId());\n      const room = (_this$orch$getConvert6 = this.orch.getConverters()) === null || _this$orch$getConvert6 === void 0 ? void 0 : _this$orch$getConvert6.get('rooms').convertById(message.rid);\n      const threadId = message.tmid;\n      const params = parameters.length === 0 || parameters === ' ' ? [] : parameters.split(' ');\n      const context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params), threadId, triggerId);\n      Promise.await((_this$orch$getManager3 = this.orch.getManager()) === null || _this$orch$getManager3 === void 0 ? void 0 : _this$orch$getManager3.getCommandManager().executePreview(command, preview, context));\n    });\n  }\n\n}","map":{"version":3,"sources":["app/apps/server/bridges/commands.ts"],"names":[],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { SlashCommandContext, ISlashCommand, ISlashCommandPreviewItem } from '@rocket.chat/apps-engine/definition/slashcommands';\nimport { CommandBridge } from '@rocket.chat/apps-engine/server/bridges/CommandBridge';\n\nimport { slashCommands } from '../../../utils/server';\nimport { Utilities } from '../../lib/misc/Utilities';\nimport { AppServerOrchestrator } from '../orchestrator';\nimport { IMessage } from '../../../../definition/IMessage';\n\nexport class AppCommandsBridge extends CommandBridge {\n\tdisabledCommands: Map<string, object>;\n\n\t// eslint-disable-next-line no-empty-function\n\tconstructor(private readonly orch: AppServerOrchestrator) {\n\t\tsuper();\n\t\tthis.disabledCommands = new Map();\n\t}\n\n\tprotected doesCommandExist(command: string, appId: string): boolean {\n\t\tthis.orch.debugLog(`The App ${appId} is checking if \"${command}\" command exists.`);\n\n\t\tif (typeof command !== 'string' || command.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\n\t\treturn typeof slashCommands.commands[cmd] === 'object' || this.disabledCommands.has(cmd);\n\t}\n\n\tprotected enableCommand(command: string, appId: string): void {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to enable the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tif (!this.disabledCommands.has(cmd)) {\n\t\t\tthrow new Error(`The command is not currently disabled: \"${cmd}\"`);\n\t\t}\n\n\t\tslashCommands.commands[cmd] = this.disabledCommands.get(cmd);\n\t\tthis.disabledCommands.delete(cmd);\n\n\t\tthis.orch.getNotifier().commandUpdated(cmd);\n\t}\n\n\tprotected disableCommand(command: string, appId: string): void {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to disable the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tif (this.disabledCommands.has(cmd)) {\n\t\t\t// The command is already disabled, no need to disable it yet again\n\t\t\treturn;\n\t\t}\n\n\t\tif (typeof slashCommands.commands[cmd] === 'undefined') {\n\t\t\tthrow new Error(`Command does not exist in the system currently: \"${cmd}\"`);\n\t\t}\n\n\t\tthis.disabledCommands.set(cmd, slashCommands.commands[cmd]);\n\t\tdelete slashCommands.commands[cmd];\n\n\t\tthis.orch.getNotifier().commandDisabled(cmd);\n\t}\n\n\t// command: { command, paramsExample, i18nDescription, executor: function }\n\tprotected modifyCommand(command: ISlashCommand, appId: string): void {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to modify the command: \"${command}\"`);\n\n\t\tthis._verifyCommand(command);\n\n\t\tconst cmd = command.command.toLowerCase();\n\t\tif (typeof slashCommands.commands[cmd] === 'undefined') {\n\t\t\tthrow new Error(`Command does not exist in the system currently (or it is disabled): \"${cmd}\"`);\n\t\t}\n\n\t\tconst item = slashCommands.commands[cmd];\n\n\t\titem.params = command.i18nParamsExample ? command.i18nParamsExample : item.params;\n\t\titem.description = command.i18nDescription ? command.i18nDescription : item.params;\n\t\titem.callback = this._appCommandExecutor.bind(this);\n\t\titem.providesPreview = command.providesPreview;\n\t\titem.previewer = command.previewer ? this._appCommandPreviewer.bind(this) : item.previewer;\n\t\titem.previewCallback = command.executePreviewItem ? this._appCommandPreviewExecutor.bind(this) : item.previewCallback;\n\n\t\tslashCommands.commands[cmd] = item;\n\t\tthis.orch.getNotifier().commandUpdated(cmd);\n\t}\n\n\tprotected registerCommand(command: ISlashCommand, appId: string): void {\n\t\tthis.orch.debugLog(`The App ${appId} is registering the command: \"${command.command}\"`);\n\n\t\tthis._verifyCommand(command);\n\n\t\tconst item = {\n\t\t\tappId,\n\t\t\tcommand: command.command.toLowerCase(),\n\t\t\tparams: Utilities.getI18nKeyForApp(command.i18nParamsExample, appId),\n\t\t\tdescription: Utilities.getI18nKeyForApp(command.i18nDescription, appId),\n\t\t\tpermission: command.permission,\n\t\t\tcallback: this._appCommandExecutor.bind(this),\n\t\t\tprovidesPreview: command.providesPreview,\n\t\t\tpreviewer: !command.previewer ? undefined : this._appCommandPreviewer.bind(this),\n\t\t\tpreviewCallback: !command.executePreviewItem ? undefined : this._appCommandPreviewExecutor.bind(this),\n\t\t};\n\n\t\tslashCommands.commands[command.command.toLowerCase()] = item;\n\t\tthis.orch.getNotifier().commandAdded(command.command.toLowerCase());\n\t}\n\n\tprotected unregisterCommand(command: string, appId: string): void {\n\t\tthis.orch.debugLog(`The App ${appId} is unregistering the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tthis.disabledCommands.delete(cmd);\n\t\tdelete slashCommands.commands[cmd];\n\n\t\tthis.orch.getNotifier().commandRemoved(cmd);\n\t}\n\n\tprivate _verifyCommand(command: ISlashCommand): void {\n\t\tif (typeof command !== 'object') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.command !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (command.i18nParamsExample && typeof command.i18nParamsExample !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (command.i18nDescription && typeof command.i18nDescription !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.providesPreview !== 'boolean') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.executor !== 'function') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\t}\n\n\tprivate _appCommandExecutor(command: string, parameters: any, message: IMessage, triggerId: string): void {\n\t\tconst user = this.orch.getConverters()?.get('users').convertById(Meteor.userId());\n\t\tconst room = this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst params = parameters.length === 0 || parameters === ' ' ? [] : parameters.split(' ');\n\n\t\tconst context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params), threadId, triggerId);\n\n\t\tPromise.await(this.orch.getManager()?.getCommandManager().executeCommand(command, context));\n\t}\n\n\tprivate _appCommandPreviewer(command: string, parameters: any, message: IMessage): any {\n\t\tconst user = this.orch.getConverters()?.get('users').convertById(Meteor.userId());\n\t\tconst room = this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst params = parameters.length === 0 || parameters === ' ' ? [] : parameters.split(' ');\n\n\t\tconst context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params), threadId);\n\t\treturn Promise.await(this.orch.getManager()?.getCommandManager().getPreviews(command, context));\n\t}\n\n\tprivate async _appCommandPreviewExecutor(\n\t\tcommand: string,\n\t\tparameters: any,\n\t\tmessage: IMessage,\n\t\tpreview: ISlashCommandPreviewItem,\n\t\ttriggerId: string,\n\t): Promise<void> {\n\t\tconst user = this.orch.getConverters()?.get('users').convertById(Meteor.userId());\n\t\tconst room = this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst params = parameters.length === 0 || parameters === ' ' ? [] : parameters.split(' ');\n\n\t\tconst context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params), threadId, triggerId);\n\n\t\tPromise.await(this.orch.getManager()?.getCommandManager().executePreview(command, preview, context));\n\t}\n}\n"],"sourceRoot":""},"sourceType":"module","hash":"48da78451ed15fb745b3df45b2cedeaf4ce1e216"}
