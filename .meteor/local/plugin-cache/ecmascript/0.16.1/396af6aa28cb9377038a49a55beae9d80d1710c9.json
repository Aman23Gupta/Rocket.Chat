{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/ui-utils/client/lib/menu.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui-utils/client/lib/menu.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/ui-utils/client/lib/menu.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/ui-utils/client/lib/menu.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-utils/client/lib/menu.js"}},"code":"module.export({\n  menu: () => menu\n});\nlet Session;\nmodule.link(\"meteor/session\", {\n  Session(v) {\n    Session = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 1);\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 2);\nlet Emitter;\nmodule.link(\"@rocket.chat/emitter\", {\n  Emitter(v) {\n    Emitter = v;\n  }\n\n}, 3);\nlet isRtl;\nmodule.link(\"../../../utils\", {\n  isRtl(v) {\n    isRtl = v;\n  }\n\n}, 4);\nconst sideNavW = 280;\n\nconst map = (x, in_min, in_max, out_min, out_max) => (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;\n\nconst menu = new class extends Emitter {\n  constructor() {\n    super();\n    this._open = false;\n    this.updateUnreadBars = _.throttle(() => {\n      if (this.list == null) {\n        return;\n      }\n\n      const listOffset = this.list.offset();\n      const listHeight = this.list.height();\n      let showTop = false;\n      let showBottom = false;\n      $('li.sidebar-item--unread').each(function () {\n        if ($(this).offset().top < listOffset.top - $(this).height()) {\n          showTop = true;\n        }\n\n        if ($(this).offset().top > listOffset.top + listHeight) {\n          showBottom = true;\n        }\n      });\n\n      if (showTop === true) {\n        $('.top-unread-rooms').removeClass('hidden');\n      } else {\n        $('.top-unread-rooms').addClass('hidden');\n      }\n\n      if (showBottom === true) {\n        return $('.bottom-unread-rooms').removeClass('hidden');\n      }\n\n      return $('.bottom-unread-rooms').addClass('hidden');\n    }, 200);\n    this.sideNavW = sideNavW;\n  }\n\n  get isRtl() {\n    return isRtl(Meteor._localStorage.getItem('userLanguage'));\n  }\n\n  touchstart(e) {\n    this.movestarted = false;\n    this.blockmove = false;\n    this.touchstartX = undefined;\n    this.touchstartY = undefined;\n    this.diff = 0;\n\n    if (e.target === this.sidebarWrap[0] || $(e.target).closest('.main-content').length > 0) {\n      this.closePopover();\n      this.touchstartX = e.touches[0].clientX;\n      this.touchstartY = e.touches[0].clientY;\n      this.mainContent = $('.main-content');\n    }\n  }\n\n  touchmove(e) {\n    if (this.touchstartX == null) {\n      return;\n    }\n\n    const [touch] = e.touches;\n    const diffX = touch.clientX - this.touchstartX;\n    const diffY = touch.clientY - this.touchstartY;\n    const absX = Math.abs(diffX);\n    const absY = Math.abs(diffY);\n\n    if (!this.movestarted && absY > 5) {\n      this.blockmove = true;\n    }\n\n    if (this.blockmove) {\n      return;\n    }\n\n    this.sidebar.css('transition', 'none');\n    this.sidebarWrap.css('transition', 'none');\n\n    if (this.movestarted === true || absX > 5) {\n      this.movestarted = true;\n\n      if (this.isRtl) {\n        if (this.isOpen()) {\n          this.diff = -sideNavW + diffX;\n        } else {\n          this.diff = diffX;\n        }\n\n        if (this.diff < -sideNavW) {\n          this.diff = -sideNavW;\n        }\n\n        if (this.diff > 0) {\n          this.diff = 0;\n        }\n      } else {\n        if (this.isOpen()) {\n          this.diff = sideNavW + diffX;\n        } else {\n          this.diff = diffX;\n        }\n\n        if (this.diff > sideNavW) {\n          this.diff = sideNavW;\n        }\n\n        if (this.diff < 0) {\n          this.diff = 0;\n        }\n      } // if (map((this.diff / sideNavW), 0, 1, -.1, .8) > 0) {\n\n\n      this.sidebar.css('box-shadow', '0 0 15px 1px rgba(0,0,0,.3)'); // this.sidebarWrap.css('z-index', '9998');\n\n      this.translate(this.diff); // }\n    }\n  }\n\n  translate(diff) {\n    let width = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : sideNavW;\n\n    if (diff === undefined) {\n      diff = this.isRtl ? -1 * sideNavW : sideNavW;\n    }\n\n    this.sidebarWrap.css('width', '100%');\n    this.wrapper.css('overflow', 'hidden');\n    this.sidebarWrap.css('background-color', '#000');\n    this.sidebarWrap.css('opacity', map(Math.abs(diff) / width, 0, 1, -0.1, 0.8).toFixed(2));\n    this.isRtl ? this.sidebar.css('transform', \"translate3d(\".concat((sideNavW + diff).toFixed(3), \"px, 0 , 0)\")) : this.sidebar.css('transform', \"translate3d(\".concat((diff - sideNavW).toFixed(3), \"px, 0 , 0)\"));\n  }\n\n  touchend() {\n    const [max, min] = [sideNavW * 0.76, sideNavW * 0.24];\n\n    if (this.movestarted !== true) {\n      return;\n    }\n\n    this.movestarted = false;\n\n    if (this.isRtl) {\n      if (this.isOpen()) {\n        return this.diff >= -max ? this.close() : this.open();\n      }\n\n      if (this.diff <= -min) {\n        return this.open();\n      }\n\n      return this.close();\n    }\n\n    if (this.isOpen()) {\n      if (this.diff >= max) {\n        return this.open();\n      }\n\n      return this.close();\n    }\n\n    if (this.diff >= min) {\n      return this.open();\n    }\n\n    return this.close();\n  }\n\n  init() {\n    this.menu = $('.sidebar');\n    this.sidebar = this.menu;\n    this.sidebarWrap = $('.sidebar-wrap');\n    this.wrapper = $('.messages-box > .wrapper');\n\n    const ignore = fn => event => document.body.clientWidth <= 780 && fn(event);\n\n    document.body.addEventListener('touchstart', ignore(e => this.touchstart(e)));\n    document.body.addEventListener('touchmove', ignore(e => this.touchmove(e)));\n    document.body.addEventListener('touchend', ignore(e => this.touchend(e)));\n    this.sidebarWrap.on('click', ignore(e => {\n      e.target === this.sidebarWrap[0] && this.isOpen() && this.emit('clickOut', e);\n    }));\n    this.on('close', () => {\n      this.sidebarWrap.css('width', ''); // this.sidebarWrap.css('z-index', '');\n\n      this.sidebarWrap.css('background-color', '');\n      this.sidebar.css('transform', '');\n      this.sidebar.css('box-shadow', '');\n      this.sidebar.css('transition', '');\n      this.sidebarWrap.css('transition', '');\n      this.wrapper && this.wrapper.css('overflow', '');\n    });\n    this.on('open', ignore(() => {\n      this.sidebar.css('box-shadow', '0 0 15px 1px rgba(0,0,0,.3)'); // this.sidebarWrap.css('z-index', '9998');\n\n      this.translate();\n    }));\n    this.mainContent = $('.main-content');\n    this.list = $('.rooms-list');\n    this._open = false;\n    Session.set('isMenuOpen', this._open);\n  }\n\n  closePopover() {\n    return this.menu.find('[data-popover=\"anchor\"]:checked').prop('checked', false).length > 0;\n  }\n\n  isOpen() {\n    return Session.get('isMenuOpen');\n  }\n\n  open() {\n    this._open = true;\n    Session.set('isMenuOpen', this._open);\n    this.emit('open');\n  }\n\n  close() {\n    this._open = false;\n    Session.set('isMenuOpen', this._open);\n    this.emit('close');\n  }\n\n  toggle() {\n    return this.isOpen() ? this.close() : this.open();\n  }\n\n}();\nlet passClosePopover = false;\nmenu.on('clickOut', function () {\n  if (!menu.closePopover()) {\n    passClosePopover = true;\n    menu.close();\n  }\n});\nmenu.on('close', function () {\n  if (!menu.sidebar) {\n    return;\n  }\n\n  menu.sidebar.css('transition', '');\n  menu.sidebarWrap.css('transition', '');\n\n  if (passClosePopover) {\n    passClosePopover = false;\n    return;\n  }\n\n  menu.closePopover();\n});","map":{"version":3,"sources":["app/ui-utils/client/lib/menu.js"],"names":["module","export","menu","Session","link","v","Meteor","_","default","Emitter","isRtl","sideNavW","map","x","in_min","in_max","out_min","out_max","constructor","_open","updateUnreadBars","throttle","list","listOffset","offset","listHeight","height","showTop","showBottom","$","each","top","removeClass","addClass","_localStorage","getItem","touchstart","e","movestarted","blockmove","touchstartX","undefined","touchstartY","diff","target","sidebarWrap","closest","length","closePopover","touches","clientX","clientY","mainContent","touchmove","touch","diffX","diffY","absX","Math","abs","absY","sidebar","css","isOpen","translate","width","wrapper","toFixed","touchend","max","min","close","open","init","ignore","fn","event","document","body","clientWidth","addEventListener","on","emit","set","find","prop","get","toggle","passClosePopover"],"mappings":"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","sourcesContent":["import { Session } from 'meteor/session';\nimport { Meteor } from 'meteor/meteor';\nimport _ from 'underscore';\nimport { Emitter } from '@rocket.chat/emitter';\n\nimport { isRtl } from '../../../utils';\n\nconst sideNavW = 280;\nconst map = (x, in_min, in_max, out_min, out_max) => ((x - in_min) * (out_max - out_min)) / (in_max - in_min) + out_min;\n\nexport const menu = new (class extends Emitter {\n\tconstructor() {\n\t\tsuper();\n\t\tthis._open = false;\n\t\tthis.updateUnreadBars = _.throttle(() => {\n\t\t\tif (this.list == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst listOffset = this.list.offset();\n\t\t\tconst listHeight = this.list.height();\n\t\t\tlet showTop = false;\n\t\t\tlet showBottom = false;\n\t\t\t$('li.sidebar-item--unread').each(function () {\n\t\t\t\tif ($(this).offset().top < listOffset.top - $(this).height()) {\n\t\t\t\t\tshowTop = true;\n\t\t\t\t}\n\t\t\t\tif ($(this).offset().top > listOffset.top + listHeight) {\n\t\t\t\t\tshowBottom = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (showTop === true) {\n\t\t\t\t$('.top-unread-rooms').removeClass('hidden');\n\t\t\t} else {\n\t\t\t\t$('.top-unread-rooms').addClass('hidden');\n\t\t\t}\n\t\t\tif (showBottom === true) {\n\t\t\t\treturn $('.bottom-unread-rooms').removeClass('hidden');\n\t\t\t}\n\t\t\treturn $('.bottom-unread-rooms').addClass('hidden');\n\t\t}, 200);\n\t\tthis.sideNavW = sideNavW;\n\t}\n\n\tget isRtl() {\n\t\treturn isRtl(Meteor._localStorage.getItem('userLanguage'));\n\t}\n\n\ttouchstart(e) {\n\t\tthis.movestarted = false;\n\t\tthis.blockmove = false;\n\t\tthis.touchstartX = undefined;\n\t\tthis.touchstartY = undefined;\n\t\tthis.diff = 0;\n\t\tif (e.target === this.sidebarWrap[0] || $(e.target).closest('.main-content').length > 0) {\n\t\t\tthis.closePopover();\n\t\t\tthis.touchstartX = e.touches[0].clientX;\n\t\t\tthis.touchstartY = e.touches[0].clientY;\n\t\t\tthis.mainContent = $('.main-content');\n\t\t}\n\t}\n\n\ttouchmove(e) {\n\t\tif (this.touchstartX == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst [touch] = e.touches;\n\t\tconst diffX = touch.clientX - this.touchstartX;\n\t\tconst diffY = touch.clientY - this.touchstartY;\n\t\tconst absX = Math.abs(diffX);\n\t\tconst absY = Math.abs(diffY);\n\n\t\tif (!this.movestarted && absY > 5) {\n\t\t\tthis.blockmove = true;\n\t\t}\n\t\tif (this.blockmove) {\n\t\t\treturn;\n\t\t}\n\t\tthis.sidebar.css('transition', 'none');\n\t\tthis.sidebarWrap.css('transition', 'none');\n\t\tif (this.movestarted === true || absX > 5) {\n\t\t\tthis.movestarted = true;\n\t\t\tif (this.isRtl) {\n\t\t\t\tif (this.isOpen()) {\n\t\t\t\t\tthis.diff = -sideNavW + diffX;\n\t\t\t\t} else {\n\t\t\t\t\tthis.diff = diffX;\n\t\t\t\t}\n\t\t\t\tif (this.diff < -sideNavW) {\n\t\t\t\t\tthis.diff = -sideNavW;\n\t\t\t\t}\n\t\t\t\tif (this.diff > 0) {\n\t\t\t\t\tthis.diff = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.isOpen()) {\n\t\t\t\t\tthis.diff = sideNavW + diffX;\n\t\t\t\t} else {\n\t\t\t\t\tthis.diff = diffX;\n\t\t\t\t}\n\t\t\t\tif (this.diff > sideNavW) {\n\t\t\t\t\tthis.diff = sideNavW;\n\t\t\t\t}\n\t\t\t\tif (this.diff < 0) {\n\t\t\t\t\tthis.diff = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// if (map((this.diff / sideNavW), 0, 1, -.1, .8) > 0) {\n\t\t\tthis.sidebar.css('box-shadow', '0 0 15px 1px rgba(0,0,0,.3)');\n\t\t\t// this.sidebarWrap.css('z-index', '9998');\n\t\t\tthis.translate(this.diff);\n\t\t\t// }\n\t\t}\n\t}\n\n\ttranslate(diff, width = sideNavW) {\n\t\tif (diff === undefined) {\n\t\t\tdiff = this.isRtl ? -1 * sideNavW : sideNavW;\n\t\t}\n\t\tthis.sidebarWrap.css('width', '100%');\n\t\tthis.wrapper.css('overflow', 'hidden');\n\t\tthis.sidebarWrap.css('background-color', '#000');\n\t\tthis.sidebarWrap.css('opacity', map(Math.abs(diff) / width, 0, 1, -0.1, 0.8).toFixed(2));\n\t\tthis.isRtl\n\t\t\t? this.sidebar.css('transform', `translate3d(${(sideNavW + diff).toFixed(3)}px, 0 , 0)`)\n\t\t\t: this.sidebar.css('transform', `translate3d(${(diff - sideNavW).toFixed(3)}px, 0 , 0)`);\n\t}\n\n\ttouchend() {\n\t\tconst [max, min] = [sideNavW * 0.76, sideNavW * 0.24];\n\t\tif (this.movestarted !== true) {\n\t\t\treturn;\n\t\t}\n\t\tthis.movestarted = false;\n\t\tif (this.isRtl) {\n\t\t\tif (this.isOpen()) {\n\t\t\t\treturn this.diff >= -max ? this.close() : this.open();\n\t\t\t}\n\t\t\tif (this.diff <= -min) {\n\t\t\t\treturn this.open();\n\t\t\t}\n\t\t\treturn this.close();\n\t\t}\n\t\tif (this.isOpen()) {\n\t\t\tif (this.diff >= max) {\n\t\t\t\treturn this.open();\n\t\t\t}\n\t\t\treturn this.close();\n\t\t}\n\t\tif (this.diff >= min) {\n\t\t\treturn this.open();\n\t\t}\n\t\treturn this.close();\n\t}\n\n\tinit() {\n\t\tthis.menu = $('.sidebar');\n\t\tthis.sidebar = this.menu;\n\t\tthis.sidebarWrap = $('.sidebar-wrap');\n\t\tthis.wrapper = $('.messages-box > .wrapper');\n\t\tconst ignore = (fn) => (event) => document.body.clientWidth <= 780 && fn(event);\n\n\t\tdocument.body.addEventListener(\n\t\t\t'touchstart',\n\t\t\tignore((e) => this.touchstart(e)),\n\t\t);\n\t\tdocument.body.addEventListener(\n\t\t\t'touchmove',\n\t\t\tignore((e) => this.touchmove(e)),\n\t\t);\n\t\tdocument.body.addEventListener(\n\t\t\t'touchend',\n\t\t\tignore((e) => this.touchend(e)),\n\t\t);\n\t\tthis.sidebarWrap.on(\n\t\t\t'click',\n\t\t\tignore((e) => {\n\t\t\t\te.target === this.sidebarWrap[0] && this.isOpen() && this.emit('clickOut', e);\n\t\t\t}),\n\t\t);\n\t\tthis.on('close', () => {\n\t\t\tthis.sidebarWrap.css('width', '');\n\t\t\t// this.sidebarWrap.css('z-index', '');\n\t\t\tthis.sidebarWrap.css('background-color', '');\n\t\t\tthis.sidebar.css('transform', '');\n\t\t\tthis.sidebar.css('box-shadow', '');\n\t\t\tthis.sidebar.css('transition', '');\n\t\t\tthis.sidebarWrap.css('transition', '');\n\t\t\tthis.wrapper && this.wrapper.css('overflow', '');\n\t\t});\n\t\tthis.on(\n\t\t\t'open',\n\t\t\tignore(() => {\n\t\t\t\tthis.sidebar.css('box-shadow', '0 0 15px 1px rgba(0,0,0,.3)');\n\t\t\t\t// this.sidebarWrap.css('z-index', '9998');\n\t\t\t\tthis.translate();\n\t\t\t}),\n\t\t);\n\t\tthis.mainContent = $('.main-content');\n\n\t\tthis.list = $('.rooms-list');\n\t\tthis._open = false;\n\t\tSession.set('isMenuOpen', this._open);\n\t}\n\n\tclosePopover() {\n\t\treturn this.menu.find('[data-popover=\"anchor\"]:checked').prop('checked', false).length > 0;\n\t}\n\n\tisOpen() {\n\t\treturn Session.get('isMenuOpen');\n\t}\n\n\topen() {\n\t\tthis._open = true;\n\t\tSession.set('isMenuOpen', this._open);\n\t\tthis.emit('open');\n\t}\n\n\tclose() {\n\t\tthis._open = false;\n\t\tSession.set('isMenuOpen', this._open);\n\t\tthis.emit('close');\n\t}\n\n\ttoggle() {\n\t\treturn this.isOpen() ? this.close() : this.open();\n\t}\n})();\n\nlet passClosePopover = false;\n\nmenu.on('clickOut', function () {\n\tif (!menu.closePopover()) {\n\t\tpassClosePopover = true;\n\t\tmenu.close();\n\t}\n});\n\nmenu.on('close', function () {\n\tif (!menu.sidebar) {\n\t\treturn;\n\t}\n\n\tmenu.sidebar.css('transition', '');\n\tmenu.sidebarWrap.css('transition', '');\n\tif (passClosePopover) {\n\t\tpassClosePopover = false;\n\t\treturn;\n\t}\n\tmenu.closePopover();\n});\n"]},"sourceType":"module","hash":"396af6aa28cb9377038a49a55beae9d80d1710c9"}
