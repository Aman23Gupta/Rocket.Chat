{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/livechat/server/methods/getInitialData.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/livechat/server/methods/getInitialData.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/livechat/server/methods/getInitialData.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/livechat/server/methods/getInitialData.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/livechat/server/methods/getInitialData.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 1);\nlet LivechatRooms, Users, LivechatDepartment, LivechatVisitors;\nmodule.link(\"../../../models/server\", {\n  LivechatRooms(v) {\n    LivechatRooms = v;\n  },\n\n  Users(v) {\n    Users = v;\n  },\n\n  LivechatDepartment(v) {\n    LivechatDepartment = v;\n  },\n\n  LivechatVisitors(v) {\n    LivechatVisitors = v;\n  }\n\n}, 2);\nlet LivechatTrigger;\nmodule.link(\"../../../models/server/raw\", {\n  LivechatTrigger(v) {\n    LivechatTrigger = v;\n  }\n\n}, 3);\nlet Livechat;\nmodule.link(\"../lib/Livechat\", {\n  Livechat(v) {\n    Livechat = v;\n  }\n\n}, 4);\nlet deprecationWarning;\nmodule.link(\"../../../api/server/helpers/deprecationWarning\", {\n  deprecationWarning(v) {\n    deprecationWarning = v;\n  }\n\n}, 5);\nMeteor.methods({\n  'livechat:getInitialData'(visitorToken, departmentId) {\n    return Promise.asyncApply(() => {\n      const info = {\n        enabled: null,\n        title: null,\n        color: null,\n        registrationForm: null,\n        room: null,\n        visitor: null,\n        triggers: [],\n        departments: [],\n        allowSwitchingDepartments: null,\n        online: true,\n        offlineColor: null,\n        offlineMessage: null,\n        offlineSuccessMessage: null,\n        offlineUnavailableMessage: null,\n        displayOfflineForm: null,\n        videoCall: null,\n        fileUpload: null,\n        conversationFinishedMessage: null,\n        conversationFinishedText: null,\n        nameFieldRegistrationForm: null,\n        emailFieldRegistrationForm: null,\n        registrationFormMessage: null,\n        showConnecting: false\n      };\n      const options = {\n        fields: {\n          name: 1,\n          t: 1,\n          cl: 1,\n          u: 1,\n          usernames: 1,\n          v: 1,\n          servedBy: 1,\n          departmentId: 1\n        }\n      };\n      const room = departmentId ? LivechatRooms.findOpenByVisitorTokenAndDepartmentId(visitorToken, departmentId, options).fetch() : LivechatRooms.findOpenByVisitorToken(visitorToken, options).fetch();\n\n      if (room && room.length > 0) {\n        info.room = room[0];\n      }\n\n      const visitor = LivechatVisitors.getVisitorByToken(visitorToken, {\n        fields: {\n          name: 1,\n          username: 1,\n          visitorEmails: 1,\n          department: 1\n        }\n      });\n\n      if (room) {\n        info.visitor = visitor;\n      }\n\n      const initSettings = Livechat.getInitSettings();\n      info.title = initSettings.Livechat_title;\n      info.color = initSettings.Livechat_title_color;\n      info.enabled = initSettings.Livechat_enabled;\n      info.registrationForm = initSettings.Livechat_registration_form;\n      info.offlineTitle = initSettings.Livechat_offline_title;\n      info.offlineColor = initSettings.Livechat_offline_title_color;\n      info.offlineMessage = initSettings.Livechat_offline_message;\n      info.offlineSuccessMessage = initSettings.Livechat_offline_success_message;\n      info.offlineUnavailableMessage = initSettings.Livechat_offline_form_unavailable;\n      info.displayOfflineForm = initSettings.Livechat_display_offline_form;\n      info.language = initSettings.Language;\n      info.videoCall = initSettings.Omnichannel_call_provider === 'Jitsi' && initSettings.Jitsi_Enabled === true;\n      info.fileUpload = initSettings.Livechat_fileupload_enabled && initSettings.FileUpload_Enabled;\n      info.transcript = initSettings.Livechat_enable_transcript;\n      info.transcriptMessage = initSettings.Livechat_transcript_message;\n      info.conversationFinishedMessage = initSettings.Livechat_conversation_finished_message;\n      info.conversationFinishedText = initSettings.Livechat_conversation_finished_text;\n      info.nameFieldRegistrationForm = initSettings.Livechat_name_field_registration_form;\n      info.emailFieldRegistrationForm = initSettings.Livechat_email_field_registration_form;\n      info.registrationFormMessage = initSettings.Livechat_registration_form_message;\n      info.showConnecting = initSettings.Livechat_Show_Connecting;\n      info.agentData = room && room[0] && room[0].servedBy && Users.getAgentInfo(room[0].servedBy._id);\n      Promise.await(LivechatTrigger.findEnabled().forEach(trigger => {\n        info.triggers.push(_.pick(trigger, '_id', 'actions', 'conditions', 'runOnce'));\n      }));\n      LivechatDepartment.findEnabledWithAgents().forEach(department => {\n        info.departments.push(department);\n      });\n      info.allowSwitchingDepartments = initSettings.Livechat_allow_switching_departments;\n      info.online = Users.findOnlineAgents().count() > 0;\n      return deprecationWarning({\n        endpoint: 'livechat:getInitialData',\n        versionWillBeRemoved: '5.0',\n        response: info\n      });\n    });\n  }\n\n});","map":{"version":3,"sources":["app/livechat/server/methods/getInitialData.js"],"names":["Meteor","module","link","v","_","default","LivechatRooms","Users","LivechatDepartment","LivechatVisitors","LivechatTrigger","Livechat","deprecationWarning","methods","visitorToken","departmentId","info","enabled","title","color","registrationForm","room","visitor","triggers","departments","allowSwitchingDepartments","online","offlineColor","offlineMessage","offlineSuccessMessage","offlineUnavailableMessage","displayOfflineForm","videoCall","fileUpload","conversationFinishedMessage","conversationFinishedText","nameFieldRegistrationForm","emailFieldRegistrationForm","registrationFormMessage","showConnecting","options","fields","name","t","cl","u","usernames","servedBy","findOpenByVisitorTokenAndDepartmentId","fetch","findOpenByVisitorToken","length","getVisitorByToken","username","visitorEmails","department","initSettings","getInitSettings","Livechat_title","Livechat_title_color","Livechat_enabled","Livechat_registration_form","offlineTitle","Livechat_offline_title","Livechat_offline_title_color","Livechat_offline_message","Livechat_offline_success_message","Livechat_offline_form_unavailable","Livechat_display_offline_form","language","Language","Omnichannel_call_provider","Jitsi_Enabled","Livechat_fileupload_enabled","FileUpload_Enabled","transcript","Livechat_enable_transcript","transcriptMessage","Livechat_transcript_message","Livechat_conversation_finished_message","Livechat_conversation_finished_text","Livechat_name_field_registration_form","Livechat_email_field_registration_form","Livechat_registration_form_message","Livechat_Show_Connecting","agentData","getAgentInfo","_id","findEnabled","forEach","trigger","push","pick","findEnabledWithAgents","Livechat_allow_switching_departments","findOnlineAgents","count","endpoint","versionWillBeRemoved","response"],"mappings":"AAAA,IAAIA,MAAJ;AAAWC,MAAM,CAACC,IAAP,CAAY,eAAZ,EAA4B;AAACF,EAAAA,MAAM,CAACG,CAAD,EAAG;AAACH,IAAAA,MAAM,GAACG,CAAP;AAAS;;AAApB,CAA5B,EAAkD,CAAlD;;AAAqD,IAAIC,CAAJ;;AAAMH,MAAM,CAACC,IAAP,CAAY,YAAZ,EAAyB;AAACG,EAAAA,OAAO,CAACF,CAAD,EAAG;AAACC,IAAAA,CAAC,GAACD,CAAF;AAAI;;AAAhB,CAAzB,EAA2C,CAA3C;AAA8C,IAAIG,aAAJ,EAAkBC,KAAlB,EAAwBC,kBAAxB,EAA2CC,gBAA3C;AAA4DR,MAAM,CAACC,IAAP,CAAY,wBAAZ,EAAqC;AAACI,EAAAA,aAAa,CAACH,CAAD,EAAG;AAACG,IAAAA,aAAa,GAACH,CAAd;AAAgB,GAAlC;;AAAmCI,EAAAA,KAAK,CAACJ,CAAD,EAAG;AAACI,IAAAA,KAAK,GAACJ,CAAN;AAAQ,GAApD;;AAAqDK,EAAAA,kBAAkB,CAACL,CAAD,EAAG;AAACK,IAAAA,kBAAkB,GAACL,CAAnB;AAAqB,GAAhG;;AAAiGM,EAAAA,gBAAgB,CAACN,CAAD,EAAG;AAACM,IAAAA,gBAAgB,GAACN,CAAjB;AAAmB;;AAAxI,CAArC,EAA+K,CAA/K;AAAkL,IAAIO,eAAJ;AAAoBT,MAAM,CAACC,IAAP,CAAY,4BAAZ,EAAyC;AAACQ,EAAAA,eAAe,CAACP,CAAD,EAAG;AAACO,IAAAA,eAAe,GAACP,CAAhB;AAAkB;;AAAtC,CAAzC,EAAiF,CAAjF;AAAoF,IAAIQ,QAAJ;AAAaV,MAAM,CAACC,IAAP,CAAY,iBAAZ,EAA8B;AAACS,EAAAA,QAAQ,CAACR,CAAD,EAAG;AAACQ,IAAAA,QAAQ,GAACR,CAAT;AAAW;;AAAxB,CAA9B,EAAwD,CAAxD;AAA2D,IAAIS,kBAAJ;AAAuBX,MAAM,CAACC,IAAP,CAAY,gDAAZ,EAA6D;AAACU,EAAAA,kBAAkB,CAACT,CAAD,EAAG;AAACS,IAAAA,kBAAkB,GAACT,CAAnB;AAAqB;;AAA5C,CAA7D,EAA2G,CAA3G;AAQziBH,MAAM,CAACa,OAAP,CAAe;AACR,2BAAN,CAAgCC,YAAhC,EAA8CC,YAA9C;AAAA,oCAA4D;AAC3D,YAAMC,IAAI,GAAG;AACZC,QAAAA,OAAO,EAAE,IADG;AAEZC,QAAAA,KAAK,EAAE,IAFK;AAGZC,QAAAA,KAAK,EAAE,IAHK;AAIZC,QAAAA,gBAAgB,EAAE,IAJN;AAKZC,QAAAA,IAAI,EAAE,IALM;AAMZC,QAAAA,OAAO,EAAE,IANG;AAOZC,QAAAA,QAAQ,EAAE,EAPE;AAQZC,QAAAA,WAAW,EAAE,EARD;AASZC,QAAAA,yBAAyB,EAAE,IATf;AAUZC,QAAAA,MAAM,EAAE,IAVI;AAWZC,QAAAA,YAAY,EAAE,IAXF;AAYZC,QAAAA,cAAc,EAAE,IAZJ;AAaZC,QAAAA,qBAAqB,EAAE,IAbX;AAcZC,QAAAA,yBAAyB,EAAE,IAdf;AAeZC,QAAAA,kBAAkB,EAAE,IAfR;AAgBZC,QAAAA,SAAS,EAAE,IAhBC;AAiBZC,QAAAA,UAAU,EAAE,IAjBA;AAkBZC,QAAAA,2BAA2B,EAAE,IAlBjB;AAmBZC,QAAAA,wBAAwB,EAAE,IAnBd;AAoBZC,QAAAA,yBAAyB,EAAE,IApBf;AAqBZC,QAAAA,0BAA0B,EAAE,IArBhB;AAsBZC,QAAAA,uBAAuB,EAAE,IAtBb;AAuBZC,QAAAA,cAAc,EAAE;AAvBJ,OAAb;AA0BA,YAAMC,OAAO,GAAG;AACfC,QAAAA,MAAM,EAAE;AACPC,UAAAA,IAAI,EAAE,CADC;AAEPC,UAAAA,CAAC,EAAE,CAFI;AAGPC,UAAAA,EAAE,EAAE,CAHG;AAIPC,UAAAA,CAAC,EAAE,CAJI;AAKPC,UAAAA,SAAS,EAAE,CALJ;AAMP3C,UAAAA,CAAC,EAAE,CANI;AAOP4C,UAAAA,QAAQ,EAAE,CAPH;AAQPhC,UAAAA,YAAY,EAAE;AARP;AADO,OAAhB;AAYA,YAAMM,IAAI,GAAGN,YAAY,GACtBT,aAAa,CAAC0C,qCAAd,CAAoDlC,YAApD,EAAkEC,YAAlE,EAAgFyB,OAAhF,EAAyFS,KAAzF,EADsB,GAEtB3C,aAAa,CAAC4C,sBAAd,CAAqCpC,YAArC,EAAmD0B,OAAnD,EAA4DS,KAA5D,EAFH;;AAGA,UAAI5B,IAAI,IAAIA,IAAI,CAAC8B,MAAL,GAAc,CAA1B,EAA6B;AAC5BnC,QAAAA,IAAI,CAACK,IAAL,GAAYA,IAAI,CAAC,CAAD,CAAhB;AACA;;AAED,YAAMC,OAAO,GAAGb,gBAAgB,CAAC2C,iBAAjB,CAAmCtC,YAAnC,EAAiD;AAChE2B,QAAAA,MAAM,EAAE;AACPC,UAAAA,IAAI,EAAE,CADC;AAEPW,UAAAA,QAAQ,EAAE,CAFH;AAGPC,UAAAA,aAAa,EAAE,CAHR;AAIPC,UAAAA,UAAU,EAAE;AAJL;AADwD,OAAjD,CAAhB;;AASA,UAAIlC,IAAJ,EAAU;AACTL,QAAAA,IAAI,CAACM,OAAL,GAAeA,OAAf;AACA;;AAED,YAAMkC,YAAY,GAAG7C,QAAQ,CAAC8C,eAAT,EAArB;AAEAzC,MAAAA,IAAI,CAACE,KAAL,GAAasC,YAAY,CAACE,cAA1B;AACA1C,MAAAA,IAAI,CAACG,KAAL,GAAaqC,YAAY,CAACG,oBAA1B;AACA3C,MAAAA,IAAI,CAACC,OAAL,GAAeuC,YAAY,CAACI,gBAA5B;AACA5C,MAAAA,IAAI,CAACI,gBAAL,GAAwBoC,YAAY,CAACK,0BAArC;AACA7C,MAAAA,IAAI,CAAC8C,YAAL,GAAoBN,YAAY,CAACO,sBAAjC;AACA/C,MAAAA,IAAI,CAACW,YAAL,GAAoB6B,YAAY,CAACQ,4BAAjC;AACAhD,MAAAA,IAAI,CAACY,cAAL,GAAsB4B,YAAY,CAACS,wBAAnC;AACAjD,MAAAA,IAAI,CAACa,qBAAL,GAA6B2B,YAAY,CAACU,gCAA1C;AACAlD,MAAAA,IAAI,CAACc,yBAAL,GAAiC0B,YAAY,CAACW,iCAA9C;AACAnD,MAAAA,IAAI,CAACe,kBAAL,GAA0ByB,YAAY,CAACY,6BAAvC;AACApD,MAAAA,IAAI,CAACqD,QAAL,GAAgBb,YAAY,CAACc,QAA7B;AACAtD,MAAAA,IAAI,CAACgB,SAAL,GAAiBwB,YAAY,CAACe,yBAAb,KAA2C,OAA3C,IAAsDf,YAAY,CAACgB,aAAb,KAA+B,IAAtG;AACAxD,MAAAA,IAAI,CAACiB,UAAL,GAAkBuB,YAAY,CAACiB,2BAAb,IAA4CjB,YAAY,CAACkB,kBAA3E;AACA1D,MAAAA,IAAI,CAAC2D,UAAL,GAAkBnB,YAAY,CAACoB,0BAA/B;AACA5D,MAAAA,IAAI,CAAC6D,iBAAL,GAAyBrB,YAAY,CAACsB,2BAAtC;AACA9D,MAAAA,IAAI,CAACkB,2BAAL,GAAmCsB,YAAY,CAACuB,sCAAhD;AACA/D,MAAAA,IAAI,CAACmB,wBAAL,GAAgCqB,YAAY,CAACwB,mCAA7C;AACAhE,MAAAA,IAAI,CAACoB,yBAAL,GAAiCoB,YAAY,CAACyB,qCAA9C;AACAjE,MAAAA,IAAI,CAACqB,0BAAL,GAAkCmB,YAAY,CAAC0B,sCAA/C;AACAlE,MAAAA,IAAI,CAACsB,uBAAL,GAA+BkB,YAAY,CAAC2B,kCAA5C;AACAnE,MAAAA,IAAI,CAACuB,cAAL,GAAsBiB,YAAY,CAAC4B,wBAAnC;AAEApE,MAAAA,IAAI,CAACqE,SAAL,GAAiBhE,IAAI,IAAIA,IAAI,CAAC,CAAD,CAAZ,IAAmBA,IAAI,CAAC,CAAD,CAAJ,CAAQ0B,QAA3B,IAAuCxC,KAAK,CAAC+E,YAAN,CAAmBjE,IAAI,CAAC,CAAD,CAAJ,CAAQ0B,QAAR,CAAiBwC,GAApC,CAAxD;AAEA,oBAAM7E,eAAe,CAAC8E,WAAhB,GAA8BC,OAA9B,CAAuCC,OAAD,IAAa;AACxD1E,QAAAA,IAAI,CAACO,QAAL,CAAcoE,IAAd,CAAmBvF,CAAC,CAACwF,IAAF,CAAOF,OAAP,EAAgB,KAAhB,EAAuB,SAAvB,EAAkC,YAAlC,EAAgD,SAAhD,CAAnB;AACA,OAFK,CAAN;AAIAlF,MAAAA,kBAAkB,CAACqF,qBAAnB,GAA2CJ,OAA3C,CAAoDlC,UAAD,IAAgB;AAClEvC,QAAAA,IAAI,CAACQ,WAAL,CAAiBmE,IAAjB,CAAsBpC,UAAtB;AACA,OAFD;AAGAvC,MAAAA,IAAI,CAACS,yBAAL,GAAiC+B,YAAY,CAACsC,oCAA9C;AAEA9E,MAAAA,IAAI,CAACU,MAAL,GAAcnB,KAAK,CAACwF,gBAAN,GAAyBC,KAAzB,KAAmC,CAAjD;AAEA,aAAOpF,kBAAkB,CAAC;AACzBqF,QAAAA,QAAQ,EAAE,yBADe;AAEzBC,QAAAA,oBAAoB,EAAE,KAFG;AAGzBC,QAAAA,QAAQ,EAAEnF;AAHe,OAAD,CAAzB;AAKA,KArGD;AAAA;;AADc,CAAf","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport _ from 'underscore';\n\nimport { LivechatRooms, Users, LivechatDepartment, LivechatVisitors } from '../../../models/server';\nimport { LivechatTrigger } from '../../../models/server/raw';\nimport { Livechat } from '../lib/Livechat';\nimport { deprecationWarning } from '../../../api/server/helpers/deprecationWarning';\n\nMeteor.methods({\n\tasync 'livechat:getInitialData'(visitorToken, departmentId) {\n\t\tconst info = {\n\t\t\tenabled: null,\n\t\t\ttitle: null,\n\t\t\tcolor: null,\n\t\t\tregistrationForm: null,\n\t\t\troom: null,\n\t\t\tvisitor: null,\n\t\t\ttriggers: [],\n\t\t\tdepartments: [],\n\t\t\tallowSwitchingDepartments: null,\n\t\t\tonline: true,\n\t\t\tofflineColor: null,\n\t\t\tofflineMessage: null,\n\t\t\tofflineSuccessMessage: null,\n\t\t\tofflineUnavailableMessage: null,\n\t\t\tdisplayOfflineForm: null,\n\t\t\tvideoCall: null,\n\t\t\tfileUpload: null,\n\t\t\tconversationFinishedMessage: null,\n\t\t\tconversationFinishedText: null,\n\t\t\tnameFieldRegistrationForm: null,\n\t\t\temailFieldRegistrationForm: null,\n\t\t\tregistrationFormMessage: null,\n\t\t\tshowConnecting: false,\n\t\t};\n\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\tv: 1,\n\t\t\t\tservedBy: 1,\n\t\t\t\tdepartmentId: 1,\n\t\t\t},\n\t\t};\n\t\tconst room = departmentId\n\t\t\t? LivechatRooms.findOpenByVisitorTokenAndDepartmentId(visitorToken, departmentId, options).fetch()\n\t\t\t: LivechatRooms.findOpenByVisitorToken(visitorToken, options).fetch();\n\t\tif (room && room.length > 0) {\n\t\t\tinfo.room = room[0];\n\t\t}\n\n\t\tconst visitor = LivechatVisitors.getVisitorByToken(visitorToken, {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tusername: 1,\n\t\t\t\tvisitorEmails: 1,\n\t\t\t\tdepartment: 1,\n\t\t\t},\n\t\t});\n\n\t\tif (room) {\n\t\t\tinfo.visitor = visitor;\n\t\t}\n\n\t\tconst initSettings = Livechat.getInitSettings();\n\n\t\tinfo.title = initSettings.Livechat_title;\n\t\tinfo.color = initSettings.Livechat_title_color;\n\t\tinfo.enabled = initSettings.Livechat_enabled;\n\t\tinfo.registrationForm = initSettings.Livechat_registration_form;\n\t\tinfo.offlineTitle = initSettings.Livechat_offline_title;\n\t\tinfo.offlineColor = initSettings.Livechat_offline_title_color;\n\t\tinfo.offlineMessage = initSettings.Livechat_offline_message;\n\t\tinfo.offlineSuccessMessage = initSettings.Livechat_offline_success_message;\n\t\tinfo.offlineUnavailableMessage = initSettings.Livechat_offline_form_unavailable;\n\t\tinfo.displayOfflineForm = initSettings.Livechat_display_offline_form;\n\t\tinfo.language = initSettings.Language;\n\t\tinfo.videoCall = initSettings.Omnichannel_call_provider === 'Jitsi' && initSettings.Jitsi_Enabled === true;\n\t\tinfo.fileUpload = initSettings.Livechat_fileupload_enabled && initSettings.FileUpload_Enabled;\n\t\tinfo.transcript = initSettings.Livechat_enable_transcript;\n\t\tinfo.transcriptMessage = initSettings.Livechat_transcript_message;\n\t\tinfo.conversationFinishedMessage = initSettings.Livechat_conversation_finished_message;\n\t\tinfo.conversationFinishedText = initSettings.Livechat_conversation_finished_text;\n\t\tinfo.nameFieldRegistrationForm = initSettings.Livechat_name_field_registration_form;\n\t\tinfo.emailFieldRegistrationForm = initSettings.Livechat_email_field_registration_form;\n\t\tinfo.registrationFormMessage = initSettings.Livechat_registration_form_message;\n\t\tinfo.showConnecting = initSettings.Livechat_Show_Connecting;\n\n\t\tinfo.agentData = room && room[0] && room[0].servedBy && Users.getAgentInfo(room[0].servedBy._id);\n\n\t\tawait LivechatTrigger.findEnabled().forEach((trigger) => {\n\t\t\tinfo.triggers.push(_.pick(trigger, '_id', 'actions', 'conditions', 'runOnce'));\n\t\t});\n\n\t\tLivechatDepartment.findEnabledWithAgents().forEach((department) => {\n\t\t\tinfo.departments.push(department);\n\t\t});\n\t\tinfo.allowSwitchingDepartments = initSettings.Livechat_allow_switching_departments;\n\n\t\tinfo.online = Users.findOnlineAgents().count() > 0;\n\n\t\treturn deprecationWarning({\n\t\t\tendpoint: 'livechat:getInitialData',\n\t\t\tversionWillBeRemoved: '5.0',\n\t\t\tresponse: info,\n\t\t});\n\t},\n});\n"]},"sourceType":"module","hash":"ad65cccf8902a4770c6051b421d90d12bf98fd9a"}
