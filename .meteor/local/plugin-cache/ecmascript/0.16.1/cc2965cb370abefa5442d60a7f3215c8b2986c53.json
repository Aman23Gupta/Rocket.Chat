{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/server/startup/migrations/v197.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"server/startup/migrations/v197.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/server/startup/migrations/v197.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/server/startup/migrations/v197.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"server/startup/migrations/v197.js"}},"code":"let moment;\nmodule.link(\"moment-timezone\", {\n  default(v) {\n    moment = v;\n  }\n\n}, 0);\nlet addMigration;\nmodule.link(\"../../lib/migrations\", {\n  addMigration(v) {\n    addMigration = v;\n  }\n\n}, 1);\nlet LivechatBusinessHours;\nmodule.link(\"../../../app/models/server/raw\", {\n  LivechatBusinessHours(v) {\n    LivechatBusinessHours = v;\n  }\n\n}, 2);\nlet LivechatBusinessHourTypes;\nmodule.link(\"../../../definition/ILivechatBusinessHour\", {\n  LivechatBusinessHourTypes(v) {\n    LivechatBusinessHourTypes = v;\n  }\n\n}, 3);\n\nconst updateBusinessHours = () => Promise.asyncApply(() => {\n  Promise.await(LivechatBusinessHours.update({\n    type: 'multiple'\n  }, {\n    $set: {\n      type: LivechatBusinessHourTypes.CUSTOM\n    }\n  }, {\n    multi: true\n  }));\n  const defaultBusinessHour = Promise.await(LivechatBusinessHours.findOne({\n    $or: [{\n      type: 'single'\n    }, {\n      type: 'default'\n    }]\n  }));\n\n  if (!defaultBusinessHour) {\n    return;\n  }\n\n  Promise.await(LivechatBusinessHours.update({\n    _id: defaultBusinessHour._id\n  }, {\n    $set: {\n      type: LivechatBusinessHourTypes.DEFAULT,\n      timezone: {\n        name: moment.tz.guess(),\n        utc: String(moment().utcOffset() / 60)\n      }\n    }\n  }));\n});\n\naddMigration({\n  version: 197,\n\n  up() {\n    Promise.await(updateBusinessHours());\n  }\n\n});","map":{"version":3,"sources":["server/startup/migrations/v197.js"],"names":["moment","module","link","default","v","addMigration","LivechatBusinessHours","LivechatBusinessHourTypes","updateBusinessHours","update","type","$set","CUSTOM","multi","defaultBusinessHour","findOne","$or","_id","DEFAULT","timezone","name","tz","guess","utc","String","utcOffset","version","up","Promise","await"],"mappings":"AAAA,IAAIA,MAAJ;AAAWC,MAAM,CAACC,IAAP,CAAY,iBAAZ,EAA8B;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACJ,IAAAA,MAAM,GAACI,CAAP;AAAS;;AAArB,CAA9B,EAAqD,CAArD;AAAwD,IAAIC,YAAJ;AAAiBJ,MAAM,CAACC,IAAP,CAAY,sBAAZ,EAAmC;AAACG,EAAAA,YAAY,CAACD,CAAD,EAAG;AAACC,IAAAA,YAAY,GAACD,CAAb;AAAe;;AAAhC,CAAnC,EAAqE,CAArE;AAAwE,IAAIE,qBAAJ;AAA0BL,MAAM,CAACC,IAAP,CAAY,gCAAZ,EAA6C;AAACI,EAAAA,qBAAqB,CAACF,CAAD,EAAG;AAACE,IAAAA,qBAAqB,GAACF,CAAtB;AAAwB;;AAAlD,CAA7C,EAAiG,CAAjG;AAAoG,IAAIG,yBAAJ;AAA8BN,MAAM,CAACC,IAAP,CAAY,2CAAZ,EAAwD;AAACK,EAAAA,yBAAyB,CAACH,CAAD,EAAG;AAACG,IAAAA,yBAAyB,GAACH,CAA1B;AAA4B;;AAA1D,CAAxD,EAAoH,CAApH;;AAMxT,MAAMI,mBAAmB,GAAG,+BAAY;AACvC,gBAAMF,qBAAqB,CAACG,MAAtB,CACL;AAAEC,IAAAA,IAAI,EAAE;AAAR,GADK,EAEL;AACCC,IAAAA,IAAI,EAAE;AACLD,MAAAA,IAAI,EAAEH,yBAAyB,CAACK;AAD3B;AADP,GAFK,EAOL;AAAEC,IAAAA,KAAK,EAAE;AAAT,GAPK,CAAN;AAUA,QAAMC,mBAAmB,iBAASR,qBAAqB,CAACS,OAAtB,CAA8B;AAC/DC,IAAAA,GAAG,EAAE,CAAC;AAAEN,MAAAA,IAAI,EAAE;AAAR,KAAD,EAAqB;AAAEA,MAAAA,IAAI,EAAE;AAAR,KAArB;AAD0D,GAA9B,CAAT,CAAzB;;AAGA,MAAI,CAACI,mBAAL,EAA0B;AACzB;AACA;;AAED,gBAAMR,qBAAqB,CAACG,MAAtB,CACL;AAAEQ,IAAAA,GAAG,EAAEH,mBAAmB,CAACG;AAA3B,GADK,EAEL;AACCN,IAAAA,IAAI,EAAE;AACLD,MAAAA,IAAI,EAAEH,yBAAyB,CAACW,OAD3B;AAELC,MAAAA,QAAQ,EAAE;AACTC,QAAAA,IAAI,EAAEpB,MAAM,CAACqB,EAAP,CAAUC,KAAV,EADG;AAETC,QAAAA,GAAG,EAAEC,MAAM,CAACxB,MAAM,GAAGyB,SAAT,KAAuB,EAAxB;AAFF;AAFL;AADP,GAFK,CAAN;AAYA,CA9B2B,CAA5B;;AAgCApB,YAAY,CAAC;AACZqB,EAAAA,OAAO,EAAE,GADG;;AAEZC,EAAAA,EAAE,GAAG;AACJC,IAAAA,OAAO,CAACC,KAAR,CAAcrB,mBAAmB,EAAjC;AACA;;AAJW,CAAD,CAAZ","sourcesContent":["import moment from 'moment-timezone';\n\nimport { addMigration } from '../../lib/migrations';\nimport { LivechatBusinessHours } from '../../../app/models/server/raw';\nimport { LivechatBusinessHourTypes } from '../../../definition/ILivechatBusinessHour';\n\nconst updateBusinessHours = async () => {\n\tawait LivechatBusinessHours.update(\n\t\t{ type: 'multiple' },\n\t\t{\n\t\t\t$set: {\n\t\t\t\ttype: LivechatBusinessHourTypes.CUSTOM,\n\t\t\t},\n\t\t},\n\t\t{ multi: true },\n\t);\n\n\tconst defaultBusinessHour = await LivechatBusinessHours.findOne({\n\t\t$or: [{ type: 'single' }, { type: 'default' }],\n\t});\n\tif (!defaultBusinessHour) {\n\t\treturn;\n\t}\n\n\tawait LivechatBusinessHours.update(\n\t\t{ _id: defaultBusinessHour._id },\n\t\t{\n\t\t\t$set: {\n\t\t\t\ttype: LivechatBusinessHourTypes.DEFAULT,\n\t\t\t\ttimezone: {\n\t\t\t\t\tname: moment.tz.guess(),\n\t\t\t\t\tutc: String(moment().utcOffset() / 60),\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t);\n};\n\naddMigration({\n\tversion: 197,\n\tup() {\n\t\tPromise.await(updateBusinessHours());\n\t},\n});\n"]},"sourceType":"module","hash":"cc2965cb370abefa5442d60a7f3215c8b2986c53"}
