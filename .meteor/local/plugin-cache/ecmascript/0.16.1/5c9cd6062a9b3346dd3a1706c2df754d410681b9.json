{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/server/startup/serverRunning.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"server/startup/serverRunning.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/server/startup/serverRunning.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/server/startup/serverRunning.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"server/startup/serverRunning.js"}},"code":"let fs;\nmodule.link(\"fs\", {\n  default(v) {\n    fs = v;\n  }\n\n}, 0);\nlet path;\nmodule.link(\"path\", {\n  default(v) {\n    path = v;\n  }\n\n}, 1);\nlet semver;\nmodule.link(\"semver\", {\n  default(v) {\n    semver = v;\n  }\n\n}, 2);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 3);\nlet TAPi18n;\nmodule.link(\"meteor/rocketchat:tap-i18n\", {\n  TAPi18n(v) {\n    TAPi18n = v;\n  }\n\n}, 4);\nlet settings;\nmodule.link(\"../../app/settings/server\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 5);\nlet Info, getMongoInfo;\nmodule.link(\"../../app/utils/server\", {\n  Info(v) {\n    Info = v;\n  },\n\n  getMongoInfo(v) {\n    getMongoInfo = v;\n  }\n\n}, 6);\nlet Users;\nmodule.link(\"../../app/models/server\", {\n  Users(v) {\n    Users = v;\n  }\n\n}, 7);\nlet sendMessagesToAdmins;\nmodule.link(\"../lib/sendMessagesToAdmins\", {\n  sendMessagesToAdmins(v) {\n    sendMessagesToAdmins = v;\n  }\n\n}, 8);\nlet showErrorBox, showWarningBox, showSuccessBox;\nmodule.link(\"../lib/logger/showBox\", {\n  showErrorBox(v) {\n    showErrorBox = v;\n  },\n\n  showWarningBox(v) {\n    showWarningBox = v;\n  },\n\n  showSuccessBox(v) {\n    showSuccessBox = v;\n  }\n\n}, 9);\n\nconst exitIfNotBypassed = function (ignore) {\n  let errorCode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n\n  if (typeof ignore === 'string' && ['yes', 'true'].includes(ignore.toLowerCase())) {\n    return;\n  }\n\n  process.exit(errorCode);\n};\n\nMeteor.startup(function () {\n  const {\n    oplogEnabled,\n    mongoVersion,\n    mongoStorageEngine\n  } = getMongoInfo();\n  const desiredNodeVersion = semver.clean(fs.readFileSync(path.join(process.cwd(), '../../.node_version.txt')).toString());\n  const desiredNodeVersionMajor = String(semver.parse(desiredNodeVersion).major);\n  return Meteor.setTimeout(function () {\n    let msg = [\"Rocket.Chat Version: \".concat(Info.version), \"     NodeJS Version: \".concat(process.versions.node, \" - \").concat(process.arch), \"    MongoDB Version: \".concat(mongoVersion), \"     MongoDB Engine: \".concat(mongoStorageEngine), \"           Platform: \".concat(process.platform), \"       Process Port: \".concat(process.env.PORT), \"           Site URL: \".concat(settings.get('Site_Url')), \"   ReplicaSet OpLog: \".concat(oplogEnabled ? 'Enabled' : 'Disabled')];\n\n    if (Info.commit && Info.commit.hash) {\n      msg.push(\"        Commit Hash: \".concat(Info.commit.hash.substr(0, 10)));\n    }\n\n    if (Info.commit && Info.commit.branch) {\n      msg.push(\"      Commit Branch: \".concat(Info.commit.branch));\n    }\n\n    msg = msg.join('\\n');\n\n    if (!process.env.DISABLE_DB_WATCH && !oplogEnabled) {\n      msg += ['', '', 'OPLOG / REPLICASET IS REQUIRED TO RUN ROCKET.CHAT, MORE INFORMATION AT:', 'https://go.rocket.chat/i/oplog-required'].join('\\n');\n      showErrorBox('SERVER ERROR', msg);\n      exitIfNotBypassed(process.env.BYPASS_OPLOG_VALIDATION);\n    }\n\n    if (!semver.satisfies(process.versions.node, desiredNodeVersionMajor)) {\n      msg += ['', '', 'YOUR CURRENT NODEJS VERSION IS NOT SUPPORTED,', \"PLEASE UPGRADE / DOWNGRADE TO VERSION \".concat(desiredNodeVersionMajor, \".X.X\")].join('\\n');\n      showErrorBox('SERVER ERROR', msg);\n      exitIfNotBypassed(process.env.BYPASS_NODEJS_VALIDATION);\n    }\n\n    if (!semver.satisfies(semver.coerce(mongoVersion), '>=3.6.0')) {\n      msg += ['', '', 'YOUR CURRENT MONGODB VERSION IS NOT SUPPORTED,', 'PLEASE UPGRADE TO VERSION 3.6 OR LATER'].join('\\n');\n      showErrorBox('SERVER ERROR', msg);\n      exitIfNotBypassed(process.env.BYPASS_MONGO_VALIDATION);\n    }\n\n    showSuccessBox('SERVER RUNNING', msg); // Deprecation\n\n    if (!semver.satisfies(semver.coerce(mongoVersion), '>=4.2.0')) {\n      msg = [\"YOUR CURRENT MONGODB VERSION (\".concat(mongoVersion, \") IS DEPRECATED.\"), 'IT WILL NOT BE SUPPORTED ON ROCKET.CHAT VERSION 5.0.0 AND GREATER,', 'PLEASE UPGRADE MONGODB TO VERSION 4.2 OR GREATER'].join('\\n');\n      showWarningBox('DEPRECATION', msg);\n      const id = \"mongodbDeprecation_\".concat(mongoVersion.replace(/[^0-9]/g, '_'));\n      const title = 'MongoDB_Deprecated';\n      const text = 'MongoDB_version_s_is_deprecated_please_upgrade_your_installation';\n      const link = 'https://go.rocket.chat/i/mongodb-deprecated';\n\n      if (!Users.bannerExistsById(id)) {\n        sendMessagesToAdmins({\n          msgs: _ref => {\n            let {\n              adminUser\n            } = _ref;\n            return [{\n              msg: \"*\".concat(TAPi18n.__(title, adminUser.language), \"*\\n\").concat(TAPi18n.__(text, mongoVersion, adminUser.language), \"\\n\").concat(link)\n            }];\n          },\n          banners: [{\n            id,\n            priority: 100,\n            title,\n            text,\n            textArguments: [mongoVersion],\n            modifiers: ['danger'],\n            link\n          }]\n        });\n      }\n    }\n  }, 100);\n});","map":{"version":3,"sources":["server/startup/serverRunning.js"],"names":["fs","module","link","default","v","path","semver","Meteor","TAPi18n","settings","Info","getMongoInfo","Users","sendMessagesToAdmins","showErrorBox","showWarningBox","showSuccessBox","exitIfNotBypassed","ignore","errorCode","includes","toLowerCase","process","exit","startup","oplogEnabled","mongoVersion","mongoStorageEngine","desiredNodeVersion","clean","readFileSync","join","cwd","toString","desiredNodeVersionMajor","String","parse","major","setTimeout","msg","version","versions","node","arch","platform","env","PORT","get","commit","hash","push","substr","branch","DISABLE_DB_WATCH","BYPASS_OPLOG_VALIDATION","satisfies","BYPASS_NODEJS_VALIDATION","coerce","BYPASS_MONGO_VALIDATION","id","replace","title","text","bannerExistsById","msgs","adminUser","__","language","banners","priority","textArguments","modifiers"],"mappings":"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","sourcesContent":["import fs from 'fs';\nimport path from 'path';\n\nimport semver from 'semver';\nimport { Meteor } from 'meteor/meteor';\nimport { TAPi18n } from 'meteor/rocketchat:tap-i18n';\n\nimport { settings } from '../../app/settings/server';\nimport { Info, getMongoInfo } from '../../app/utils/server';\nimport { Users } from '../../app/models/server';\nimport { sendMessagesToAdmins } from '../lib/sendMessagesToAdmins';\nimport { showErrorBox, showWarningBox, showSuccessBox } from '../lib/logger/showBox';\n\nconst exitIfNotBypassed = (ignore, errorCode = 1) => {\n\tif (typeof ignore === 'string' && ['yes', 'true'].includes(ignore.toLowerCase())) {\n\t\treturn;\n\t}\n\n\tprocess.exit(errorCode);\n};\n\nMeteor.startup(function () {\n\tconst { oplogEnabled, mongoVersion, mongoStorageEngine } = getMongoInfo();\n\n\tconst desiredNodeVersion = semver.clean(fs.readFileSync(path.join(process.cwd(), '../../.node_version.txt')).toString());\n\tconst desiredNodeVersionMajor = String(semver.parse(desiredNodeVersion).major);\n\n\treturn Meteor.setTimeout(function () {\n\t\tlet msg = [\n\t\t\t`Rocket.Chat Version: ${Info.version}`,\n\t\t\t`     NodeJS Version: ${process.versions.node} - ${process.arch}`,\n\t\t\t`    MongoDB Version: ${mongoVersion}`,\n\t\t\t`     MongoDB Engine: ${mongoStorageEngine}`,\n\t\t\t`           Platform: ${process.platform}`,\n\t\t\t`       Process Port: ${process.env.PORT}`,\n\t\t\t`           Site URL: ${settings.get('Site_Url')}`,\n\t\t\t`   ReplicaSet OpLog: ${oplogEnabled ? 'Enabled' : 'Disabled'}`,\n\t\t];\n\n\t\tif (Info.commit && Info.commit.hash) {\n\t\t\tmsg.push(`        Commit Hash: ${Info.commit.hash.substr(0, 10)}`);\n\t\t}\n\n\t\tif (Info.commit && Info.commit.branch) {\n\t\t\tmsg.push(`      Commit Branch: ${Info.commit.branch}`);\n\t\t}\n\n\t\tmsg = msg.join('\\n');\n\n\t\tif (!process.env.DISABLE_DB_WATCH && !oplogEnabled) {\n\t\t\tmsg += [\n\t\t\t\t'',\n\t\t\t\t'',\n\t\t\t\t'OPLOG / REPLICASET IS REQUIRED TO RUN ROCKET.CHAT, MORE INFORMATION AT:',\n\t\t\t\t'https://go.rocket.chat/i/oplog-required',\n\t\t\t].join('\\n');\n\t\t\tshowErrorBox('SERVER ERROR', msg);\n\n\t\t\texitIfNotBypassed(process.env.BYPASS_OPLOG_VALIDATION);\n\t\t}\n\n\t\tif (!semver.satisfies(process.versions.node, desiredNodeVersionMajor)) {\n\t\t\tmsg += [\n\t\t\t\t'',\n\t\t\t\t'',\n\t\t\t\t'YOUR CURRENT NODEJS VERSION IS NOT SUPPORTED,',\n\t\t\t\t`PLEASE UPGRADE / DOWNGRADE TO VERSION ${desiredNodeVersionMajor}.X.X`,\n\t\t\t].join('\\n');\n\t\t\tshowErrorBox('SERVER ERROR', msg);\n\n\t\t\texitIfNotBypassed(process.env.BYPASS_NODEJS_VALIDATION);\n\t\t}\n\n\t\tif (!semver.satisfies(semver.coerce(mongoVersion), '>=3.6.0')) {\n\t\t\tmsg += ['', '', 'YOUR CURRENT MONGODB VERSION IS NOT SUPPORTED,', 'PLEASE UPGRADE TO VERSION 3.6 OR LATER'].join('\\n');\n\t\t\tshowErrorBox('SERVER ERROR', msg);\n\n\t\t\texitIfNotBypassed(process.env.BYPASS_MONGO_VALIDATION);\n\t\t}\n\n\t\tshowSuccessBox('SERVER RUNNING', msg);\n\n\t\t// Deprecation\n\t\tif (!semver.satisfies(semver.coerce(mongoVersion), '>=4.2.0')) {\n\t\t\tmsg = [\n\t\t\t\t`YOUR CURRENT MONGODB VERSION (${mongoVersion}) IS DEPRECATED.`,\n\t\t\t\t'IT WILL NOT BE SUPPORTED ON ROCKET.CHAT VERSION 5.0.0 AND GREATER,',\n\t\t\t\t'PLEASE UPGRADE MONGODB TO VERSION 4.2 OR GREATER',\n\t\t\t].join('\\n');\n\t\t\tshowWarningBox('DEPRECATION', msg);\n\n\t\t\tconst id = `mongodbDeprecation_${mongoVersion.replace(/[^0-9]/g, '_')}`;\n\t\t\tconst title = 'MongoDB_Deprecated';\n\t\t\tconst text = 'MongoDB_version_s_is_deprecated_please_upgrade_your_installation';\n\t\t\tconst link = 'https://go.rocket.chat/i/mongodb-deprecated';\n\n\t\t\tif (!Users.bannerExistsById(id)) {\n\t\t\t\tsendMessagesToAdmins({\n\t\t\t\t\tmsgs: ({ adminUser }) => [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmsg: `*${TAPi18n.__(title, adminUser.language)}*\\n${TAPi18n.__(text, mongoVersion, adminUser.language)}\\n${link}`,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tbanners: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\t\ttitle,\n\t\t\t\t\t\t\ttext,\n\t\t\t\t\t\t\ttextArguments: [mongoVersion],\n\t\t\t\t\t\t\tmodifiers: ['danger'],\n\t\t\t\t\t\t\tlink,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}, 100);\n});\n"]},"sourceType":"module","hash":"5c9cd6062a9b3346dd3a1706c2df754d410681b9"}
