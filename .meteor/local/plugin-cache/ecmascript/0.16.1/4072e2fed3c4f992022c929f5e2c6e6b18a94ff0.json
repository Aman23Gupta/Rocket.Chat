{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/livestream/server/functions/livestream.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/livestream/server/functions/livestream.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/livestream/server/functions/livestream.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/livestream/server/functions/livestream.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/livestream/server/functions/livestream.js"}},"code":"module.export({\n  getBroadcastStatus: () => getBroadcastStatus,\n  statusStreamLiveStream: () => statusStreamLiveStream,\n  statusLiveStream: () => statusLiveStream,\n  setBroadcastStatus: () => setBroadcastStatus,\n  createLiveStream: () => createLiveStream\n});\nlet google;\nmodule.link(\"googleapis\", {\n  default(v) {\n    google = v;\n  }\n\n}, 0);\nconst {\n  OAuth2\n} = google.auth;\n\nconst p = fn => new Promise(function (resolve, reject) {\n  fn(function (err, value) {\n    if (err) {\n      return reject(err);\n    }\n\n    resolve(value.data);\n  });\n});\n\nconst getBroadcastStatus = _ref => Promise.asyncApply(() => {\n  let {\n    id,\n    access_token,\n    refresh_token,\n    clientId,\n    clientSecret\n  } = _ref;\n  const auth = new OAuth2(clientId, clientSecret);\n  auth.setCredentials({\n    access_token,\n    refresh_token\n  });\n  const youtube = google.youtube({\n    version: 'v3',\n    auth\n  });\n  const result = Promise.await(p(resolve => youtube.liveBroadcasts.list({\n    part: 'id,status',\n    id\n  }, resolve)));\n  return result.items && result.items[0] && result.items[0].status.lifeCycleStatus;\n});\n\nconst statusStreamLiveStream = _ref2 => Promise.asyncApply(() => {\n  let {\n    id,\n    access_token,\n    refresh_token,\n    clientId,\n    clientSecret\n  } = _ref2;\n  const auth = new OAuth2(clientId, clientSecret);\n  auth.setCredentials({\n    access_token,\n    refresh_token\n  });\n  const youtube = google.youtube({\n    version: 'v3',\n    auth\n  });\n  const result = Promise.await(p(resolve => youtube.liveStreams.list({\n    part: 'id,status',\n    id\n  }, resolve)));\n  return result.items && result.items[0].status.streamStatus;\n});\n\nconst statusLiveStream = _ref3 => {\n  let {\n    id,\n    access_token,\n    refresh_token,\n    clientId,\n    clientSecret,\n    status\n  } = _ref3;\n  const auth = new OAuth2(clientId, clientSecret);\n  auth.setCredentials({\n    access_token,\n    refresh_token\n  });\n  const youtube = google.youtube({\n    version: 'v3',\n    auth\n  });\n  return p(resolve => youtube.liveBroadcasts.transition({\n    part: 'id,status',\n    id,\n    broadcastStatus: status\n  }, resolve));\n};\n\nconst setBroadcastStatus = _ref4 => {\n  let {\n    id,\n    access_token,\n    refresh_token,\n    clientId,\n    clientSecret,\n    status\n  } = _ref4;\n  const auth = new OAuth2(clientId, clientSecret);\n  auth.setCredentials({\n    access_token,\n    refresh_token\n  });\n  const youtube = google.youtube({\n    version: 'v3',\n    auth\n  });\n  return p(resolve => youtube.liveBroadcasts.transition({\n    part: 'id,status',\n    id,\n    broadcastStatus: status\n  }, resolve));\n};\n\nconst createLiveStream = _ref5 => Promise.asyncApply(() => {\n  let {\n    room,\n    access_token,\n    refresh_token,\n    clientId,\n    clientSecret\n  } = _ref5;\n  const auth = new OAuth2(clientId, clientSecret);\n  auth.setCredentials({\n    access_token,\n    refresh_token\n  });\n  const youtube = google.youtube({\n    version: 'v3',\n    auth\n  });\n  const [stream, broadcast] = Promise.await(Promise.all([p(resolve => youtube.liveStreams.insert({\n    part: 'id,snippet,cdn,contentDetails,status',\n    resource: {\n      snippet: {\n        title: room.name || 'RocketChat Broadcast'\n      },\n      cdn: {\n        format: '480p',\n        ingestionType: 'rtmp'\n      }\n    }\n  }, resolve)), p(resolve => youtube.liveBroadcasts.insert({\n    part: 'id,snippet,contentDetails,status',\n    resource: {\n      snippet: {\n        title: room.name || 'RocketChat Broadcast',\n        scheduledStartTime: new Date().toISOString()\n      },\n      status: {\n        privacyStatus: 'unlisted'\n      }\n    }\n  }, resolve))]));\n  Promise.await(p(resolve => youtube.liveBroadcasts.bind({\n    part: 'id,snippet,status',\n    // resource: {\n    id: broadcast.id,\n    streamId: stream.id\n  }, resolve)));\n  return {\n    id: stream.cdn.ingestionInfo.streamName,\n    stream,\n    broadcast\n  };\n});","map":{"version":3,"sources":["app/livestream/server/functions/livestream.js"],"names":["module","export","getBroadcastStatus","statusStreamLiveStream","statusLiveStream","setBroadcastStatus","createLiveStream","google","link","default","v","OAuth2","auth","p","fn","Promise","resolve","reject","err","value","data","id","access_token","refresh_token","clientId","clientSecret","setCredentials","youtube","version","result","liveBroadcasts","list","part","items","status","lifeCycleStatus","liveStreams","streamStatus","transition","broadcastStatus","room","stream","broadcast","all","insert","resource","snippet","title","name","cdn","format","ingestionType","scheduledStartTime","Date","toISOString","privacyStatus","bind","streamId","ingestionInfo","streamName"],"mappings":"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","sourcesContent":["import google from 'googleapis';\n\nconst { OAuth2 } = google.auth;\n\nconst p = (fn) =>\n\tnew Promise(function (resolve, reject) {\n\t\tfn(function (err, value) {\n\t\t\tif (err) {\n\t\t\t\treturn reject(err);\n\t\t\t}\n\t\t\tresolve(value.data);\n\t\t});\n\t});\n\nexport const getBroadcastStatus = async ({ id, access_token, refresh_token, clientId, clientSecret }) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token,\n\t});\n\tconst youtube = google.youtube({ version: 'v3', auth });\n\tconst result = await p((resolve) =>\n\t\tyoutube.liveBroadcasts.list(\n\t\t\t{\n\t\t\t\tpart: 'id,status',\n\t\t\t\tid,\n\t\t\t},\n\t\t\tresolve,\n\t\t),\n\t);\n\treturn result.items && result.items[0] && result.items[0].status.lifeCycleStatus;\n};\n\nexport const statusStreamLiveStream = async ({ id, access_token, refresh_token, clientId, clientSecret }) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token,\n\t});\n\n\tconst youtube = google.youtube({ version: 'v3', auth });\n\tconst result = await p((resolve) =>\n\t\tyoutube.liveStreams.list(\n\t\t\t{\n\t\t\t\tpart: 'id,status',\n\t\t\t\tid,\n\t\t\t},\n\t\t\tresolve,\n\t\t),\n\t);\n\treturn result.items && result.items[0].status.streamStatus;\n};\n\nexport const statusLiveStream = ({ id, access_token, refresh_token, clientId, clientSecret, status }) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token,\n\t});\n\n\tconst youtube = google.youtube({ version: 'v3', auth });\n\n\treturn p((resolve) =>\n\t\tyoutube.liveBroadcasts.transition(\n\t\t\t{\n\t\t\t\tpart: 'id,status',\n\t\t\t\tid,\n\t\t\t\tbroadcastStatus: status,\n\t\t\t},\n\t\t\tresolve,\n\t\t),\n\t);\n};\n\nexport const setBroadcastStatus = ({ id, access_token, refresh_token, clientId, clientSecret, status }) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token,\n\t});\n\n\tconst youtube = google.youtube({ version: 'v3', auth });\n\n\treturn p((resolve) =>\n\t\tyoutube.liveBroadcasts.transition(\n\t\t\t{\n\t\t\t\tpart: 'id,status',\n\t\t\t\tid,\n\t\t\t\tbroadcastStatus: status,\n\t\t\t},\n\t\t\tresolve,\n\t\t),\n\t);\n};\n\nexport const createLiveStream = async ({ room, access_token, refresh_token, clientId, clientSecret }) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token,\n\t});\n\tconst youtube = google.youtube({ version: 'v3', auth });\n\n\tconst [stream, broadcast] = await Promise.all([\n\t\tp((resolve) =>\n\t\t\tyoutube.liveStreams.insert(\n\t\t\t\t{\n\t\t\t\t\tpart: 'id,snippet,cdn,contentDetails,status',\n\t\t\t\t\tresource: {\n\t\t\t\t\t\tsnippet: {\n\t\t\t\t\t\t\ttitle: room.name || 'RocketChat Broadcast',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcdn: {\n\t\t\t\t\t\t\tformat: '480p',\n\t\t\t\t\t\t\tingestionType: 'rtmp',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tresolve,\n\t\t\t),\n\t\t),\n\t\tp((resolve) =>\n\t\t\tyoutube.liveBroadcasts.insert(\n\t\t\t\t{\n\t\t\t\t\tpart: 'id,snippet,contentDetails,status',\n\t\t\t\t\tresource: {\n\t\t\t\t\t\tsnippet: {\n\t\t\t\t\t\t\ttitle: room.name || 'RocketChat Broadcast',\n\t\t\t\t\t\t\tscheduledStartTime: new Date().toISOString(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\tprivacyStatus: 'unlisted',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tresolve,\n\t\t\t),\n\t\t),\n\t]);\n\n\tawait p((resolve) =>\n\t\tyoutube.liveBroadcasts.bind(\n\t\t\t{\n\t\t\t\tpart: 'id,snippet,status',\n\t\t\t\t// resource: {\n\t\t\t\tid: broadcast.id,\n\t\t\t\tstreamId: stream.id,\n\t\t\t},\n\t\t\tresolve,\n\t\t),\n\t);\n\n\treturn { id: stream.cdn.ingestionInfo.streamName, stream, broadcast };\n};\n"]},"sourceType":"module","hash":"4072e2fed3c4f992022c929f5e2c6e6b18a94ff0"}
