{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/version-check/server/functions/getNewUpdates.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/version-check/server/functions/getNewUpdates.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/version-check/server/functions/getNewUpdates.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/version-check/server/functions/getNewUpdates.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/version-check/server/functions/getNewUpdates.js"}},"code":"let os;\nmodule.link(\"os\", {\n  default(v) {\n    os = v;\n  }\n\n}, 0);\nlet HTTP;\nmodule.link(\"meteor/http\", {\n  HTTP(v) {\n    HTTP = v;\n  }\n\n}, 1);\nlet check, Match;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  },\n\n  Match(v) {\n    Match = v;\n  }\n\n}, 2);\nlet Settings;\nmodule.link(\"../../../models\", {\n  Settings(v) {\n    Settings = v;\n  }\n\n}, 3);\nlet Info;\nmodule.link(\"../../../utils\", {\n  Info(v) {\n    Info = v;\n  }\n\n}, 4);\nlet getWorkspaceAccessToken;\nmodule.link(\"../../../cloud/server\", {\n  getWorkspaceAccessToken(v) {\n    getWorkspaceAccessToken = v;\n  }\n\n}, 5);\nmodule.exportDefault(() => {\n  try {\n    const uniqueID = Settings.findOne('uniqueID');\n    const params = {\n      uniqueId: uniqueID.value,\n      installedAt: uniqueID.createdAt.toJSON(),\n      version: Info.version,\n      osType: os.type(),\n      osPlatform: os.platform(),\n      osArch: os.arch(),\n      osRelease: os.release(),\n      nodeVersion: process.version,\n      deployMethod: process.env.DEPLOY_METHOD || 'tar',\n      deployPlatform: process.env.DEPLOY_PLATFORM || 'selfinstall'\n    };\n    const headers = {};\n    const token = getWorkspaceAccessToken();\n\n    if (token) {\n      headers.Authorization = \"Bearer \".concat(token);\n    }\n\n    const {\n      data\n    } = HTTP.get('https://releases.rocket.chat/updates/check', {\n      params,\n      headers\n    });\n    check(data, Match.ObjectIncluding({\n      versions: [Match.ObjectIncluding({\n        version: Match.Optional(String),\n        security: Match.Optional(Boolean),\n        infoUrl: Match.Optional(String)\n      })],\n      alerts: Match.Optional([Match.ObjectIncluding({\n        id: Match.Optional(String),\n        title: Match.Optional(String),\n        text: Match.Optional(String),\n        textArguments: Match.Optional([Match.Any]),\n        modifiers: Match.Optional([String]),\n        infoUrl: Match.Optional(String)\n      })])\n    }));\n    return data;\n  } catch (error) {\n    // There's no need to log this error\n    // as it's pointless and the user\n    // can't do anything about it anyways\n    return {\n      versions: [],\n      alerts: []\n    };\n  }\n});","map":{"version":3,"sources":["app/version-check/server/functions/getNewUpdates.js"],"names":["os","module","link","default","v","HTTP","check","Match","Settings","Info","getWorkspaceAccessToken","exportDefault","uniqueID","findOne","params","uniqueId","value","installedAt","createdAt","toJSON","version","osType","type","osPlatform","platform","osArch","arch","osRelease","release","nodeVersion","process","deployMethod","env","DEPLOY_METHOD","deployPlatform","DEPLOY_PLATFORM","headers","token","Authorization","data","get","ObjectIncluding","versions","Optional","String","security","Boolean","infoUrl","alerts","id","title","text","textArguments","Any","modifiers","error"],"mappings":"AAAA,IAAIA,EAAJ;AAAOC,MAAM,CAACC,IAAP,CAAY,IAAZ,EAAiB;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACJ,IAAAA,EAAE,GAACI,CAAH;AAAK;;AAAjB,CAAjB,EAAoC,CAApC;AAAuC,IAAIC,IAAJ;AAASJ,MAAM,CAACC,IAAP,CAAY,aAAZ,EAA0B;AAACG,EAAAA,IAAI,CAACD,CAAD,EAAG;AAACC,IAAAA,IAAI,GAACD,CAAL;AAAO;;AAAhB,CAA1B,EAA4C,CAA5C;AAA+C,IAAIE,KAAJ,EAAUC,KAAV;AAAgBN,MAAM,CAACC,IAAP,CAAY,cAAZ,EAA2B;AAACI,EAAAA,KAAK,CAACF,CAAD,EAAG;AAACE,IAAAA,KAAK,GAACF,CAAN;AAAQ,GAAlB;;AAAmBG,EAAAA,KAAK,CAACH,CAAD,EAAG;AAACG,IAAAA,KAAK,GAACH,CAAN;AAAQ;;AAApC,CAA3B,EAAiE,CAAjE;AAAoE,IAAII,QAAJ;AAAaP,MAAM,CAACC,IAAP,CAAY,iBAAZ,EAA8B;AAACM,EAAAA,QAAQ,CAACJ,CAAD,EAAG;AAACI,IAAAA,QAAQ,GAACJ,CAAT;AAAW;;AAAxB,CAA9B,EAAwD,CAAxD;AAA2D,IAAIK,IAAJ;AAASR,MAAM,CAACC,IAAP,CAAY,gBAAZ,EAA6B;AAACO,EAAAA,IAAI,CAACL,CAAD,EAAG;AAACK,IAAAA,IAAI,GAACL,CAAL;AAAO;;AAAhB,CAA7B,EAA+C,CAA/C;AAAkD,IAAIM,uBAAJ;AAA4BT,MAAM,CAACC,IAAP,CAAY,uBAAZ,EAAoC;AAACQ,EAAAA,uBAAuB,CAACN,CAAD,EAAG;AAACM,IAAAA,uBAAuB,GAACN,CAAxB;AAA0B;;AAAtD,CAApC,EAA4F,CAA5F;AAAzVH,MAAM,CAACU,aAAP,CASe,MAAM;AACpB,MAAI;AACH,UAAMC,QAAQ,GAAGJ,QAAQ,CAACK,OAAT,CAAiB,UAAjB,CAAjB;AAEA,UAAMC,MAAM,GAAG;AACdC,MAAAA,QAAQ,EAAEH,QAAQ,CAACI,KADL;AAEdC,MAAAA,WAAW,EAAEL,QAAQ,CAACM,SAAT,CAAmBC,MAAnB,EAFC;AAGdC,MAAAA,OAAO,EAAEX,IAAI,CAACW,OAHA;AAIdC,MAAAA,MAAM,EAAErB,EAAE,CAACsB,IAAH,EAJM;AAKdC,MAAAA,UAAU,EAAEvB,EAAE,CAACwB,QAAH,EALE;AAMdC,MAAAA,MAAM,EAAEzB,EAAE,CAAC0B,IAAH,EANM;AAOdC,MAAAA,SAAS,EAAE3B,EAAE,CAAC4B,OAAH,EAPG;AAQdC,MAAAA,WAAW,EAAEC,OAAO,CAACV,OARP;AASdW,MAAAA,YAAY,EAAED,OAAO,CAACE,GAAR,CAAYC,aAAZ,IAA6B,KAT7B;AAUdC,MAAAA,cAAc,EAAEJ,OAAO,CAACE,GAAR,CAAYG,eAAZ,IAA+B;AAVjC,KAAf;AAaA,UAAMC,OAAO,GAAG,EAAhB;AACA,UAAMC,KAAK,GAAG3B,uBAAuB,EAArC;;AACA,QAAI2B,KAAJ,EAAW;AACVD,MAAAA,OAAO,CAACE,aAAR,oBAAkCD,KAAlC;AACA;;AAED,UAAM;AAAEE,MAAAA;AAAF,QAAWlC,IAAI,CAACmC,GAAL,CAAS,4CAAT,EAAuD;AACvE1B,MAAAA,MADuE;AAEvEsB,MAAAA;AAFuE,KAAvD,CAAjB;AAKA9B,IAAAA,KAAK,CACJiC,IADI,EAEJhC,KAAK,CAACkC,eAAN,CAAsB;AACrBC,MAAAA,QAAQ,EAAE,CACTnC,KAAK,CAACkC,eAAN,CAAsB;AACrBrB,QAAAA,OAAO,EAAEb,KAAK,CAACoC,QAAN,CAAeC,MAAf,CADY;AAErBC,QAAAA,QAAQ,EAAEtC,KAAK,CAACoC,QAAN,CAAeG,OAAf,CAFW;AAGrBC,QAAAA,OAAO,EAAExC,KAAK,CAACoC,QAAN,CAAeC,MAAf;AAHY,OAAtB,CADS,CADW;AAQrBI,MAAAA,MAAM,EAAEzC,KAAK,CAACoC,QAAN,CAAe,CACtBpC,KAAK,CAACkC,eAAN,CAAsB;AACrBQ,QAAAA,EAAE,EAAE1C,KAAK,CAACoC,QAAN,CAAeC,MAAf,CADiB;AAErBM,QAAAA,KAAK,EAAE3C,KAAK,CAACoC,QAAN,CAAeC,MAAf,CAFc;AAGrBO,QAAAA,IAAI,EAAE5C,KAAK,CAACoC,QAAN,CAAeC,MAAf,CAHe;AAIrBQ,QAAAA,aAAa,EAAE7C,KAAK,CAACoC,QAAN,CAAe,CAACpC,KAAK,CAAC8C,GAAP,CAAf,CAJM;AAKrBC,QAAAA,SAAS,EAAE/C,KAAK,CAACoC,QAAN,CAAe,CAACC,MAAD,CAAf,CALU;AAMrBG,QAAAA,OAAO,EAAExC,KAAK,CAACoC,QAAN,CAAeC,MAAf;AANY,OAAtB,CADsB,CAAf;AARa,KAAtB,CAFI,CAAL;AAuBA,WAAOL,IAAP;AACA,GAnDD,CAmDE,OAAOgB,KAAP,EAAc;AACf;AACA;AACA;AAEA,WAAO;AACNb,MAAAA,QAAQ,EAAE,EADJ;AAENM,MAAAA,MAAM,EAAE;AAFF,KAAP;AAIA;AACD,CAvED","sourcesContent":["import os from 'os';\n\nimport { HTTP } from 'meteor/http';\nimport { check, Match } from 'meteor/check';\n\nimport { Settings } from '../../../models';\nimport { Info } from '../../../utils';\nimport { getWorkspaceAccessToken } from '../../../cloud/server';\n\nexport default () => {\n\ttry {\n\t\tconst uniqueID = Settings.findOne('uniqueID');\n\n\t\tconst params = {\n\t\t\tuniqueId: uniqueID.value,\n\t\t\tinstalledAt: uniqueID.createdAt.toJSON(),\n\t\t\tversion: Info.version,\n\t\t\tosType: os.type(),\n\t\t\tosPlatform: os.platform(),\n\t\t\tosArch: os.arch(),\n\t\t\tosRelease: os.release(),\n\t\t\tnodeVersion: process.version,\n\t\t\tdeployMethod: process.env.DEPLOY_METHOD || 'tar',\n\t\t\tdeployPlatform: process.env.DEPLOY_PLATFORM || 'selfinstall',\n\t\t};\n\n\t\tconst headers = {};\n\t\tconst token = getWorkspaceAccessToken();\n\t\tif (token) {\n\t\t\theaders.Authorization = `Bearer ${token}`;\n\t\t}\n\n\t\tconst { data } = HTTP.get('https://releases.rocket.chat/updates/check', {\n\t\t\tparams,\n\t\t\theaders,\n\t\t});\n\n\t\tcheck(\n\t\t\tdata,\n\t\t\tMatch.ObjectIncluding({\n\t\t\t\tversions: [\n\t\t\t\t\tMatch.ObjectIncluding({\n\t\t\t\t\t\tversion: Match.Optional(String),\n\t\t\t\t\t\tsecurity: Match.Optional(Boolean),\n\t\t\t\t\t\tinfoUrl: Match.Optional(String),\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\talerts: Match.Optional([\n\t\t\t\t\tMatch.ObjectIncluding({\n\t\t\t\t\t\tid: Match.Optional(String),\n\t\t\t\t\t\ttitle: Match.Optional(String),\n\t\t\t\t\t\ttext: Match.Optional(String),\n\t\t\t\t\t\ttextArguments: Match.Optional([Match.Any]),\n\t\t\t\t\t\tmodifiers: Match.Optional([String]),\n\t\t\t\t\t\tinfoUrl: Match.Optional(String),\n\t\t\t\t\t}),\n\t\t\t\t]),\n\t\t\t}),\n\t\t);\n\n\t\treturn data;\n\t} catch (error) {\n\t\t// There's no need to log this error\n\t\t// as it's pointless and the user\n\t\t// can't do anything about it anyways\n\n\t\treturn {\n\t\t\tversions: [],\n\t\t\talerts: [],\n\t\t};\n\t}\n};\n"]},"sourceType":"module","hash":"bf6c1121c476a26b4f4548fa6355971fc74f29b9"}
