{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/google-oauth/server/index.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/google-oauth/server/index.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/google-oauth/server/index.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/google-oauth/server/index.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/google-oauth/server/index.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet OAuth;\nmodule.link(\"meteor/oauth\", {\n  OAuth(v) {\n    OAuth = v;\n  }\n\n}, 1);\n// The code on this file was copied directly from Meteor and modified to support mobile google oauth\n// https://github.com/meteor/meteor/blob/ffcfa5062cf1bf8a64ea64fef681ffcd99fe7939/packages/oauth/oauth_server.js\nMeteor.startup(() => {\n  const appRedirectUrl = 'rocketchat://auth';\n\n  const renderEndOfLoginResponse = options => {\n    const escape = s => {\n      if (!s) {\n        return s;\n      }\n\n      return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\\'/g, '&quot;').replace(/\\'/g, '&#x27;').replace(/\\//g, '&#x2F;');\n    };\n\n    const config = {\n      setCredentialToken: !!options.setCredentialToken,\n      credentialToken: escape(options.credentialToken),\n      credentialSecret: escape(options.credentialSecret),\n      storagePrefix: escape(OAuth._storageTokenPrefix),\n      redirectUrl: escape(options.redirectUrl),\n      isCordova: Boolean(options.isCordova)\n    };\n    let template;\n\n    if (options.loginStyle === 'popup') {\n      template = OAuth._endOfPopupResponseTemplate;\n    } else if (options.loginStyle === 'redirect') {\n      template = OAuth._endOfRedirectResponseTemplate;\n    } else {\n      throw new Error(\"invalid loginStyle: \".concat(options.loginStyle));\n    }\n\n    const result = template.replace(/##CONFIG##/, JSON.stringify(config)).replace(/##ROOT_URL_PATH_PREFIX##/, __meteor_runtime_config__.ROOT_URL_PATH_PREFIX);\n    return \"<!DOCTYPE html>\\n\".concat(result);\n  };\n\n  OAuth._endOfLoginResponse = (res, details) => {\n    res.writeHead(200, {\n      'Content-Type': 'text/html'\n    });\n    let redirectUrl;\n\n    if (details.loginStyle === 'redirect') {\n      var _Meteor$settings, _Meteor$settings$pack, _Meteor$settings$pack2;\n\n      redirectUrl = OAuth._stateFromQuery(details.query).redirectUrl;\n      const appHost = Meteor.absoluteUrl();\n\n      if (redirectUrl.startsWith(appRedirectUrl)) {\n        redirectUrl = \"\".concat(appRedirectUrl, \"?host=\").concat(appHost, \"&type=oauth\");\n\n        if (details.error) {\n          const error = encodeURIComponent(details.error.toString());\n          redirectUrl = \"\".concat(redirectUrl, \"&error=\").concat(error);\n        }\n\n        if (details.credentials) {\n          const {\n            token,\n            secret\n          } = details.credentials;\n          redirectUrl = \"\".concat(redirectUrl, \"&credentialToken=\").concat(token, \"&credentialSecret=\").concat(secret);\n        }\n      } else if (!((_Meteor$settings = Meteor.settings) !== null && _Meteor$settings !== void 0 && (_Meteor$settings$pack = _Meteor$settings.packages) !== null && _Meteor$settings$pack !== void 0 && (_Meteor$settings$pack2 = _Meteor$settings$pack.oauth) !== null && _Meteor$settings$pack2 !== void 0 && _Meteor$settings$pack2.disableCheckRedirectUrlOrigin) && OAuth._checkRedirectUrlOrigin(redirectUrl)) {\n        details.error = \"redirectUrl (\".concat(redirectUrl, \") is not on the same host as the app (\").concat(appHost, \")\");\n        redirectUrl = appHost;\n      }\n    }\n\n    const isCordova = OAuth._isCordovaFromQuery(details.query);\n\n    if (details.error) {\n      res.end(renderEndOfLoginResponse({\n        loginStyle: details.loginStyle,\n        setCredentialToken: false,\n        redirectUrl,\n        isCordova\n      }), 'utf-8');\n      return;\n    } // If we have a credentialSecret, report it back to the parent\n    // window, with the corresponding credentialToken. The parent window\n    // uses the credentialToken and credentialSecret to log in over DDP.\n\n\n    res.end(renderEndOfLoginResponse({\n      loginStyle: details.loginStyle,\n      setCredentialToken: true,\n      credentialToken: details.credentials.token,\n      credentialSecret: details.credentials.secret,\n      redirectUrl,\n      isCordova\n    }), 'utf-8');\n  };\n});","map":{"version":3,"sources":["app/google-oauth/server/index.js"],"names":["Meteor","module","link","v","OAuth","startup","appRedirectUrl","renderEndOfLoginResponse","options","escape","s","replace","config","setCredentialToken","credentialToken","credentialSecret","storagePrefix","_storageTokenPrefix","redirectUrl","isCordova","Boolean","template","loginStyle","_endOfPopupResponseTemplate","_endOfRedirectResponseTemplate","Error","result","JSON","stringify","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","_endOfLoginResponse","res","details","writeHead","_stateFromQuery","query","appHost","absoluteUrl","startsWith","error","encodeURIComponent","toString","credentials","token","secret","settings","packages","oauth","disableCheckRedirectUrlOrigin","_checkRedirectUrlOrigin","_isCordovaFromQuery","end"],"mappings":"AAAA,IAAIA,MAAJ;AAAWC,MAAM,CAACC,IAAP,CAAY,eAAZ,EAA4B;AAACF,EAAAA,MAAM,CAACG,CAAD,EAAG;AAACH,IAAAA,MAAM,GAACG,CAAP;AAAS;;AAApB,CAA5B,EAAkD,CAAlD;AAAqD,IAAIC,KAAJ;AAAUH,MAAM,CAACC,IAAP,CAAY,cAAZ,EAA2B;AAACE,EAAAA,KAAK,CAACD,CAAD,EAAG;AAACC,IAAAA,KAAK,GAACD,CAAN;AAAQ;;AAAlB,CAA3B,EAA+C,CAA/C;AAG1E;AACA;AAEAH,MAAM,CAACK,OAAP,CAAe,MAAM;AACpB,QAAMC,cAAc,GAAG,mBAAvB;;AAEA,QAAMC,wBAAwB,GAAIC,OAAD,IAAa;AAC7C,UAAMC,MAAM,GAAIC,CAAD,IAAO;AACrB,UAAI,CAACA,CAAL,EAAQ;AACP,eAAOA,CAAP;AACA;;AAED,aAAOA,CAAC,CACNC,OADK,CACG,IADH,EACS,OADT,EAELA,OAFK,CAEG,IAFH,EAES,MAFT,EAGLA,OAHK,CAGG,IAHH,EAGS,MAHT,EAILA,OAJK,CAIG,KAJH,EAIU,QAJV,EAKLA,OALK,CAKG,KALH,EAKU,QALV,EAMLA,OANK,CAMG,KANH,EAMU,QANV,CAAP;AAOA,KAZD;;AAcA,UAAMC,MAAM,GAAG;AACdC,MAAAA,kBAAkB,EAAE,CAAC,CAACL,OAAO,CAACK,kBADhB;AAEdC,MAAAA,eAAe,EAAEL,MAAM,CAACD,OAAO,CAACM,eAAT,CAFT;AAGdC,MAAAA,gBAAgB,EAAEN,MAAM,CAACD,OAAO,CAACO,gBAAT,CAHV;AAIdC,MAAAA,aAAa,EAAEP,MAAM,CAACL,KAAK,CAACa,mBAAP,CAJP;AAKdC,MAAAA,WAAW,EAAET,MAAM,CAACD,OAAO,CAACU,WAAT,CALL;AAMdC,MAAAA,SAAS,EAAEC,OAAO,CAACZ,OAAO,CAACW,SAAT;AANJ,KAAf;AASA,QAAIE,QAAJ;;AACA,QAAIb,OAAO,CAACc,UAAR,KAAuB,OAA3B,EAAoC;AACnCD,MAAAA,QAAQ,GAAGjB,KAAK,CAACmB,2BAAjB;AACA,KAFD,MAEO,IAAIf,OAAO,CAACc,UAAR,KAAuB,UAA3B,EAAuC;AAC7CD,MAAAA,QAAQ,GAAGjB,KAAK,CAACoB,8BAAjB;AACA,KAFM,MAEA;AACN,YAAM,IAAIC,KAAJ,+BAAiCjB,OAAO,CAACc,UAAzC,EAAN;AACA;;AAED,UAAMI,MAAM,GAAGL,QAAQ,CACrBV,OADa,CACL,YADK,EACSgB,IAAI,CAACC,SAAL,CAAehB,MAAf,CADT,EAEbD,OAFa,CAEL,0BAFK,EAEuBkB,yBAAyB,CAACC,oBAFjD,CAAf;AAIA,sCAA2BJ,MAA3B;AACA,GAtCD;;AAwCAtB,EAAAA,KAAK,CAAC2B,mBAAN,GAA4B,CAACC,GAAD,EAAMC,OAAN,KAAkB;AAC7CD,IAAAA,GAAG,CAACE,SAAJ,CAAc,GAAd,EAAmB;AAAE,sBAAgB;AAAlB,KAAnB;AACA,QAAIhB,WAAJ;;AAEA,QAAIe,OAAO,CAACX,UAAR,KAAuB,UAA3B,EAAuC;AAAA;;AACtCJ,MAAAA,WAAW,GAAGd,KAAK,CAAC+B,eAAN,CAAsBF,OAAO,CAACG,KAA9B,EAAqClB,WAAnD;AACA,YAAMmB,OAAO,GAAGrC,MAAM,CAACsC,WAAP,EAAhB;;AAEA,UAAIpB,WAAW,CAACqB,UAAZ,CAAuBjC,cAAvB,CAAJ,EAA4C;AAC3CY,QAAAA,WAAW,aAAMZ,cAAN,mBAA6B+B,OAA7B,gBAAX;;AAEA,YAAIJ,OAAO,CAACO,KAAZ,EAAmB;AAClB,gBAAMA,KAAK,GAAGC,kBAAkB,CAACR,OAAO,CAACO,KAAR,CAAcE,QAAd,EAAD,CAAhC;AACAxB,UAAAA,WAAW,aAAMA,WAAN,oBAA2BsB,KAA3B,CAAX;AACA;;AAED,YAAIP,OAAO,CAACU,WAAZ,EAAyB;AACxB,gBAAM;AAAEC,YAAAA,KAAF;AAASC,YAAAA;AAAT,cAAoBZ,OAAO,CAACU,WAAlC;AACAzB,UAAAA,WAAW,aAAMA,WAAN,8BAAqC0B,KAArC,+BAA+DC,MAA/D,CAAX;AACA;AACD,OAZD,MAYO,IAAI,sBAAC7C,MAAM,CAAC8C,QAAR,sEAAC,iBAAiBC,QAAlB,4EAAC,sBAA2BC,KAA5B,mDAAC,uBAAkCC,6BAAnC,KAAoE7C,KAAK,CAAC8C,uBAAN,CAA8BhC,WAA9B,CAAxE,EAAoH;AAC1He,QAAAA,OAAO,CAACO,KAAR,0BAAgCtB,WAAhC,mDAAoFmB,OAApF;AACAnB,QAAAA,WAAW,GAAGmB,OAAd;AACA;AACD;;AAED,UAAMlB,SAAS,GAAGf,KAAK,CAAC+C,mBAAN,CAA0BlB,OAAO,CAACG,KAAlC,CAAlB;;AAEA,QAAIH,OAAO,CAACO,KAAZ,EAAmB;AAClBR,MAAAA,GAAG,CAACoB,GAAJ,CACC7C,wBAAwB,CAAC;AACxBe,QAAAA,UAAU,EAAEW,OAAO,CAACX,UADI;AAExBT,QAAAA,kBAAkB,EAAE,KAFI;AAGxBK,QAAAA,WAHwB;AAIxBC,QAAAA;AAJwB,OAAD,CADzB,EAOC,OAPD;AASA;AACA,KAvC4C,CAyC7C;AACA;AACA;;;AACAa,IAAAA,GAAG,CAACoB,GAAJ,CACC7C,wBAAwB,CAAC;AACxBe,MAAAA,UAAU,EAAEW,OAAO,CAACX,UADI;AAExBT,MAAAA,kBAAkB,EAAE,IAFI;AAGxBC,MAAAA,eAAe,EAAEmB,OAAO,CAACU,WAAR,CAAoBC,KAHb;AAIxB7B,MAAAA,gBAAgB,EAAEkB,OAAO,CAACU,WAAR,CAAoBE,MAJd;AAKxB3B,MAAAA,WALwB;AAMxBC,MAAAA;AANwB,KAAD,CADzB,EASC,OATD;AAWA,GAvDD;AAwDA,CAnGD","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { OAuth } from 'meteor/oauth';\n\n// The code on this file was copied directly from Meteor and modified to support mobile google oauth\n// https://github.com/meteor/meteor/blob/ffcfa5062cf1bf8a64ea64fef681ffcd99fe7939/packages/oauth/oauth_server.js\n\nMeteor.startup(() => {\n\tconst appRedirectUrl = 'rocketchat://auth';\n\n\tconst renderEndOfLoginResponse = (options) => {\n\t\tconst escape = (s) => {\n\t\t\tif (!s) {\n\t\t\t\treturn s;\n\t\t\t}\n\n\t\t\treturn s\n\t\t\t\t.replace(/&/g, '&amp;')\n\t\t\t\t.replace(/</g, '&lt;')\n\t\t\t\t.replace(/>/g, '&gt;')\n\t\t\t\t.replace(/\\'/g, '&quot;')\n\t\t\t\t.replace(/\\'/g, '&#x27;')\n\t\t\t\t.replace(/\\//g, '&#x2F;');\n\t\t};\n\n\t\tconst config = {\n\t\t\tsetCredentialToken: !!options.setCredentialToken,\n\t\t\tcredentialToken: escape(options.credentialToken),\n\t\t\tcredentialSecret: escape(options.credentialSecret),\n\t\t\tstoragePrefix: escape(OAuth._storageTokenPrefix),\n\t\t\tredirectUrl: escape(options.redirectUrl),\n\t\t\tisCordova: Boolean(options.isCordova),\n\t\t};\n\n\t\tlet template;\n\t\tif (options.loginStyle === 'popup') {\n\t\t\ttemplate = OAuth._endOfPopupResponseTemplate;\n\t\t} else if (options.loginStyle === 'redirect') {\n\t\t\ttemplate = OAuth._endOfRedirectResponseTemplate;\n\t\t} else {\n\t\t\tthrow new Error(`invalid loginStyle: ${options.loginStyle}`);\n\t\t}\n\n\t\tconst result = template\n\t\t\t.replace(/##CONFIG##/, JSON.stringify(config))\n\t\t\t.replace(/##ROOT_URL_PATH_PREFIX##/, __meteor_runtime_config__.ROOT_URL_PATH_PREFIX);\n\n\t\treturn `<!DOCTYPE html>\\n${result}`;\n\t};\n\n\tOAuth._endOfLoginResponse = (res, details) => {\n\t\tres.writeHead(200, { 'Content-Type': 'text/html' });\n\t\tlet redirectUrl;\n\n\t\tif (details.loginStyle === 'redirect') {\n\t\t\tredirectUrl = OAuth._stateFromQuery(details.query).redirectUrl;\n\t\t\tconst appHost = Meteor.absoluteUrl();\n\n\t\t\tif (redirectUrl.startsWith(appRedirectUrl)) {\n\t\t\t\tredirectUrl = `${appRedirectUrl}?host=${appHost}&type=oauth`;\n\n\t\t\t\tif (details.error) {\n\t\t\t\t\tconst error = encodeURIComponent(details.error.toString());\n\t\t\t\t\tredirectUrl = `${redirectUrl}&error=${error}`;\n\t\t\t\t}\n\n\t\t\t\tif (details.credentials) {\n\t\t\t\t\tconst { token, secret } = details.credentials;\n\t\t\t\t\tredirectUrl = `${redirectUrl}&credentialToken=${token}&credentialSecret=${secret}`;\n\t\t\t\t}\n\t\t\t} else if (!Meteor.settings?.packages?.oauth?.disableCheckRedirectUrlOrigin && OAuth._checkRedirectUrlOrigin(redirectUrl)) {\n\t\t\t\tdetails.error = `redirectUrl (${redirectUrl}) is not on the same host as the app (${appHost})`;\n\t\t\t\tredirectUrl = appHost;\n\t\t\t}\n\t\t}\n\n\t\tconst isCordova = OAuth._isCordovaFromQuery(details.query);\n\n\t\tif (details.error) {\n\t\t\tres.end(\n\t\t\t\trenderEndOfLoginResponse({\n\t\t\t\t\tloginStyle: details.loginStyle,\n\t\t\t\t\tsetCredentialToken: false,\n\t\t\t\t\tredirectUrl,\n\t\t\t\t\tisCordova,\n\t\t\t\t}),\n\t\t\t\t'utf-8',\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t// If we have a credentialSecret, report it back to the parent\n\t\t// window, with the corresponding credentialToken. The parent window\n\t\t// uses the credentialToken and credentialSecret to log in over DDP.\n\t\tres.end(\n\t\t\trenderEndOfLoginResponse({\n\t\t\t\tloginStyle: details.loginStyle,\n\t\t\t\tsetCredentialToken: true,\n\t\t\t\tcredentialToken: details.credentials.token,\n\t\t\t\tcredentialSecret: details.credentials.secret,\n\t\t\t\tredirectUrl,\n\t\t\t\tisCordova,\n\t\t\t}),\n\t\t\t'utf-8',\n\t\t);\n\t};\n});\n"]},"sourceType":"module","hash":"be54e404bf2a3e7c8f7bda9a844493fe02af99c1"}
