{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/apps/server/converters/rooms.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/apps/server/converters/rooms.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/apps/server/converters/rooms.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/apps/server/converters/rooms.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/apps/server/converters/rooms.js"}},"code":"let _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nmodule.export({\n  AppRoomsConverter: () => AppRoomsConverter\n});\nlet RoomType;\nmodule.link(\"@rocket.chat/apps-engine/definition/rooms\", {\n  RoomType(v) {\n    RoomType = v;\n  }\n\n}, 0);\nlet Rooms, Users, LivechatVisitors, LivechatDepartment;\nmodule.link(\"../../../models\", {\n  Rooms(v) {\n    Rooms = v;\n  },\n\n  Users(v) {\n    Users = v;\n  },\n\n  LivechatVisitors(v) {\n    LivechatVisitors = v;\n  },\n\n  LivechatDepartment(v) {\n    LivechatDepartment = v;\n  }\n\n}, 1);\nlet transformMappedData;\nmodule.link(\"../../lib/misc/transformMappedData\", {\n  transformMappedData(v) {\n    transformMappedData = v;\n  }\n\n}, 2);\n\nclass AppRoomsConverter {\n  constructor(orch) {\n    this.orch = orch;\n  }\n\n  convertById(roomId) {\n    const room = Rooms.findOneById(roomId);\n    return this.convertRoom(room);\n  }\n\n  convertByName(roomName) {\n    const room = Rooms.findOneByName(roomName);\n    return this.convertRoom(room);\n  }\n\n  convertAppRoom(room) {\n    if (!room) {\n      return undefined;\n    }\n\n    let u;\n\n    if (room.creator) {\n      const creator = Users.findOneById(room.creator.id);\n      u = {\n        _id: creator._id,\n        username: creator.username\n      };\n    }\n\n    let v;\n\n    if (room.visitor) {\n      const visitor = LivechatVisitors.findOneById(room.visitor.id);\n      v = {\n        _id: visitor._id,\n        username: visitor.username,\n        token: visitor.token\n      };\n    }\n\n    let departmentId;\n\n    if (room.department) {\n      const department = LivechatDepartment.findOneById(room.department.id);\n      departmentId = department._id;\n    }\n\n    let servedBy;\n\n    if (room.servedBy) {\n      const user = Users.findOneById(room.servedBy.id);\n      servedBy = {\n        _id: user._id,\n        username: user.username\n      };\n    }\n\n    let closedBy;\n\n    if (room.closedBy) {\n      const user = Users.findOneById(room.closedBy.id);\n      closedBy = {\n        _id: user._id,\n        username: user.username\n      };\n    }\n\n    const newRoom = _objectSpread(_objectSpread(_objectSpread({}, room.id && {\n      _id: room.id\n    }), {}, {\n      fname: room.displayName,\n      name: room.slugifiedName,\n      t: room.type,\n      u,\n      v,\n      departmentId,\n      servedBy,\n      closedBy,\n      members: room.members,\n      uids: room.userIds,\n      default: typeof room.isDefault === 'undefined' ? false : room.isDefault,\n      ro: typeof room.isReadOnly === 'undefined' ? false : room.isReadOnly,\n      sysMes: typeof room.displaySystemMessages === 'undefined' ? true : room.displaySystemMessages,\n      waitingResponse: typeof room.isWaitingResponse === 'undefined' ? undefined : !!room.isWaitingResponse,\n      open: typeof room.isOpen === 'undefined' ? undefined : !!room.isOpen,\n      msgs: room.messageCount || 0,\n      ts: room.createdAt,\n      _updatedAt: room.updatedAt,\n      closedAt: room.closedAt,\n      lm: room.lastModifiedAt,\n      customFields: room.customFields,\n      livechatData: room.livechatData,\n      prid: typeof room.parentRoom === 'undefined' ? undefined : room.parentRoom.id\n    }, room._USERNAMES && {\n      _USERNAMES: room._USERNAMES\n    }), room.source && {\n      source: _objectSpread({}, room.source)\n    });\n\n    return Object.assign(newRoom, room._unmappedProperties_);\n  }\n\n  convertRoom(room) {\n    if (!room) {\n      return undefined;\n    }\n\n    const map = {\n      id: '_id',\n      displayName: 'fname',\n      slugifiedName: 'name',\n      members: 'members',\n      userIds: 'uids',\n      messageCount: 'msgs',\n      createdAt: 'ts',\n      updatedAt: '_updatedAt',\n      closedAt: 'closedAt',\n      lastModifiedAt: 'lm',\n      customFields: 'customFields',\n      livechatData: 'livechatData',\n      isWaitingResponse: 'waitingResponse',\n      isOpen: 'open',\n      _USERNAMES: '_USERNAMES',\n      description: 'description',\n      source: 'source',\n      isDefault: room => {\n        const result = !!room.default;\n        delete room.default;\n        return result;\n      },\n      isReadOnly: room => {\n        const result = !!room.ro;\n        delete room.ro;\n        return result;\n      },\n      displaySystemMessages: room => {\n        const {\n          sysMes\n        } = room;\n\n        if (typeof sysMes === 'undefined') {\n          return true;\n        }\n\n        delete room.sysMes;\n        return sysMes;\n      },\n      type: room => {\n        const result = this._convertTypeToApp(room.t);\n\n        delete room.t;\n        return result;\n      },\n      creator: room => {\n        const {\n          u\n        } = room;\n\n        if (!u) {\n          return undefined;\n        }\n\n        delete room.u;\n        return this.orch.getConverters().get('users').convertById(u._id);\n      },\n      visitor: room => {\n        const {\n          v\n        } = room;\n\n        if (!v) {\n          return undefined;\n        }\n\n        delete room.v;\n        return this.orch.getConverters().get('visitors').convertById(v._id);\n      },\n      department: room => {\n        const {\n          departmentId\n        } = room;\n\n        if (!departmentId) {\n          return undefined;\n        }\n\n        delete room.departmentId;\n        return this.orch.getConverters().get('departments').convertById(departmentId);\n      },\n      servedBy: room => {\n        const {\n          servedBy\n        } = room;\n\n        if (!servedBy) {\n          return undefined;\n        }\n\n        delete room.servedBy;\n        return this.orch.getConverters().get('users').convertById(servedBy._id);\n      },\n      responseBy: room => {\n        const {\n          responseBy\n        } = room;\n\n        if (!responseBy) {\n          return undefined;\n        }\n\n        delete room.responseBy;\n        return this.orch.getConverters().get('users').convertById(responseBy._id);\n      },\n      parentRoom: room => {\n        const {\n          prid\n        } = room;\n\n        if (!prid) {\n          return undefined;\n        }\n\n        delete room.prid;\n        return this.orch.getConverters().get('rooms').convertById(prid);\n      }\n    };\n    return transformMappedData(room, map);\n  }\n\n  _convertTypeToApp(typeChar) {\n    switch (typeChar) {\n      case 'c':\n        return RoomType.CHANNEL;\n\n      case 'p':\n        return RoomType.PRIVATE_GROUP;\n\n      case 'd':\n        return RoomType.DIRECT_MESSAGE;\n\n      case 'l':\n        return RoomType.LIVE_CHAT;\n\n      default:\n        return typeChar;\n    }\n  }\n\n}","map":{"version":3,"sources":["app/apps/server/converters/rooms.js"],"names":["_objectSpread","module","link","default","v","export","AppRoomsConverter","RoomType","Rooms","Users","LivechatVisitors","LivechatDepartment","transformMappedData","constructor","orch","convertById","roomId","room","findOneById","convertRoom","convertByName","roomName","findOneByName","convertAppRoom","undefined","u","creator","id","_id","username","visitor","token","departmentId","department","servedBy","user","closedBy","newRoom","fname","displayName","name","slugifiedName","t","type","members","uids","userIds","isDefault","ro","isReadOnly","sysMes","displaySystemMessages","waitingResponse","isWaitingResponse","open","isOpen","msgs","messageCount","ts","createdAt","_updatedAt","updatedAt","closedAt","lm","lastModifiedAt","customFields","livechatData","prid","parentRoom","_USERNAMES","source","Object","assign","_unmappedProperties_","map","description","result","_convertTypeToApp","getConverters","get","responseBy","typeChar","CHANNEL","PRIVATE_GROUP","DIRECT_MESSAGE","LIVE_CHAT"],"mappings":"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","sourcesContent":["import { RoomType } from '@rocket.chat/apps-engine/definition/rooms';\n\nimport { Rooms, Users, LivechatVisitors, LivechatDepartment } from '../../../models';\nimport { transformMappedData } from '../../lib/misc/transformMappedData';\n\nexport class AppRoomsConverter {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tconvertById(roomId) {\n\t\tconst room = Rooms.findOneById(roomId);\n\n\t\treturn this.convertRoom(room);\n\t}\n\n\tconvertByName(roomName) {\n\t\tconst room = Rooms.findOneByName(roomName);\n\n\t\treturn this.convertRoom(room);\n\t}\n\n\tconvertAppRoom(room) {\n\t\tif (!room) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tlet u;\n\t\tif (room.creator) {\n\t\t\tconst creator = Users.findOneById(room.creator.id);\n\t\t\tu = {\n\t\t\t\t_id: creator._id,\n\t\t\t\tusername: creator.username,\n\t\t\t};\n\t\t}\n\n\t\tlet v;\n\t\tif (room.visitor) {\n\t\t\tconst visitor = LivechatVisitors.findOneById(room.visitor.id);\n\t\t\tv = {\n\t\t\t\t_id: visitor._id,\n\t\t\t\tusername: visitor.username,\n\t\t\t\ttoken: visitor.token,\n\t\t\t};\n\t\t}\n\n\t\tlet departmentId;\n\t\tif (room.department) {\n\t\t\tconst department = LivechatDepartment.findOneById(room.department.id);\n\t\t\tdepartmentId = department._id;\n\t\t}\n\n\t\tlet servedBy;\n\t\tif (room.servedBy) {\n\t\t\tconst user = Users.findOneById(room.servedBy.id);\n\t\t\tservedBy = {\n\t\t\t\t_id: user._id,\n\t\t\t\tusername: user.username,\n\t\t\t};\n\t\t}\n\n\t\tlet closedBy;\n\t\tif (room.closedBy) {\n\t\t\tconst user = Users.findOneById(room.closedBy.id);\n\t\t\tclosedBy = {\n\t\t\t\t_id: user._id,\n\t\t\t\tusername: user.username,\n\t\t\t};\n\t\t}\n\n\t\tconst newRoom = {\n\t\t\t...(room.id && { _id: room.id }),\n\t\t\tfname: room.displayName,\n\t\t\tname: room.slugifiedName,\n\t\t\tt: room.type,\n\t\t\tu,\n\t\t\tv,\n\t\t\tdepartmentId,\n\t\t\tservedBy,\n\t\t\tclosedBy,\n\t\t\tmembers: room.members,\n\t\t\tuids: room.userIds,\n\t\t\tdefault: typeof room.isDefault === 'undefined' ? false : room.isDefault,\n\t\t\tro: typeof room.isReadOnly === 'undefined' ? false : room.isReadOnly,\n\t\t\tsysMes: typeof room.displaySystemMessages === 'undefined' ? true : room.displaySystemMessages,\n\t\t\twaitingResponse: typeof room.isWaitingResponse === 'undefined' ? undefined : !!room.isWaitingResponse,\n\t\t\topen: typeof room.isOpen === 'undefined' ? undefined : !!room.isOpen,\n\t\t\tmsgs: room.messageCount || 0,\n\t\t\tts: room.createdAt,\n\t\t\t_updatedAt: room.updatedAt,\n\t\t\tclosedAt: room.closedAt,\n\t\t\tlm: room.lastModifiedAt,\n\t\t\tcustomFields: room.customFields,\n\t\t\tlivechatData: room.livechatData,\n\t\t\tprid: typeof room.parentRoom === 'undefined' ? undefined : room.parentRoom.id,\n\t\t\t...(room._USERNAMES && { _USERNAMES: room._USERNAMES }),\n\t\t\t...(room.source && {\n\t\t\t\tsource: {\n\t\t\t\t\t...room.source,\n\t\t\t\t},\n\t\t\t}),\n\t\t};\n\n\t\treturn Object.assign(newRoom, room._unmappedProperties_);\n\t}\n\n\tconvertRoom(room) {\n\t\tif (!room) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst map = {\n\t\t\tid: '_id',\n\t\t\tdisplayName: 'fname',\n\t\t\tslugifiedName: 'name',\n\t\t\tmembers: 'members',\n\t\t\tuserIds: 'uids',\n\t\t\tmessageCount: 'msgs',\n\t\t\tcreatedAt: 'ts',\n\t\t\tupdatedAt: '_updatedAt',\n\t\t\tclosedAt: 'closedAt',\n\t\t\tlastModifiedAt: 'lm',\n\t\t\tcustomFields: 'customFields',\n\t\t\tlivechatData: 'livechatData',\n\t\t\tisWaitingResponse: 'waitingResponse',\n\t\t\tisOpen: 'open',\n\t\t\t_USERNAMES: '_USERNAMES',\n\t\t\tdescription: 'description',\n\t\t\tsource: 'source',\n\t\t\tisDefault: (room) => {\n\t\t\t\tconst result = !!room.default;\n\t\t\t\tdelete room.default;\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\tisReadOnly: (room) => {\n\t\t\t\tconst result = !!room.ro;\n\t\t\t\tdelete room.ro;\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\tdisplaySystemMessages: (room) => {\n\t\t\t\tconst { sysMes } = room;\n\n\t\t\t\tif (typeof sysMes === 'undefined') {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tdelete room.sysMes;\n\t\t\t\treturn sysMes;\n\t\t\t},\n\t\t\ttype: (room) => {\n\t\t\t\tconst result = this._convertTypeToApp(room.t);\n\t\t\t\tdelete room.t;\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\tcreator: (room) => {\n\t\t\t\tconst { u } = room;\n\n\t\t\t\tif (!u) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tdelete room.u;\n\n\t\t\t\treturn this.orch.getConverters().get('users').convertById(u._id);\n\t\t\t},\n\t\t\tvisitor: (room) => {\n\t\t\t\tconst { v } = room;\n\n\t\t\t\tif (!v) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tdelete room.v;\n\n\t\t\t\treturn this.orch.getConverters().get('visitors').convertById(v._id);\n\t\t\t},\n\t\t\tdepartment: (room) => {\n\t\t\t\tconst { departmentId } = room;\n\n\t\t\t\tif (!departmentId) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tdelete room.departmentId;\n\n\t\t\t\treturn this.orch.getConverters().get('departments').convertById(departmentId);\n\t\t\t},\n\t\t\tservedBy: (room) => {\n\t\t\t\tconst { servedBy } = room;\n\n\t\t\t\tif (!servedBy) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tdelete room.servedBy;\n\n\t\t\t\treturn this.orch.getConverters().get('users').convertById(servedBy._id);\n\t\t\t},\n\t\t\tresponseBy: (room) => {\n\t\t\t\tconst { responseBy } = room;\n\n\t\t\t\tif (!responseBy) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tdelete room.responseBy;\n\n\t\t\t\treturn this.orch.getConverters().get('users').convertById(responseBy._id);\n\t\t\t},\n\t\t\tparentRoom: (room) => {\n\t\t\t\tconst { prid } = room;\n\n\t\t\t\tif (!prid) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tdelete room.prid;\n\n\t\t\t\treturn this.orch.getConverters().get('rooms').convertById(prid);\n\t\t\t},\n\t\t};\n\n\t\treturn transformMappedData(room, map);\n\t}\n\n\t_convertTypeToApp(typeChar) {\n\t\tswitch (typeChar) {\n\t\t\tcase 'c':\n\t\t\t\treturn RoomType.CHANNEL;\n\t\t\tcase 'p':\n\t\t\t\treturn RoomType.PRIVATE_GROUP;\n\t\t\tcase 'd':\n\t\t\t\treturn RoomType.DIRECT_MESSAGE;\n\t\t\tcase 'l':\n\t\t\t\treturn RoomType.LIVE_CHAT;\n\t\t\tdefault:\n\t\t\t\treturn typeChar;\n\t\t}\n\t}\n}\n"]},"sourceType":"module","hash":"643d81a8060bed33cb3a212e66ea9ed1d21efdc6"}
