{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/apps/server/converters/users.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/apps/server/converters/users.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/apps/server/converters/users.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/apps/server/converters/users.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/apps/server/converters/users.js"}},"code":"module.export({\n  AppUsersConverter: () => AppUsersConverter\n});\nlet UserStatusConnection, UserType;\nmodule.link(\"@rocket.chat/apps-engine/definition/users\", {\n  UserStatusConnection(v) {\n    UserStatusConnection = v;\n  },\n\n  UserType(v) {\n    UserType = v;\n  }\n\n}, 0);\nlet Users;\nmodule.link(\"../../../models\", {\n  Users(v) {\n    Users = v;\n  }\n\n}, 1);\n\nclass AppUsersConverter {\n  constructor(orch) {\n    this.orch = orch;\n  }\n\n  convertById(userId) {\n    const user = Users.findOneById(userId);\n    return this.convertToApp(user);\n  }\n\n  convertByUsername(username) {\n    const user = Users.findOneByUsername(username);\n    return this.convertToApp(user);\n  }\n\n  convertToApp(user) {\n    if (!user) {\n      return undefined;\n    }\n\n    const type = this._convertUserTypeToEnum(user.type);\n\n    const statusConnection = this._convertStatusConnectionToEnum(user.username, user._id, user.statusConnection);\n\n    return {\n      id: user._id,\n      username: user.username,\n      emails: user.emails,\n      type,\n      isEnabled: user.active,\n      name: user.name,\n      roles: user.roles,\n      status: user.status,\n      statusConnection,\n      utcOffset: user.utcOffset,\n      createdAt: user.createdAt,\n      updatedAt: user._updatedAt,\n      lastLoginAt: user.lastLogin,\n      appId: user.appId,\n      customFields: user.customFields\n    };\n  }\n\n  convertToRocketChat(user) {\n    if (!user) {\n      return undefined;\n    }\n\n    return {\n      _id: user.id,\n      username: user.username,\n      emails: user.emails,\n      type: user.type,\n      active: user.isEnabled,\n      name: user.name,\n      roles: user.roles,\n      status: user.status,\n      statusConnection: user.statusConnection,\n      utcOffset: user.utfOffset,\n      createdAt: user.createdAt,\n      _updatedAt: user.updatedAt,\n      lastLogin: user.lastLoginAt,\n      appId: user.appId\n    };\n  }\n\n  _convertUserTypeToEnum(type) {\n    switch (type) {\n      case 'user':\n        return UserType.USER;\n\n      case 'bot':\n        return UserType.BOT;\n\n      case 'app':\n        return UserType.APP;\n\n      case '':\n      case undefined:\n        return UserType.UNKNOWN;\n\n      default:\n        console.warn(\"A new user type has been added that the Apps don't know about? \\\"\".concat(type, \"\\\"\"));\n        return type.toUpperCase();\n    }\n  }\n\n  _convertStatusConnectionToEnum(username, userId, status) {\n    switch (status) {\n      case 'offline':\n        return UserStatusConnection.OFFLINE;\n\n      case 'online':\n        return UserStatusConnection.ONLINE;\n\n      case 'away':\n        return UserStatusConnection.AWAY;\n\n      case 'busy':\n        return UserStatusConnection.BUSY;\n\n      case undefined:\n        // This is needed for Livechat guests and Rocket.Cat user.\n        return UserStatusConnection.UNDEFINED;\n\n      default:\n        console.warn(\"The user \".concat(username, \" (\").concat(userId, \") does not have a valid status (offline, online, away, or busy). It is currently: \\\"\").concat(status, \"\\\"\"));\n        return !status ? UserStatusConnection.OFFLINE : status.toUpperCase();\n    }\n  }\n\n}","map":{"version":3,"sources":["app/apps/server/converters/users.js"],"names":["module","export","AppUsersConverter","UserStatusConnection","UserType","link","v","Users","constructor","orch","convertById","userId","user","findOneById","convertToApp","convertByUsername","username","findOneByUsername","undefined","type","_convertUserTypeToEnum","statusConnection","_convertStatusConnectionToEnum","_id","id","emails","isEnabled","active","name","roles","status","utcOffset","createdAt","updatedAt","_updatedAt","lastLoginAt","lastLogin","appId","customFields","convertToRocketChat","utfOffset","USER","BOT","APP","UNKNOWN","console","warn","toUpperCase","OFFLINE","ONLINE","AWAY","BUSY","UNDEFINED"],"mappings":"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","sourcesContent":["import { UserStatusConnection, UserType } from '@rocket.chat/apps-engine/definition/users';\n\nimport { Users } from '../../../models';\n\nexport class AppUsersConverter {\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tconvertById(userId) {\n\t\tconst user = Users.findOneById(userId);\n\n\t\treturn this.convertToApp(user);\n\t}\n\n\tconvertByUsername(username) {\n\t\tconst user = Users.findOneByUsername(username);\n\n\t\treturn this.convertToApp(user);\n\t}\n\n\tconvertToApp(user) {\n\t\tif (!user) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst type = this._convertUserTypeToEnum(user.type);\n\t\tconst statusConnection = this._convertStatusConnectionToEnum(user.username, user._id, user.statusConnection);\n\n\t\treturn {\n\t\t\tid: user._id,\n\t\t\tusername: user.username,\n\t\t\temails: user.emails,\n\t\t\ttype,\n\t\t\tisEnabled: user.active,\n\t\t\tname: user.name,\n\t\t\troles: user.roles,\n\t\t\tstatus: user.status,\n\t\t\tstatusConnection,\n\t\t\tutcOffset: user.utcOffset,\n\t\t\tcreatedAt: user.createdAt,\n\t\t\tupdatedAt: user._updatedAt,\n\t\t\tlastLoginAt: user.lastLogin,\n\t\t\tappId: user.appId,\n\t\t\tcustomFields: user.customFields,\n\t\t};\n\t}\n\n\tconvertToRocketChat(user) {\n\t\tif (!user) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\t_id: user.id,\n\t\t\tusername: user.username,\n\t\t\temails: user.emails,\n\t\t\ttype: user.type,\n\t\t\tactive: user.isEnabled,\n\t\t\tname: user.name,\n\t\t\troles: user.roles,\n\t\t\tstatus: user.status,\n\t\t\tstatusConnection: user.statusConnection,\n\t\t\tutcOffset: user.utfOffset,\n\t\t\tcreatedAt: user.createdAt,\n\t\t\t_updatedAt: user.updatedAt,\n\t\t\tlastLogin: user.lastLoginAt,\n\t\t\tappId: user.appId,\n\t\t};\n\t}\n\n\t_convertUserTypeToEnum(type) {\n\t\tswitch (type) {\n\t\t\tcase 'user':\n\t\t\t\treturn UserType.USER;\n\t\t\tcase 'bot':\n\t\t\t\treturn UserType.BOT;\n\t\t\tcase 'app':\n\t\t\t\treturn UserType.APP;\n\t\t\tcase '':\n\t\t\tcase undefined:\n\t\t\t\treturn UserType.UNKNOWN;\n\t\t\tdefault:\n\t\t\t\tconsole.warn(`A new user type has been added that the Apps don't know about? \"${type}\"`);\n\t\t\t\treturn type.toUpperCase();\n\t\t}\n\t}\n\n\t_convertStatusConnectionToEnum(username, userId, status) {\n\t\tswitch (status) {\n\t\t\tcase 'offline':\n\t\t\t\treturn UserStatusConnection.OFFLINE;\n\t\t\tcase 'online':\n\t\t\t\treturn UserStatusConnection.ONLINE;\n\t\t\tcase 'away':\n\t\t\t\treturn UserStatusConnection.AWAY;\n\t\t\tcase 'busy':\n\t\t\t\treturn UserStatusConnection.BUSY;\n\t\t\tcase undefined:\n\t\t\t\t// This is needed for Livechat guests and Rocket.Cat user.\n\t\t\t\treturn UserStatusConnection.UNDEFINED;\n\t\t\tdefault:\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`The user ${username} (${userId}) does not have a valid status (offline, online, away, or busy). It is currently: \"${status}\"`,\n\t\t\t\t);\n\t\t\t\treturn !status ? UserStatusConnection.OFFLINE : status.toUpperCase();\n\t\t}\n\t}\n}\n"]},"sourceType":"module","hash":"ca5c0aad45be54b6462e7709cf3bb1748a03f3e4"}
