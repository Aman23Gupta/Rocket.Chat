{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/mentions/server/Mentions.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/mentions/server/Mentions.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/mentions/server/Mentions.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/mentions/server/Mentions.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/mentions/server/Mentions.js"}},"code":"module.export({\n  default: () => MentionsServer\n});\nlet MentionsParser;\nmodule.link(\"../lib/MentionsParser\", {\n  MentionsParser(v) {\n    MentionsParser = v;\n  }\n\n}, 0);\n\nclass MentionsServer extends MentionsParser {\n  constructor(args) {\n    super(args);\n    this.messageMaxAll = args.messageMaxAll;\n    this.getChannel = args.getChannel;\n    this.getChannels = args.getChannels;\n    this.getUsers = args.getUsers;\n    this.getUser = args.getUser;\n    this.getTotalChannelMembers = args.getTotalChannelMembers;\n\n    this.onMaxRoomMembersExceeded = args.onMaxRoomMembersExceeded || (() => {});\n  }\n\n  set getUsers(m) {\n    this._getUsers = m;\n  }\n\n  get getUsers() {\n    return typeof this._getUsers === 'function' ? this._getUsers : () => this._getUsers;\n  }\n\n  set getChannels(m) {\n    this._getChannels = m;\n  }\n\n  get getChannels() {\n    return typeof this._getChannels === 'function' ? this._getChannels : () => this._getChannels;\n  }\n\n  set getChannel(m) {\n    this._getChannel = m;\n  }\n\n  get getChannel() {\n    return typeof this._getChannel === 'function' ? this._getChannel : () => this._getChannel;\n  }\n\n  set messageMaxAll(m) {\n    this._messageMaxAll = m;\n  }\n\n  get messageMaxAll() {\n    return typeof this._messageMaxAll === 'function' ? this._messageMaxAll() : this._messageMaxAll;\n  }\n\n  getUsersByMentions(_ref) {\n    let {\n      msg,\n      rid,\n      u: sender\n    } = _ref;\n    let mentions = this.getUserMentions(msg);\n    const mentionsAll = [];\n    const userMentions = [];\n    mentions.forEach(m => {\n      const mention = m.trim().substr(1);\n\n      if (mention !== 'all' && mention !== 'here') {\n        return userMentions.push(mention);\n      }\n\n      if (this.messageMaxAll > 0 && this.getTotalChannelMembers(rid) > this.messageMaxAll) {\n        return this.onMaxRoomMembersExceeded({\n          sender,\n          rid\n        });\n      }\n\n      mentionsAll.push({\n        _id: mention,\n        username: mention\n      });\n    });\n    mentions = userMentions.length ? this.getUsers(userMentions) : [];\n    return [...mentionsAll, ...mentions];\n  }\n\n  getChannelbyMentions(_ref2) {\n    let {\n      msg\n    } = _ref2;\n    const channels = this.getChannelMentions(msg);\n    return this.getChannels(channels.map(c => c.trim().substr(1)));\n  }\n\n  execute(message) {\n    const mentionsAll = this.getUsersByMentions(message);\n    const channels = this.getChannelbyMentions(message);\n    message.mentions = mentionsAll;\n    message.channels = channels;\n    return message;\n  }\n\n}","map":{"version":3,"sources":["app/mentions/server/Mentions.js"],"names":["module","export","default","MentionsServer","MentionsParser","link","v","constructor","args","messageMaxAll","getChannel","getChannels","getUsers","getUser","getTotalChannelMembers","onMaxRoomMembersExceeded","m","_getUsers","_getChannels","_getChannel","_messageMaxAll","getUsersByMentions","msg","rid","u","sender","mentions","getUserMentions","mentionsAll","userMentions","forEach","mention","trim","substr","push","_id","username","length","getChannelbyMentions","channels","getChannelMentions","map","c","execute","message"],"mappings":"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","sourcesContent":["/*\n * Mentions is a named function that will process Mentions\n * @param {Object} message - The message object\n */\nimport { MentionsParser } from '../lib/MentionsParser';\n\nexport default class MentionsServer extends MentionsParser {\n\tconstructor(args) {\n\t\tsuper(args);\n\t\tthis.messageMaxAll = args.messageMaxAll;\n\t\tthis.getChannel = args.getChannel;\n\t\tthis.getChannels = args.getChannels;\n\t\tthis.getUsers = args.getUsers;\n\t\tthis.getUser = args.getUser;\n\t\tthis.getTotalChannelMembers = args.getTotalChannelMembers;\n\t\tthis.onMaxRoomMembersExceeded = args.onMaxRoomMembersExceeded || (() => {});\n\t}\n\n\tset getUsers(m) {\n\t\tthis._getUsers = m;\n\t}\n\n\tget getUsers() {\n\t\treturn typeof this._getUsers === 'function' ? this._getUsers : () => this._getUsers;\n\t}\n\n\tset getChannels(m) {\n\t\tthis._getChannels = m;\n\t}\n\n\tget getChannels() {\n\t\treturn typeof this._getChannels === 'function' ? this._getChannels : () => this._getChannels;\n\t}\n\n\tset getChannel(m) {\n\t\tthis._getChannel = m;\n\t}\n\n\tget getChannel() {\n\t\treturn typeof this._getChannel === 'function' ? this._getChannel : () => this._getChannel;\n\t}\n\n\tset messageMaxAll(m) {\n\t\tthis._messageMaxAll = m;\n\t}\n\n\tget messageMaxAll() {\n\t\treturn typeof this._messageMaxAll === 'function' ? this._messageMaxAll() : this._messageMaxAll;\n\t}\n\n\tgetUsersByMentions({ msg, rid, u: sender }) {\n\t\tlet mentions = this.getUserMentions(msg);\n\t\tconst mentionsAll = [];\n\t\tconst userMentions = [];\n\n\t\tmentions.forEach((m) => {\n\t\t\tconst mention = m.trim().substr(1);\n\t\t\tif (mention !== 'all' && mention !== 'here') {\n\t\t\t\treturn userMentions.push(mention);\n\t\t\t}\n\t\t\tif (this.messageMaxAll > 0 && this.getTotalChannelMembers(rid) > this.messageMaxAll) {\n\t\t\t\treturn this.onMaxRoomMembersExceeded({ sender, rid });\n\t\t\t}\n\t\t\tmentionsAll.push({\n\t\t\t\t_id: mention,\n\t\t\t\tusername: mention,\n\t\t\t});\n\t\t});\n\t\tmentions = userMentions.length ? this.getUsers(userMentions) : [];\n\t\treturn [...mentionsAll, ...mentions];\n\t}\n\n\tgetChannelbyMentions({ msg }) {\n\t\tconst channels = this.getChannelMentions(msg);\n\t\treturn this.getChannels(channels.map((c) => c.trim().substr(1)));\n\t}\n\n\texecute(message) {\n\t\tconst mentionsAll = this.getUsersByMentions(message);\n\t\tconst channels = this.getChannelbyMentions(message);\n\n\t\tmessage.mentions = mentionsAll;\n\t\tmessage.channels = channels;\n\n\t\treturn message;\n\t}\n}\n"]},"sourceType":"module","hash":"f32fa26ad41cda6a295420fd4527c2b614fabca6"}
