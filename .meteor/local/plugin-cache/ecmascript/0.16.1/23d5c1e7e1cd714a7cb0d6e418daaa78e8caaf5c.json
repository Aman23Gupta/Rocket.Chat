{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/ui-master/server/index.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/ui-master/server/index.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/ui-master/server/index.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/ui-master/server/index.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-master/server/index.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Inject;\nmodule.link(\"meteor/meteorhacks:inject-initial\", {\n  Inject(v) {\n    Inject = v;\n  }\n\n}, 1);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n\n}, 2);\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 3);\nlet escapeHTML;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeHTML(v) {\n    escapeHTML = v;\n  }\n\n}, 4);\nlet Settings;\nmodule.link(\"../../models\", {\n  Settings(v) {\n    Settings = v;\n  }\n\n}, 5);\nlet settings;\nmodule.link(\"../../settings/server\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 6);\nlet applyHeadInjections, headInjections, injectIntoBody, injectIntoHead;\nmodule.link(\"./inject\", {\n  applyHeadInjections(v) {\n    applyHeadInjections = v;\n  },\n\n  headInjections(v) {\n    headInjections = v;\n  },\n\n  injectIntoBody(v) {\n    injectIntoBody = v;\n  },\n\n  injectIntoHead(v) {\n    injectIntoHead = v;\n  }\n\n}, 7);\nmodule.link(\"./scripts\");\nmodule.link(\"./inject\", {\n  \"*\": \"*\"\n}, 8);\nMeteor.startup(() => {\n  Tracker.autorun(() => {\n    const injections = Object.values(headInjections.all());\n    Inject.rawModHtml('headInjections', applyHeadInjections(injections));\n  });\n  settings.watch('Default_Referrer_Policy', value => {\n    if (!value) {\n      return injectIntoHead('noreferrer', '<meta name=\"referrer\" content=\"same-origin\" />');\n    }\n\n    injectIntoHead('noreferrer', \"<meta name=\\\"referrer\\\" content=\\\"\".concat(value, \"\\\" />\"));\n  });\n\n  if (process.env.DISABLE_ANIMATION) {\n    injectIntoHead('disable-animation', \"\\n\\t\\t<style>\\n\\t\\t\\tbody, body * {\\n\\t\\t\\t\\tanimation: none !important;\\n\\t\\t\\t}\\n\\t\\t\\t</style>\\n\\t\\t\\t\");\n  }\n\n  settings.watch('Assets_SvgFavicon_Enable', value => {\n    const standardFavicons = \"\\n\\t\\t\\t<link rel=\\\"icon\\\" sizes=\\\"16x16\\\" type=\\\"image/png\\\" href=\\\"assets/favicon_16.png\\\" />\\n\\t\\t\\t<link rel=\\\"icon\\\" sizes=\\\"32x32\\\" type=\\\"image/png\\\" href=\\\"assets/favicon_32.png\\\" />\";\n\n    if (value) {\n      injectIntoHead('Assets_SvgFavicon_Enable', \"\".concat(standardFavicons, \"\\n\\t\\t\\t\\t<link rel=\\\"icon\\\" sizes=\\\"any\\\" type=\\\"image/svg+xml\\\" href=\\\"assets/favicon.svg\\\" />\"));\n    } else {\n      injectIntoHead('Assets_SvgFavicon_Enable', standardFavicons);\n    }\n  });\n  settings.watch('theme-color-sidebar-background', value => {\n    const escapedValue = escapeHTML(value);\n    injectIntoHead('theme-color-sidebar-background', \"<meta name=\\\"msapplication-TileColor\\\" content=\\\"\".concat(escapedValue, \"\\\" /><meta name=\\\"theme-color\\\" content=\\\"\").concat(escapedValue, \"\\\" />\"));\n  });\n  settings.watch('Site_Name', function () {\n    let value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Rocket.Chat';\n    const escapedValue = escapeHTML(value);\n    injectIntoHead('Site_Name', \"<title>\".concat(escapedValue, \"</title>\") + \"<meta name=\\\"application-name\\\" content=\\\"\".concat(escapedValue, \"\\\">\") + \"<meta name=\\\"apple-mobile-web-app-title\\\" content=\\\"\".concat(escapedValue, \"\\\">\"));\n  });\n  settings.watch('Meta_language', function () {\n    let value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    const escapedValue = escapeHTML(value);\n    injectIntoHead('Meta_language', \"<meta http-equiv=\\\"content-language\\\" content=\\\"\".concat(escapedValue, \"\\\"><meta name=\\\"language\\\" content=\\\"\").concat(escapedValue, \"\\\">\"));\n  });\n  settings.watch('Meta_robots', function () {\n    let value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    const escapedValue = escapeHTML(value);\n    injectIntoHead('Meta_robots', \"<meta name=\\\"robots\\\" content=\\\"\".concat(escapedValue, \"\\\">\"));\n  });\n  settings.watch('Meta_msvalidate01', function () {\n    let value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    const escapedValue = escapeHTML(value);\n    injectIntoHead('Meta_msvalidate01', \"<meta name=\\\"msvalidate.01\\\" content=\\\"\".concat(escapedValue, \"\\\">\"));\n  });\n  settings.watch('Meta_google-site-verification', function () {\n    let value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    const escapedValue = escapeHTML(value);\n    injectIntoHead('Meta_google-site-verification', \"<meta name=\\\"google-site-verification\\\" content=\\\"\".concat(escapedValue, \"\\\">\"));\n  });\n  settings.watch('Meta_fb_app_id', function () {\n    let value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    const escapedValue = escapeHTML(value);\n    injectIntoHead('Meta_fb_app_id', \"<meta property=\\\"fb:app_id\\\" content=\\\"\".concat(escapedValue, \"\\\">\"));\n  });\n  settings.watch('Meta_custom', function () {\n    let value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    injectIntoHead('Meta_custom', value);\n  });\n\n  const baseUrl = (prefix => {\n    if (!prefix) {\n      return '/';\n    }\n\n    prefix = prefix.trim();\n\n    if (!prefix) {\n      return '/';\n    }\n\n    return /\\/$/.test(prefix) ? prefix : \"\".concat(prefix, \"/\");\n  })(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX);\n\n  injectIntoHead('base', \"<base href=\\\"\".concat(baseUrl, \"\\\">\"));\n  injectIntoHead('css-theme', '');\n});\n\nconst renderDynamicCssList = _.debounce(Meteor.bindEnvironment(() => {\n  // const variables = RocketChat.models.Settings.findOne({_id:'theme-custom-variables'}, {fields: { value: 1}});\n  const colors = Settings.find({\n    _id: /theme-color-rc/i\n  }, {\n    fields: {\n      value: 1,\n      editor: 1\n    }\n  }).fetch().filter(color => color && color.value);\n\n  if (!colors) {\n    return;\n  }\n\n  const css = colors.map(_ref => {\n    let {\n      _id,\n      value,\n      editor\n    } = _ref;\n\n    if (editor === 'expression') {\n      return \"--\".concat(_id.replace('theme-color-', ''), \": var(--\").concat(value, \");\");\n    }\n\n    return \"--\".concat(_id.replace('theme-color-', ''), \": \").concat(value, \";\");\n  }).join('\\n');\n  injectIntoBody('dynamic-variables', \"<style id='css-variables'> :root {\".concat(css, \"}</style>\"));\n}), 500);\n\nrenderDynamicCssList(); // RocketChat.models.Settings.find({_id:'theme-custom-variables'}, {fields: { value: 1}}).observe({\n// \tchanged: renderDynamicCssList\n// });\n\nsettings.watchByRegex(/theme-color-rc/i, renderDynamicCssList);\ninjectIntoBody('react-root', \"\\n<div id=\\\"react-root\\\">\\n\\t<div class=\\\"page-loading\\\">\\n\\t\\t<div class=\\\"loading-animation\\\">\\n\\t\\t\\t<div class=\\\"bounce bounce1\\\"></div>\\n\\t\\t\\t<div class=\\\"bounce bounce2\\\"></div>\\n\\t\\t\\t<div class=\\\"bounce bounce3\\\"></div>\\n\\t\\t</div>\\n\\t</div>\\n</div>\\n\");\ninjectIntoBody('icons', Assets.getText('public/icons.svg'));","map":{"version":3,"sources":["app/ui-master/server/index.js"],"names":["Meteor","module","link","v","Inject","Tracker","_","default","escapeHTML","Settings","settings","applyHeadInjections","headInjections","injectIntoBody","injectIntoHead","startup","autorun","injections","Object","values","all","rawModHtml","watch","value","process","env","DISABLE_ANIMATION","standardFavicons","escapedValue","baseUrl","prefix","trim","test","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","renderDynamicCssList","debounce","bindEnvironment","colors","find","_id","fields","editor","fetch","filter","color","css","map","replace","join","watchByRegex","Assets","getText"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Inject } from 'meteor/meteorhacks:inject-initial';\nimport { Tracker } from 'meteor/tracker';\nimport _ from 'underscore';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\n\nimport { Settings } from '../../models';\nimport { settings } from '../../settings/server';\nimport { applyHeadInjections, headInjections, injectIntoBody, injectIntoHead } from './inject';\nimport './scripts';\n\nexport * from './inject';\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst injections = Object.values(headInjections.all());\n\t\tInject.rawModHtml('headInjections', applyHeadInjections(injections));\n\t});\n\n\tsettings.watch('Default_Referrer_Policy', (value) => {\n\t\tif (!value) {\n\t\t\treturn injectIntoHead('noreferrer', '<meta name=\"referrer\" content=\"same-origin\" />');\n\t\t}\n\n\t\tinjectIntoHead('noreferrer', `<meta name=\"referrer\" content=\"${value}\" />`);\n\t});\n\n\tif (process.env.DISABLE_ANIMATION) {\n\t\tinjectIntoHead(\n\t\t\t'disable-animation',\n\t\t\t`\n\t\t<style>\n\t\t\tbody, body * {\n\t\t\t\tanimation: none !important;\n\t\t\t}\n\t\t\t</style>\n\t\t\t`,\n\t\t);\n\t}\n\n\tsettings.watch('Assets_SvgFavicon_Enable', (value) => {\n\t\tconst standardFavicons = `\n\t\t\t<link rel=\"icon\" sizes=\"16x16\" type=\"image/png\" href=\"assets/favicon_16.png\" />\n\t\t\t<link rel=\"icon\" sizes=\"32x32\" type=\"image/png\" href=\"assets/favicon_32.png\" />`;\n\n\t\tif (value) {\n\t\t\tinjectIntoHead(\n\t\t\t\t'Assets_SvgFavicon_Enable',\n\t\t\t\t`${standardFavicons}\n\t\t\t\t<link rel=\"icon\" sizes=\"any\" type=\"image/svg+xml\" href=\"assets/favicon.svg\" />`,\n\t\t\t);\n\t\t} else {\n\t\t\tinjectIntoHead('Assets_SvgFavicon_Enable', standardFavicons);\n\t\t}\n\t});\n\n\tsettings.watch('theme-color-sidebar-background', (value) => {\n\t\tconst escapedValue = escapeHTML(value);\n\t\tinjectIntoHead(\n\t\t\t'theme-color-sidebar-background',\n\t\t\t`<meta name=\"msapplication-TileColor\" content=\"${escapedValue}\" /><meta name=\"theme-color\" content=\"${escapedValue}\" />`,\n\t\t);\n\t});\n\n\tsettings.watch('Site_Name', (value = 'Rocket.Chat') => {\n\t\tconst escapedValue = escapeHTML(value);\n\t\tinjectIntoHead(\n\t\t\t'Site_Name',\n\t\t\t`<title>${escapedValue}</title>` +\n\t\t\t\t`<meta name=\"application-name\" content=\"${escapedValue}\">` +\n\t\t\t\t`<meta name=\"apple-mobile-web-app-title\" content=\"${escapedValue}\">`,\n\t\t);\n\t});\n\n\tsettings.watch('Meta_language', (value = '') => {\n\t\tconst escapedValue = escapeHTML(value);\n\t\tinjectIntoHead(\n\t\t\t'Meta_language',\n\t\t\t`<meta http-equiv=\"content-language\" content=\"${escapedValue}\"><meta name=\"language\" content=\"${escapedValue}\">`,\n\t\t);\n\t});\n\n\tsettings.watch('Meta_robots', (value = '') => {\n\t\tconst escapedValue = escapeHTML(value);\n\t\tinjectIntoHead('Meta_robots', `<meta name=\"robots\" content=\"${escapedValue}\">`);\n\t});\n\n\tsettings.watch('Meta_msvalidate01', (value = '') => {\n\t\tconst escapedValue = escapeHTML(value);\n\t\tinjectIntoHead('Meta_msvalidate01', `<meta name=\"msvalidate.01\" content=\"${escapedValue}\">`);\n\t});\n\n\tsettings.watch('Meta_google-site-verification', (value = '') => {\n\t\tconst escapedValue = escapeHTML(value);\n\t\tinjectIntoHead('Meta_google-site-verification', `<meta name=\"google-site-verification\" content=\"${escapedValue}\">`);\n\t});\n\n\tsettings.watch('Meta_fb_app_id', (value = '') => {\n\t\tconst escapedValue = escapeHTML(value);\n\t\tinjectIntoHead('Meta_fb_app_id', `<meta property=\"fb:app_id\" content=\"${escapedValue}\">`);\n\t});\n\n\tsettings.watch('Meta_custom', (value = '') => {\n\t\tinjectIntoHead('Meta_custom', value);\n\t});\n\n\tconst baseUrl = ((prefix) => {\n\t\tif (!prefix) {\n\t\t\treturn '/';\n\t\t}\n\n\t\tprefix = prefix.trim();\n\n\t\tif (!prefix) {\n\t\t\treturn '/';\n\t\t}\n\n\t\treturn /\\/$/.test(prefix) ? prefix : `${prefix}/`;\n\t})(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX);\n\n\tinjectIntoHead('base', `<base href=\"${baseUrl}\">`);\n\n\tinjectIntoHead('css-theme', '');\n});\n\nconst renderDynamicCssList = _.debounce(\n\tMeteor.bindEnvironment(() => {\n\t\t// const variables = RocketChat.models.Settings.findOne({_id:'theme-custom-variables'}, {fields: { value: 1}});\n\t\tconst colors = Settings.find({ _id: /theme-color-rc/i }, { fields: { value: 1, editor: 1 } })\n\t\t\t.fetch()\n\t\t\t.filter((color) => color && color.value);\n\n\t\tif (!colors) {\n\t\t\treturn;\n\t\t}\n\t\tconst css = colors\n\t\t\t.map(({ _id, value, editor }) => {\n\t\t\t\tif (editor === 'expression') {\n\t\t\t\t\treturn `--${_id.replace('theme-color-', '')}: var(--${value});`;\n\t\t\t\t}\n\t\t\t\treturn `--${_id.replace('theme-color-', '')}: ${value};`;\n\t\t\t})\n\t\t\t.join('\\n');\n\t\tinjectIntoBody('dynamic-variables', `<style id='css-variables'> :root {${css}}</style>`);\n\t}),\n\t500,\n);\n\nrenderDynamicCssList();\n\n// RocketChat.models.Settings.find({_id:'theme-custom-variables'}, {fields: { value: 1}}).observe({\n// \tchanged: renderDynamicCssList\n// });\n\nsettings.watchByRegex(/theme-color-rc/i, renderDynamicCssList);\n\ninjectIntoBody(\n\t'react-root',\n\t`\n<div id=\"react-root\">\n\t<div class=\"page-loading\">\n\t\t<div class=\"loading-animation\">\n\t\t\t<div class=\"bounce bounce1\"></div>\n\t\t\t<div class=\"bounce bounce2\"></div>\n\t\t\t<div class=\"bounce bounce3\"></div>\n\t\t</div>\n\t</div>\n</div>\n`,\n);\n\ninjectIntoBody('icons', Assets.getText('public/icons.svg'));\n"]},"sourceType":"module","hash":"23d5c1e7e1cd714a7cb0d6e418daaa78e8caaf5c"}
