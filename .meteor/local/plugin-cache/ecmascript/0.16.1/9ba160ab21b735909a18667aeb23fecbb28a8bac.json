{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/file-upload/server/config/Webdav.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/file-upload/server/config/Webdav.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/file-upload/server/config/Webdav.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/file-upload/server/config/Webdav.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/file-upload/server/config/Webdav.js"}},"code":"let _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 0);\nlet FileUploadClass, FileUpload;\nmodule.link(\"../lib/FileUpload\", {\n  FileUploadClass(v) {\n    FileUploadClass = v;\n  },\n\n  FileUpload(v) {\n    FileUpload = v;\n  }\n\n}, 1);\nlet settings;\nmodule.link(\"../../../settings\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 2);\nmodule.link(\"../../ufs/Webdav/server.js\");\nlet SystemLogger;\nmodule.link(\"../../../../server/lib/logger/system\", {\n  SystemLogger(v) {\n    SystemLogger = v;\n  }\n\n}, 3);\n\nconst get = function (file, req, res) {\n  this.store.getReadStream(file._id, file).on('error', () => {\n    SystemLogger.error('An error ocurred when fetching the file');\n    res.writeHead(503);\n    res.end();\n  }).on('data', chunk => {\n    res.write(chunk);\n  }).on('end', res.end.bind(res));\n};\n\nconst copy = function (file, out) {\n  this.store.getReadStream(file._id, file).pipe(out);\n};\n\nconst WebdavUploads = new FileUploadClass({\n  name: 'Webdav:Uploads',\n  get,\n  copy // store setted bellow\n\n});\nconst WebdavAvatars = new FileUploadClass({\n  name: 'Webdav:Avatars',\n  get,\n  copy // store setted bellow\n\n});\nconst WebdavUserDataFiles = new FileUploadClass({\n  name: 'Webdav:UserDataFiles',\n  get,\n  copy // store setted bellow\n\n});\n\nconst configure = _.debounce(function () {\n  const uploadFolderPath = settings.get('FileUpload_Webdav_Upload_Folder_Path');\n  const server = settings.get('FileUpload_Webdav_Server_URL');\n  const username = settings.get('FileUpload_Webdav_Username');\n  const password = settings.get('FileUpload_Webdav_Password');\n\n  if (!server || !username || !password) {\n    return;\n  }\n\n  const config = {\n    connection: {\n      credentials: {\n        server,\n        username,\n        password\n      }\n    },\n    uploadFolderPath\n  };\n  WebdavUploads.store = FileUpload.configureUploadsStore('Webdav', WebdavUploads.name, config);\n  WebdavAvatars.store = FileUpload.configureUploadsStore('Webdav', WebdavAvatars.name, config);\n  WebdavUserDataFiles.store = FileUpload.configureUploadsStore('Webdav', WebdavUserDataFiles.name, config);\n}, 500);\n\nsettings.watchByRegex(/^FileUpload_Webdav_/, configure);","map":{"version":3,"sources":["app/file-upload/server/config/Webdav.js"],"names":["_","module","link","default","v","FileUploadClass","FileUpload","settings","SystemLogger","get","file","req","res","store","getReadStream","_id","on","error","writeHead","end","chunk","write","bind","copy","out","pipe","WebdavUploads","name","WebdavAvatars","WebdavUserDataFiles","configure","debounce","uploadFolderPath","server","username","password","config","connection","credentials","configureUploadsStore","watchByRegex"],"mappings":"AAAA,IAAIA,CAAJ;;AAAMC,MAAM,CAACC,IAAP,CAAY,YAAZ,EAAyB;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACJ,IAAAA,CAAC,GAACI,CAAF;AAAI;;AAAhB,CAAzB,EAA2C,CAA3C;AAA8C,IAAIC,eAAJ,EAAoBC,UAApB;AAA+BL,MAAM,CAACC,IAAP,CAAY,mBAAZ,EAAgC;AAACG,EAAAA,eAAe,CAACD,CAAD,EAAG;AAACC,IAAAA,eAAe,GAACD,CAAhB;AAAkB,GAAtC;;AAAuCE,EAAAA,UAAU,CAACF,CAAD,EAAG;AAACE,IAAAA,UAAU,GAACF,CAAX;AAAa;;AAAlE,CAAhC,EAAoG,CAApG;AAAuG,IAAIG,QAAJ;AAAaN,MAAM,CAACC,IAAP,CAAY,mBAAZ,EAAgC;AAACK,EAAAA,QAAQ,CAACH,CAAD,EAAG;AAACG,IAAAA,QAAQ,GAACH,CAAT;AAAW;;AAAxB,CAAhC,EAA0D,CAA1D;AAA6DH,MAAM,CAACC,IAAP,CAAY,4BAAZ;AAA0C,IAAIM,YAAJ;AAAiBP,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACM,EAAAA,YAAY,CAACJ,CAAD,EAAG;AAACI,IAAAA,YAAY,GAACJ,CAAb;AAAe;;AAAhC,CAAnD,EAAqF,CAArF;;AAO/T,MAAMK,GAAG,GAAG,UAAUC,IAAV,EAAgBC,GAAhB,EAAqBC,GAArB,EAA0B;AACrC,OAAKC,KAAL,CACEC,aADF,CACgBJ,IAAI,CAACK,GADrB,EAC0BL,IAD1B,EAEEM,EAFF,CAEK,OAFL,EAEc,MAAM;AAClBR,IAAAA,YAAY,CAACS,KAAb,CAAmB,yCAAnB;AACAL,IAAAA,GAAG,CAACM,SAAJ,CAAc,GAAd;AACAN,IAAAA,GAAG,CAACO,GAAJ;AACA,GANF,EAOEH,EAPF,CAOK,MAPL,EAOcI,KAAD,IAAW;AACtBR,IAAAA,GAAG,CAACS,KAAJ,CAAUD,KAAV;AACA,GATF,EAUEJ,EAVF,CAUK,KAVL,EAUYJ,GAAG,CAACO,GAAJ,CAAQG,IAAR,CAAaV,GAAb,CAVZ;AAWA,CAZD;;AAcA,MAAMW,IAAI,GAAG,UAAUb,IAAV,EAAgBc,GAAhB,EAAqB;AACjC,OAAKX,KAAL,CAAWC,aAAX,CAAyBJ,IAAI,CAACK,GAA9B,EAAmCL,IAAnC,EAAyCe,IAAzC,CAA8CD,GAA9C;AACA,CAFD;;AAIA,MAAME,aAAa,GAAG,IAAIrB,eAAJ,CAAoB;AACzCsB,EAAAA,IAAI,EAAE,gBADmC;AAEzClB,EAAAA,GAFyC;AAGzCc,EAAAA,IAHyC,CAIzC;;AAJyC,CAApB,CAAtB;AAOA,MAAMK,aAAa,GAAG,IAAIvB,eAAJ,CAAoB;AACzCsB,EAAAA,IAAI,EAAE,gBADmC;AAEzClB,EAAAA,GAFyC;AAGzCc,EAAAA,IAHyC,CAIzC;;AAJyC,CAApB,CAAtB;AAOA,MAAMM,mBAAmB,GAAG,IAAIxB,eAAJ,CAAoB;AAC/CsB,EAAAA,IAAI,EAAE,sBADyC;AAE/ClB,EAAAA,GAF+C;AAG/Cc,EAAAA,IAH+C,CAI/C;;AAJ+C,CAApB,CAA5B;;AAOA,MAAMO,SAAS,GAAG9B,CAAC,CAAC+B,QAAF,CAAW,YAAY;AACxC,QAAMC,gBAAgB,GAAGzB,QAAQ,CAACE,GAAT,CAAa,sCAAb,CAAzB;AACA,QAAMwB,MAAM,GAAG1B,QAAQ,CAACE,GAAT,CAAa,8BAAb,CAAf;AACA,QAAMyB,QAAQ,GAAG3B,QAAQ,CAACE,GAAT,CAAa,4BAAb,CAAjB;AACA,QAAM0B,QAAQ,GAAG5B,QAAQ,CAACE,GAAT,CAAa,4BAAb,CAAjB;;AAEA,MAAI,CAACwB,MAAD,IAAW,CAACC,QAAZ,IAAwB,CAACC,QAA7B,EAAuC;AACtC;AACA;;AAED,QAAMC,MAAM,GAAG;AACdC,IAAAA,UAAU,EAAE;AACXC,MAAAA,WAAW,EAAE;AACZL,QAAAA,MADY;AAEZC,QAAAA,QAFY;AAGZC,QAAAA;AAHY;AADF,KADE;AAQdH,IAAAA;AARc,GAAf;AAWAN,EAAAA,aAAa,CAACb,KAAd,GAAsBP,UAAU,CAACiC,qBAAX,CAAiC,QAAjC,EAA2Cb,aAAa,CAACC,IAAzD,EAA+DS,MAA/D,CAAtB;AACAR,EAAAA,aAAa,CAACf,KAAd,GAAsBP,UAAU,CAACiC,qBAAX,CAAiC,QAAjC,EAA2CX,aAAa,CAACD,IAAzD,EAA+DS,MAA/D,CAAtB;AACAP,EAAAA,mBAAmB,CAAChB,KAApB,GAA4BP,UAAU,CAACiC,qBAAX,CAAiC,QAAjC,EAA2CV,mBAAmB,CAACF,IAA/D,EAAqES,MAArE,CAA5B;AACA,CAxBiB,EAwBf,GAxBe,CAAlB;;AA0BA7B,QAAQ,CAACiC,YAAT,CAAsB,qBAAtB,EAA6CV,SAA7C","sourcesContent":["import _ from 'underscore';\n\nimport { FileUploadClass, FileUpload } from '../lib/FileUpload';\nimport { settings } from '../../../settings';\nimport '../../ufs/Webdav/server.js';\nimport { SystemLogger } from '../../../../server/lib/logger/system';\n\nconst get = function (file, req, res) {\n\tthis.store\n\t\t.getReadStream(file._id, file)\n\t\t.on('error', () => {\n\t\t\tSystemLogger.error('An error ocurred when fetching the file');\n\t\t\tres.writeHead(503);\n\t\t\tres.end();\n\t\t})\n\t\t.on('data', (chunk) => {\n\t\t\tres.write(chunk);\n\t\t})\n\t\t.on('end', res.end.bind(res));\n};\n\nconst copy = function (file, out) {\n\tthis.store.getReadStream(file._id, file).pipe(out);\n};\n\nconst WebdavUploads = new FileUploadClass({\n\tname: 'Webdav:Uploads',\n\tget,\n\tcopy,\n\t// store setted bellow\n});\n\nconst WebdavAvatars = new FileUploadClass({\n\tname: 'Webdav:Avatars',\n\tget,\n\tcopy,\n\t// store setted bellow\n});\n\nconst WebdavUserDataFiles = new FileUploadClass({\n\tname: 'Webdav:UserDataFiles',\n\tget,\n\tcopy,\n\t// store setted bellow\n});\n\nconst configure = _.debounce(function () {\n\tconst uploadFolderPath = settings.get('FileUpload_Webdav_Upload_Folder_Path');\n\tconst server = settings.get('FileUpload_Webdav_Server_URL');\n\tconst username = settings.get('FileUpload_Webdav_Username');\n\tconst password = settings.get('FileUpload_Webdav_Password');\n\n\tif (!server || !username || !password) {\n\t\treturn;\n\t}\n\n\tconst config = {\n\t\tconnection: {\n\t\t\tcredentials: {\n\t\t\t\tserver,\n\t\t\t\tusername,\n\t\t\t\tpassword,\n\t\t\t},\n\t\t},\n\t\tuploadFolderPath,\n\t};\n\n\tWebdavUploads.store = FileUpload.configureUploadsStore('Webdav', WebdavUploads.name, config);\n\tWebdavAvatars.store = FileUpload.configureUploadsStore('Webdav', WebdavAvatars.name, config);\n\tWebdavUserDataFiles.store = FileUpload.configureUploadsStore('Webdav', WebdavUserDataFiles.name, config);\n}, 500);\n\nsettings.watchByRegex(/^FileUpload_Webdav_/, configure);\n"]},"sourceType":"module","hash":"9ba160ab21b735909a18667aeb23fecbb28a8bac"}
