{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/livechat/server/methods/sendMessageLivechat.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/livechat/server/methods/sendMessageLivechat.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/livechat/server/methods/sendMessageLivechat.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/livechat/server/methods/sendMessageLivechat.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/livechat/server/methods/sendMessageLivechat.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Match, check;\nmodule.link(\"meteor/check\", {\n  Match(v) {\n    Match = v;\n  },\n\n  check(v) {\n    check = v;\n  }\n\n}, 1);\nlet LivechatVisitors;\nmodule.link(\"../../../models\", {\n  LivechatVisitors(v) {\n    LivechatVisitors = v;\n  }\n\n}, 2);\nlet Livechat;\nmodule.link(\"../lib/Livechat\", {\n  Livechat(v) {\n    Livechat = v;\n  }\n\n}, 3);\nlet OmnichannelSourceType;\nmodule.link(\"../../../../definition/IRoom\", {\n  OmnichannelSourceType(v) {\n    OmnichannelSourceType = v;\n  }\n\n}, 4);\nlet settings;\nmodule.link(\"../../../settings/server\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 5);\nMeteor.methods({\n  sendMessageLivechat(_ref, agent) {\n    let {\n      token,\n      _id,\n      rid,\n      msg,\n      file,\n      attachments\n    } = _ref;\n    check(token, String);\n    check(_id, String);\n    check(rid, String);\n    check(msg, String);\n    check(agent, Match.Maybe({\n      agentId: String,\n      username: String\n    }));\n    const guest = LivechatVisitors.getVisitorByToken(token, {\n      fields: {\n        name: 1,\n        username: 1,\n        department: 1,\n        token: 1\n      }\n    });\n\n    if (!guest) {\n      throw new Meteor.Error('invalid-token');\n    }\n\n    if (settings.get('Livechat_enable_message_character_limit') && msg.length > parseInt(settings.get('Livechat_message_character_limit'))) {\n      throw new Meteor.Error('message-length-exceeds-character-limit');\n    }\n\n    return Livechat.sendMessage({\n      guest,\n      message: {\n        _id,\n        rid,\n        msg,\n        token,\n        file,\n        attachments\n      },\n      agent,\n      roomInfo: {\n        source: {\n          type: OmnichannelSourceType.API\n        }\n      }\n    });\n  }\n\n});","map":{"version":3,"sources":["app/livechat/server/methods/sendMessageLivechat.js"],"names":["Meteor","module","link","v","Match","check","LivechatVisitors","Livechat","OmnichannelSourceType","settings","methods","sendMessageLivechat","agent","token","_id","rid","msg","file","attachments","String","Maybe","agentId","username","guest","getVisitorByToken","fields","name","department","Error","get","length","parseInt","sendMessage","message","roomInfo","source","type","API"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Match, check } from 'meteor/check';\n\nimport { LivechatVisitors } from '../../../models';\nimport { Livechat } from '../lib/Livechat';\nimport { OmnichannelSourceType } from '../../../../definition/IRoom';\nimport { settings } from '../../../settings/server';\n\nMeteor.methods({\n\tsendMessageLivechat({ token, _id, rid, msg, file, attachments }, agent) {\n\t\tcheck(token, String);\n\t\tcheck(_id, String);\n\t\tcheck(rid, String);\n\t\tcheck(msg, String);\n\n\t\tcheck(\n\t\t\tagent,\n\t\t\tMatch.Maybe({\n\t\t\t\tagentId: String,\n\t\t\t\tusername: String,\n\t\t\t}),\n\t\t);\n\n\t\tconst guest = LivechatVisitors.getVisitorByToken(token, {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tusername: 1,\n\t\t\t\tdepartment: 1,\n\t\t\t\ttoken: 1,\n\t\t\t},\n\t\t});\n\n\t\tif (!guest) {\n\t\t\tthrow new Meteor.Error('invalid-token');\n\t\t}\n\n\t\tif (\n\t\t\tsettings.get('Livechat_enable_message_character_limit') &&\n\t\t\tmsg.length > parseInt(settings.get('Livechat_message_character_limit'))\n\t\t) {\n\t\t\tthrow new Meteor.Error('message-length-exceeds-character-limit');\n\t\t}\n\n\t\treturn Livechat.sendMessage({\n\t\t\tguest,\n\t\t\tmessage: {\n\t\t\t\t_id,\n\t\t\t\trid,\n\t\t\t\tmsg,\n\t\t\t\ttoken,\n\t\t\t\tfile,\n\t\t\t\tattachments,\n\t\t\t},\n\t\t\tagent,\n\t\t\troomInfo: {\n\t\t\t\tsource: {\n\t\t\t\t\ttype: OmnichannelSourceType.API,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t},\n});\n"]},"sourceType":"module","hash":"88ac329d89b5e4d3c9bedf8a9499478d95f921a9"}
