{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/slashcommands-inviteall/server/server.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/slashcommands-inviteall/server/server.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/slashcommands-inviteall/server/server.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/slashcommands-inviteall/server/server.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/slashcommands-inviteall/server/server.js"}},"code":"!function (module1) {\n  let Meteor;\n  module1.link(\"meteor/meteor\", {\n    Meteor(v) {\n      Meteor = v;\n    }\n\n  }, 0);\n  let Match;\n  module1.link(\"meteor/check\", {\n    Match(v) {\n      Match = v;\n    }\n\n  }, 1);\n  let TAPi18n;\n  module1.link(\"meteor/rocketchat:tap-i18n\", {\n    TAPi18n(v) {\n      TAPi18n = v;\n    }\n\n  }, 2);\n  let Rooms, Subscriptions;\n  module1.link(\"../../models\", {\n    Rooms(v) {\n      Rooms = v;\n    },\n\n    Subscriptions(v) {\n      Subscriptions = v;\n    }\n\n  }, 3);\n  let slashCommands;\n  module1.link(\"../../utils\", {\n    slashCommands(v) {\n      slashCommands = v;\n    }\n\n  }, 4);\n  let settings;\n  module1.link(\"../../settings\", {\n    settings(v) {\n      settings = v;\n    }\n\n  }, 5);\n  let api;\n  module1.link(\"../../../server/sdk/api\", {\n    api(v) {\n      api = v;\n    }\n\n  }, 6);\n\n  function inviteAll(type) {\n    return function inviteAll(command, params, item) {\n      if (!/invite\\-all-(to|from)/.test(command) || !Match.test(params, String)) {\n        return;\n      }\n\n      const regexp = /#?([^\\s,.:;\"']+)(?=[\\s,.:;\"']|$)/g;\n      const [, channel] = regexp.exec(params.trim());\n\n      if (!channel) {\n        return;\n      }\n\n      const userId = Meteor.userId();\n      const currentUser = Meteor.users.findOne(userId);\n      const baseChannel = type === 'to' ? Rooms.findOneById(item.rid) : Rooms.findOneByName(channel);\n      const targetChannel = type === 'from' ? Rooms.findOneById(item.rid) : Rooms.findOneByName(channel);\n\n      if (!baseChannel) {\n        return api.broadcast('notify.ephemeralMessage', userId, item.rid, {\n          msg: TAPi18n.__('Channel_doesnt_exist', {\n            postProcess: 'sprintf',\n            sprintf: [channel]\n          }, currentUser.language)\n        });\n      }\n\n      const cursor = Subscriptions.findByRoomIdWhenUsernameExists(baseChannel._id, {\n        fields: {\n          'u.username': 1\n        }\n      });\n\n      try {\n        if (cursor.count() > settings.get('API_User_Limit')) {\n          throw new Meteor.Error('error-user-limit-exceeded', 'User Limit Exceeded', {\n            method: 'addAllToRoom'\n          });\n        }\n\n        const users = cursor.fetch().map(s => s.u.username);\n\n        if (!targetChannel && ['c', 'p'].indexOf(baseChannel.t) > -1) {\n          Meteor.call(baseChannel.t === 'c' ? 'createChannel' : 'createPrivateGroup', channel, users);\n          api.broadcast('notify.ephemeralMessage', userId, item.rid, {\n            msg: TAPi18n.__('Channel_created', {\n              postProcess: 'sprintf',\n              sprintf: [channel]\n            }, currentUser.language)\n          });\n        } else {\n          Meteor.call('addUsersToRoom', {\n            rid: targetChannel._id,\n            users\n          });\n        }\n\n        return api.broadcast('notify.ephemeralMessage', userId, item.rid, {\n          msg: TAPi18n.__('Users_added', null, currentUser.language)\n        });\n      } catch (e) {\n        const msg = e.error === 'cant-invite-for-direct-room' ? 'Cannot_invite_users_to_direct_rooms' : e.error;\n        api.broadcast('notify.ephemeralMessage', userId, item.rid, {\n          msg: TAPi18n.__(msg, null, currentUser.language)\n        });\n      }\n    };\n  }\n\n  slashCommands.add('invite-all-to', inviteAll('to'), {\n    description: 'Invite_user_to_join_channel_all_to',\n    params: '#room',\n    permission: ['add-user-to-joined-room', 'add-user-to-any-c-room', 'add-user-to-any-p-room']\n  });\n  slashCommands.add('invite-all-from', inviteAll('from'), {\n    description: 'Invite_user_to_join_channel_all_from',\n    params: '#room',\n    permission: 'add-user-to-joined-room'\n  });\n  module.exports = inviteAll;\n}.call(this, module);","map":{"version":3,"sources":["app/slashcommands-inviteall/server/server.js"],"names":["Meteor","module1","link","v","Match","TAPi18n","Rooms","Subscriptions","slashCommands","settings","api","inviteAll","type","command","params","item","test","String","regexp","channel","exec","trim","userId","currentUser","users","findOne","baseChannel","findOneById","rid","findOneByName","targetChannel","broadcast","msg","__","postProcess","sprintf","language","cursor","findByRoomIdWhenUsernameExists","_id","fields","count","get","Error","method","fetch","map","s","u","username","indexOf","t","call","e","error","add","description","permission","module","exports"],"mappings":"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","sourcesContent":["/*\n * Invite is a named function that will replace /invite commands\n * @param {Object} message - The message object\n */\nimport { Meteor } from 'meteor/meteor';\nimport { Match } from 'meteor/check';\nimport { TAPi18n } from 'meteor/rocketchat:tap-i18n';\n\nimport { Rooms, Subscriptions } from '../../models';\nimport { slashCommands } from '../../utils';\nimport { settings } from '../../settings';\nimport { api } from '../../../server/sdk/api';\n\nfunction inviteAll(type) {\n\treturn function inviteAll(command, params, item) {\n\t\tif (!/invite\\-all-(to|from)/.test(command) || !Match.test(params, String)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst regexp = /#?([^\\s,.:;\"']+)(?=[\\s,.:;\"']|$)/g;\n\t\tconst [, channel] = regexp.exec(params.trim());\n\n\t\tif (!channel) {\n\t\t\treturn;\n\t\t}\n\t\tconst userId = Meteor.userId();\n\t\tconst currentUser = Meteor.users.findOne(userId);\n\t\tconst baseChannel = type === 'to' ? Rooms.findOneById(item.rid) : Rooms.findOneByName(channel);\n\t\tconst targetChannel = type === 'from' ? Rooms.findOneById(item.rid) : Rooms.findOneByName(channel);\n\n\t\tif (!baseChannel) {\n\t\t\treturn api.broadcast('notify.ephemeralMessage', userId, item.rid, {\n\t\t\t\tmsg: TAPi18n.__(\n\t\t\t\t\t'Channel_doesnt_exist',\n\t\t\t\t\t{\n\t\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\t\tsprintf: [channel],\n\t\t\t\t\t},\n\t\t\t\t\tcurrentUser.language,\n\t\t\t\t),\n\t\t\t});\n\t\t}\n\t\tconst cursor = Subscriptions.findByRoomIdWhenUsernameExists(baseChannel._id, {\n\t\t\tfields: { 'u.username': 1 },\n\t\t});\n\n\t\ttry {\n\t\t\tif (cursor.count() > settings.get('API_User_Limit')) {\n\t\t\t\tthrow new Meteor.Error('error-user-limit-exceeded', 'User Limit Exceeded', {\n\t\t\t\t\tmethod: 'addAllToRoom',\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst users = cursor.fetch().map((s) => s.u.username);\n\n\t\t\tif (!targetChannel && ['c', 'p'].indexOf(baseChannel.t) > -1) {\n\t\t\t\tMeteor.call(baseChannel.t === 'c' ? 'createChannel' : 'createPrivateGroup', channel, users);\n\t\t\t\tapi.broadcast('notify.ephemeralMessage', userId, item.rid, {\n\t\t\t\t\tmsg: TAPi18n.__(\n\t\t\t\t\t\t'Channel_created',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\t\t\tsprintf: [channel],\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcurrentUser.language,\n\t\t\t\t\t),\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tMeteor.call('addUsersToRoom', {\n\t\t\t\t\trid: targetChannel._id,\n\t\t\t\t\tusers,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn api.broadcast('notify.ephemeralMessage', userId, item.rid, {\n\t\t\t\tmsg: TAPi18n.__('Users_added', null, currentUser.language),\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tconst msg = e.error === 'cant-invite-for-direct-room' ? 'Cannot_invite_users_to_direct_rooms' : e.error;\n\t\t\tapi.broadcast('notify.ephemeralMessage', userId, item.rid, {\n\t\t\t\tmsg: TAPi18n.__(msg, null, currentUser.language),\n\t\t\t});\n\t\t}\n\t};\n}\n\nslashCommands.add('invite-all-to', inviteAll('to'), {\n\tdescription: 'Invite_user_to_join_channel_all_to',\n\tparams: '#room',\n\tpermission: ['add-user-to-joined-room', 'add-user-to-any-c-room', 'add-user-to-any-p-room'],\n});\nslashCommands.add('invite-all-from', inviteAll('from'), {\n\tdescription: 'Invite_user_to_join_channel_all_from',\n\tparams: '#room',\n\tpermission: 'add-user-to-joined-room',\n});\nmodule.exports = inviteAll;\n"]},"sourceType":"module","hash":"6463a89d6c4a5c37e692e8e407e29f9d84ccc8dd"}
