{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/lib/server/oauth/facebook.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/lib/server/oauth/facebook.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/lib/server/oauth/facebook.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/lib/server/oauth/facebook.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/lib/server/oauth/facebook.js"}},"code":"let crypto;\nmodule.link(\"crypto\", {\n  default(v) {\n    crypto = v;\n  }\n\n}, 0);\nlet Match, check;\nmodule.link(\"meteor/check\", {\n  Match(v) {\n    Match = v;\n  },\n\n  check(v) {\n    check = v;\n  }\n\n}, 1);\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 2);\nlet OAuth;\nmodule.link(\"meteor/oauth\", {\n  OAuth(v) {\n    OAuth = v;\n  }\n\n}, 3);\nlet HTTP;\nmodule.link(\"meteor/http\", {\n  HTTP(v) {\n    HTTP = v;\n  }\n\n}, 4);\nlet registerAccessTokenService;\nmodule.link(\"./oauth\", {\n  registerAccessTokenService(v) {\n    registerAccessTokenService = v;\n  }\n\n}, 5);\nconst whitelisted = ['id', 'email', 'name', 'first_name', 'last_name', 'link', 'gender', 'locale', 'age_range'];\nconst FB_API_VERSION = 'v2.9';\nconst FB_URL = 'https://graph.facebook.com';\n\nconst getIdentity = function (accessToken, fields, secret) {\n  const hmac = crypto.createHmac('sha256', OAuth.openSecret(secret));\n  hmac.update(accessToken);\n\n  try {\n    return HTTP.get(\"\".concat(FB_URL, \"/\").concat(FB_API_VERSION, \"/me\"), {\n      params: {\n        access_token: accessToken,\n        appsecret_proof: hmac.digest('hex'),\n        fields: fields.join(',')\n      }\n    }).data;\n  } catch (err) {\n    throw _.extend(new Error(\"Failed to fetch identity from Facebook. \".concat(err.message)), {\n      response: err.response\n    });\n  }\n};\n\nregisterAccessTokenService('facebook', function (options) {\n  check(options, Match.ObjectIncluding({\n    accessToken: String,\n    secret: String,\n    expiresIn: Match.Integer\n  }));\n  const identity = getIdentity(options.accessToken, whitelisted, options.secret);\n  const serviceData = {\n    accessToken: options.accessToken,\n    expiresAt: +new Date() + 1000 * parseInt(options.expiresIn, 10)\n  };\n\n  const fields = _.pick(identity, whitelisted);\n\n  _.extend(serviceData, fields);\n\n  return {\n    serviceData,\n    options: {\n      profile: {\n        name: identity.name\n      }\n    }\n  };\n});","map":{"version":3,"sources":["app/lib/server/oauth/facebook.js"],"names":["crypto","module","link","default","v","Match","check","_","OAuth","HTTP","registerAccessTokenService","whitelisted","FB_API_VERSION","FB_URL","getIdentity","accessToken","fields","secret","hmac","createHmac","openSecret","update","get","params","access_token","appsecret_proof","digest","join","data","err","extend","Error","message","response","options","ObjectIncluding","String","expiresIn","Integer","identity","serviceData","expiresAt","Date","parseInt","pick","profile","name"],"mappings":"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","sourcesContent":["import crypto from 'crypto';\n\nimport { Match, check } from 'meteor/check';\nimport _ from 'underscore';\nimport { OAuth } from 'meteor/oauth';\nimport { HTTP } from 'meteor/http';\n\nimport { registerAccessTokenService } from './oauth';\n\nconst whitelisted = ['id', 'email', 'name', 'first_name', 'last_name', 'link', 'gender', 'locale', 'age_range'];\n\nconst FB_API_VERSION = 'v2.9';\nconst FB_URL = 'https://graph.facebook.com';\n\nconst getIdentity = function (accessToken, fields, secret) {\n\tconst hmac = crypto.createHmac('sha256', OAuth.openSecret(secret));\n\thmac.update(accessToken);\n\n\ttry {\n\t\treturn HTTP.get(`${FB_URL}/${FB_API_VERSION}/me`, {\n\t\t\tparams: {\n\t\t\t\taccess_token: accessToken,\n\t\t\t\tappsecret_proof: hmac.digest('hex'),\n\t\t\t\tfields: fields.join(','),\n\t\t\t},\n\t\t}).data;\n\t} catch (err) {\n\t\tthrow _.extend(new Error(`Failed to fetch identity from Facebook. ${err.message}`), {\n\t\t\tresponse: err.response,\n\t\t});\n\t}\n};\n\nregisterAccessTokenService('facebook', function (options) {\n\tcheck(\n\t\toptions,\n\t\tMatch.ObjectIncluding({\n\t\t\taccessToken: String,\n\t\t\tsecret: String,\n\t\t\texpiresIn: Match.Integer,\n\t\t}),\n\t);\n\n\tconst identity = getIdentity(options.accessToken, whitelisted, options.secret);\n\n\tconst serviceData = {\n\t\taccessToken: options.accessToken,\n\t\texpiresAt: +new Date() + 1000 * parseInt(options.expiresIn, 10),\n\t};\n\n\tconst fields = _.pick(identity, whitelisted);\n\t_.extend(serviceData, fields);\n\n\treturn {\n\t\tserviceData,\n\t\toptions: {\n\t\t\tprofile: {\n\t\t\t\tname: identity.name,\n\t\t\t},\n\t\t},\n\t};\n});\n"]},"sourceType":"module","hash":"f0de4fdab591e5b3cad54ac1c8f51151e2e46b51"}
