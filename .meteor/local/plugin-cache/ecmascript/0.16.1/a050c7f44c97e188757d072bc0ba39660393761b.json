{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/lib/lib/roomTypes/public.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/lib/lib/roomTypes/public.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/lib/lib/roomTypes/public.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/lib/lib/roomTypes/public.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/lib/lib/roomTypes/public.js"}},"code":"module.export({\n  PublicRoomRoute: () => PublicRoomRoute,\n  PublicRoomType: () => PublicRoomType\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet openRoom;\nmodule.link(\"../../../ui-utils\", {\n  openRoom(v) {\n    openRoom = v;\n  }\n\n}, 1);\nlet ChatRoom, ChatSubscription;\nmodule.link(\"../../../models\", {\n  ChatRoom(v) {\n    ChatRoom = v;\n  },\n\n  ChatSubscription(v) {\n    ChatSubscription = v;\n  }\n\n}, 2);\nlet settings;\nmodule.link(\"../../../settings\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 3);\nlet hasAtLeastOnePermission;\nmodule.link(\"../../../authorization\", {\n  hasAtLeastOnePermission(v) {\n    hasAtLeastOnePermission = v;\n  }\n\n}, 4);\nlet getUserPreference, RoomTypeConfig, RoomTypeRouteConfig, RoomSettingsEnum, UiTextContext, RoomMemberActions;\nmodule.link(\"../../../utils\", {\n  getUserPreference(v) {\n    getUserPreference = v;\n  },\n\n  RoomTypeConfig(v) {\n    RoomTypeConfig = v;\n  },\n\n  RoomTypeRouteConfig(v) {\n    RoomTypeRouteConfig = v;\n  },\n\n  RoomSettingsEnum(v) {\n    RoomSettingsEnum = v;\n  },\n\n  UiTextContext(v) {\n    UiTextContext = v;\n  },\n\n  RoomMemberActions(v) {\n    RoomMemberActions = v;\n  }\n\n}, 5);\nlet getAvatarURL;\nmodule.link(\"../../../utils/lib/getAvatarURL\", {\n  getAvatarURL(v) {\n    getAvatarURL = v;\n  }\n\n}, 6);\n\nclass PublicRoomRoute extends RoomTypeRouteConfig {\n  constructor() {\n    super({\n      name: 'channel',\n      path: '/channel/:name/:tab?/:context?'\n    });\n  }\n\n  action(params) {\n    return openRoom('c', params.name);\n  }\n\n}\n\nclass PublicRoomType extends RoomTypeConfig {\n  constructor() {\n    super({\n      identifier: 'c',\n      order: 30,\n      icon: 'hashtag',\n      label: 'Channels',\n      route: new PublicRoomRoute()\n    });\n  }\n\n  getIcon(roomData) {\n    if (roomData.prid) {\n      return 'discussion';\n    }\n\n    if (roomData.teamMain) {\n      return 'team';\n    }\n\n    return this.icon;\n  }\n\n  findRoom(identifier) {\n    const query = {\n      t: 'c',\n      name: identifier\n    };\n    return ChatRoom.findOne(query);\n  }\n\n  roomName(roomData) {\n    if (roomData.prid) {\n      return roomData.fname;\n    }\n\n    if (settings.get('UI_Allow_room_names_with_special_chars')) {\n      return roomData.fname || roomData.name;\n    }\n\n    return roomData.name;\n  }\n\n  condition() {\n    const groupByType = getUserPreference(Meteor.userId(), 'sidebarGroupByType');\n    return groupByType && (hasAtLeastOnePermission(['view-c-room', 'view-joined-room']) || settings.get('Accounts_AllowAnonymousRead') === true);\n  }\n\n  showJoinLink(roomId) {\n    return !!ChatRoom.findOne({\n      _id: roomId,\n      t: 'c'\n    });\n  }\n\n  includeInRoomSearch() {\n    return true;\n  }\n\n  isGroupChat() {\n    return true;\n  }\n\n  includeInDashboard() {\n    return true;\n  }\n\n  canAddUser(room) {\n    return hasAtLeastOnePermission(['add-user-to-any-c-room', 'add-user-to-joined-room'], room._id);\n  }\n\n  canSendMessage(roomId) {\n    const room = ChatRoom.findOne({\n      _id: roomId,\n      t: 'c'\n    }, {\n      fields: {\n        prid: 1\n      }\n    });\n\n    if (room.prid) {\n      return true;\n    } // TODO: remove duplicated code\n\n\n    return ChatSubscription.find({\n      rid: roomId\n    }).count() > 0;\n  }\n\n  enableMembersListProfile() {\n    return true;\n  }\n\n  allowRoomSettingChange(room, setting) {\n    switch (setting) {\n      case RoomSettingsEnum.BROADCAST:\n        return room.broadcast;\n\n      case RoomSettingsEnum.READ_ONLY:\n        return !room.broadcast;\n\n      case RoomSettingsEnum.REACT_WHEN_READ_ONLY:\n        return !room.broadcast && room.ro;\n\n      case RoomSettingsEnum.E2E:\n        return false;\n\n      case RoomSettingsEnum.SYSTEM_MESSAGES:\n      default:\n        return true;\n    }\n  }\n\n  allowMemberAction(room, action) {\n    switch (action) {\n      case RoomMemberActions.BLOCK:\n        return false;\n\n      default:\n        return true;\n    }\n  }\n\n  getUiText(context) {\n    switch (context) {\n      case UiTextContext.HIDE_WARNING:\n        return 'Hide_Room_Warning';\n\n      case UiTextContext.LEAVE_WARNING:\n        return 'Leave_Room_Warning';\n\n      default:\n        return '';\n    }\n  }\n\n  getAvatarPath(roomData) {\n    return getAvatarURL({\n      roomId: roomData._id,\n      cache: roomData.avatarETag\n    });\n  }\n\n  getDiscussionType() {\n    return 'c';\n  }\n\n}","map":{"version":3,"sources":["app/lib/lib/roomTypes/public.js"],"names":["module","export","PublicRoomRoute","PublicRoomType","Meteor","link","v","openRoom","ChatRoom","ChatSubscription","settings","hasAtLeastOnePermission","getUserPreference","RoomTypeConfig","RoomTypeRouteConfig","RoomSettingsEnum","UiTextContext","RoomMemberActions","getAvatarURL","constructor","name","path","action","params","identifier","order","icon","label","route","getIcon","roomData","prid","teamMain","findRoom","query","t","findOne","roomName","fname","get","condition","groupByType","userId","showJoinLink","roomId","_id","includeInRoomSearch","isGroupChat","includeInDashboard","canAddUser","room","canSendMessage","fields","find","rid","count","enableMembersListProfile","allowRoomSettingChange","setting","BROADCAST","broadcast","READ_ONLY","REACT_WHEN_READ_ONLY","ro","E2E","SYSTEM_MESSAGES","allowMemberAction","BLOCK","getUiText","context","HIDE_WARNING","LEAVE_WARNING","getAvatarPath","cache","avatarETag","getDiscussionType"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport { openRoom } from '../../../ui-utils';\nimport { ChatRoom, ChatSubscription } from '../../../models';\nimport { settings } from '../../../settings';\nimport { hasAtLeastOnePermission } from '../../../authorization';\nimport { getUserPreference, RoomTypeConfig, RoomTypeRouteConfig, RoomSettingsEnum, UiTextContext, RoomMemberActions } from '../../../utils';\nimport { getAvatarURL } from '../../../utils/lib/getAvatarURL';\n\nexport class PublicRoomRoute extends RoomTypeRouteConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tname: 'channel',\n\t\t\tpath: '/channel/:name/:tab?/:context?',\n\t\t});\n\t}\n\n\taction(params) {\n\t\treturn openRoom('c', params.name);\n\t}\n}\n\nexport class PublicRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'c',\n\t\t\torder: 30,\n\t\t\ticon: 'hashtag',\n\t\t\tlabel: 'Channels',\n\t\t\troute: new PublicRoomRoute(),\n\t\t});\n\t}\n\n\tgetIcon(roomData) {\n\t\tif (roomData.prid) {\n\t\t\treturn 'discussion';\n\t\t}\n\t\tif (roomData.teamMain) {\n\t\t\treturn 'team';\n\t\t}\n\t\treturn this.icon;\n\t}\n\n\tfindRoom(identifier) {\n\t\tconst query = {\n\t\t\tt: 'c',\n\t\t\tname: identifier,\n\t\t};\n\t\treturn ChatRoom.findOne(query);\n\t}\n\n\troomName(roomData) {\n\t\tif (roomData.prid) {\n\t\t\treturn roomData.fname;\n\t\t}\n\t\tif (settings.get('UI_Allow_room_names_with_special_chars')) {\n\t\t\treturn roomData.fname || roomData.name;\n\t\t}\n\t\treturn roomData.name;\n\t}\n\n\tcondition() {\n\t\tconst groupByType = getUserPreference(Meteor.userId(), 'sidebarGroupByType');\n\t\treturn (\n\t\t\tgroupByType && (hasAtLeastOnePermission(['view-c-room', 'view-joined-room']) || settings.get('Accounts_AllowAnonymousRead') === true)\n\t\t);\n\t}\n\n\tshowJoinLink(roomId) {\n\t\treturn !!ChatRoom.findOne({ _id: roomId, t: 'c' });\n\t}\n\n\tincludeInRoomSearch() {\n\t\treturn true;\n\t}\n\n\tisGroupChat() {\n\t\treturn true;\n\t}\n\n\tincludeInDashboard() {\n\t\treturn true;\n\t}\n\n\tcanAddUser(room) {\n\t\treturn hasAtLeastOnePermission(['add-user-to-any-c-room', 'add-user-to-joined-room'], room._id);\n\t}\n\n\tcanSendMessage(roomId) {\n\t\tconst room = ChatRoom.findOne({ _id: roomId, t: 'c' }, { fields: { prid: 1 } });\n\t\tif (room.prid) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// TODO: remove duplicated code\n\t\treturn (\n\t\t\tChatSubscription.find({\n\t\t\t\trid: roomId,\n\t\t\t}).count() > 0\n\t\t);\n\t}\n\n\tenableMembersListProfile() {\n\t\treturn true;\n\t}\n\n\tallowRoomSettingChange(room, setting) {\n\t\tswitch (setting) {\n\t\t\tcase RoomSettingsEnum.BROADCAST:\n\t\t\t\treturn room.broadcast;\n\t\t\tcase RoomSettingsEnum.READ_ONLY:\n\t\t\t\treturn !room.broadcast;\n\t\t\tcase RoomSettingsEnum.REACT_WHEN_READ_ONLY:\n\t\t\t\treturn !room.broadcast && room.ro;\n\t\t\tcase RoomSettingsEnum.E2E:\n\t\t\t\treturn false;\n\t\t\tcase RoomSettingsEnum.SYSTEM_MESSAGES:\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t}\n\n\tallowMemberAction(room, action) {\n\t\tswitch (action) {\n\t\t\tcase RoomMemberActions.BLOCK:\n\t\t\t\treturn false;\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t}\n\n\tgetUiText(context) {\n\t\tswitch (context) {\n\t\t\tcase UiTextContext.HIDE_WARNING:\n\t\t\t\treturn 'Hide_Room_Warning';\n\t\t\tcase UiTextContext.LEAVE_WARNING:\n\t\t\t\treturn 'Leave_Room_Warning';\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n\n\tgetAvatarPath(roomData) {\n\t\treturn getAvatarURL({ roomId: roomData._id, cache: roomData.avatarETag });\n\t}\n\n\tgetDiscussionType() {\n\t\treturn 'c';\n\t}\n}\n"]},"sourceType":"module","hash":"a050c7f44c97e188757d072bc0ba39660393761b"}
