{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/lib/server/functions/validateCustomFields.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/lib/server/functions/validateCustomFields.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/lib/server/functions/validateCustomFields.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/app/lib/server/functions/validateCustomFields.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/lib/server/functions/validateCustomFields.js"}},"code":"module.export({\n  validateCustomFields: () => validateCustomFields\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet s;\nmodule.link(\"underscore.string\", {\n  default(v) {\n    s = v;\n  }\n\n}, 1);\nlet settings;\nmodule.link(\"../../../settings\", {\n  settings(v) {\n    settings = v;\n  }\n\n}, 2);\n\nconst validateCustomFields = function (fields) {\n  // Special Case:\n  // If an admin didn't set any custom fields there's nothing to validate against so consider any customFields valid\n  if (s.trim(settings.get('Accounts_CustomFields')) === '') {\n    return;\n  }\n\n  let customFieldsMeta;\n\n  try {\n    customFieldsMeta = JSON.parse(settings.get('Accounts_CustomFields'));\n  } catch (e) {\n    throw new Meteor.Error('error-invalid-customfield-json', 'Invalid JSON for Custom Fields');\n  }\n\n  const customFields = {};\n  Object.keys(customFieldsMeta).forEach(fieldName => {\n    const field = customFieldsMeta[fieldName];\n    customFields[fieldName] = fields[fieldName];\n    const fieldValue = s.trim(fields[fieldName]);\n\n    if (field.required && fieldValue === '') {\n      throw new Meteor.Error('error-user-registration-custom-field', \"Field \".concat(fieldName, \" is required\"), {\n        method: 'registerUser'\n      });\n    }\n\n    if (field.type === 'select' && field.options.indexOf(fields[fieldName]) === -1) {\n      throw new Meteor.Error('error-user-registration-custom-field', \"Value for field \".concat(fieldName, \" is invalid\"), {\n        method: 'registerUser'\n      });\n    }\n\n    if (field.maxLength && fieldValue.length > field.maxLength) {\n      throw new Meteor.Error('error-user-registration-custom-field', \"Max length of field \".concat(fieldName, \" \").concat(field.maxLength), {\n        method: 'registerUser'\n      });\n    }\n\n    if (field.minLength && fieldValue.length > 0 && fieldValue.length < field.minLength) {\n      throw new Meteor.Error('error-user-registration-custom-field', \"Min length of field \".concat(fieldName, \" \").concat(field.minLength), {\n        method: 'registerUser'\n      });\n    }\n  });\n};","map":{"version":3,"sources":["app/lib/server/functions/validateCustomFields.js"],"names":["module","export","validateCustomFields","Meteor","link","v","s","default","settings","fields","trim","get","customFieldsMeta","JSON","parse","e","Error","customFields","Object","keys","forEach","fieldName","field","fieldValue","required","method","type","options","indexOf","maxLength","length","minLength"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport s from 'underscore.string';\n\nimport { settings } from '../../../settings';\n\nexport const validateCustomFields = function (fields) {\n\t// Special Case:\n\t// If an admin didn't set any custom fields there's nothing to validate against so consider any customFields valid\n\tif (s.trim(settings.get('Accounts_CustomFields')) === '') {\n\t\treturn;\n\t}\n\n\tlet customFieldsMeta;\n\ttry {\n\t\tcustomFieldsMeta = JSON.parse(settings.get('Accounts_CustomFields'));\n\t} catch (e) {\n\t\tthrow new Meteor.Error('error-invalid-customfield-json', 'Invalid JSON for Custom Fields');\n\t}\n\n\tconst customFields = {};\n\n\tObject.keys(customFieldsMeta).forEach((fieldName) => {\n\t\tconst field = customFieldsMeta[fieldName];\n\n\t\tcustomFields[fieldName] = fields[fieldName];\n\t\tconst fieldValue = s.trim(fields[fieldName]);\n\n\t\tif (field.required && fieldValue === '') {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Field ${fieldName} is required`, { method: 'registerUser' });\n\t\t}\n\n\t\tif (field.type === 'select' && field.options.indexOf(fields[fieldName]) === -1) {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Value for field ${fieldName} is invalid`, { method: 'registerUser' });\n\t\t}\n\n\t\tif (field.maxLength && fieldValue.length > field.maxLength) {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Max length of field ${fieldName} ${field.maxLength}`, {\n\t\t\t\tmethod: 'registerUser',\n\t\t\t});\n\t\t}\n\n\t\tif (field.minLength && fieldValue.length > 0 && fieldValue.length < field.minLength) {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Min length of field ${fieldName} ${field.minLength}`, {\n\t\t\t\tmethod: 'registerUser',\n\t\t\t});\n\t\t}\n\t});\n};\n"]},"sourceType":"module","hash":"94f616627352b22c3c61b9999c8e31c788e9e309"}
