{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/ee/app/models/server/models/LivechatDepartment.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"ee/app/models/server/models/LivechatDepartment.js","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/ee/app/models/server/models/LivechatDepartment.js","targets":{"android":"95.0.0","chrome":"95.0.0","edge":"95.0.0","firefox":"78.0.0","ie":"10.0.0","ios":"15.0.0","opera":"81.0.0","safari":"15.1.0","samsung":"14.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.16.5","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/ee/app/models/server/models/LivechatDepartment.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"ee/app/models/server/models/LivechatDepartment.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet LivechatDepartment;\nmodule.link(\"../../../../../app/models/server/models/LivechatDepartment\", {\n  LivechatDepartment(v) {\n    LivechatDepartment = v;\n  }\n\n}, 1);\nlet LivechatDepartmentModel;\nmodule.link(\"../../../../../app/models/server\", {\n  LivechatDepartment(v) {\n    LivechatDepartmentModel = v;\n  }\n\n}, 2);\nlet LivechatUnit;\nmodule.link(\"../index\", {\n  LivechatUnit(v) {\n    LivechatUnit = v;\n  }\n\n}, 3);\nlet overwriteClassOnLicense;\nmodule.link(\"../../../license/server\", {\n  overwriteClassOnLicense(v) {\n    overwriteClassOnLicense = v;\n  }\n\n}, 4);\nconst {\n  find,\n  findOne,\n  update,\n  remove\n} = LivechatDepartment.prototype;\noverwriteClassOnLicense('livechat-enterprise', LivechatDepartment, {\n  unfilteredFind(originalFn) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    return find.apply(this, args);\n  },\n\n  unfilteredFindOne(originalFn) {\n    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n\n    return findOne.apply(this, args);\n  },\n\n  unfilteredUpdate(originalFn) {\n    for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n      args[_key3 - 1] = arguments[_key3];\n    }\n\n    return update.apply(this, args);\n  },\n\n  unfilteredRemove(originalFn) {\n    for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n      args[_key4 - 1] = arguments[_key4];\n    }\n\n    return remove.apply(this, args);\n  },\n\n  createOrUpdateDepartment(originalFn) {\n    for (var _len5 = arguments.length, args = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n      args[_key5 - 1] = arguments[_key5];\n    }\n\n    if (args.length > 2 && !args[1].type) {\n      args[1].type = 'd';\n    }\n\n    if (args[1] && args[1].departmentsAllowedToForward) {\n      args[1].departmentsAllowedToForward = args[1].departmentsAllowedToForward.split(',');\n    }\n\n    return originalFn.apply(this, args);\n  },\n\n  removeParentAndAncestorById(originalFn, parentId) {\n    const query = {\n      parentId\n    };\n    const update = {\n      $unset: {\n        parentId: 1\n      },\n      $pull: {\n        ancestors: parentId\n      }\n    };\n    return this.update(query, update, {\n      multi: true\n    });\n  },\n\n  findEnabledWithAgentsAndBusinessUnit(originalFn, businessUnit) {\n    let fields = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : undefined;\n\n    if (!businessUnit) {\n      return LivechatDepartmentModel.findEnabledWithAgents(fields);\n    }\n\n    const unit = LivechatUnit.findOneById(businessUnit, {\n      fields: {\n        _id: 1\n      }\n    });\n\n    if (!unit) {\n      throw new Meteor.Error('error-unit-not-found', \"Error! No Active Business Unit found with id: \".concat(businessUnit));\n    }\n\n    return LivechatDepartmentModel.findActiveByUnitIds([businessUnit], {\n      fields\n    });\n  }\n\n});\n\nLivechatDepartment.prototype.removeDepartmentFromForwardListById = function (_id) {\n  return this.update({\n    departmentsAllowedToForward: _id\n  }, {\n    $pull: {\n      departmentsAllowedToForward: _id\n    }\n  }, {\n    multi: true\n  });\n};\n\nmodule.exportDefault(LivechatDepartment);","map":{"version":3,"sources":["ee/app/models/server/models/LivechatDepartment.js"],"names":["Meteor","module","link","v","LivechatDepartment","LivechatDepartmentModel","LivechatUnit","overwriteClassOnLicense","find","findOne","update","remove","prototype","unfilteredFind","originalFn","args","apply","unfilteredFindOne","unfilteredUpdate","unfilteredRemove","createOrUpdateDepartment","length","type","departmentsAllowedToForward","split","removeParentAndAncestorById","parentId","query","$unset","$pull","ancestors","multi","findEnabledWithAgentsAndBusinessUnit","businessUnit","fields","undefined","findEnabledWithAgents","unit","findOneById","_id","Error","findActiveByUnitIds","removeDepartmentFromForwardListById","exportDefault"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport { LivechatDepartment } from '../../../../../app/models/server/models/LivechatDepartment';\nimport { LivechatDepartment as LivechatDepartmentModel } from '../../../../../app/models/server';\nimport { LivechatUnit } from '../index';\nimport { overwriteClassOnLicense } from '../../../license/server';\n\nconst { find, findOne, update, remove } = LivechatDepartment.prototype;\n\noverwriteClassOnLicense('livechat-enterprise', LivechatDepartment, {\n\tunfilteredFind(originalFn, ...args) {\n\t\treturn find.apply(this, args);\n\t},\n\tunfilteredFindOne(originalFn, ...args) {\n\t\treturn findOne.apply(this, args);\n\t},\n\tunfilteredUpdate(originalFn, ...args) {\n\t\treturn update.apply(this, args);\n\t},\n\tunfilteredRemove(originalFn, ...args) {\n\t\treturn remove.apply(this, args);\n\t},\n\tcreateOrUpdateDepartment(originalFn, ...args) {\n\t\tif (args.length > 2 && !args[1].type) {\n\t\t\targs[1].type = 'd';\n\t\t}\n\t\tif (args[1] && args[1].departmentsAllowedToForward) {\n\t\t\targs[1].departmentsAllowedToForward = args[1].departmentsAllowedToForward.split(',');\n\t\t}\n\n\t\treturn originalFn.apply(this, args);\n\t},\n\tremoveParentAndAncestorById(originalFn, parentId) {\n\t\tconst query = {\n\t\t\tparentId,\n\t\t};\n\n\t\tconst update = {\n\t\t\t$unset: { parentId: 1 },\n\t\t\t$pull: { ancestors: parentId },\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t},\n\tfindEnabledWithAgentsAndBusinessUnit(originalFn, businessUnit, fields = undefined) {\n\t\tif (!businessUnit) {\n\t\t\treturn LivechatDepartmentModel.findEnabledWithAgents(fields);\n\t\t}\n\t\tconst unit = LivechatUnit.findOneById(businessUnit, { fields: { _id: 1 } });\n\t\tif (!unit) {\n\t\t\tthrow new Meteor.Error('error-unit-not-found', `Error! No Active Business Unit found with id: ${businessUnit}`);\n\t\t}\n\n\t\treturn LivechatDepartmentModel.findActiveByUnitIds([businessUnit], { fields });\n\t},\n});\n\nLivechatDepartment.prototype.removeDepartmentFromForwardListById = function (_id) {\n\treturn this.update({ departmentsAllowedToForward: _id }, { $pull: { departmentsAllowedToForward: _id } }, { multi: true });\n};\n\nexport default LivechatDepartment;\n"]},"sourceType":"module","hash":"fe877754e4dbdc5b2387fc05c73a9e736a5cf6b9"}
