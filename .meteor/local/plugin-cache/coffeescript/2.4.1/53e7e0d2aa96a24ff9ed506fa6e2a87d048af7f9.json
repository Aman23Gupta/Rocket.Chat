{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-server.coffee","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-server.coffee","filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-server.coffee","passPerPreset":false,"envName":"development","cwd":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","root":"/Users/amangupta/Documents/Open-Source/Rocket.Chat","plugins":[{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"presets":[],"generatorOpts":{"filename":"/Users/amangupta/Documents/Open-Source/Rocket.Chat/packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-server.coffee","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-server.coffee"}},"code":"module.export({\n  TAPi18nServer: () => TAPi18nServer\n});\nlet TAPi18nBase;\nmodule.link(\"./tap_i18n-common\", {\n  TAPi18nBase(v) {\n    TAPi18nBase = v;\n  }\n\n}, 0);\nlet globals;\nmodule.link(\"./globals\", {\n  globals(v) {\n    globals = v;\n  }\n\n}, 1);\nvar indexOf = [].indexOf;\n\nvar TAPi18nServer = function () {\n  class TAPi18nServer extends TAPi18nBase {\n    _registerServerTranslator(lang_tag, package_name) {\n      if (this._enabled()) {\n        if (!(lang_tag in this.server_translators)) {\n          this.server_translators[lang_tag] = this._getSpecificLangTranslator(lang_tag);\n        } // fallback language is integrated, and isn't part of @translations\n\n\n        if (lang_tag !== this._fallback_language) {\n          this.addResourceBundle(lang_tag, package_name, this.translations[lang_tag][package_name]);\n        }\n      }\n\n      if (!(this._fallback_language in this.server_translators)) {\n        return this.server_translators[this._fallback_language] = this._getSpecificLangTranslator(this._fallback_language);\n      }\n    }\n\n    _registerAllServerTranslators() {\n      var i, lang_tag, len, package_name, ref, results;\n      ref = this._getProjectLanguages();\n      results = [];\n\n      for (i = 0, len = ref.length; i < len; i++) {\n        lang_tag = ref[i];\n        results.push(function () {\n          var results1;\n          results1 = [];\n\n          for (package_name in this.translations[lang_tag]) {\n            results1.push(this._registerServerTranslator(lang_tag, package_name));\n          }\n\n          return results1;\n        }.call(this));\n      }\n\n      return results;\n    }\n\n    _getPackageI18nextProxy(package_name) {\n      // A proxy to TAPi18next.t where the namespace is preset to the package's\n      return (key, options, lang_tag = null) => {\n        if (lang_tag == null) {\n          // translate to fallback_language\n          return this.server_translators[this._fallback_language](`${this._getPackageDomain(package_name)}:${key}`, options);\n        } else if (!(lang_tag in this.server_translators)) {\n          console.log(`Warning: language ${lang_tag} is not supported in this project, fallback language (${this._fallback_language})`);\n          return this.server_translators[this._fallback_language](`${this._getPackageDomain(package_name)}:${key}`, options);\n        } else {\n          return this.server_translators[lang_tag](`${this._getPackageDomain(package_name)}:${key}`, options);\n        }\n      };\n    }\n\n    _registerHTTPMethod() {\n      var methods, self;\n      self = this;\n      methods = {};\n\n      if (!self._enabled()) {\n        throw new Meteor.Error(500, \"tap-i18n has to be enabled in order to register the HTTP method\");\n      }\n\n      JsonRoutes.add('get', `${self.conf.i18n_files_route.replace(/\\/$/, \"\")}/multi/:langs`, function (req, res, next) {\n        var i, lang_tag, langs, language_translations, len, output;\n\n        if (!RegExp(`^((${globals.langauges_tags_regex},)*${globals.langauges_tags_regex}|all).json$`).test(req.params.langs)) {\n          return JsonRoutes.sendResult(res, {\n            code: 401\n          });\n        }\n\n        langs = req.params.langs.replace(\".json\", \"\");\n\n        if (langs === \"all\") {\n          output = self.translations;\n        } else {\n          output = {};\n          langs = langs.split(\",\");\n\n          for (i = 0, len = langs.length; i < len; i++) {\n            lang_tag = langs[i];\n\n            if (indexOf.call(self._getProjectLanguages(), lang_tag) >= 0 && lang_tag !== self._fallback_language) {\n              // fallback language is integrated to the bundle\n              language_translations = self.translations[lang_tag];\n\n              if (language_translations != null) {\n                output[lang_tag] = language_translations;\n              }\n            }\n          }\n        }\n\n        return JsonRoutes.sendResult(res, {\n          data: output\n        });\n      });\n      return JsonRoutes.add('get', `${self.conf.i18n_files_route.replace(/\\/$/, \"\")}/:lang`, function (req, res, next) {\n        var lang_tag, language_translations;\n\n        if (!RegExp(`^${globals.langauges_tags_regex}.json$`).test(req.params.lang)) {\n          return JsonRoutes.sendResult(res, {\n            code: 401\n          });\n        }\n\n        lang_tag = req.params.lang.replace(\".json\", \"\");\n\n        if (indexOf.call(self._getProjectLanguages(), lang_tag) < 0 || lang_tag === self._fallback_language) {\n          // fallback language is integrated to the bundle\n          return JsonRoutes.sendResult(res, {\n            code: 404 // not found\n\n          });\n        }\n\n        language_translations = self.translations[lang_tag]; // returning {} if lang_tag is not in translations allows the project\n        // developer to force a language supporte with project-tap.i18n's\n        // supported_languages property, even if that language has no lang\n        // files.\n\n        return JsonRoutes.sendResult(res, {\n          data: language_translations != null ? language_translations : {}\n        });\n      });\n    }\n\n    _onceEnabled() {\n      return this._registerAllServerTranslators();\n    }\n\n  }\n\n  ;\n  TAPi18nServer.prototype.server_translators = null;\n  return TAPi18nServer;\n}.call(this);","map":{"version":3,"sources":["packages/rocketchat:tap-i18n/lib/tap_i18n/tap_i18n-server.coffee"],"names":["module","export","TAPi18nServer","TAPi18nBase","link","v","globals","indexOf","_registerServerTranslator","lang_tag","package_name","_enabled","server_translators","_getSpecificLangTranslator","_fallback_language","addResourceBundle","translations","_registerAllServerTranslators","i","len","ref","results","_getProjectLanguages","length","push","results1","call","_getPackageI18nextProxy","key","options","_getPackageDomain","console","log","_registerHTTPMethod","methods","self","Meteor","Error","JsonRoutes","add","conf","i18n_files_route","replace","req","res","next","langs","language_translations","output","RegExp","langauges_tags_regex","test","params","sendResult","code","split","data","lang","_onceEnabled","prototype"],"mappings":"AAAAA,MAAM,CAACC,MAAP,CAAc;AAACC,EAAAA,aAAa,EAAC,MAAIA;AAAnB,CAAd;AAAiD,IAAIC,WAAJ;AAAgBH,MAAM,CAACI,IAAP,CAAY,mBAAZ,EAAgC;AAACD,EAAAA,WAAW,CAACE,CAAD,EAAG;AAACF,IAAAA,WAAW,GAACE,CAAZ;AAAc;;AAA9B,CAAhC,EAAgE,CAAhE;AAAmE,IAAIC,OAAJ;AAAYN,MAAM,CAACI,IAAP,CAAY,WAAZ,EAAwB;AAACE,EAAAA,OAAO,CAACD,CAAD,EAAG;AAACC,IAAAA,OAAO,GAACD,CAAR;AAAU;;AAAtB,CAAxB,EAAgD,CAAhD;AAAhJ,IAAIE,OAAO,GAAG,GAAGA,OAAjB;;AAUO,IAAIL,aAAa,GAAI,YAAW;AACrC,QAAMA,aAAN,SAA4BC,WAA5B,CAAwC;AACtCK,IAAAA,yBAAyB,CAACC,QAAD,EAAWC,YAAX,EAAyB;AAChD,UAAI,KAAKC,QAAL,EAAJ,EAAqB;AACnB,YAAI,EAAEF,QAAQ,IAAI,KAAKG,kBAAnB,CAAJ,EAA4C;AAC1C,eAAKA,kBAAL,CAAwBH,QAAxB,IAAoC,KAAKI,0BAAL,CAAgCJ,QAAhC,CAApC;AACD,SAHkB,CAInB;;;AACA,YAAIA,QAAQ,KAAK,KAAKK,kBAAtB,EAA0C;AACxC,eAAKC,iBAAL,CAAuBN,QAAvB,EAAiCC,YAAjC,EAA+C,KAAKM,YAAL,CAAkBP,QAAlB,EAA4BC,YAA5B,CAA/C;AACD;AACF;;AACD,UAAI,EAAE,KAAKI,kBAAL,IAA2B,KAAKF,kBAAlC,CAAJ,EAA2D;AACzD,eAAO,KAAKA,kBAAL,CAAwB,KAAKE,kBAA7B,IAAmD,KAAKD,0BAAL,CAAgC,KAAKC,kBAArC,CAA1D;AACD;AACF;;AAEDG,IAAAA,6BAA6B,GAAG;AAC9B,UAAIC,CAAJ,EAAOT,QAAP,EAAiBU,GAAjB,EAAsBT,YAAtB,EAAoCU,GAApC,EAAyCC,OAAzC;AACAD,MAAAA,GAAG,GAAG,KAAKE,oBAAL,EAAN;AACAD,MAAAA,OAAO,GAAG,EAAV;;AACA,WAAKH,CAAC,GAAG,CAAJ,EAAOC,GAAG,GAAGC,GAAG,CAACG,MAAtB,EAA8BL,CAAC,GAAGC,GAAlC,EAAuCD,CAAC,EAAxC,EAA4C;AAC1CT,QAAAA,QAAQ,GAAGW,GAAG,CAACF,CAAD,CAAd;AACAG,QAAAA,OAAO,CAACG,IAAR,CAAc,YAAW;AACvB,cAAIC,QAAJ;AACAA,UAAAA,QAAQ,GAAG,EAAX;;AACA,eAAKf,YAAL,IAAqB,KAAKM,YAAL,CAAkBP,QAAlB,CAArB,EAAkD;AAChDgB,YAAAA,QAAQ,CAACD,IAAT,CAAc,KAAKhB,yBAAL,CAA+BC,QAA/B,EAAyCC,YAAzC,CAAd;AACD;;AACD,iBAAOe,QAAP;AACD,SAPY,CAOVC,IAPU,CAOL,IAPK,CAAb;AAQD;;AACD,aAAOL,OAAP;AACD;;AAEDM,IAAAA,uBAAuB,CAACjB,YAAD,EAAe;AACpC;AACA,aAAO,CAACkB,GAAD,EAAMC,OAAN,EAAepB,QAAQ,GAAG,IAA1B,KAAmC;AACxC,YAAIA,QAAQ,IAAI,IAAhB,EAAsB;AACpB;AACA,iBAAO,KAAKG,kBAAL,CAAwB,KAAKE,kBAA7B,EAAkD,GAAE,KAAKgB,iBAAL,CAAuBpB,YAAvB,CAAqC,IAAGkB,GAAI,EAAhG,EAAmGC,OAAnG,CAAP;AACD,SAHD,MAGO,IAAI,EAAEpB,QAAQ,IAAI,KAAKG,kBAAnB,CAAJ,EAA4C;AACjDmB,UAAAA,OAAO,CAACC,GAAR,CAAa,qBAAoBvB,QAAS,yDAAwD,KAAKK,kBAAmB,GAA1H;AACA,iBAAO,KAAKF,kBAAL,CAAwB,KAAKE,kBAA7B,EAAkD,GAAE,KAAKgB,iBAAL,CAAuBpB,YAAvB,CAAqC,IAAGkB,GAAI,EAAhG,EAAmGC,OAAnG,CAAP;AACD,SAHM,MAGA;AACL,iBAAO,KAAKjB,kBAAL,CAAwBH,QAAxB,EAAmC,GAAE,KAAKqB,iBAAL,CAAuBpB,YAAvB,CAAqC,IAAGkB,GAAI,EAAjF,EAAoFC,OAApF,CAAP;AACD;AACF,OAVD;AAWD;;AAEDI,IAAAA,mBAAmB,GAAG;AACpB,UAAIC,OAAJ,EAAaC,IAAb;AACAA,MAAAA,IAAI,GAAG,IAAP;AACAD,MAAAA,OAAO,GAAG,EAAV;;AACA,UAAI,CAACC,IAAI,CAACxB,QAAL,EAAL,EAAsB;AACpB,cAAM,IAAIyB,MAAM,CAACC,KAAX,CAAiB,GAAjB,EAAsB,iEAAtB,CAAN;AACD;;AACDC,MAAAA,UAAU,CAACC,GAAX,CAAe,KAAf,EAAuB,GAAEJ,IAAI,CAACK,IAAL,CAAUC,gBAAV,CAA2BC,OAA3B,CAAmC,KAAnC,EAA0C,EAA1C,CAA8C,eAAvE,EAAuF,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AAC9G,YAAI3B,CAAJ,EAAOT,QAAP,EAAiBqC,KAAjB,EAAwBC,qBAAxB,EAA+C5B,GAA/C,EAAoD6B,MAApD;;AACA,YAAI,CAACC,MAAM,CAAE,MAAK3C,OAAO,CAAC4C,oBAAqB,MAAK5C,OAAO,CAAC4C,oBAAqB,aAAtE,CAAN,CAA0FC,IAA1F,CAA+FR,GAAG,CAACS,MAAJ,CAAWN,KAA1G,CAAL,EAAuH;AACrH,iBAAOR,UAAU,CAACe,UAAX,CAAsBT,GAAtB,EAA2B;AAChCU,YAAAA,IAAI,EAAE;AAD0B,WAA3B,CAAP;AAGD;;AACDR,QAAAA,KAAK,GAAGH,GAAG,CAACS,MAAJ,CAAWN,KAAX,CAAiBJ,OAAjB,CAAyB,OAAzB,EAAkC,EAAlC,CAAR;;AACA,YAAII,KAAK,KAAK,KAAd,EAAqB;AACnBE,UAAAA,MAAM,GAAGb,IAAI,CAACnB,YAAd;AACD,SAFD,MAEO;AACLgC,UAAAA,MAAM,GAAG,EAAT;AACAF,UAAAA,KAAK,GAAGA,KAAK,CAACS,KAAN,CAAY,GAAZ,CAAR;;AACA,eAAKrC,CAAC,GAAG,CAAJ,EAAOC,GAAG,GAAG2B,KAAK,CAACvB,MAAxB,EAAgCL,CAAC,GAAGC,GAApC,EAAyCD,CAAC,EAA1C,EAA8C;AAC5CT,YAAAA,QAAQ,GAAGqC,KAAK,CAAC5B,CAAD,CAAhB;;AACA,gBAAIX,OAAO,CAACmB,IAAR,CAAaS,IAAI,CAACb,oBAAL,EAAb,EAA0Cb,QAA1C,KAAuD,CAAvD,IAA4DA,QAAQ,KAAK0B,IAAI,CAACrB,kBAAlF,EAAsG;AAAE;AACtGiC,cAAAA,qBAAqB,GAAGZ,IAAI,CAACnB,YAAL,CAAkBP,QAAlB,CAAxB;;AACA,kBAAIsC,qBAAqB,IAAI,IAA7B,EAAmC;AACjCC,gBAAAA,MAAM,CAACvC,QAAD,CAAN,GAAmBsC,qBAAnB;AACD;AACF;AACF;AACF;;AACD,eAAOT,UAAU,CAACe,UAAX,CAAsBT,GAAtB,EAA2B;AAChCY,UAAAA,IAAI,EAAER;AAD0B,SAA3B,CAAP;AAGD,OA1BD;AA2BA,aAAOV,UAAU,CAACC,GAAX,CAAe,KAAf,EAAuB,GAAEJ,IAAI,CAACK,IAAL,CAAUC,gBAAV,CAA2BC,OAA3B,CAAmC,KAAnC,EAA0C,EAA1C,CAA8C,QAAvE,EAAgF,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AAC9G,YAAIpC,QAAJ,EAAcsC,qBAAd;;AACA,YAAI,CAACE,MAAM,CAAE,IAAG3C,OAAO,CAAC4C,oBAAqB,QAAlC,CAAN,CAAiDC,IAAjD,CAAsDR,GAAG,CAACS,MAAJ,CAAWK,IAAjE,CAAL,EAA6E;AAC3E,iBAAOnB,UAAU,CAACe,UAAX,CAAsBT,GAAtB,EAA2B;AAChCU,YAAAA,IAAI,EAAE;AAD0B,WAA3B,CAAP;AAGD;;AACD7C,QAAAA,QAAQ,GAAGkC,GAAG,CAACS,MAAJ,CAAWK,IAAX,CAAgBf,OAAhB,CAAwB,OAAxB,EAAiC,EAAjC,CAAX;;AACA,YAAInC,OAAO,CAACmB,IAAR,CAAaS,IAAI,CAACb,oBAAL,EAAb,EAA0Cb,QAA1C,IAAsD,CAAtD,IAA2DA,QAAQ,KAAK0B,IAAI,CAACrB,kBAAjF,EAAqG;AAAE;AACrG,iBAAOwB,UAAU,CAACe,UAAX,CAAsBT,GAAtB,EAA2B;AAChCU,YAAAA,IAAI,EAAE,GAD0B,CACtB;;AADsB,WAA3B,CAAP;AAGD;;AACDP,QAAAA,qBAAqB,GAAGZ,IAAI,CAACnB,YAAL,CAAkBP,QAAlB,CAAxB,CAb8G,CAc9G;AACA;AACA;AACA;;AACA,eAAO6B,UAAU,CAACe,UAAX,CAAsBT,GAAtB,EAA2B;AAChCY,UAAAA,IAAI,EAAGT,qBAAqB,IAAI,IAAzB,GAAgCA,qBAAhC,GAAwD;AAD/B,SAA3B,CAAP;AAGD,OArBM,CAAP;AAsBD;;AAEDW,IAAAA,YAAY,GAAG;AACb,aAAO,KAAKzC,6BAAL,EAAP;AACD;;AA7GqC;;AA+GvC;AAEDf,EAAAA,aAAa,CAACyD,SAAd,CAAwB/C,kBAAxB,GAA6C,IAA7C;AAEA,SAAOV,aAAP;AAED,CAtH0B,CAsHxBwB,IAtHwB,CAsHnB,IAtHmB,CAApB","sourcesContent":["var indexOf = [].indexOf;\n\nimport {\n  TAPi18nBase\n} from './tap_i18n-common';\n\nimport {\n  globals\n} from './globals';\n\nexport var TAPi18nServer = (function() {\n  class TAPi18nServer extends TAPi18nBase {\n    _registerServerTranslator(lang_tag, package_name) {\n      if (this._enabled()) {\n        if (!(lang_tag in this.server_translators)) {\n          this.server_translators[lang_tag] = this._getSpecificLangTranslator(lang_tag);\n        }\n        // fallback language is integrated, and isn't part of @translations\n        if (lang_tag !== this._fallback_language) {\n          this.addResourceBundle(lang_tag, package_name, this.translations[lang_tag][package_name]);\n        }\n      }\n      if (!(this._fallback_language in this.server_translators)) {\n        return this.server_translators[this._fallback_language] = this._getSpecificLangTranslator(this._fallback_language);\n      }\n    }\n\n    _registerAllServerTranslators() {\n      var i, lang_tag, len, package_name, ref, results;\n      ref = this._getProjectLanguages();\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        lang_tag = ref[i];\n        results.push((function() {\n          var results1;\n          results1 = [];\n          for (package_name in this.translations[lang_tag]) {\n            results1.push(this._registerServerTranslator(lang_tag, package_name));\n          }\n          return results1;\n        }).call(this));\n      }\n      return results;\n    }\n\n    _getPackageI18nextProxy(package_name) {\n      // A proxy to TAPi18next.t where the namespace is preset to the package's\n      return (key, options, lang_tag = null) => {\n        if (lang_tag == null) {\n          // translate to fallback_language\n          return this.server_translators[this._fallback_language](`${this._getPackageDomain(package_name)}:${key}`, options);\n        } else if (!(lang_tag in this.server_translators)) {\n          console.log(`Warning: language ${lang_tag} is not supported in this project, fallback language (${this._fallback_language})`);\n          return this.server_translators[this._fallback_language](`${this._getPackageDomain(package_name)}:${key}`, options);\n        } else {\n          return this.server_translators[lang_tag](`${this._getPackageDomain(package_name)}:${key}`, options);\n        }\n      };\n    }\n\n    _registerHTTPMethod() {\n      var methods, self;\n      self = this;\n      methods = {};\n      if (!self._enabled()) {\n        throw new Meteor.Error(500, \"tap-i18n has to be enabled in order to register the HTTP method\");\n      }\n      JsonRoutes.add('get', `${self.conf.i18n_files_route.replace(/\\/$/, \"\")}/multi/:langs`, function(req, res, next) {\n        var i, lang_tag, langs, language_translations, len, output;\n        if (!RegExp(`^((${globals.langauges_tags_regex},)*${globals.langauges_tags_regex}|all).json$`).test(req.params.langs)) {\n          return JsonRoutes.sendResult(res, {\n            code: 401\n          });\n        }\n        langs = req.params.langs.replace(\".json\", \"\");\n        if (langs === \"all\") {\n          output = self.translations;\n        } else {\n          output = {};\n          langs = langs.split(\",\");\n          for (i = 0, len = langs.length; i < len; i++) {\n            lang_tag = langs[i];\n            if (indexOf.call(self._getProjectLanguages(), lang_tag) >= 0 && lang_tag !== self._fallback_language) { // fallback language is integrated to the bundle\n              language_translations = self.translations[lang_tag];\n              if (language_translations != null) {\n                output[lang_tag] = language_translations;\n              }\n            }\n          }\n        }\n        return JsonRoutes.sendResult(res, {\n          data: output\n        });\n      });\n      return JsonRoutes.add('get', `${self.conf.i18n_files_route.replace(/\\/$/, \"\")}/:lang`, function(req, res, next) {\n        var lang_tag, language_translations;\n        if (!RegExp(`^${globals.langauges_tags_regex}.json$`).test(req.params.lang)) {\n          return JsonRoutes.sendResult(res, {\n            code: 401\n          });\n        }\n        lang_tag = req.params.lang.replace(\".json\", \"\");\n        if (indexOf.call(self._getProjectLanguages(), lang_tag) < 0 || lang_tag === self._fallback_language) { // fallback language is integrated to the bundle\n          return JsonRoutes.sendResult(res, {\n            code: 404 // not found\n          });\n        }\n        language_translations = self.translations[lang_tag];\n        // returning {} if lang_tag is not in translations allows the project\n        // developer to force a language supporte with project-tap.i18n's\n        // supported_languages property, even if that language has no lang\n        // files.\n        return JsonRoutes.sendResult(res, {\n          data: (language_translations != null ? language_translations : {})\n        });\n      });\n    }\n\n    _onceEnabled() {\n      return this._registerAllServerTranslators();\n    }\n\n  };\n\n  TAPi18nServer.prototype.server_translators = null;\n\n  return TAPi18nServer;\n\n}).call(this);\n"]},"sourceType":"script","hash":"53e7e0d2aa96a24ff9ed506fa6e2a87d048af7f9"}
