{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:streamer/lib/ev.js","meteor://ðŸ’»app/packages/rocketchat:streamer/client/client.js"],"names":["EV","handlers","emit","event","args","forEach","handler","apply","emitWithScope","scope","listenerCount","length","on","callback","push","once","self","onetimeCallback","removeListener","arguments","index","indexOf","splice","removeAllListeners","undefined","_createClass","module","link","default","v","_assertThisInitialized","_inheritsLoose","NonEmptyString","Match","Where","x","check","String","StreamerCentral","instances","ddpConnections","setupDdpConnection","name","ddpConnection","hasMeteorStreamerEventListeners","_stream","raw_msg","msg","DDPCommon","parseDDP","collection","fields","eventName","unshift","storeDdpConnection","Meteor","Streamer","useCollection","connection","console","warn","subscriptions","subscriptionName","lastMessage","prototype","call","stop","subscription","stopAll","Object","keys","unsubscribe","subscribe","Promise","resolve","reject","Tracker","nonreactive","onStop","onReady","onReconnect","fn","getLastMessageFromEvent","pop","Function","_name","_useCollection","Boolean"],"mappings":"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","file":"/packages/rocketchat_streamer.js","sourcesContent":["/* globals EV:true */\n/* exported EV */\n\nEV = class EV {\n\tconstructor() {\n\t\tthis.handlers = {};\n\t}\n\n\temit(event, ...args) {\n\t\treturn this.handlers[event] && this.handlers[event].forEach(handler => handler.apply(this, args));\n\t}\n\n\temitWithScope(event, scope, ...args) {\n\t\treturn this.handlers[event] && this.handlers[event].forEach(handler => handler.apply(scope, args));\n\t}\n\n\tlistenerCount(event) {\n\t\treturn (this.handlers[event] && this.handlers[event].length) || 0;\n\t}\n\n\ton(event, callback) {\n\t\tif (!this.handlers[event]) {\n\t\t\tthis.handlers[event] = [];\n\t\t}\n\t\tthis.handlers[event].push(callback);\n\t}\n\n\tonce(event, callback) {\n\t\tconst self = this;\n\t\tthis.on(event, function onetimeCallback() {\n\t\t\tself.removeListener(event, onetimeCallback);\n\t\t\tcallback.apply(this, arguments);\n\t\t});\n\t}\n\n\tremoveListener(event, callback) {\n\t\tif (!this.handlers[event]) {\n\t\t\treturn;\n\t\t}\n\t\tconst index = this.handlers[event].indexOf(callback);\n\t\tif (index > -1) {\n\t\t\tthis.handlers[event].splice(index, 1);\n\t\t}\n\t}\n\n\tremoveAllListeners(event) {\n\t\tthis.handlers[event] = undefined;\n\t}\n};\n","/* globals DDPCommon, EV */\n/* eslint-disable new-cap */\nconst NonEmptyString = Match.Where(function (x) {\n\tcheck(x, String);\n\treturn x.length > 0;\n});\n\nclass StreamerCentral extends EV {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.instances = {};\n\t\tthis.ddpConnections = {};\t\t// since each Streamer instance can provide its own ddp connection, store them by streamer name\n\t}\n\n\tsetupDdpConnection(name, ddpConnection) {\n\t\t// make sure we only setup event listeners for each ddp connection once\n\t\tif (ddpConnection.hasMeteorStreamerEventListeners) {\n\t\t\treturn;\n\t\t}\n\t\tddpConnection._stream.on('message', (raw_msg) => {\n\t\t\tconst msg = DDPCommon.parseDDP(raw_msg);\n\t\t\tif (msg && msg.msg === 'changed' && msg.collection && msg.fields && msg.fields.eventName && msg.fields.args) {\n\t\t\t\tmsg.fields.args.unshift(msg.fields.eventName);\n\t\t\t\tmsg.fields.args.unshift(msg.collection);\n\t\t\t\tthis.emit.apply(this, msg.fields.args);\n\t\t\t}\n\t\t});\n\t\t// store ddp connection\n\t\tthis.storeDdpConnection(name, ddpConnection);\n\n\t}\n\n\tstoreDdpConnection(name, ddpConnection) {\n\t\t// mark the connection as setup for Streamer, and store it\n\t\tddpConnection.hasMeteorStreamerEventListeners = true;\n\t\tthis.ddpConnections[name] = ddpConnection;\n\t}\n}\n\nMeteor.StreamerCentral = new StreamerCentral;\n\nMeteor.Streamer = class Streamer extends EV {\n\tconstructor(name, { useCollection = false, ddpConnection = Meteor.connection } = {}) {\n\t\tif (Meteor.StreamerCentral.instances[name]) {\n\t\t\tconsole.warn('Streamer instance already exists:', name);\n\t\t\treturn Meteor.StreamerCentral.instances[name];\n\t\t}\n\t\tMeteor.StreamerCentral.setupDdpConnection(name, ddpConnection);\n\n\t\tsuper();\n\n\t\tthis.ddpConnection = ddpConnection || Meteor.connection;\n\n\t\tMeteor.StreamerCentral.instances[name] = this;\n\n\t\tthis.name = name;\n\t\tthis.useCollection = useCollection;\n\t\tthis.subscriptions = {};\n\n\t\tMeteor.StreamerCentral.on(this.subscriptionName, (eventName, ...args) => {\n\t\t\tif (this.subscriptions[eventName]) {\n\t\t\t\tthis.subscriptions[eventName].lastMessage = args;\n\t\t\t\tEV.prototype.emit.call(this, eventName, ...args);\n\t\t\t}\n\t\t});\n\n\t\tthis.ddpConnection._stream.on('reset', () => {\n\t\t\tEV.prototype.emit.call(this, '__reconnect__');\n\t\t});\n\t}\n\n\tget name() {\n\t\treturn this._name;\n\t}\n\n\tset name(name) {\n\t\tcheck(name, String);\n\t\tthis._name = name;\n\t}\n\n\tget subscriptionName() {\n\t\treturn `stream-${this.name}`;\n\t}\n\n\tget useCollection() {\n\t\treturn this._useCollection;\n\t}\n\n\tset useCollection(useCollection) {\n\t\tcheck(useCollection, Boolean);\n\t\tthis._useCollection = useCollection;\n\t}\n\n\tstop(eventName) {\n\t\treturn this.subscriptions[eventName] && this.subscriptions[eventName].subscription && this.subscriptions[eventName].subscription.stop();\n\t}\n\n\tstopAll() {\n\t\tObject.keys(this.subscriptions).forEach(eventName => this.removeAllListeners(eventName));\n\t}\n\n\tunsubscribe(eventName) {\n\t\tdelete this.subscriptions[eventName];\n\t\tEV.prototype.removeAllListeners.call(this, eventName);\n\t}\n\n\tsubscribe(eventName, args) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (this.subscriptions[eventName]) {\n\t\t\t\treturn resolve();\n\t\t\t}\n\t\t\tconst subscription = Tracker.nonreactive(() => this.ddpConnection.subscribe(\n\t\t\t\tthis.subscriptionName,\n\t\t\t\teventName,\n\t\t\t\t{ useCollection: this.useCollection, args },\n\t\t\t\t{\n\t\t\t\t\tonStop: () => reject(this.unsubscribe(eventName)),\n\t\t\t\t\tonReady: resolve\n\t\t\t\t}\n\t\t\t));\n\t\t\tthis.subscriptions[eventName] = { subscription };\n\t\t})\n\t}\n\n\tonReconnect(fn) {\n\t\tif (typeof fn === 'function') {\n\t\t\tEV.prototype.on.call(this, '__reconnect__', fn);\n\t\t}\n\t}\n\n\tgetLastMessageFromEvent(eventName) {\n\t\tconst subscription = this.subscriptions[eventName];\n\t\tif (subscription && subscription.lastMessage) {\n\t\t\treturn subscription.lastMessage;\n\t\t}\n\t}\n\n\tremoveAllListeners(eventName) {\n\t\tEV.prototype.removeAllListeners.call(this, eventName);\n\t\treturn this.stop(eventName);\n\t}\n\n\tremoveListener(eventName, ...args) {\n\t\tif (this.listenerCount(eventName) === 1) {\n\t\t\tthis.stop(eventName);\n\t\t}\n\t\tEV.prototype.removeListener.call(this, eventName, ...args);\n\t}\n\n\ton(eventName, ...args) {\n\t\tcheck(eventName, NonEmptyString);\n\n\t\tconst callback = args.pop();\n\t\tcheck(callback, Function);\n\n\t\tEV.prototype.on.call(this, eventName, callback);\n\n\t\treturn this.subscribe(eventName, args);\n\t}\n\n\tonce(eventName, ...args) {\n\t\tcheck(eventName, NonEmptyString);\n\n\t\tconst callback = args.pop();\n\t\tcheck(callback, Function);\n\n\t\tEV.prototype.once.call(this, eventName, (...args) => {\n\t\t\tcallback(...args);\n\t\t\tif (this.listenerCount(eventName) === 0) {\n\t\t\t\treturn this.stop(eventName);\n\t\t\t}\n\t\t});\n\n\t\treturn this.subscribe(eventName, args);\n\t}\n\n\temit(...args) {\n\t\tthis.ddpConnection.call(this.subscriptionName, ...args);\n\t}\n};\n"]}