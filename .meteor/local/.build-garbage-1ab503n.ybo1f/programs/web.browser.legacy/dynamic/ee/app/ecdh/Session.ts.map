{"version":3,"sources":["meteor://ðŸ’»app/ee/app/ecdh/Session.ts"],"names":[],"mappings":"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","file":"dynamic/ee/app/ecdh/Session.ts","sourcesContent":["import { SodiumPlus, X25519PublicKey, X25519SecretKey, CryptographyKey } from 'sodium-plus';\n\nlet sodium: SodiumPlus;\n\nexport class Session {\n\t// Encoding for the key exchange, no requirements to be small\n\tprotected readonly stringFormatKey: BufferEncoding = 'base64';\n\n\t// Encoding for the transfer of encrypted data, should be smaller as possible\n\tprotected readonly stringFormatEncryptedData: BufferEncoding = 'base64';\n\n\t// Encoding before the encryption to keep unicode chars\n\tprotected readonly stringFormatRawData: BufferEncoding = 'base64';\n\n\tprotected decryptKey: CryptographyKey;\n\n\tprotected encryptKey: CryptographyKey;\n\n\tprotected secretKey: X25519SecretKey;\n\n\tpublic publicKey: X25519PublicKey;\n\n\tasync sodium(): Promise<SodiumPlus> {\n\t\treturn sodium || SodiumPlus.auto();\n\t}\n\n\tget publicKeyString(): string {\n\t\treturn this.publicKey.toString(this.stringFormatKey);\n\t}\n\n\tpublicKeyFromString(text: string): X25519PublicKey {\n\t\treturn new X25519PublicKey(Buffer.from(text, this.stringFormatKey));\n\t}\n\n\tasync encryptToBuffer(plaintext: string | Buffer): Promise<Buffer> {\n\t\tconst sodium = await this.sodium();\n\t\tconst nonce = await sodium.randombytes_buf(24);\n\n\t\tconst ciphertext = await sodium.crypto_secretbox(Buffer.from(plaintext).toString(this.stringFormatRawData), nonce, this.encryptKey);\n\n\t\treturn Buffer.concat([nonce, ciphertext]);\n\t}\n\n\tasync encrypt(plaintext: string | Buffer): Promise<string> {\n\t\tconst buffer = await this.encryptToBuffer(plaintext);\n\t\treturn buffer.toString(this.stringFormatEncryptedData);\n\t}\n\n\tasync decryptToBuffer(data: string | Buffer): Promise<Buffer> {\n\t\tconst sodium = await this.sodium();\n\t\tconst buffer = Buffer.from(Buffer.isBuffer(data) ? data.toString() : data, this.stringFormatEncryptedData);\n\n\t\tconst decrypted = await sodium.crypto_secretbox_open(buffer.slice(24), buffer.slice(0, 24), this.decryptKey);\n\n\t\treturn Buffer.from(decrypted.toString(), this.stringFormatRawData);\n\t}\n\n\tasync decrypt(data: string | Buffer): Promise<string> {\n\t\tconst buffer = await this.decryptToBuffer(data);\n\t\treturn buffer.toString();\n\t}\n}\n"]}