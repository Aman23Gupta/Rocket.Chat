{"version":3,"sources":["meteor://ðŸ’»app/app/webdav/client/webdavFilePicker.js"],"names":["_regeneratorRuntime","module","link","default","v","Meteor","Template","_","Session","Handlebars","ReactiveVar","ReactiveDict","timeAgo","modal","t","fileUploadHandler","call","dispatchToastMessage","sortTable","data","sortBy","sortDirection","sort","a","b","basename","localeCompare","size","Date","lastmod","showFilePreviews","accountId","nodes","Array","isArray","length","promises","map","node","index","type","filename","then","res","blob","Blob","imgURL","URL","createObjectURL","preview","catch","e","filter","Boolean","Promise","all","showWebdavFileList","instance","directory","state","get","isLoading","set","webdavNodes","err","console","log","response","success","close","unfilteredWebdavNodes","$","val","searchText","nodesWithPreviews","webdavFilePicker","helpers","iconType","icon","extension","split","pop","mime","match","includes","filePreview","listMode","isListMode","key","getSortBy","getName","maxwidth","slice","getSize","bytes","k","sizes","i","Math","floor","parseFloat","pow","toFixed","getDate","sortIcon","onTableSort","parentFolders","currentFolder","s","webdavCurrentFolder","events","newSortBy","focus","preventDefault","stopPropagation","debounce","currentTarget","value","delay","target","parentFolder","substr","lastIndexOf","event","targetFolder","roomId","file","error","message","lastModified","name","text","_escape","open","title","showCancelButton","closeOnConfirm","closeOnCancel","confirmButtonText","cancelButtonText","html","onRendered","isConfirm","record","document","getElementById","rid","description","upload","uploading","push","id","getFileName","percentage","onProgress","progress","item","findWhere","round","start","storage","isObject","setTimeout","without","autorun","loading","input","regex","RegExp","onCreated"],"mappings":"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","file":"dynamic/app/webdav/client/webdavFilePicker.js","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Template } from 'meteor/templating';\nimport _ from 'underscore';\nimport { Session } from 'meteor/session';\nimport { Handlebars } from 'meteor/ui';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { ReactiveDict } from 'meteor/reactive-dict';\n\nimport { timeAgo } from '../../ui/client/views/app/helpers';\nimport { modal } from '../../ui-utils/client';\nimport { t } from '../../utils/client';\nimport { fileUploadHandler } from '../../file-upload/client';\nimport { call } from '../../../client/lib/utils/call';\nimport { dispatchToastMessage } from '../../../client/lib/toast';\n\nfunction sortTable(data, sortBy, sortDirection) {\n\tif (sortDirection === 'desc') {\n\t\tif (sortBy === 'name') {\n\t\t\tdata.sort((a, b) => b.basename.localeCompare(a.basename));\n\t\t}\n\t\tif (sortBy === 'size') {\n\t\t\tdata.sort((a, b) => b.size - a.size);\n\t\t}\n\t\tif (sortBy === 'date') {\n\t\t\tdata.sort((a, b) => new Date(b.lastmod) - new Date(a.lastmod));\n\t\t}\n\t} else {\n\t\tif (sortBy === 'name') {\n\t\t\tdata.sort((a, b) => a.basename.localeCompare(b.basename));\n\t\t}\n\t\tif (sortBy === 'size') {\n\t\t\tdata.sort((a, b) => a.size - b.size);\n\t\t}\n\t\tif (sortBy === 'date') {\n\t\t\tdata.sort((a, b) => new Date(a.lastmod) - new Date(b.lastmod));\n\t\t}\n\t}\n\treturn data;\n}\n\nasync function showFilePreviews(accountId, nodes) {\n\tif (!Array.isArray(nodes) || !nodes.length) {\n\t\treturn;\n\t}\n\tconst promises = nodes\n\t\t.map((node, index) => {\n\t\t\tif (node.type !== 'file') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn call('getWebdavFilePreview', accountId, node.filename)\n\t\t\t\t.then((res) => {\n\t\t\t\t\tconst blob = new Blob([res.data], { type: 'image/png' });\n\t\t\t\t\tconst imgURL = URL.createObjectURL(blob);\n\t\t\t\t\tnodes[index].preview = imgURL;\n\t\t\t\t})\n\t\t\t\t.catch((e) => e);\n\t\t})\n\t\t.filter(Boolean);\n\n\treturn Promise.all(promises)\n\t\t.then(() => nodes)\n\t\t.catch((e) => e);\n}\n\nasync function showWebdavFileList() {\n\tconst instance = Template.instance();\n\tconst { accountId } = instance.data;\n\n\tconst directory = instance.state.get('webdavCurrentFolder');\n\tlet unfilteredWebdavNodes;\n\tinstance.isLoading.set(true);\n\tinstance.state.set({\n\t\twebdavNodes: [],\n\t});\n\ttry {\n\t\tconst response = await call('getWebdavFileList', accountId, directory).catch((err) => console.log(err));\n\t\tif (!response || !response.success) {\n\t\t\tinstance.isLoading.set(false);\n\t\t\tmodal.close();\n\t\t\treturn;\n\t\t}\n\t\tunfilteredWebdavNodes = response.data;\n\t\tinstance.state.set({ unfilteredWebdavNodes });\n\t\t$('.js-webdav-search-input').val('');\n\t\tinstance.searchText.set('');\n\t} finally {\n\t\tinstance.isLoading.set(false);\n\t\tconst nodesWithPreviews = await showFilePreviews(accountId, unfilteredWebdavNodes);\n\t\tif (Array.isArray(nodesWithPreviews) && nodesWithPreviews.length) {\n\t\t\tinstance.state.set({ unfilteredWebdavNodes: nodesWithPreviews });\n\t\t}\n\t}\n}\n\nTemplate.webdavFilePicker.helpers({\n\ticonType() {\n\t\t// add icon for different types\n\t\tlet icon = 'clip';\n\t\tlet type = '';\n\n\t\tlet extension = this.basename.split('.').pop();\n\t\tif (extension === this.basename) {\n\t\t\textension = '';\n\t\t}\n\n\t\tif (this.type === 'directory') {\n\t\t\ticon = 'folder';\n\t\t\ttype = 'directory';\n\t\t} else if (this.mime.match(/application\\/pdf/)) {\n\t\t\ticon = 'file-pdf';\n\t\t\ttype = 'pdf';\n\t\t} else if (['application/vnd.oasis.opendocument.text', 'application/vnd.oasis.opendocument.presentation'].includes(this.mime)) {\n\t\t\ticon = 'file-document';\n\t\t\ttype = 'document';\n\t\t} else if (\n\t\t\t[\n\t\t\t\t'application/vnd.ms-excel',\n\t\t\t\t'application/vnd.oasis.opendocument.spreadsheet',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n\t\t\t].includes(this.mime)\n\t\t) {\n\t\t\ticon = 'file-sheets';\n\t\t\ttype = 'sheets';\n\t\t} else if (['application/vnd.ms-powerpoint', 'application/vnd.oasis.opendocument.presentation'].includes(this.mime)) {\n\t\t\ticon = 'file-sheets';\n\t\t\ttype = 'ppt';\n\t\t}\n\t\treturn { icon, type, extension };\n\t},\n\tfilePreview() {\n\t\treturn this.preview;\n\t},\n\tisLoading() {\n\t\treturn Template.instance().isLoading.get();\n\t},\n\tlistMode() {\n\t\treturn Template.instance().isListMode.get();\n\t},\n\tsortBy(key) {\n\t\treturn Template.instance().sortBy.get() === key;\n\t},\n\tgetSortBy() {\n\t\treturn Template.instance().sortBy.get();\n\t},\n\tgetName(basename) {\n\t\tconst maxwidth = Template.instance().isListMode.get() ? 35 : 20;\n\t\tif (basename.length < maxwidth) {\n\t\t\treturn basename;\n\t\t}\n\t\treturn `${basename.slice(0, maxwidth - 10)}\\u2026${basename.slice(-7)}`;\n\t},\n\tgetSize() {\n\t\tif (this.type === 'directory') {\n\t\t\treturn '';\n\t\t}\n\t\tconst bytes = this.size;\n\t\tif (bytes === 0) {\n\t\t\treturn '0 B';\n\t\t}\n\t\tconst k = 1024;\n\t\tconst sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n\t\tconst i = Math.floor(Math.log(bytes) / Math.log(k));\n\t\treturn `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;\n\t},\n\tgetDate() {\n\t\treturn timeAgo(new Date(this.lastmod), t);\n\t},\n\tsortIcon(key) {\n\t\tconst { sortDirection, sortBy } = Template.instance();\n\t\treturn key === sortBy.get() && sortDirection.get() === 'asc' ? 'sort-up' : 'sort-down';\n\t},\n\tonTableSort() {\n\t\tconst { sortDirection, sortBy } = Template.instance();\n\t\treturn function (type) {\n\t\t\tif (sortBy.get() === type) {\n\t\t\t\tsortDirection.set(sortDirection.get() === 'asc' ? 'desc' : 'asc');\n\t\t\t} else {\n\t\t\t\tsortBy.set(type);\n\t\t\t\tsortDirection.set('asc');\n\t\t\t}\n\t\t};\n\t},\n\tparentFolders() {\n\t\tconst currentFolder = Template.instance().state.get('webdavCurrentFolder');\n\t\treturn currentFolder ? currentFolder.split('/').filter((s) => s) : [];\n\t},\n\twebdavNodes() {\n\t\treturn Template.instance().state.get('webdavNodes');\n\t},\n\twebdavCurrentFolder() {\n\t\treturn Template.instance().state.get('webdavCurrentFolder');\n\t},\n});\n\nTemplate.webdavFilePicker.events({\n\t'click .js-list-grid-mode'() {\n\t\tconst instance = Template.instance();\n\t\tinstance.isListMode.set(!instance.isListMode.get());\n\t},\n\t'click .js-webdav-sort-direction'() {\n\t\tconst { sortDirection } = Template.instance();\n\t\tsortDirection.set(sortDirection.get() === 'asc' ? 'desc' : 'asc');\n\t},\n\t'change .js-webdav-select-sort'() {\n\t\tconst { sortBy } = Template.instance();\n\t\tconst newSortBy = $('.js-webdav-select-sort').val();\n\t\tsortBy.set(newSortBy);\n\t},\n\t'click .js-webdav-search-icon'() {\n\t\t$('.js-webdav-search-input').focus();\n\t},\n\t'submit .js-search-form'(e) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t},\n\t'input .js-webdav-search-input': _.debounce((e, t) => {\n\t\tt.searchText.set(e.currentTarget.value);\n\t}, 200),\n\t'blur .js-webdav-search-input'(e, t) {\n\t\t_.delay(() => {\n\t\t\te.target.value = '';\n\t\t\tt.searchText.set('');\n\t\t}, 200);\n\t},\n\tasync 'click .js-webdav-grid-back-icon'() {\n\t\tconst instance = Template.instance();\n\n\t\tlet currentFolder = instance.state.get('webdavCurrentFolder');\n\t\t// determine parent directory to go back\n\t\tlet parentFolder = '/';\n\t\tif (currentFolder && currentFolder !== '/') {\n\t\t\tif (currentFolder[currentFolder.length - 1] === '/') {\n\t\t\t\tcurrentFolder = currentFolder.slice(0, -1);\n\t\t\t}\n\t\t\tparentFolder = currentFolder.substr(0, currentFolder.lastIndexOf('/') + 1);\n\t\t}\n\t\tinstance.state.set('webdavCurrentFolder', parentFolder);\n\t},\n\tasync 'click .js-webdav_directory'() {\n\t\tconst instance = Template.instance();\n\t\tinstance.state.set('webdavCurrentFolder', this.filename);\n\t},\n\tasync 'click .js-webdav-breadcrumb-folder'(event) {\n\t\tconst instance = Template.instance();\n\t\tconst index = $(event.target).data('index');\n\t\tconst currentFolder = instance.state.get('webdavCurrentFolder');\n\t\tconst parentFolders = currentFolder.split('/').filter((s) => s);\n\t\t// determine parent directory to go to\n\t\tlet targetFolder = '/';\n\t\tfor (let i = 0; i <= index; i++) {\n\t\t\ttargetFolder += parentFolders[i];\n\t\t\ttargetFolder += '/';\n\t\t}\n\t\tinstance.state.set('webdavCurrentFolder', targetFolder);\n\t},\n\tasync 'click .js-webdav_file'() {\n\t\tconst roomId = Session.get('openedRoom');\n\t\tconst instance = Template.instance();\n\t\tconst { accountId } = instance.data;\n\t\tinstance.isLoading.set(true);\n\t\tconst file = this;\n\t\tconst response = await call('getFileFromWebdav', accountId, file).catch((error) => {\n\t\t\tconsole.log(error);\n\t\t});\n\t\tinstance.isLoading.set(false);\n\t\tif (!response || !response.success) {\n\t\t\tmodal.close();\n\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Failed_to_get_webdav_file') });\n\t\t}\n\t\tconst blob = new Blob([response.data], { type: response.type });\n\t\t// converting to file object\n\t\tblob.lastModified = file.lastmod;\n\t\tblob.name = file.basename;\n\t\tconst text = `\n\t\t\t<div class='upload-preview-title'>\n\t\t\t\t<div class=\"rc-input__wrapper\">\n\t\t\t\t\t<input class=\"rc-input__element\" id='file-name' style='display: inherit;' value='${Handlebars._escape(blob.name)}' placeholder='${t(\n\t\t\t'Upload_file_name',\n\t\t)}'>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"rc-input__wrapper\">\n\t\t\t\t\t<input class=\"rc-input__element\" id='file-description' style='display: inherit;' value='' placeholder='${t('Upload_file_description')}'>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\treturn modal.open(\n\t\t\t{\n\t\t\t\ttitle: t('Upload_file_question'),\n\t\t\t\ttext,\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tcloseOnConfirm: false,\n\t\t\t\tcloseOnCancel: false,\n\t\t\t\tconfirmButtonText: t('Send'),\n\t\t\t\tcancelButtonText: t('Cancel'),\n\t\t\t\thtml: true,\n\t\t\t\tonRendered: () => $('#file-name').focus(),\n\t\t\t},\n\t\t\tfunction (isConfirm) {\n\t\t\t\tconst record = {\n\t\t\t\t\tname: document.getElementById('file-name').value || blob.name,\n\t\t\t\t\tsize: blob.size,\n\t\t\t\t\ttype: blob.type,\n\t\t\t\t\trid: roomId,\n\t\t\t\t\tdescription: document.getElementById('file-description').value,\n\t\t\t\t};\n\t\t\t\tmodal.close();\n\n\t\t\t\tif (!isConfirm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst upload = fileUploadHandler('Uploads', record, blob);\n\n\t\t\t\tlet uploading = Session.get('uploading') || [];\n\t\t\t\tuploading.push({\n\t\t\t\t\tid: upload.id,\n\t\t\t\t\tname: upload.getFileName(),\n\t\t\t\t\tpercentage: 0,\n\t\t\t\t});\n\n\t\t\t\tSession.set('uploading', uploading);\n\n\t\t\t\tupload.onProgress = function (progress) {\n\t\t\t\t\tuploading = Session.get('uploading');\n\n\t\t\t\t\tconst item = _.findWhere(uploading, { id: upload.id });\n\t\t\t\t\tif (item != null) {\n\t\t\t\t\t\titem.percentage = Math.round(progress * 100) || 0;\n\t\t\t\t\t\treturn Session.set('uploading', uploading);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tupload.start(function (error, file, storage) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tlet uploading = Session.get('uploading');\n\t\t\t\t\t\tif (!Array.isArray(uploading)) {\n\t\t\t\t\t\t\tuploading = [];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst item = _.findWhere(uploading, { id: upload.id });\n\n\t\t\t\t\t\tif (_.isObject(item)) {\n\t\t\t\t\t\t\titem.error = error.message;\n\t\t\t\t\t\t\titem.percentage = 0;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuploading.push({\n\t\t\t\t\t\t\t\terror: error.error,\n\t\t\t\t\t\t\t\tpercentage: 0,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn Session.set('uploading', uploading);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (file) {\n\t\t\t\t\t\tMeteor.call('sendFileMessage', roomId, storage, file, () => {\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tconst uploading = Session.get('uploading');\n\t\t\t\t\t\t\t\tif (uploading !== null) {\n\t\t\t\t\t\t\t\t\tconst item = _.findWhere(uploading, {\n\t\t\t\t\t\t\t\t\t\tid: upload.id,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\treturn Session.set('uploading', _.without(uploading, item));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, 2000);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\t},\n});\n\nTemplate.webdavFilePicker.onRendered(async function () {\n\tthis.autorun(() => {\n\t\tshowWebdavFileList();\n\t});\n\n\tthis.autorun(() => {\n\t\tconst { sortDirection, sortBy } = Template.instance();\n\t\tconst data = sortTable(this.state.get('webdavNodes'), sortBy.get(), sortDirection.get());\n\t\tthis.state.set('webdavNodes', data);\n\t});\n\n\tthis.autorun(() => {\n\t\tconst loading = this.isLoading.get();\n\t\tif (loading) {\n\t\t\treturn;\n\t\t}\n\t\tconst input = this.searchText.get();\n\t\tconst regex = new RegExp(`\\\\b${input}`, 'i');\n\t\tconst data = this.state.get('unfilteredWebdavNodes').filter(({ basename }) => basename.match(regex));\n\t\tthis.state.set('webdavNodes', data);\n\t});\n});\n\nTemplate.webdavFilePicker.onCreated(function () {\n\tthis.state = new ReactiveDict({\n\t\twebdavCurrentFolder: '/',\n\t\twebdavNodes: [],\n\t\tunfilteredWebdavNodes: [],\n\t});\n\tthis.isLoading = new ReactiveVar(true);\n\tthis.isListMode = new ReactiveVar(true);\n\tthis.sortBy = new ReactiveVar('name');\n\tthis.sortDirection = new ReactiveVar('asc');\n\tthis.searchText = new ReactiveVar('');\n});\n"]}