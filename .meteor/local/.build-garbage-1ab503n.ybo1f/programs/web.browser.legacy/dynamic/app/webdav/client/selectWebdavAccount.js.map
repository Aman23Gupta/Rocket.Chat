{"version":3,"sources":["meteor://ðŸ’»app/app/webdav/client/selectWebdavAccount.js"],"names":["Meteor","module","link","v","Template","modal","t","WebdavAccounts","dispatchToastMessage","selectWebdavAccount","helpers","webdavAccounts","find","fetch","usernamePlusServer","account","name","username","server_url","replace","events","close","accountId","_id","url","instance","data","attachment","title","fileRequest","XMLHttpRequest","open","responseType","onload","arrayBuffer","response","fileData","Uint8Array","call","error","type","message","success","send"],"mappings":"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","file":"dynamic/app/webdav/client/selectWebdavAccount.js","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Template } from 'meteor/templating';\n\nimport { modal } from '../../ui-utils';\nimport { t } from '../../utils';\nimport { WebdavAccounts } from '../../models/client';\nimport { dispatchToastMessage } from '../../../client/lib/toast';\n\nTemplate.selectWebdavAccount.helpers({\n\twebdavAccounts() {\n\t\treturn WebdavAccounts.find().fetch();\n\t},\n\tusernamePlusServer(account) {\n\t\treturn account.name || `${account.username}@${account.server_url.replace(/^https?\\:\\/\\//i, '')}`;\n\t},\n});\nTemplate.selectWebdavAccount.events({\n\t'click .webdav-account'() {\n\t\tmodal.close();\n\t\tconst accountId = this._id;\n\t\tconst { url } = Template.instance().data;\n\t\tconst name = Template.instance().data.attachment.title;\n\n\t\tconst fileRequest = new XMLHttpRequest();\n\t\tfileRequest.open('GET', url, true);\n\t\tfileRequest.responseType = 'arraybuffer';\n\t\tfileRequest.onload = function () {\n\t\t\tconst arrayBuffer = fileRequest.response;\n\t\t\tif (arrayBuffer) {\n\t\t\t\tconst fileData = new Uint8Array(arrayBuffer);\n\t\t\t\tMeteor.call('uploadFileToWebdav', accountId, fileData, name, (error, response) => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\treturn dispatchToastMessage({ type: 'error', message: t(error.error) });\n\t\t\t\t\t}\n\t\t\t\t\tif (!response.success) {\n\t\t\t\t\t\treturn dispatchToastMessage({ type: 'error', message: t(response.message) });\n\t\t\t\t\t}\n\t\t\t\t\treturn dispatchToastMessage({ type: 'success', message: t('File_uploaded') });\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tfileRequest.send(null);\n\t},\n});\n"]}