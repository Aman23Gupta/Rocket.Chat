{"version":3,"sources":["meteor://ðŸ’»app/app/livechat/client/views/app/tabbar/visitorInfo.js"],"names":["_regeneratorRuntime","module","link","default","v","TAPi18n","Meteor","ReactiveVar","FlowRouter","Session","Template","_","moment","UAParser","modal","Subscriptions","settings","t","roomTypes","hasRole","hasPermission","hasAtLeastOnePermission","APIClient","RoomManager","getCustomFormTemplate","Markdown","handleError","formatDateAndTime","isSubscribedToRoom","data","currentData","rid","subscription","findOne","undefined","closingDialogRequired","department","get","requestTagBeforeClosingChat","visitorInfo","helpers","user","instance","userAgent","ua","setUA","os","getOS","name","version","indexOf","osIcon","toLowerCase","browser","getBrowser","browserIcon","status","getUserStatus","room","joinTags","tags","join","customRoomFields","customFields","length","fields","livechatData","Object","keys","forEach","key","field","findWhere","_id","visibility","scope","push","label","value","customVisitorFields","createdAt","format","lastLogin","editing","action","forwarding","sendingTranscript","roomInfoData","visitorId","roomId","save","set","cancel","roomOpen","uid","userId","open","servedBy","canReturnQueue","config","routingConfig","returnQueue","showDetail","canSeeButtons","canEditRoom","canCloseRoom","canForwardGuest","canSendTranscript","email","canPlaceChatOnHold","onHold","lastMessage","token","roomClosedDateTime","closedAt","roomClosedBy","closedBy","closer","username","closerLabel","charAt","toUpperCase","slice","customInfoTemplate","roomDataContext","transcriptRequest","transcriptRequestedDateTime","requestedAt","markdown","text","parse","events","event","preventDefault","comment","__","call","clientAction","error","title","type","timer","showConfirmButton","modifier","content","confirmOnEnter","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","go","v1","post","success","onCreated","departmentId","updateVisitor","visitor","updateRoom","err","loadRoomData","roomStream","on","autorun","onDestroyed","removeListener"],"mappings":"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","file":"dynamic/app/livechat/client/views/app/tabbar/visitorInfo.js","sourcesContent":["import { TAPi18n } from 'meteor/rocketchat:tap-i18n';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\nimport { Session } from 'meteor/session';\nimport { Template } from 'meteor/templating';\nimport _ from 'underscore';\nimport moment from 'moment';\nimport UAParser from 'ua-parser-js';\n\nimport { modal } from '../../../../../ui-utils';\nimport { Subscriptions } from '../../../../../models';\nimport { settings } from '../../../../../settings';\nimport { t, roomTypes } from '../../../../../utils';\nimport { hasRole, hasPermission, hasAtLeastOnePermission } from '../../../../../authorization';\nimport './visitorInfo.html';\nimport { APIClient } from '../../../../../utils/client';\nimport { RoomManager } from '../../../../../ui-utils/client';\nimport { getCustomFormTemplate } from '../customTemplates/register';\nimport { Markdown } from '../../../../../markdown/client';\nimport { handleError } from '../../../../../../client/lib/utils/handleError';\nimport { formatDateAndTime } from '../../../../../../client/lib/utils/formatDateAndTime';\n\nconst isSubscribedToRoom = () => {\n\tconst data = Template.currentData();\n\tif (!data || !data.rid) {\n\t\treturn false;\n\t}\n\n\tconst subscription = Subscriptions.findOne({ rid: data.rid });\n\treturn subscription !== undefined;\n};\n\nconst closingDialogRequired = (department) => {\n\tif (settings.get('Livechat_request_comment_when_closing_conversation')) {\n\t\treturn true;\n\t}\n\n\treturn department && department.requestTagBeforeClosingChat;\n};\n\nTemplate.visitorInfo.helpers({\n\tuser() {\n\t\tconst user = Template.instance().user.get();\n\t\tif (user && user.userAgent) {\n\t\t\tconst ua = new UAParser();\n\t\t\tua.setUA(user.userAgent);\n\n\t\t\tuser.os = `${ua.getOS().name} ${ua.getOS().version}`;\n\t\t\tif (['Mac OS', 'iOS'].indexOf(ua.getOS().name) !== -1) {\n\t\t\t\tuser.osIcon = 'icon-apple';\n\t\t\t} else {\n\t\t\t\tuser.osIcon = `icon-${ua.getOS().name.toLowerCase()}`;\n\t\t\t}\n\t\t\tuser.browser = `${ua.getBrowser().name} ${ua.getBrowser().version}`;\n\t\t\tuser.browserIcon = `icon-${ua.getBrowser().name.toLowerCase()}`;\n\n\t\t\tuser.status = roomTypes.getUserStatus('l', this.rid) || 'offline';\n\t\t}\n\t\treturn user;\n\t},\n\n\troom() {\n\t\treturn Template.instance().room.get();\n\t},\n\n\tdepartment() {\n\t\treturn Template.instance().department.get();\n\t},\n\n\tjoinTags() {\n\t\tconst tags = Template.instance().tags.get();\n\t\treturn tags && tags.join(', ');\n\t},\n\n\tcustomRoomFields() {\n\t\tconst customFields = Template.instance().customFields.get();\n\t\tif (!customFields || customFields.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst fields = [];\n\t\tconst room = Template.instance().room.get();\n\t\tconst { livechatData = {} } = room || {};\n\n\t\tObject.keys(livechatData).forEach((key) => {\n\t\t\tconst field = _.findWhere(customFields, { _id: key });\n\t\t\tif (field && field.visibility !== 'hidden' && field.scope === 'room') {\n\t\t\t\tfields.push({ label: field.label, value: livechatData[key] });\n\t\t\t}\n\t\t});\n\n\t\treturn fields;\n\t},\n\n\tcustomVisitorFields() {\n\t\tconst customFields = Template.instance().customFields.get();\n\t\tif (!hasAtLeastOnePermission(['view-livechat-room-customfields', 'edit-livechat-room-customfields'])) {\n\t\t\treturn;\n\t\t}\n\t\tif (!customFields || customFields.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst fields = [];\n\t\tconst user = Template.instance().user.get();\n\t\tconst { livechatData = {} } = user || {};\n\n\t\tObject.keys(livechatData).forEach((key) => {\n\t\t\tconst field = _.findWhere(customFields, { _id: key });\n\t\t\tif (field && field.visibility !== 'hidden' && field.scope === 'visitor') {\n\t\t\t\tfields.push({ label: field.label, value: livechatData[key] });\n\t\t\t}\n\t\t});\n\n\t\treturn fields;\n\t},\n\n\tcreatedAt() {\n\t\tif (!this.createdAt) {\n\t\t\treturn '';\n\t\t}\n\t\treturn moment(this.createdAt).format('L LTS');\n\t},\n\n\tlastLogin() {\n\t\tif (!this.lastLogin) {\n\t\t\treturn '';\n\t\t}\n\t\treturn moment(this.lastLogin).format('L LTS');\n\t},\n\n\tediting() {\n\t\treturn Template.instance().action.get() === 'edit';\n\t},\n\n\tforwarding() {\n\t\treturn Template.instance().action.get() === 'forward';\n\t},\n\n\tsendingTranscript() {\n\t\treturn Template.instance().action.get() === 'transcript';\n\t},\n\n\troomInfoData() {\n\t\tconst instance = Template.instance();\n\t\tconst user = instance.user.get();\n\t\treturn {\n\t\t\tvisitorId: user ? user._id : null,\n\t\t\troomId: this.rid,\n\t\t\tsave() {\n\t\t\t\tinstance.action.set();\n\t\t\t},\n\t\t\tcancel() {\n\t\t\t\tinstance.action.set();\n\t\t\t},\n\t\t};\n\t},\n\n\troomOpen() {\n\t\tconst room = Template.instance().room.get();\n\t\tconst uid = Meteor.userId();\n\t\treturn room && room.open && ((room.servedBy && room.servedBy._id === uid) || hasRole(uid, 'livechat-manager'));\n\t},\n\n\tcanReturnQueue() {\n\t\tconst config = Template.instance().routingConfig.get();\n\t\treturn config.returnQueue;\n\t},\n\n\tshowDetail() {\n\t\tif (Template.instance().action.get()) {\n\t\t\treturn 'hidden';\n\t\t}\n\t},\n\n\tcanSeeButtons() {\n\t\tif (hasAtLeastOnePermission(['close-others-livechat-room', 'transfer-livechat-guest'])) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isSubscribedToRoom();\n\t},\n\n\tcanEditRoom() {\n\t\tif (hasPermission('save-others-livechat-room-info')) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isSubscribedToRoom();\n\t},\n\n\tcanCloseRoom() {\n\t\tif (hasPermission('close-others-livechat-room')) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isSubscribedToRoom();\n\t},\n\n\tcanForwardGuest() {\n\t\treturn hasPermission('transfer-livechat-guest');\n\t},\n\n\tcanSendTranscript() {\n\t\tconst room = Template.instance().room.get();\n\t\treturn !room.email && hasPermission('send-omnichannel-chat-transcript');\n\t},\n\n\tcanPlaceChatOnHold() {\n\t\tconst room = Template.instance().room.get();\n\t\treturn (\n\t\t\troom.open &&\n\t\t\t!room.onHold &&\n\t\t\troom.servedBy &&\n\t\t\troom.lastMessage &&\n\t\t\t!room.lastMessage?.token &&\n\t\t\tsettings.get('Livechat_allow_manual_on_hold')\n\t\t);\n\t},\n\n\troomClosedDateTime() {\n\t\tconst { closedAt } = this;\n\t\treturn formatDateAndTime(closedAt);\n\t},\n\n\troomClosedBy() {\n\t\tconst { closedBy = {}, servedBy = {} } = this;\n\t\tlet { closer } = this;\n\n\t\tif (closer === 'user') {\n\t\t\tif (servedBy._id !== closedBy._id) {\n\t\t\t\treturn closedBy.username;\n\t\t\t}\n\n\t\t\tcloser = 'agent';\n\t\t}\n\n\t\tconst closerLabel = closer.charAt(0).toUpperCase() + closer.slice(1);\n\t\treturn t(`${closerLabel}`);\n\t},\n\n\tcustomInfoTemplate() {\n\t\treturn getCustomFormTemplate('livechatVisitorInfo');\n\t},\n\n\troomDataContext() {\n\t\t// To make the dynamic template reactive we need to pass a ReactiveVar through the data property\n\t\t// because only the dynamic template data will be reloaded\n\t\treturn Template.instance().room;\n\t},\n\n\ttranscriptRequest() {\n\t\tconst room = Template.instance().room.get();\n\t\treturn room?.transcriptRequest;\n\t},\n\n\ttranscriptRequestedDateTime() {\n\t\tconst { requestedAt } = this;\n\t\treturn formatDateAndTime(requestedAt);\n\t},\n\n\tmarkdown(text) {\n\t\treturn Markdown.parse(text);\n\t},\n});\n\nTemplate.visitorInfo.events({\n\t'click .edit-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('edit');\n\t},\n\t'click .close-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tif (!closingDialogRequired(instance.department.get())) {\n\t\t\tconst comment = TAPi18n.__('Chat_closed_by_agent');\n\t\t\treturn Meteor.call('livechat:closeRoom', this.rid, comment, { clientAction: true }, function (error /* , result*/) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\n\t\t\t\tmodal.open({\n\t\t\t\t\ttitle: t('Chat_closed'),\n\t\t\t\t\ttext: t('Chat_closed_successfully'),\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimer: 1000,\n\t\t\t\t\tshowConfirmButton: false,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tmodal.open({\n\t\t\ttitle: t('Closing_chat'),\n\t\t\tmodifier: 'modal',\n\t\t\tcontent: 'closeRoom',\n\t\t\tdata: {\n\t\t\t\trid: this.rid,\n\t\t\t},\n\t\t\tconfirmOnEnter: false,\n\t\t\tshowConfirmButton: false,\n\t\t\tshowCancelButton: false,\n\t\t});\n\t},\n\n\t'click .return-inquiry'(event) {\n\t\tevent.preventDefault();\n\n\t\tmodal.open(\n\t\t\t{\n\t\t\t\ttitle: t('Would_you_like_to_return_the_inquiry'),\n\t\t\t\ttype: 'warning',\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tconfirmButtonColor: '#3085d6',\n\t\t\t\tcancelButtonColor: '#d33',\n\t\t\t\tconfirmButtonText: t('Yes'),\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tMeteor.call('livechat:returnAsInquiry', this.rid, function (error /* , result*/) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\thandleError(error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tSession.set('openedRoom');\n\t\t\t\t\t\tFlowRouter.go('/home');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\t},\n\n\t'click .forward-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('forward');\n\t},\n\n\t'click .send-transcript'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('transcript');\n\t},\n\n\t'click .on-hold'(event) {\n\t\tevent.preventDefault();\n\n\t\tmodal.open(\n\t\t\t{\n\t\t\t\ttitle: t('Would_you_like_to_place_chat_on_hold'),\n\t\t\t\ttype: 'warning',\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tconfirmButtonColor: '#3085d6',\n\t\t\t\tcancelButtonColor: '#d33',\n\t\t\t\tconfirmButtonText: t('Yes'),\n\t\t\t},\n\t\t\tasync () => {\n\t\t\t\tconst { success } = await APIClient.v1.post('livechat/room.onHold', { roomId: this.rid });\n\t\t\t\tif (success) {\n\t\t\t\t\tmodal.open({\n\t\t\t\t\t\ttitle: t('Chat_On_Hold'),\n\t\t\t\t\t\ttext: t('Chat_On_Hold_Successfully'),\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\ttimer: 1500,\n\t\t\t\t\t\tshowConfirmButton: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t},\n});\n\nTemplate.visitorInfo.onCreated(function () {\n\tthis.visitorId = new ReactiveVar(null);\n\tthis.customFields = new ReactiveVar([]);\n\tthis.action = new ReactiveVar();\n\tthis.user = new ReactiveVar();\n\tthis.departmentId = new ReactiveVar(null);\n\tthis.tags = new ReactiveVar(null);\n\tthis.routingConfig = new ReactiveVar({});\n\tthis.department = new ReactiveVar({});\n\tthis.room = new ReactiveVar({});\n\n\tthis.updateVisitor = async (visitorId) => {\n\t\tconst { visitor } = await APIClient.v1.get(`livechat/visitors.info?visitorId=${visitorId}`);\n\t\tthis.user.set(visitor);\n\t};\n\n\tthis.updateRoom = (room) => {\n\t\tthis.departmentId.set(room && room.departmentId);\n\t\tthis.tags.set(room && room.tags);\n\t\tthis.room.set(room);\n\t\tconst visitorId = room && room.v && room.v._id;\n\t\tthis.visitorId.set(visitorId);\n\t\tthis.updateVisitor(visitorId);\n\t};\n\n\tMeteor.call('livechat:getCustomFields', (err, customFields) => {\n\t\tif (customFields) {\n\t\t\tthis.customFields.set(customFields);\n\t\t}\n\t});\n\n\tconst { rid } = Template.currentData();\n\tMeteor.call('livechat:getRoutingConfig', (err, config) => {\n\t\tif (config) {\n\t\t\tthis.routingConfig.set(config);\n\t\t}\n\t});\n\n\tconst loadRoomData = async (rid) => {\n\t\tconst { room } = await APIClient.v1.get(`rooms.info?roomId=${rid}`);\n\t\tthis.updateRoom(room);\n\t};\n\n\tif (rid) {\n\t\tRoomManager.roomStream.on(rid, this.updateRoom);\n\t\tloadRoomData(rid);\n\t}\n\n\tthis.autorun(async () => {\n\t\tif (this.departmentId.get()) {\n\t\t\tconst { department } = await APIClient.v1.get(`livechat/department/${this.departmentId.get()}?includeAgents=false`);\n\t\t\tthis.department.set(department);\n\t\t}\n\t});\n\n\tthis.autorun(() => {\n\t\tconst visitorId = this.visitorId.get();\n\t\tif (visitorId) {\n\t\t\tthis.updateVisitor(visitorId);\n\t\t}\n\t});\n});\n\nTemplate.visitorInfo.onDestroyed(function () {\n\tconst { rid } = Template.currentData();\n\tRoomManager.roomStream.removeListener(rid, this.updateRoom);\n});\n"]}