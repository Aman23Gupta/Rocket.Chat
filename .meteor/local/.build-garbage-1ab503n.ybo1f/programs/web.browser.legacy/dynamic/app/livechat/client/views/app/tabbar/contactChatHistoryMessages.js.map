{"version":3,"sources":["meteor://ðŸ’»app/app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js"],"names":["_regeneratorRuntime","module","link","default","v","_objectSpread","Template","ReactiveVar","_","messageContext","APIClient","MESSAGES_LIMIT","contactChatHistoryMessages","helpers","messages","instance","get","result","call","rid","settings","showReplyButton","showreply","hideRoles","hasMore","isLoading","isSearching","searchTerm","length","empty","hasError","error","events","e","clear","throttle","target","scrollTop","scrollHeight","clientHeight","offset","set","limit","debounce","keyCode","preventDefault","value","onCreated","currentData","loadMessages","url","v1","total","concat","autorun"],"mappings":"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","file":"dynamic/app/livechat/client/views/app/tabbar/contactChatHistoryMessages.js","sourcesContent":["import { Template } from 'meteor/templating';\nimport './contactChatHistoryMessages.html';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport _ from 'underscore';\n\nimport { messageContext } from '../../../../../ui-utils/client/lib/messageContext';\nimport { APIClient } from '../../../../../utils/client';\n\nconst MESSAGES_LIMIT = 50;\n\nTemplate.contactChatHistoryMessages.helpers({\n\tmessages() {\n\t\treturn Template.instance().messages.get();\n\t},\n\tmessageContext() {\n\t\tconst result = messageContext.call(this, { rid: Template.instance().rid });\n\t\treturn {\n\t\t\t...result,\n\t\t\tsettings: {\n\t\t\t\t...result.settings,\n\t\t\t\tshowReplyButton: false,\n\t\t\t\tshowreply: false,\n\t\t\t\thideRoles: true,\n\t\t\t},\n\t\t};\n\t},\n\thasMore() {\n\t\treturn Template.instance().hasMore.get();\n\t},\n\tisLoading() {\n\t\treturn Template.instance().isLoading.get();\n\t},\n\tisSearching() {\n\t\treturn Template.instance().searchTerm.get().length > 0;\n\t},\n\tempty() {\n\t\treturn Template.instance().messages.get().length === 0;\n\t},\n\thasError() {\n\t\treturn Template.instance().hasError.get();\n\t},\n\terror() {\n\t\treturn Template.instance().error.get();\n\t},\n});\n\nTemplate.contactChatHistoryMessages.events({\n\t'click .js-back'(e, instance) {\n\t\treturn instance.clear();\n\t},\n\t'scroll .js-list': _.throttle(function (e, instance) {\n\t\tif (e.target.scrollTop >= e.target.scrollHeight - e.target.clientHeight && instance.hasMore.get()) {\n\t\t\tinstance.offset.set(instance.offset.get() + instance.limit.get());\n\t\t}\n\t}, 200),\n\t'keyup #message-search': _.debounce(function (e, instance) {\n\t\tif (e.keyCode === 13) {\n\t\t\treturn e.preventDefault();\n\t\t}\n\n\t\tconst { value } = e.target;\n\n\t\tif (e.keyCode === 40 || e.keyCode === 38) {\n\t\t\treturn e.preventDefault();\n\t\t}\n\n\t\tinstance.offset.set(0);\n\t\tinstance.searchTerm.set(value);\n\t}, 300),\n});\n\nTemplate.contactChatHistoryMessages.onCreated(function () {\n\tconst currentData = Template.currentData();\n\tthis.rid = currentData.rid;\n\tthis.messages = new ReactiveVar([]);\n\tthis.hasMore = new ReactiveVar(true);\n\tthis.offset = new ReactiveVar(0);\n\tthis.searchTerm = new ReactiveVar('');\n\tthis.isLoading = new ReactiveVar(true);\n\tthis.limit = new ReactiveVar(MESSAGES_LIMIT);\n\tthis.hasError = new ReactiveVar(false);\n\tthis.error = new ReactiveVar(null);\n\n\tthis.loadMessages = async (url) => {\n\t\tthis.isLoading.set(true);\n\t\tconst offset = this.offset.get();\n\n\t\ttry {\n\t\t\tconst { messages, total } = await APIClient.v1.get(url);\n\t\t\tthis.messages.set(offset === 0 ? messages : this.messages.get().concat(messages));\n\t\t\tthis.hasMore.set(total > this.messages.get().length);\n\t\t} catch (e) {\n\t\t\tthis.hasError.set(true);\n\t\t\tthis.error.set(e);\n\t\t} finally {\n\t\t\tthis.isLoading.set(false);\n\t\t}\n\t};\n\n\tthis.autorun(() => {\n\t\tconst limit = this.limit.get();\n\t\tconst offset = this.offset.get();\n\t\tconst searchTerm = this.searchTerm.get();\n\n\t\tif (searchTerm !== '') {\n\t\t\treturn this.loadMessages(`chat.search/?roomId=${this.rid}&searchText=${searchTerm}&count=${limit}&offset=${offset}&sort={\"ts\": 1}`);\n\t\t}\n\n\t\tthis.loadMessages(`livechat/${this.rid}/messages?count=${limit}&offset=${offset}&sort={\"ts\": 1}`);\n\t});\n\n\tthis.autorun(() => {\n\t\tif (currentData.clear != null) {\n\t\t\tthis.clear = currentData.clear;\n\t\t}\n\t});\n});\n"]}