{"version":3,"sources":["meteor://ðŸ’»app/client/lib/minimongo/bson.ts"],"names":[],"mappings":"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","file":"dynamic/client/lib/minimongo/bson.ts","sourcesContent":["import { BSONType } from './types';\n\nexport const getBSONType = <T>(v: T): BSONType => {\n\tif (typeof v === 'number') {\n\t\treturn BSONType.Double;\n\t}\n\n\tif (typeof v === 'string') {\n\t\treturn BSONType.String;\n\t}\n\n\tif (typeof v === 'boolean') {\n\t\treturn BSONType.Boolean;\n\t}\n\n\tif (Array.isArray(v)) {\n\t\treturn BSONType.Array;\n\t}\n\n\tif (v === null) {\n\t\treturn BSONType.Null;\n\t}\n\n\tif (v instanceof RegExp) {\n\t\treturn BSONType.Regex;\n\t}\n\n\tif (typeof v === 'function') {\n\t\treturn BSONType.JavaScript;\n\t}\n\n\tif (v instanceof Date) {\n\t\treturn BSONType.Date;\n\t}\n\n\tif (v instanceof Uint8Array) {\n\t\treturn BSONType.BinData;\n\t}\n\n\treturn BSONType.Object;\n};\n\nconst getBSONTypeOrder = (type: BSONType): number => {\n\tswitch (type) {\n\t\tcase BSONType.Null:\n\t\t\treturn 0;\n\n\t\tcase BSONType.Double:\n\t\tcase BSONType.Int:\n\t\tcase BSONType.Long:\n\t\t\treturn 1;\n\n\t\tcase BSONType.String:\n\t\tcase BSONType.Symbol:\n\t\t\treturn 2;\n\n\t\tcase BSONType.Object:\n\t\t\treturn 3;\n\n\t\tcase BSONType.Array:\n\t\t\treturn 4;\n\n\t\tcase BSONType.BinData:\n\t\t\treturn 5;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn 6;\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn 7;\n\n\t\tcase BSONType.Date:\n\t\tcase BSONType.Timestamp:\n\t\t\treturn 8;\n\n\t\tcase BSONType.Regex:\n\t\t\treturn 9;\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\treturn 100;\n\n\t\tdefault:\n\t\t\treturn -1;\n\t}\n};\n\ntype ObjectID = {\n\ttoHexString(): string;\n\tequals(otherID: ObjectID): boolean;\n};\n\nexport const compareBSONValues = (a: unknown, b: unknown): number => {\n\tif (a === undefined) {\n\t\treturn b === undefined ? 0 : -1;\n\t}\n\n\tif (b === undefined) {\n\t\treturn 1;\n\t}\n\n\tconst ta = getBSONType(a);\n\tconst oa = getBSONTypeOrder(ta);\n\n\tconst tb = getBSONType(b);\n\tconst ob = getBSONTypeOrder(tb);\n\n\tif (oa !== ob) {\n\t\treturn oa < ob ? -1 : 1;\n\t}\n\n\tif (ta !== tb) {\n\t\tthrow Error('Missing type coercion logic in compareBSONValues');\n\t}\n\n\tswitch (ta) {\n\t\tcase BSONType.Double:\n\t\t\treturn (a as number) - (b as number);\n\n\t\tcase BSONType.String:\n\t\t\treturn (a as string).localeCompare(b as string);\n\n\t\tcase BSONType.Object:\n\t\t\treturn compareBSONValues(\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(a as Record<string, unknown>)),\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(b as Record<string, unknown>)),\n\t\t\t);\n\n\t\tcase BSONType.Array: {\n\t\t\tfor (let i = 0; ; i++) {\n\t\t\t\tif (i === (a as unknown[]).length) {\n\t\t\t\t\treturn i === (b as unknown[]).length ? 0 : -1;\n\t\t\t\t}\n\n\t\t\t\tif (i === (b as unknown[]).length) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tconst s = compareBSONValues((a as unknown[])[i], (b as unknown[])[i]);\n\t\t\t\tif (s !== 0) {\n\t\t\t\t\treturn s;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tcase BSONType.BinData: {\n\t\t\tif ((a as Uint8Array).length !== (b as Uint8Array).length) {\n\t\t\t\treturn (a as Uint8Array).length - (b as Uint8Array).length;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < (a as Uint8Array).length; i++) {\n\t\t\t\tif ((a as Uint8Array)[i] === (b as Uint8Array)[i]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\treturn (a as Uint8Array)[i] < (b as Uint8Array)[i] ? -1 : 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t}\n\n\t\tcase BSONType.Null:\n\t\tcase BSONType.Undefined:\n\t\t\treturn 0;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn (a as ObjectID).toHexString().localeCompare((b as ObjectID).toHexString());\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn Number(a) - Number(b);\n\n\t\tcase BSONType.Date:\n\t\t\treturn (a as Date).getTime() - (b as Date).getTime();\n\n\t\tcase BSONType.Regex:\n\t\t\tthrow Error('Sorting not supported on regular expression');\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\tthrow Error('Sorting not supported on Javascript code');\n\t}\n\n\tthrow Error('Unknown type to sort');\n};\n"]}