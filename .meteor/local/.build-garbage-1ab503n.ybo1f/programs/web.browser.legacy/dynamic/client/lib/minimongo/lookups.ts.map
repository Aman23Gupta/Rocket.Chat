{"version":3,"sources":["meteor://ðŸ’»app/client/lib/minimongo/lookups.ts"],"names":[],"mappings":";;;;;;;;AAAA;;AAAS,MAAc,KAAd,CAAoB,sCAApB,EAAoC;AAAA;AAAA;AAAA;AAAA,CAApC,EAAoC,CAApC;;AAAoC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAA7C,OAAO,MAAP,CAAS;AAAA,sBAAoB,cAAgB;AAAA;AAAA;AAApC,CAAT;AAA6C;AAAA;AAAA;AAAA;AAAA;AAAA;;AAE7C,IAAM,cAAc,GAAG,UAAC,GAAD;AAAA,SAA2C,GAAG,KAAK,SAAR,IAAqB,GAAG,KAAK,IAAxE;AAAA,CAAvB;;AAEA,IAAM,gBAAgB,GAAG,UAAC,GAAD;AAAA,SACxB,GAAG,KAAK,SAAR,IAAqB,GAAG,KAAK,IAA7B,KAAsC,QAAO,GAAP,MAAe,QAAf,IAA2B,OAAO,GAAP,KAAe,UAAhF,CADwB;AAAA,CAAzB;;AAGA,IAAM,iBAAiB,GAAG,UAAI,KAAJ,EAAoB,iBAApB;AAAA,SAAiE,KAAK,CAAC,OAAN,CAAc,KAAd,KAAwB,iBAAzF;AAAA,CAA1B;;AAEO,IAAM,oBAAoB,GAAG,UAAI,GAAJ,EAA4C;AAC/E,mBAAsB,GAAG,CAAC,KAAJ,CAAU,QAAV,CAAtB;AAAA;AAAA,MAAO,KAAP;AAAA,MAAc,IAAd;;AAEA,MAAI,CAAC,IAAL,EAAW;AACV,WAAO,UAAI,GAAJ,EAAyB;AAC/B,UAAI,cAAc,CAAC,GAAD,CAAd,IAAuB,CAAC,gBAAgB,CAAC,GAAD,CAA5C,EAAmD;AAClD,eAAO,CAAC,SAAD,CAAP;AACA;;AAED,aAAO,CAAC,GAAG,CAAC,KAAD,CAAJ,CAAP;AACA,KAND;AAOA;;AAED,MAAM,UAAU,GAAG,oBAAoB,CAAC,IAAD,CAAvC;AACA,MAAM,aAAa,GAAG,aAAa,IAAb,CAAkB,IAAlB,CAAtB;AAEA,SAAO,UAAI,GAAJ,EAAyB;AAC/B,QAAI,cAAc,CAAC,GAAD,CAAd,IAAuB,CAAC,gBAAgB,CAAC,GAAD,CAA5C,EAAmD;AAClD,aAAO,CAAC,SAAD,CAAP;AACA;;AAED,QAAM,UAAU,GAAG,GAAG,CAAC,KAAD,CAAtB;;AAEA,QAAI,YAAY,CAAC,UAAD,CAAhB,EAA8B;AAC7B,aAAO,CAAC,SAAD,CAAP;AACA;;AAED,QAAM,IAAI,GAAG,iBAAiB,CAAC,UAAD,EAAa,aAAb,CAAjB,GAA+C,UAA/C,GAA4D,CAAC,UAAD,CAAzE;AACA,WAAO,KAAK,CAAC,SAAN,CAAgB,MAAhB,CAAuB,KAAvB,CAA6B,EAA7B,EAAiC,IAAI,CAAC,GAAL,CAAS,UAAT,CAAjC,CAAP;AACA,GAbD;AAcA,CA9BM,C","file":"dynamic/client/lib/minimongo/lookups.ts","sourcesContent":["import { isEmptyArray } from './comparisons';\n\nconst isNullDocument = (doc: unknown): doc is undefined | null => doc === undefined || doc === null;\n\nconst isRecordDocument = (doc: unknown): doc is Record<string, unknown> =>\n\tdoc !== undefined && doc !== null && (typeof doc === 'object' || typeof doc === 'function');\n\nconst isIndexedByNumber = <T>(value: unknown, isIndexedByNumber: boolean): value is T[] => Array.isArray(value) || isIndexedByNumber;\n\nexport const createLookupFunction = <T>(key: string): ((doc: T) => unknown[]) => {\n\tconst [first, rest] = key.split(/\\.(.+)/);\n\n\tif (!rest) {\n\t\treturn <T>(doc: T): unknown[] => {\n\t\t\tif (isNullDocument(doc) || !isRecordDocument(doc)) {\n\t\t\t\treturn [undefined];\n\t\t\t}\n\n\t\t\treturn [doc[first]];\n\t\t};\n\t}\n\n\tconst lookupRest = createLookupFunction(rest);\n\tconst nextIsNumeric = /^\\d+(\\.|$)/.test(rest);\n\n\treturn <T>(doc: T): unknown[] => {\n\t\tif (isNullDocument(doc) || !isRecordDocument(doc)) {\n\t\t\treturn [undefined];\n\t\t}\n\n\t\tconst firstLevel = doc[first];\n\n\t\tif (isEmptyArray(firstLevel)) {\n\t\t\treturn [undefined];\n\t\t}\n\n\t\tconst docs = isIndexedByNumber(firstLevel, nextIsNumeric) ? firstLevel : [firstLevel as T];\n\t\treturn Array.prototype.concat.apply([], docs.map(lookupRest));\n\t};\n};\n"]}