{"version":3,"sources":["meteor://ðŸ’»app/client/lib/lists/ThreadsList.ts"],"names":[],"mappings":";;;;;;;;AAAA;;AAAS,MAAc,KAAd,CAAoB,oCAApB,EAAkD;AAAA;AAAA;AAAA;AAAA,CAAlD,EAAkD,CAAlD;;AAAkD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAA3D,OAAO,MAAP,CAAS;AAAA,aAAc,cAAM;AAAA;AAAA;AAApB,CAAT;AAA2D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA0B3D,IAAM,qBAAqB,GAAG,UAAC,OAAD,EAAoB,GAApB;AAAA,SAC7B,OAAO,CAAC,GAAR,KAAgB,GAAhB,IAAuB,OAAQ,OAAyB,CAAC,MAAlC,KAA6C,QADvC;AAAA,CAA9B;;AAGA,IAAM,sBAAsB,GAAG,UAAC,aAAD,EAA+B,GAA/B;AAAA;;AAAA,4DAA8D,aAAa,CAAC,OAA5E,2DAA8D,uBAAuB,QAAvB,CAAgC,GAAhC,CAA9D,yEAAsG,KAAtG;AAAA,CAA/B;;AAEA,IAAM,cAAc,GAAG,UAAC,aAAD,EAA+B,OAA/B;AAAA,SACtB,OAAO,CAAC,OAAD,aAAC,OAAD,uBAAC,OAAO,CAAE,QAAT,CAAkB,aAAa,CAAC,GAAhC,CAAD,CADe;AAAA,CAAvB;;AAGA,IAAM,oBAAoB,GAAG,UAAC,aAAD,EAA+B,KAA/B;AAAA,SAA0D,KAAK,CAAC,IAAN,CAAW,aAAa,CAAC,GAAzB,CAA1D;AAAA,CAA7B;;IAEa,W;;;AACZ,uBAA2B,QAA3B,EAAuD;AAAA;;AACtD;AADsD,UAA5B,QAA4B;AAA5B;AAA4B;AAEtD;;;;SAMM,a;AAAA,2BAAc,OAAd,EAAyC;AAC/C,WAAK,QAAL,GAAgB,OAAhB;AACA,WAAK,KAAL;AACA;;;;;SAES,M;AAAA,oBAAO,OAAP,EAAwB;AACjC,UAAQ,GAAR,GAAgB,KAAK,QAArB,CAAQ,GAAR;;AAEA,UAAI,CAAC,qBAAqB,CAAC,OAAD,EAAU,GAAV,CAA1B,EAA0C;AACzC,eAAO,KAAP;AACA;;AAED,UAAI,KAAK,QAAL,CAAc,IAAd,KAAuB,WAA3B,EAAwC;AACvC,YAAQ,GAAR,GAAgB,KAAK,QAArB,CAAQ,GAAR;;AACA,YAAI,CAAC,sBAAsB,CAAC,OAAD,EAAU,GAAV,CAA3B,EAA2C;AAC1C,iBAAO,KAAP;AACA;AACD;;AAED,UAAI,KAAK,QAAL,CAAc,IAAd,KAAuB,QAA3B,EAAqC;AACpC,YAAQ,OAAR,GAAoB,KAAK,QAAzB,CAAQ,OAAR;;AACA,YAAI,CAAC,cAAc,CAAC,OAAD,EAAU,OAAV,CAAnB,EAAuC;AACtC,iBAAO,KAAP;AACA;AACD;;AAED,UAAI,KAAK,QAAL,CAAc,IAAlB,EAAwB;AACvB,YAAM,KAAK,GAAG,IAAI,MAAJ,CAAW,YAAY,CAAC,KAAK,QAAL,CAAc,IAAf,CAAvB,EAA6C,GAA7C,CAAd;;AACA,YAAI,CAAC,oBAAoB,CAAC,OAAD,EAAU,KAAV,CAAzB,EAA2C;AAC1C,iBAAO,KAAP;AACA;AACD;;AAED,aAAO,IAAP;AACA;;;;;SAES,O;AAAA,qBAAQ,CAAR,EAAqB,CAArB,EAAgC;AAAA;;AACzC,aAAO,WAAC,CAAC,CAAC,GAAH,2CAAU,CAAC,CAAC,EAAZ,EAAgB,OAAhB,KAA4B,WAAC,CAAC,CAAC,GAAH,2CAAU,CAAC,CAAC,EAAZ,EAAgB,OAAhB,EAAnC;AACA;;;;;;;SA1CD,YAAkB;AACjB,aAAO,KAAK,QAAZ;AACA;;;;EAP+B,W","file":"dynamic/client/lib/lists/ThreadsList.ts","sourcesContent":["import { escapeRegExp } from '@rocket.chat/string-helpers';\n\nimport type { IMessage } from '../../../definition/IMessage';\nimport { ISubscription } from '../../../definition/ISubscription';\nimport { IUser } from '../../../definition/IUser';\nimport { MessageList } from './MessageList';\n\ntype ThreadMessage = Omit<IMessage, 'tcount'> & Required<Pick<IMessage, 'tcount'>>;\n\nexport type ThreadsListOptions = {\n\trid: IMessage['rid'];\n\ttext?: string;\n} & (\n\t| {\n\t\t\ttype: 'unread';\n\t\t\ttunread: ISubscription['tunread'];\n\t  }\n\t| {\n\t\t\ttype: 'following';\n\t\t\tuid: IUser['_id'];\n\t  }\n\t| {\n\t\t\ttype: 'all';\n\t  }\n);\n\nconst isThreadMessageInRoom = (message: IMessage, rid: IMessage['rid']): message is ThreadMessage =>\n\tmessage.rid === rid && typeof (message as ThreadMessage).tcount === 'number';\n\nconst isThreadFollowedByUser = (threadMessage: ThreadMessage, uid: IUser['_id']): boolean => threadMessage.replies?.includes(uid) ?? false;\n\nconst isThreadUnread = (threadMessage: ThreadMessage, tunread: ISubscription['tunread']): boolean =>\n\tBoolean(tunread?.includes(threadMessage._id));\n\nconst isThreadTextMatching = (threadMessage: ThreadMessage, regex: RegExp): boolean => regex.test(threadMessage.msg);\n\nexport class ThreadsList extends MessageList {\n\tpublic constructor(private _options: ThreadsListOptions) {\n\t\tsuper();\n\t}\n\n\tpublic get options(): ThreadsListOptions {\n\t\treturn this._options;\n\t}\n\n\tpublic updateFilters(options: ThreadsListOptions): void {\n\t\tthis._options = options;\n\t\tthis.clear();\n\t}\n\n\tprotected filter(message: IMessage): boolean {\n\t\tconst { rid } = this._options;\n\n\t\tif (!isThreadMessageInRoom(message, rid)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this._options.type === 'following') {\n\t\t\tconst { uid } = this._options;\n\t\t\tif (!isThreadFollowedByUser(message, uid)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (this._options.type === 'unread') {\n\t\t\tconst { tunread } = this._options;\n\t\t\tif (!isThreadUnread(message, tunread)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (this._options.text) {\n\t\t\tconst regex = new RegExp(escapeRegExp(this._options.text), 'i');\n\t\t\tif (!isThreadTextMatching(message, regex)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprotected compare(a: IMessage, b: IMessage): number {\n\t\treturn (b.tlm ?? b.ts).getTime() - (a.tlm ?? a.ts).getTime();\n\t}\n}\n"]}