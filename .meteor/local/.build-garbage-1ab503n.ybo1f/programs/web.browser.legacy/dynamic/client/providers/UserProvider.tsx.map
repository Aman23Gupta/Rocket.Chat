{"version":3,"sources":["meteor://ðŸ’»app/client/providers/UserProvider.tsx"],"names":[],"mappings":"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","file":"dynamic/client/providers/UserProvider.tsx","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport React, { useMemo, FC } from 'react';\n\nimport { Subscriptions, Rooms } from '../../app/models/client';\nimport { getUserPreference } from '../../app/utils/client';\nimport { IRoom } from '../../definition/IRoom';\nimport { ISubscription } from '../../definition/ISubscription';\nimport { IUser } from '../../definition/IUser';\nimport { callbacks } from '../../lib/callbacks';\nimport { UserContext } from '../contexts/UserContext';\nimport { useReactiveValue } from '../hooks/useReactiveValue';\nimport { createReactiveSubscriptionFactory } from './createReactiveSubscriptionFactory';\n\nconst getUserId = (): string | null => Meteor.userId();\n\nconst getUser = (): IUser | null => Meteor.user() as IUser | null;\n\nconst loginWithPassword = (user: string | object, password: string): Promise<void> =>\n\tnew Promise((resolve, reject) => {\n\t\tMeteor.loginWithPassword(user, password, (error: Error | Meteor.Error | Meteor.TypedError | undefined) => {\n\t\t\tif (error) {\n\t\t\t\treject(error);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tresolve();\n\t\t});\n\t});\n\nconst logout = (): Promise<void> =>\n\tnew Promise((resolve) => {\n\t\tconst user = getUser();\n\n\t\tif (!user) {\n\t\t\treturn resolve();\n\t\t}\n\n\t\tMeteor.logout(() => {\n\t\t\tcallbacks.run('afterLogoutCleanUp', user);\n\t\t\tMeteor.call('logoutCleanUp', user, resolve);\n\t\t});\n\t});\n\nconst UserProvider: FC = ({ children }) => {\n\tconst userId = useReactiveValue(getUserId);\n\tconst user = useReactiveValue(getUser);\n\tconst contextValue = useMemo(\n\t\t() => ({\n\t\t\tuserId,\n\t\t\tuser,\n\t\t\tloginWithPassword,\n\t\t\tlogout,\n\t\t\tqueryPreference: createReactiveSubscriptionFactory((key, defaultValue) => getUserPreference(userId, key, defaultValue)),\n\t\t\tquerySubscription: createReactiveSubscriptionFactory<ISubscription | undefined>((query, fields) =>\n\t\t\t\tSubscriptions.findOne(query, { fields }),\n\t\t\t),\n\t\t\tqueryRoom: createReactiveSubscriptionFactory<IRoom | undefined>((query, fields) => Rooms.findOne(query, { fields })),\n\t\t\tquerySubscriptions: createReactiveSubscriptionFactory<Array<ISubscription> | []>((query, options) =>\n\t\t\t\t(userId ? Subscriptions : Rooms).find(query, options).fetch(),\n\t\t\t),\n\t\t}),\n\t\t[userId, user],\n\t);\n\n\treturn <UserContext.Provider children={children} value={contextValue} />;\n};\n\nexport default UserProvider;\n"]}