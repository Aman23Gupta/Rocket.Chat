{"version":3,"sources":["meteor://ðŸ’»app/client/hooks/useUpdateAvatar.js"],"names":["_regeneratorRuntime","module","link","default","v","_objectSpread","export","useUpdateAvatar","useMemo","useCallback","useMethod","useToastMessageDispatch","useTranslation","useEndpointAction","useEndpointUpload","avatarObj","userId","t","avatarUrl","successText","setAvatarFromService","dispatchToastMessage","saveAvatarQuery","resetAvatarQuery","saveAvatarAction","saveAvatarUrlAction","resetAvatarAction","updateAvatar","service","blob","contentType","type","message","FormData","set"],"mappings":"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","file":"dynamic/client/hooks/useUpdateAvatar.js","sourcesContent":["import { useMemo, useCallback } from 'react';\n\nimport { useMethod } from '../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../contexts/ToastMessagesContext';\nimport { useTranslation } from '../contexts/TranslationContext';\nimport { useEndpointAction } from './useEndpointAction';\nimport { useEndpointUpload } from './useEndpointUpload';\n\nexport const useUpdateAvatar = (avatarObj, userId) => {\n\tconst t = useTranslation();\n\tconst avatarUrl = avatarObj?.avatarUrl;\n\n\tconst successText = t('Avatar_changed_successfully');\n\tconst setAvatarFromService = useMethod('setAvatarFromService');\n\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst saveAvatarQuery = useMemo(\n\t\t() => ({\n\t\t\tuserId,\n\t\t\t...(avatarUrl && { avatarUrl }),\n\t\t}),\n\t\t[avatarUrl, userId],\n\t);\n\n\tconst resetAvatarQuery = useMemo(\n\t\t() => ({\n\t\t\tuserId,\n\t\t}),\n\t\t[userId],\n\t);\n\n\tconst saveAvatarAction = useEndpointUpload('users.setAvatar', saveAvatarQuery, successText);\n\tconst saveAvatarUrlAction = useEndpointAction('POST', 'users.setAvatar', saveAvatarQuery, successText);\n\tconst resetAvatarAction = useEndpointAction('POST', 'users.resetAvatar', resetAvatarQuery, successText);\n\n\tconst updateAvatar = useCallback(async () => {\n\t\tif (avatarObj === 'reset') {\n\t\t\treturn resetAvatarAction();\n\t\t}\n\t\tif (avatarObj.avatarUrl) {\n\t\t\treturn saveAvatarUrlAction();\n\t\t}\n\t\tif (avatarObj.service) {\n\t\t\tconst { blob, contentType, service } = avatarObj;\n\t\t\ttry {\n\t\t\t\tawait setAvatarFromService(blob, contentType, service);\n\t\t\t\tdispatchToastMessage({ type: 'success', message: successText });\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (avatarObj instanceof FormData) {\n\t\t\tavatarObj.set('userId', userId);\n\t\t\treturn saveAvatarAction(avatarObj);\n\t\t}\n\t}, [\n\t\tavatarObj,\n\t\tdispatchToastMessage,\n\t\tresetAvatarAction,\n\t\tsaveAvatarAction,\n\t\tsaveAvatarUrlAction,\n\t\tsetAvatarFromService,\n\t\tsuccessText,\n\t\tuserId,\n\t]);\n\n\treturn updateAvatar;\n};\n"]}