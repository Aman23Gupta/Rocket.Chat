{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/Call/Jitsi/lib/JitsiBridge.js"],"names":["_inheritsLoose","module","link","default","v","export","JitsiBridge","Emitter","JitsiMeetExternalAPI","heartbeat","openNewWindow","ssl","domain","jitsiRoomName","accessToken","desktopSharingChromeExtId","name","window","undefined","needsStart","start","domTarget","heartbeatTimer","setInterval","emit","once","clearTimeout","protocol","configOverwrite","interfaceConfigOverwrite","queryString","newWindow","open","timer","closed","dispose","focus","width","height","api","executeCommand","clearInterval"],"mappings":"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","file":"dynamic/client/views/room/contextualBar/Call/Jitsi/lib/JitsiBridge.js","sourcesContent":["import { Emitter } from '@rocket.chat/emitter';\n\nimport { JitsiMeetExternalAPI } from './Jitsi';\n\nexport class JitsiBridge extends Emitter {\n\tconstructor({ openNewWindow, ssl, domain, jitsiRoomName, accessToken, desktopSharingChromeExtId, name }, heartbeat) {\n\t\tsuper();\n\n\t\tthis.openNewWindow = openNewWindow;\n\t\tthis.ssl = ssl;\n\t\tthis.domain = domain;\n\t\tthis.jitsiRoomName = jitsiRoomName;\n\t\tthis.accessToken = accessToken;\n\t\tthis.desktopSharingChromeExtId = desktopSharingChromeExtId;\n\t\tthis.name = name;\n\t\tthis.heartbeat = heartbeat;\n\t\tthis.window = undefined;\n\t\tthis.needsStart = false;\n\t}\n\n\tstart(domTarget) {\n\t\tif (!this.needsStart) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.needsStart = false;\n\n\t\tconst heartbeatTimer = setInterval(() => this.emit('HEARTBEAT', true), this.heartbeat);\n\t\tthis.once('dispose', () => clearTimeout(heartbeatTimer));\n\n\t\tconst { openNewWindow, ssl, domain, jitsiRoomName, accessToken, desktopSharingChromeExtId, name } = this;\n\n\t\tconst protocol = ssl ? 'https://' : 'http://';\n\n\t\tconst configOverwrite = {\n\t\t\tdesktopSharingChromeExtId,\n\t\t};\n\n\t\tconst interfaceConfigOverwrite = {};\n\n\t\tif (openNewWindow) {\n\t\t\tconst queryString = accessToken ? `?jwt=${accessToken}` : '';\n\t\t\tconst newWindow = window.open(`${protocol + domain}/${jitsiRoomName}${queryString}`, jitsiRoomName);\n\n\t\t\tif (!newWindow) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst timer = setInterval(() => {\n\t\t\t\tif (newWindow.closed) {\n\t\t\t\t\tthis.dispose();\n\t\t\t\t}\n\t\t\t}, 1000);\n\n\t\t\tthis.once('dispose', () => clearTimeout(timer));\n\t\t\tthis.window = newWindow;\n\t\t\treturn newWindow.focus();\n\t\t}\n\n\t\tconst width = 'auto';\n\t\tconst height = 500;\n\n\t\tconst api = new JitsiMeetExternalAPI(\n\t\t\tdomain,\n\t\t\tjitsiRoomName,\n\t\t\twidth,\n\t\t\theight,\n\t\t\tdomTarget,\n\t\t\tconfigOverwrite,\n\t\t\tinterfaceConfigOverwrite,\n\t\t\t!ssl,\n\t\t\taccessToken,\n\t\t); // eslint-disable-line no-undef\n\t\tapi.executeCommand('displayName', [name]);\n\t\tthis.once('dispose', () => api.dispose());\n\t}\n\n\tdispose() {\n\t\tclearInterval(this.timer);\n\t\tthis.emit('dispose', true);\n\t}\n}\n"]}