{"version":3,"sources":["meteor://ðŸ’»app/client/views/login/AppleOauth/AppleOauthButton.tsx"],"names":[],"mappings":"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","file":"dynamic/client/views/login/AppleOauth/AppleOauthButton.tsx","sourcesContent":["import { Accounts } from 'meteor/accounts-base';\nimport React, { FC, useCallback, useEffect, useLayoutEffect, useRef } from 'react';\n\nimport { useAbsoluteUrl } from '../../../contexts/ServerContext';\nimport { useSetting } from '../../../contexts/SettingsContext';\n\nexport const AppleOauthButton: FC = () => {\n\tconst enabled = useSetting('Accounts_OAuth_Apple');\n\tconst absoluteUrl = useAbsoluteUrl();\n\tconst appleClientID = useSetting('Accounts_OAuth_Apple_id');\n\n\tconst redirectURI = absoluteUrl('_oauth/apple');\n\n\tuseEffect(() => {\n\t\tconst success = (data: any): void => {\n\t\t\tconst { authorization, user } = data.detail;\n\n\t\t\tAccounts.callLoginMethod({\n\t\t\t\tmethodArguments: [\n\t\t\t\t\t{\n\t\t\t\t\t\tserviceName: 'apple',\n\t\t\t\t\t\tidentityToken: authorization.id_token,\n\t\t\t\t\t\t...(user && {\n\t\t\t\t\t\t\tfullName: {\n\t\t\t\t\t\t\t\tgivenName: user.name.firstName,\n\t\t\t\t\t\t\t\tfamilyName: user.name.lastName,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\t}),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tuserCallback: console.log,\n\t\t\t});\n\t\t};\n\n\t\tconst error = (error: any): void => {\n\t\t\t// handle error.\n\t\t\tconsole.error(error);\n\t\t};\n\t\tdocument.addEventListener('AppleIDSignInOnSuccess', success);\n\t\t// Listen for authorization failures\n\t\tdocument.addEventListener('AppleIDSignInOnFailure', error);\n\n\t\treturn (): void => {\n\t\t\tdocument.removeEventListener('AppleIDSignInOnSuccess', success);\n\t\t\tdocument.removeEventListener('AppleIDSignInOnFailure', error);\n\t\t};\n\t}, []);\n\n\tconst scriptLoadedHandler = useCallback(() => {\n\t\tif (!enabled) {\n\t\t\treturn;\n\t\t}\n\t\t(window as any).AppleID.auth.init({\n\t\t\tclientId: appleClientID,\n\t\t\tscope: 'name email',\n\t\t\tredirectURI,\n\t\t\tusePopup: true,\n\t\t});\n\t}, [enabled, appleClientID, redirectURI]);\n\n\tconst ref = useRef<HTMLScriptElement>();\n\n\tuseEffect(() => {\n\t\tif ((window as any).AppleID) {\n\t\t\tscriptLoadedHandler();\n\t\t\treturn;\n\t\t}\n\t\tif (!ref.current) {\n\t\t\treturn;\n\t\t}\n\t\tref.current.onload = scriptLoadedHandler;\n\t}, [scriptLoadedHandler]);\n\n\tuseLayoutEffect(() => {\n\t\tconst script = document.createElement('script');\n\t\tscript.src = 'https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js';\n\t\tscript.async = true;\n\t\tref.current = script;\n\t\tdocument.body.appendChild(script);\n\t\treturn (): void => {\n\t\t\tdocument.body.removeChild(script);\n\t\t};\n\t}, []);\n\n\tif (!enabled) {\n\t\treturn null;\n\t}\n\n\treturn <div id='appleid-signin' data-height='40px'></div>;\n};\n\nexport default AppleOauthButton;\n"]}