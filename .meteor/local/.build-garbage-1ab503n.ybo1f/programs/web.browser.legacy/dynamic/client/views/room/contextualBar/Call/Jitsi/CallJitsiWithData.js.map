{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/Call/Jitsi/CallJitsiWithData.js"],"names":["_regeneratorRuntime","module","link","default","v","_slicedToArray","Skeleton","useMutableCallback","useSafely","clear","React","useRef","useEffect","useState","useMemo","useLayoutEffect","memo","HEARTBEAT","TIMEOUT","DEBOUNCE","useConnectionStatus","useSetModal","useMethod","useSettings","useToastMessageDispatch","useTranslation","useUser","useRoom","useTabBarClose","CallJitsi","CallModal","JitsiBridge","querySettings","_id","CallJitsiWithData","rid","user","connected","accessToken","setAccessToken","accepted","setAccepted","room","setModal","handleClose","closeModal","generateAccessToken","updateTimeout","dispatchToastMessage","t","handleCancel","ref","Object","fromEntries","map","value","openNewWindow","Jitsi_Open_New_Window","domain","Jitsi_Domain","ssl","Jitsi_SSL","desktopSharingChromeExtId","Jitsi_Chrome_Extension","useHashName","Jitsi_URL_Room_Hash","uniqueID","prefix","Jitsi_URL_Room_Prefix","sufix","Jitsi_URL_Room_Suffix","isEnabledTokenAuth","Jitsi_Enabled_TokenAuth","ignore","rname","encodeURIComponent","usernames","join","name","jitsi","jitsiRoomName","username","testAndHandleTimeout","window","closed","dispose","error","type","message","reason","Date","jitsiTimeout","off","needsStart","start","current","on","handleYes","exportDefault"],"mappings":"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","file":"dynamic/client/views/room/contextualBar/Call/Jitsi/CallJitsiWithData.js","sourcesContent":["import { Skeleton } from '@rocket.chat/fuselage';\nimport { useMutableCallback, useSafely } from '@rocket.chat/fuselage-hooks';\nimport { clear } from '@rocket.chat/memo';\nimport React, { useRef, useEffect, useState, useMemo, useLayoutEffect, memo } from 'react';\n\nimport { HEARTBEAT, TIMEOUT, DEBOUNCE } from '../../../../../../app/videobridge/constants';\nimport { useConnectionStatus } from '../../../../../contexts/ConnectionStatusContext';\nimport { useSetModal } from '../../../../../contexts/ModalContext';\nimport { useMethod } from '../../../../../contexts/ServerContext';\nimport { useSettings } from '../../../../../contexts/SettingsContext';\nimport { useToastMessageDispatch } from '../../../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../../../contexts/TranslationContext';\nimport { useUser } from '../../../../../contexts/UserContext';\nimport { useRoom } from '../../../contexts/RoomContext';\nimport { useTabBarClose } from '../../../providers/ToolboxProvider';\nimport CallJitsi from './CallJitsi';\nimport CallModal from './components/CallModal';\nimport { JitsiBridge } from './lib/JitsiBridge';\n\nexport { default as CallJitsi } from './CallJitsi';\n\nconst querySettings = {\n\t_id: [\n\t\t'Jitsi_Open_New_Window',\n\t\t'Jitsi_Domain',\n\t\t'Jitsi_URL_Room_Hash',\n\t\t'uniqueID',\n\t\t'Jitsi_URL_Room_Prefix',\n\t\t'Jitsi_URL_Room_Suffix',\n\t\t'Jitsi_Chrome_Extension',\n\t\t'Jitsi_SSL',\n\t\t'Jitsi_Enabled_TokenAuth',\n\t],\n};\n\nconst CallJitsiWithData = ({ rid }) => {\n\tconst user = useUser();\n\tconst { connected } = useConnectionStatus();\n\tconst [accessToken, setAccessToken] = useSafely(useState());\n\tconst [accepted, setAccepted] = useState(false);\n\tconst room = useRoom();\n\tconst setModal = useSetModal();\n\tconst handleClose = useTabBarClose();\n\tconst closeModal = useMutableCallback(() => setModal(null));\n\tconst generateAccessToken = useMethod('jitsi:generateAccessToken');\n\tconst updateTimeout = useMethod('jitsi:updateTimeout');\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst t = useTranslation();\n\n\tconst handleCancel = useMutableCallback(() => {\n\t\tcloseModal();\n\t\thandleClose();\n\t});\n\n\tconst ref = useRef();\n\n\tconst {\n\t\tJitsi_Open_New_Window: openNewWindow,\n\t\tJitsi_Domain: domain,\n\t\tJitsi_SSL: ssl,\n\t\tJitsi_Chrome_Extension: desktopSharingChromeExtId,\n\t\tJitsi_URL_Room_Hash: useHashName,\n\t\tuniqueID,\n\t\tJitsi_URL_Room_Prefix: prefix,\n\t\tJitsi_URL_Room_Suffix: sufix,\n\t\tJitsi_Enabled_TokenAuth: isEnabledTokenAuth,\n\t} = Object.fromEntries(useSettings(querySettings).map(({ _id, value }) => [_id, value]));\n\n\tuseEffect(() => {\n\t\tlet ignore = false;\n\t\tif (!isEnabledTokenAuth) {\n\t\t\tsetAccessToken();\n\t\t\treturn;\n\t\t}\n\t\t(async () => {\n\t\t\tconst accessToken = await generateAccessToken(rid);\n\t\t\t!ignore && setAccessToken(accessToken);\n\t\t})();\n\t\treturn () => {\n\t\t\tignore = true;\n\t\t};\n\t}, [generateAccessToken, isEnabledTokenAuth, rid, setAccessToken]);\n\n\tuseLayoutEffect(() => {\n\t\tif (!connected) {\n\t\t\thandleClose();\n\t\t}\n\t}, [connected, handleClose]);\n\n\tconst rname = useHashName ? uniqueID + rid : encodeURIComponent(room.t === 'd' ? room.usernames.join(' x ') : room.name);\n\n\tconst jitsi = useMemo(() => {\n\t\tif (isEnabledTokenAuth && !accessToken) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst jitsiRoomName = prefix + rname + sufix;\n\n\t\treturn new JitsiBridge(\n\t\t\t{\n\t\t\t\topenNewWindow,\n\t\t\t\tssl,\n\t\t\t\tdomain,\n\t\t\t\tjitsiRoomName,\n\t\t\t\taccessToken,\n\t\t\t\tdesktopSharingChromeExtId,\n\t\t\t\tname: user.name || user.username,\n\t\t\t},\n\t\t\tHEARTBEAT,\n\t\t);\n\t}, [\n\t\taccessToken,\n\t\tdesktopSharingChromeExtId,\n\t\tdomain,\n\t\tisEnabledTokenAuth,\n\t\topenNewWindow,\n\t\tprefix,\n\t\trname,\n\t\tssl,\n\t\tsufix,\n\t\tuser.name,\n\t\tuser.username,\n\t]);\n\n\tconst testAndHandleTimeout = useMutableCallback(() => {\n\t\tif (jitsi.openNewWindow) {\n\t\t\tif (jitsi.window?.closed) {\n\t\t\t\treturn jitsi.dispose();\n\t\t\t}\n\t\t\ttry {\n\t\t\t\treturn updateTimeout(rid, false);\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t(error.reason) });\n\t\t\t\tclear();\n\t\t\t\thandleClose();\n\t\t\t\treturn jitsi.dispose();\n\t\t\t}\n\t\t}\n\t\tif (new Date() - new Date(room.jitsiTimeout) > TIMEOUT) {\n\t\t\treturn jitsi.dispose();\n\t\t}\n\n\t\tif (new Date() - new Date(room.jitsiTimeout) + TIMEOUT > DEBOUNCE) {\n\t\t\ttry {\n\t\t\t\treturn updateTimeout(rid, false);\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t(error.reason) });\n\t\t\t\tclear();\n\t\t\t\thandleClose();\n\t\t\t\treturn jitsi.dispose();\n\t\t\t}\n\t\t}\n\t});\n\n\tuseEffect(() => {\n\t\tif (!accepted || !jitsi) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst clear = () => {\n\t\t\tjitsi.off('HEARTBEAT', testAndHandleTimeout);\n\t\t\tjitsi.dispose();\n\t\t};\n\n\t\ttry {\n\t\t\tif (jitsi.needsStart) {\n\t\t\t\tjitsi.start(ref.current);\n\t\t\t\tupdateTimeout(rid, true);\n\t\t\t} else {\n\t\t\t\tupdateTimeout(rid, false);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: t(error.reason) });\n\t\t\tclear();\n\t\t\thandleClose();\n\t\t}\n\t\tjitsi.on('HEARTBEAT', testAndHandleTimeout);\n\n\t\treturn () => {\n\t\t\tif (!jitsi.openNewWindow) clear();\n\t\t};\n\t}, [accepted, jitsi, rid, testAndHandleTimeout, updateTimeout, dispatchToastMessage, handleClose, t]);\n\n\tconst handleYes = useMutableCallback(() => {\n\t\tif (jitsi) {\n\t\t\tjitsi.needsStart = true;\n\t\t}\n\n\t\tsetAccepted(true);\n\n\t\tif (openNewWindow) {\n\t\t\thandleClose();\n\t\t}\n\t});\n\n\tuseLayoutEffect(() => {\n\t\tif (!accepted) {\n\t\t\tsetModal(() => <CallModal handleYes={handleYes} handleCancel={handleCancel} />);\n\t\t\treturn;\n\t\t}\n\t\tcloseModal();\n\t}, [accepted, closeModal, handleCancel, handleYes, setModal]);\n\n\treturn (\n\t\t<CallJitsi handleClose={handleClose} openNewWindow={openNewWindow} refContent={ref}>\n\t\t\t{!accepted && <Skeleton />}\n\t\t</CallJitsi>\n\t);\n};\n\nexport default memo(CallJitsiWithData);\n"]}