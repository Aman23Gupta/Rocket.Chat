{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/OTR/OTRWithData.js"],"names":["_slicedToArray","module","link","default","v","useMutableCallback","React","useEffect","useMemo","useCallback","ORTInstance","OTR","useSetModal","usePresence","useReactiveValue","OTRModal","OTRWithData","rid","tabBar","onClickClose","close","setModal","closeModal","otr","getInstanceByRoomId","established","get","establishing","isEstablished","isEstablishing","userStatus","peerId","status","isOnline","includes","handleStart","handshake","handleEnd","end","handleReset","reset","timeout","setTimeout","set","clearTimeout","exportDefault"],"mappings":";;;;;;;;AAAA,IAAIA,cAAJ;;AAAmBC,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACC,SAAO,EAAC,UAASC,CAAT,EAAW;AAACJ,kBAAc,GAACI,CAAf;AAAiB;AAAtC,CAAnD,EAA2F,CAA3F;AAAnB,IAAIC,kBAAJ;AAAuBJ,MAAM,CAACC,IAAP,CAAY,6BAAZ,EAA0C;AAACG,oBAAkB,EAAC,UAASD,CAAT,EAAW;AAACC,sBAAkB,GAACD,CAAnB;AAAqB;AAArD,CAA1C,EAAiG,CAAjG;AAAoG,IAAIE,KAAJ,EAAUC,SAAV,EAAoBC,OAApB,EAA4BC,WAA5B;AAAwCR,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAoB;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACE,SAAK,GAACF,CAAN;AAAQ,GAA7B;AAA8BG,WAAS,EAAC,UAASH,CAAT,EAAW;AAACG,aAAS,GAACH,CAAV;AAAY,GAAhE;AAAiEI,SAAO,EAAC,UAASJ,CAAT,EAAW;AAACI,WAAO,GAACJ,CAAR;AAAU,GAA/F;AAAgGK,aAAW,EAAC,UAASL,CAAT,EAAW;AAACK,eAAW,GAACL,CAAZ;AAAc;AAAtI,CAApB,EAA4J,CAA5J;AAA+J,IAAIM,WAAJ;AAAgBT,MAAM,CAACC,IAAP,CAAY,8CAAZ,EAA2D;AAACS,KAAG,EAAC,UAASP,CAAT,EAAW;AAACM,eAAW,GAACN,CAAZ;AAAc;AAA/B,CAA3D,EAA4F,CAA5F;AAA+F,IAAIQ,WAAJ;AAAgBX,MAAM,CAACC,IAAP,CAAY,mCAAZ,EAAgD;AAACU,aAAW,EAAC,UAASR,CAAT,EAAW;AAACQ,eAAW,GAACR,CAAZ;AAAc;AAAvC,CAAhD,EAAyF,CAAzF;AAA4F,IAAIS,WAAJ;AAAgBZ,MAAM,CAACC,IAAP,CAAY,+BAAZ,EAA4C;AAACW,aAAW,EAAC,UAAST,CAAT,EAAW;AAACS,eAAW,GAACT,CAAZ;AAAc;AAAvC,CAA5C,EAAqF,CAArF;AAAwF,IAAIU,gBAAJ;AAAqBb,MAAM,CAACC,IAAP,CAAY,oCAAZ,EAAiD;AAACY,kBAAgB,EAAC,UAASV,CAAT,EAAW;AAACU,oBAAgB,GAACV,CAAjB;AAAmB;AAAjD,CAAjD,EAAoG,CAApG;AAAuG,IAAIO,GAAJ;AAAQV,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAoB;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACO,OAAG,GAACP,CAAJ;AAAM;AAA3B,CAApB,EAAiD,CAAjD;AAAoD,IAAIW,QAAJ;AAAad,MAAM,CAACC,IAAP,CAAY,YAAZ,EAAyB;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACW,YAAQ,GAACX,CAAT;AAAW;AAAhC,CAAzB,EAA2D,CAA3D;;AAU10B,IAAMY,WAAW,GAAG,gBAAqB;AAAA;;AAAA,MAAlBC,GAAkB,QAAlBA,GAAkB;AAAA,MAAbC,MAAa,QAAbA,MAAa;AACxC,MAAMC,YAAY,GAAGd,kBAAkB,CAAC;AAAA,WAAMa,MAAM,IAAIA,MAAM,CAACE,KAAP,EAAhB;AAAA,GAAD,CAAvC;AAEA,MAAMC,QAAQ,GAAGT,WAAW,EAA5B;AACA,MAAMU,UAAU,GAAGjB,kBAAkB,CAAC;AAAA,WAAMgB,QAAQ,EAAd;AAAA,GAAD,CAArC;AACA,MAAME,GAAG,GAAGf,OAAO,CAAC;AAAA,WAAME,WAAW,CAACc,mBAAZ,CAAgCP,GAAhC,CAAN;AAAA,GAAD,EAA6C,CAACA,GAAD,CAA7C,CAAnB;;AAEA,0BAAwCH,gBAAgB,CACvDL,WAAW,CAAC;AAAA,WAAOc,GAAG,GAAG,CAACA,GAAG,CAACE,WAAJ,CAAgBC,GAAhB,EAAD,EAAwBH,GAAG,CAACI,YAAJ,CAAiBD,GAAjB,EAAxB,CAAH,GAAqD,CAAC,KAAD,EAAQ,KAAR,CAA/D;AAAA,GAAD,EAAiF,CAACH,GAAD,CAAjF,CAD4C,CAAxD;AAAA;AAAA,MAAOK,aAAP;AAAA,MAAsBC,cAAtB;;AAIA,MAAMC,UAAU,mBAAGjB,WAAW,CAACU,GAAG,CAACQ,MAAL,CAAd,iDAAG,aAAyBC,MAA5C;AAEA,MAAMC,QAAQ,GAAG,CAAC,CAAC,SAAD,EAAY,SAAZ,EAAuBC,QAAvB,CAAgCJ,UAAhC,CAAlB;;AAEA,MAAMK,WAAW,GAAG,YAAM;AACzBZ,OAAG,CAACa,SAAJ;AACA,GAFD;;AAIA,MAAMC,SAAS,GAAG;AAAA,WAAMd,GAAN,aAAMA,GAAN,uBAAMA,GAAG,CAAEe,GAAL,EAAN;AAAA,GAAlB;;AAEA,MAAMC,WAAW,GAAG,YAAM;AACzBhB,OAAG,CAACiB,KAAJ;AACAjB,OAAG,CAACa,SAAJ,CAAc,IAAd;AACA,GAHD;;AAKA7B,WAAS,CAAC,YAAM;AACf,QAAIqB,aAAJ,EAAmB;AAClB,aAAON,UAAU,EAAjB;AACA;;AAED,QAAI,CAACO,cAAL,EAAqB;AACpB;AACA;;AAED,QAAMY,OAAO,GAAGC,UAAU,CAAC,YAAM;AAChCnB,SAAG,CAACI,YAAJ,CAAiBgB,GAAjB,CAAqB,KAArB;AACAtB,cAAQ,eAAC,oBAAC,QAAD;AAAU,iBAAS,EAAEC,UAArB;AAAiC,gBAAQ,EAAEA;AAA3C,QAAD,CAAR;AACA,KAHyB,EAGvB,KAHuB,CAA1B;AAKA,WAAO;AAAA,aAAMsB,YAAY,CAACH,OAAD,CAAlB;AAAA,KAAP;AACA,GAfQ,EAeN,CAACnB,UAAD,EAAaM,aAAb,EAA4BC,cAA5B,EAA4CR,QAA5C,EAAsDE,GAAtD,CAfM,CAAT;AAiBA,sBACC,oBAAC,GAAD;AACC,YAAQ,EAAEU,QADX;AAEC,kBAAc,EAAEJ,cAFjB;AAGC,iBAAa,EAAED,aAHhB;AAIC,gBAAY,EAAET,YAJf;AAKC,gBAAY,EAAEgB,WALf;AAMC,cAAU,EAAEE,SANb;AAOC,kBAAc,EAAEE;AAPjB,IADD;AAWA,CAtDD;;AAVAtC,MAAM,CAAC4C,aAAP,CAkEe7B,WAlEf,E","file":"dynamic/client/views/room/contextualBar/OTR/OTRWithData.js","sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, useMemo, useCallback } from 'react';\n\nimport { OTR as ORTInstance } from '../../../../../app/otr/client/rocketchat.otr';\nimport { useSetModal } from '../../../../contexts/ModalContext';\nimport { usePresence } from '../../../../hooks/usePresence';\nimport { useReactiveValue } from '../../../../hooks/useReactiveValue';\nimport OTR from './OTR';\nimport OTRModal from './OTRModal';\n\nconst OTRWithData = ({ rid, tabBar }) => {\n\tconst onClickClose = useMutableCallback(() => tabBar && tabBar.close());\n\n\tconst setModal = useSetModal();\n\tconst closeModal = useMutableCallback(() => setModal());\n\tconst otr = useMemo(() => ORTInstance.getInstanceByRoomId(rid), [rid]);\n\n\tconst [isEstablished, isEstablishing] = useReactiveValue(\n\t\tuseCallback(() => (otr ? [otr.established.get(), otr.establishing.get()] : [false, false]), [otr]),\n\t);\n\n\tconst userStatus = usePresence(otr.peerId)?.status;\n\n\tconst isOnline = !['offline', 'loading'].includes(userStatus);\n\n\tconst handleStart = () => {\n\t\totr.handshake();\n\t};\n\n\tconst handleEnd = () => otr?.end();\n\n\tconst handleReset = () => {\n\t\totr.reset();\n\t\totr.handshake(true);\n\t};\n\n\tuseEffect(() => {\n\t\tif (isEstablished) {\n\t\t\treturn closeModal();\n\t\t}\n\n\t\tif (!isEstablishing) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeout = setTimeout(() => {\n\t\t\totr.establishing.set(false);\n\t\t\tsetModal(<OTRModal onConfirm={closeModal} onCancel={closeModal} />);\n\t\t}, 10000);\n\n\t\treturn () => clearTimeout(timeout);\n\t}, [closeModal, isEstablished, isEstablishing, setModal, otr]);\n\n\treturn (\n\t\t<OTR\n\t\t\tisOnline={isOnline}\n\t\t\tisEstablishing={isEstablishing}\n\t\t\tisEstablished={isEstablished}\n\t\t\tonClickClose={onClickClose}\n\t\t\tonClickStart={handleStart}\n\t\t\tonClickEnd={handleEnd}\n\t\t\tonClickRefresh={handleReset}\n\t\t/>\n\t);\n};\n\nexport default OTRWithData;\n"]}