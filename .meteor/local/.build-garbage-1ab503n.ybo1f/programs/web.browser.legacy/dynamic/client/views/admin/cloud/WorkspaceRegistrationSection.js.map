{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/cloud/WorkspaceRegistrationSection.js"],"names":["_regeneratorRuntime","module","link","default","v","_extends","_slicedToArray","_objectWithoutProperties","Box","Button","ButtonGroup","Field","Margins","TextInput","useSafely","useUniqueId","React","useState","useMethod","useToastMessageDispatch","useTranslation","WorkspaceRegistrationSection","initialToken","token","workspaceId","uniqueId","onRegisterStatusChange","props","t","dispatchToastMessage","connectWorkspace","syncWorkspace","isProcessing","setProcessing","setToken","handleTokenChange","value","currentTarget","handleConnectButtonClick","isConnected","Error","type","message","isSynced","tokenInputId","exportDefault"],"mappings":"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","file":"dynamic/client/views/admin/cloud/WorkspaceRegistrationSection.js","sourcesContent":["import { Box, Button, ButtonGroup, Field, Margins, TextInput } from '@rocket.chat/fuselage';\nimport { useSafely, useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport React, { useState } from 'react';\n\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\n\nfunction WorkspaceRegistrationSection({ token: initialToken, workspaceId, uniqueId, onRegisterStatusChange, ...props }) {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst connectWorkspace = useMethod('cloud:connectWorkspace');\n\tconst syncWorkspace = useMethod('cloud:syncWorkspace');\n\n\tconst [isProcessing, setProcessing] = useSafely(useState(false));\n\tconst [token, setToken] = useState(initialToken);\n\n\tconst handleTokenChange = ({ currentTarget: { value } }) => {\n\t\tsetToken(value);\n\t};\n\n\tconst handleConnectButtonClick = async () => {\n\t\tsetProcessing(true);\n\n\t\ttry {\n\t\t\tconst isConnected = await connectWorkspace(token);\n\n\t\t\tif (!isConnected) {\n\t\t\t\tthrow Error(t('An error occured connecting'));\n\t\t\t}\n\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Connected') });\n\n\t\t\tconst isSynced = await syncWorkspace();\n\n\t\t\tif (!isSynced) {\n\t\t\t\tthrow Error(t('An error occured syncing'));\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t} finally {\n\t\t\tawait (onRegisterStatusChange && onRegisterStatusChange());\n\t\t\tsetProcessing(false);\n\t\t}\n\t};\n\n\tconst tokenInputId = useUniqueId();\n\n\treturn (\n\t\t<Box marginBlock='neg-x24' {...props}>\n\t\t\t<Margins block='x24'>\n\t\t\t\t<Box withRichContent color='neutral-800'>\n\t\t\t\t\t<p>{t('Cloud_token_instructions')}</p>\n\t\t\t\t</Box>\n\n\t\t\t\t<Field>\n\t\t\t\t\t<Field.Label htmlFor={tokenInputId}>{t('Token')}</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<TextInput id={tokenInputId} disabled={isProcessing} value={token} onChange={handleTokenChange} />\n\t\t\t\t\t</Field.Row>\n\t\t\t\t\t<Field.Hint>{t('Cloud_manually_input_token')}</Field.Hint>\n\t\t\t\t</Field>\n\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t<Button primary disabled={isProcessing} onClick={handleConnectButtonClick}>\n\t\t\t\t\t\t{t('Connect')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Margins>\n\t\t</Box>\n\t);\n}\n\nexport default WorkspaceRegistrationSection;\n"]}