{"version":3,"sources":["meteor://ðŸ’»app/client/views/omnichannel/triggers/EditTriggerPage.js"],"names":["_regeneratorRuntime","module","link","default","v","_objectSpread","_objectWithoutProperties","_slicedToArray","Margins","FieldGroup","Box","Button","useMutableCallback","React","useRoute","useMethod","useToastMessageDispatch","useTranslation","useForm","TriggersForm","getInitialValues","name","description","enabled","runOnce","conditions","condName","condValue","value","actions","actName","action","params","actSender","sender","actMsg","msg","actSenderName","EditTriggerPage","data","onSave","dispatchToastMessage","t","router","save","values","handlers","hasUnsavedChanges","handleSave","restValues","_id","type","message","push","canSave","exportDefault"],"mappings":"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","file":"dynamic/client/views/omnichannel/triggers/EditTriggerPage.js","sourcesContent":["import { Margins, FieldGroup, Box, Button } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React from 'react';\n\nimport { useRoute } from '../../../contexts/RouterContext';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useForm } from '../../../hooks/useForm';\nimport TriggersForm from './TriggersForm';\n\nconst getInitialValues = ({\n\tname,\n\tdescription,\n\tenabled,\n\trunOnce,\n\tconditions: [{ name: condName, value: condValue }],\n\tactions: [\n\t\t{\n\t\t\taction: actName,\n\t\t\tparams: { sender: actSender, msg: actMsg, name: actSenderName },\n\t\t},\n\t],\n}) => ({\n\tname: name ?? '',\n\tdescription: description ?? '',\n\tenabled: !!enabled,\n\trunOnce: !!runOnce,\n\tconditions: {\n\t\tname: condName ?? 'page-url',\n\t\tvalue: condValue ?? '',\n\t},\n\tactions: {\n\t\tname: actName ?? '',\n\t\tparams: {\n\t\t\tsender: actSender ?? 'queue',\n\t\t\tmsg: actMsg ?? '',\n\t\t\tname: actSenderName ?? '',\n\t\t},\n\t},\n});\n\nconst EditTriggerPage = ({ data, onSave }) => {\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst t = useTranslation();\n\n\tconst router = useRoute('omnichannel-triggers');\n\n\tconst save = useMethod('livechat:saveTrigger');\n\n\tconst { values, handlers, hasUnsavedChanges } = useForm(getInitialValues(data));\n\n\tconst handleSave = useMutableCallback(async () => {\n\t\ttry {\n\t\t\tconst {\n\t\t\t\tactions: {\n\t\t\t\t\tparams: { sender, msg, name },\n\t\t\t\t},\n\t\t\t\t...restValues\n\t\t\t} = values;\n\t\t\tawait save({\n\t\t\t\t_id: data._id,\n\t\t\t\t...restValues,\n\t\t\t\tconditions: [values.conditions],\n\t\t\t\tactions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'send-message',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tsender,\n\t\t\t\t\t\t\tmsg,\n\t\t\t\t\t\t\t...(sender === 'custom' && { name }),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Saved') });\n\t\t\tonSave();\n\t\t\trouter.push({});\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tconst { name } = values;\n\n\tconst canSave = name && hasUnsavedChanges;\n\n\treturn (\n\t\t<>\n\t\t\t<FieldGroup>\n\t\t\t\t<TriggersForm values={values} handlers={handlers} />\n\t\t\t</FieldGroup>\n\t\t\t<Box display='flex' flexDirection='row' justifyContent='space-between' w='full'>\n\t\t\t\t<Margins inlineEnd='x4'>\n\t\t\t\t\t<Button flexGrow={1} primary onClick={handleSave} disabled={!canSave}>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t</Margins>\n\t\t\t</Box>\n\t\t</>\n\t);\n};\n\nexport default EditTriggerPage;\n"]}