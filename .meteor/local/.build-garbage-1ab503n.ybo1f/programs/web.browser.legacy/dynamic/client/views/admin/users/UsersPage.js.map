{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/users/UsersPage.js"],"names":["_slicedToArray","module","link","default","v","_objectSpread","useDebouncedValue","React","useEffect","useMemo","useState","UserPageHeaderContentWithSeatsCap","useSeatsCap","Page","VerticalBar","useRoute","useRouteParameter","useTranslation","useEndpointData","AddUser","EditUserWithData","InviteUsers","UserInfoWithData","UserPageHeaderContent","UsersTable","sortDir","useQuery","sortFields","text","itemsPerPage","current","fields","JSON","stringify","name","username","emails","roles","status","avatarETag","active","query","$or","$regex","$options","sort","reduce","agg","column","direction","count","offset","UsersPage","context","id","seatsCap","usersRoute","activeUsers","maxActiveUsers","includes","push","t","handleVerticalBarCloseButtonClick","params","setParams","setSort","debouncedParams","debouncedSort","value","data","reloadList","reload","Number","POSITIVE_INFINITY","users","total","exportDefault"],"mappings":"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","file":"dynamic/client/views/admin/users/UsersPage.js","sourcesContent":["import { useDebouncedValue } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, useMemo, useState } from 'react';\n\nimport UserPageHeaderContentWithSeatsCap from '../../../../ee/client/views/admin/users/UserPageHeaderContentWithSeatsCap';\nimport { useSeatsCap } from '../../../../ee/client/views/admin/users/useSeatsCap';\nimport Page from '../../../components/Page';\nimport VerticalBar from '../../../components/VerticalBar';\nimport { useRoute, useRouteParameter } from '../../../contexts/RouterContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useEndpointData } from '../../../hooks/useEndpointData';\nimport { AddUser } from './AddUser';\nimport EditUserWithData from './EditUserWithData';\nimport { InviteUsers } from './InviteUsers';\nimport { UserInfoWithData } from './UserInfo';\nimport UserPageHeaderContent from './UserPageHeaderContent';\nimport UsersTable from './UsersTable';\n\nconst sortDir = (sortDir) => (sortDir === 'asc' ? 1 : -1);\n\nconst useQuery = ({ text, itemsPerPage, current }, sortFields) =>\n\tuseMemo(\n\t\t() => ({\n\t\t\tfields: JSON.stringify({\n\t\t\t\tname: 1,\n\t\t\t\tusername: 1,\n\t\t\t\temails: 1,\n\t\t\t\troles: 1,\n\t\t\t\tstatus: 1,\n\t\t\t\tavatarETag: 1,\n\t\t\t\tactive: 1,\n\t\t\t}),\n\t\t\tquery: JSON.stringify({\n\t\t\t\t$or: [\n\t\t\t\t\t{ 'emails.address': { $regex: text || '', $options: 'i' } },\n\t\t\t\t\t{ username: { $regex: text || '', $options: 'i' } },\n\t\t\t\t\t{ name: { $regex: text || '', $options: 'i' } },\n\t\t\t\t],\n\t\t\t}),\n\t\t\tsort: JSON.stringify(\n\t\t\t\tsortFields.reduce((agg, [column, direction]) => {\n\t\t\t\t\tagg[column] = sortDir(direction);\n\t\t\t\t\treturn agg;\n\t\t\t\t}, {}),\n\t\t\t),\n\t\t\t...(itemsPerPage && { count: itemsPerPage }),\n\t\t\t...(current && { offset: current }),\n\t\t}),\n\t\t[text, itemsPerPage, current, sortFields],\n\t);\n\nfunction UsersPage() {\n\tconst context = useRouteParameter('context');\n\tconst id = useRouteParameter('id');\n\tconst seatsCap = useSeatsCap();\n\tconst usersRoute = useRoute('admin-users');\n\n\tuseEffect(() => {\n\t\tif (!context || !seatsCap) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (seatsCap.activeUsers >= seatsCap.maxActiveUsers && !['edit', 'info'].includes(context)) {\n\t\t\tusersRoute.push({});\n\t\t}\n\t}, [context, seatsCap, usersRoute]);\n\n\tconst t = useTranslation();\n\n\tconst handleVerticalBarCloseButtonClick = () => {\n\t\tusersRoute.push({});\n\t};\n\tconst [params, setParams] = useState({ text: '', current: 0, itemsPerPage: 25 });\n\tconst [sort, setSort] = useState([\n\t\t['name', 'asc'],\n\t\t['usernames', 'asc'],\n\t]);\n\n\tconst debouncedParams = useDebouncedValue(params, 500);\n\tconst debouncedSort = useDebouncedValue(sort, 500);\n\tconst query = useQuery(debouncedParams, debouncedSort);\n\tconst { value: data = {}, reload: reloadList } = useEndpointData('users.list', query);\n\n\tconst reload = () => {\n\t\tseatsCap?.reload();\n\t\treloadList();\n\t};\n\n\treturn (\n\t\t<Page flexDirection='row'>\n\t\t\t<Page>\n\t\t\t\t<Page.Header title={t('Users')}>\n\t\t\t\t\t{seatsCap &&\n\t\t\t\t\t\t(seatsCap.maxActiveUsers < Number.POSITIVE_INFINITY ? (\n\t\t\t\t\t\t\t<UserPageHeaderContentWithSeatsCap {...seatsCap} />\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<UserPageHeaderContent />\n\t\t\t\t\t\t))}\n\t\t\t\t</Page.Header>\n\t\t\t\t<Page.Content>\n\t\t\t\t\t<UsersTable users={data.users} total={data.total} params={params} onChangeParams={setParams} sort={sort} onChangeSort={setSort} />\n\t\t\t\t</Page.Content>\n\t\t\t</Page>\n\t\t\t{context && (\n\t\t\t\t<VerticalBar>\n\t\t\t\t\t<VerticalBar.Header>\n\t\t\t\t\t\t{context === 'info' && t('User_Info')}\n\t\t\t\t\t\t{context === 'edit' && t('Edit_User')}\n\t\t\t\t\t\t{context === 'new' && t('Add_User')}\n\t\t\t\t\t\t{context === 'invite' && t('Invite_Users')}\n\t\t\t\t\t\t<VerticalBar.Close onClick={handleVerticalBarCloseButtonClick} />\n\t\t\t\t\t</VerticalBar.Header>\n\n\t\t\t\t\t{context === 'info' && id && <UserInfoWithData uid={id} onReload={reload} />}\n\t\t\t\t\t{context === 'edit' && <EditUserWithData uid={id} onReload={reload} />}\n\t\t\t\t\t{context === 'new' && <AddUser onReload={reload} />}\n\t\t\t\t\t{context === 'invite' && <InviteUsers />}\n\t\t\t\t</VerticalBar>\n\t\t\t)}\n\t\t</Page>\n\t);\n}\n\nexport default UsersPage;\n"]}