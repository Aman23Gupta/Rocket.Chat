{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/apps/hooks/useAppInfo.ts"],"names":[],"mappings":"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","file":"dynamic/client/views/admin/apps/hooks/useAppInfo.ts","sourcesContent":["import { IApiEndpointMetadata } from '@rocket.chat/apps-engine/definition/api';\nimport { AppSettingsManager } from '@rocket.chat/apps-engine/server/managers/AppSettingsManager';\nimport { useState, useEffect, useContext } from 'react';\n\nimport { Apps } from '../../../../../app/apps/client/orchestrator';\nimport { AppsContext } from '../AppsContext';\nimport { AppInfo } from '../definitions/AppInfo';\nimport { handleAPIError } from '../helpers';\nimport { App } from '../types';\n\nconst getBundledIn = async (appId: string, appVersion: string): Promise<App['bundledIn']> => {\n\ttry {\n\t\tconst { bundledIn } = (await Apps.getLatestAppFromMarketplace(appId, appVersion)) as App;\n\t\tif (!bundledIn) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn await Promise.all(\n\t\t\tbundledIn.map(async (bundle) => {\n\t\t\t\tconst apps = await Apps.getAppsOnBundle(bundle.bundleId);\n\t\t\t\tbundle.apps = apps.slice(0, 4);\n\t\t\t\treturn bundle;\n\t\t\t}),\n\t\t);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn [];\n\t}\n};\n\nconst getSettings = async (appId: string, installed: boolean): Promise<ReturnType<AppSettingsManager['getAppSettings']>> => {\n\tif (!installed) {\n\t\treturn {};\n\t}\n\n\ttry {\n\t\treturn Apps.getAppSettings(appId);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn {};\n\t}\n};\n\nconst getApis = async (appId: string, installed: boolean): Promise<Array<IApiEndpointMetadata>> => {\n\tif (!installed) {\n\t\treturn [];\n\t}\n\n\ttry {\n\t\treturn Apps.getAppApis(appId);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn [];\n\t}\n};\n\nexport const useAppInfo = (appId: string): AppInfo | undefined => {\n\tconst { installedApps, marketplaceApps } = useContext(AppsContext);\n\n\tconst [appData, setAppData] = useState<AppInfo>();\n\n\tuseEffect(() => {\n\t\tconst apps: App[] = [];\n\n\t\tif (marketplaceApps.value) {\n\t\t\tapps.push(...marketplaceApps.value.apps);\n\t\t}\n\n\t\tif (installedApps.value) {\n\t\t\tapps.push(...installedApps.value.apps);\n\t\t}\n\n\t\tconst fetchAppInfo = async (): Promise<void> => {\n\t\t\tif (!apps?.length || !appId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst app = apps.find((app) => app.id === appId) ?? {\n\t\t\t\t...(await Apps.getApp(appId)),\n\t\t\t\tinstalled: true,\n\t\t\t\tmarketplace: false,\n\t\t\t};\n\n\t\t\tconst [bundledIn, settings, apis] = await Promise.all([\n\t\t\t\tapp.marketplace === false ? [] : getBundledIn(app.id, app.version),\n\t\t\t\tgetSettings(app.id, app.installed),\n\t\t\t\tgetApis(app.id, app.installed),\n\t\t\t]);\n\t\t\tsetAppData({ ...app, bundledIn, settings, apis });\n\t\t};\n\n\t\tfetchAppInfo();\n\t}, [appId, installedApps, marketplaceApps]);\n\n\treturn appData;\n};\n"]}