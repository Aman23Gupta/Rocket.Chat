{"version":3,"sources":["meteor://ðŸ’»app/client/views/omnichannel/businessHours/BusinessHoursFormContainer.js"],"names":["_slicedToArray","module","link","default","v","_objectSpread","FieldGroup","Box","useMutableCallback","React","useEffect","useState","useSubscription","businessHourManager","useForm","useReactiveValue","formsSubscription","BusinessHourForm","useChangeHandler","name","ref","val","current","getInitalData","workHours","daysOpen","filter","open","map","day","daysTime","reduce","acc","start","time","finish","cleanFunc","BusinessHoursFormContainer","data","saveRef","onChange","forms","hasChangesMultiple","setHasChangesMultiple","hasChangesTimeZone","setHasChangesTimeZone","useBusinessHoursTimeZone","useBusinessHoursMultiple","TimezoneForm","MultipleBHForm","showTimezone","showTimezoneTemplate","showMultipleBHForm","showCustomTemplate","onChangeTimezone","onChangeMultipleBHForm","values","handlers","hasUnsavedChanges","form","timezone","timezoneName","exportDefault"],"mappings":"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","file":"dynamic/client/views/omnichannel/businessHours/BusinessHoursFormContainer.js","sourcesContent":["import { FieldGroup, Box } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, useState } from 'react';\nimport { useSubscription } from 'use-subscription';\n\nimport { businessHourManager } from '../../../../app/livechat/client/views/app/business-hours/BusinessHours';\nimport { useForm } from '../../../hooks/useForm';\nimport { useReactiveValue } from '../../../hooks/useReactiveValue';\nimport { formsSubscription } from '../additionalForms';\nimport BusinessHourForm from './BusinessHoursForm';\n\nconst useChangeHandler = (name, ref) =>\n\tuseMutableCallback((val) => {\n\t\tref.current[name] = { ...ref.current[name], ...val };\n\t});\n\nconst getInitalData = ({ workHours }) => ({\n\tdaysOpen: workHours.filter(({ open }) => !!open).map(({ day }) => day),\n\tdaysTime: workHours.reduce((acc, { day, start: { time: start }, finish: { time: finish } }) => {\n\t\tacc = { ...acc, [day]: { start, finish } };\n\t\treturn acc;\n\t}, {}),\n});\n\nconst cleanFunc = () => {};\n\nconst BusinessHoursFormContainer = ({ data, saveRef, onChange = () => {} }) => {\n\tconst forms = useSubscription(formsSubscription);\n\n\tconst [hasChangesMultiple, setHasChangesMultiple] = useState(false);\n\tconst [hasChangesTimeZone, setHasChangesTimeZone] = useState(false);\n\n\tconst { useBusinessHoursTimeZone = cleanFunc, useBusinessHoursMultiple = cleanFunc } = forms;\n\n\tconst TimezoneForm = useBusinessHoursTimeZone();\n\tconst MultipleBHForm = useBusinessHoursMultiple();\n\n\tconst showTimezone = useReactiveValue(useMutableCallback(() => businessHourManager.showTimezoneTemplate()));\n\tconst showMultipleBHForm = useReactiveValue(useMutableCallback(() => businessHourManager.showCustomTemplate(data)));\n\n\tconst onChangeTimezone = useChangeHandler('timezone', saveRef);\n\tconst onChangeMultipleBHForm = useChangeHandler('multiple', saveRef);\n\n\tconst { values, handlers, hasUnsavedChanges } = useForm(getInitalData(data));\n\n\tsaveRef.current.form = values;\n\n\tuseEffect(() => {\n\t\tonChange(hasUnsavedChanges || (showMultipleBHForm && hasChangesMultiple) || (showTimezone && hasChangesTimeZone));\n\t});\n\n\treturn (\n\t\t<Box maxWidth='600px' w='full' alignSelf='center'>\n\t\t\t<FieldGroup>\n\t\t\t\t{showMultipleBHForm && MultipleBHForm && (\n\t\t\t\t\t<MultipleBHForm onChange={onChangeMultipleBHForm} data={data} hasChangesAndIsValid={setHasChangesMultiple} />\n\t\t\t\t)}\n\t\t\t\t{showTimezone && TimezoneForm && (\n\t\t\t\t\t<TimezoneForm onChange={onChangeTimezone} data={data?.timezone?.name ?? data?.timezoneName} hasChanges={setHasChangesTimeZone} />\n\t\t\t\t)}\n\t\t\t\t<BusinessHourForm values={values} handlers={handlers} />\n\t\t\t</FieldGroup>\n\t\t</Box>\n\t);\n};\n\nexport default BusinessHoursFormContainer;\n"]}