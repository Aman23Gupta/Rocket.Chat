{"version":3,"sources":["meteor://ðŸ’»app/client/views/account/tokens/AccountTokensTable.js"],"names":["_regeneratorRuntime","module","link","default","v","_extends","_slicedToArray","Box","React","useMemo","useCallback","useState","GenericTable","useSetModal","useMethod","useToastMessageDispatch","useTranslation","useUserId","useResizeInlineBreakpoint","AccountTokensRow","InfoModal","AccountTokensTable","data","reload","t","dispatchToastMessage","setModal","userId","regenerateToken","removeToken","ref","isMedium","current","itemsPerPage","params","setParams","tokensTotal","success","tokens","length","sliceStart","slice","closeModal","header","filter","Boolean","onRegenerate","name","onConfirm","tokenName","token","__html","type","message","onRemove","props","exportDefault"],"mappings":"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","file":"dynamic/client/views/account/tokens/AccountTokensTable.js","sourcesContent":["import { Box } from '@rocket.chat/fuselage';\nimport React, { useMemo, useCallback, useState } from 'react';\n\nimport GenericTable from '../../../components/GenericTable';\nimport { useSetModal } from '../../../contexts/ModalContext';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useUserId } from '../../../contexts/UserContext';\nimport { useResizeInlineBreakpoint } from '../../../hooks/useResizeInlineBreakpoint';\nimport AccountTokensRow from './AccountTokensRow';\nimport InfoModal from './InfoModal';\n\nconst AccountTokensTable = ({ data, reload }) => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst setModal = useSetModal();\n\n\tconst userId = useUserId();\n\n\tconst regenerateToken = useMethod('personalAccessTokens:regenerateToken');\n\tconst removeToken = useMethod('personalAccessTokens:removeToken');\n\n\tconst [ref, isMedium] = useResizeInlineBreakpoint([600], 200);\n\n\tconst [params, setParams] = useState({ current: 0, itemsPerPage: 25 });\n\n\tconst tokensTotal = data && data.success ? data.tokens.length : 0;\n\n\tconst { current, itemsPerPage } = params;\n\n\tconst tokens = useMemo(() => {\n\t\tif (!data) {\n\t\t\treturn null;\n\t\t}\n\t\tif (!data.success) {\n\t\t\treturn [];\n\t\t}\n\t\tconst sliceStart = current > tokensTotal ? tokensTotal - itemsPerPage : current;\n\t\treturn data.tokens.slice(sliceStart, sliceStart + itemsPerPage);\n\t}, [current, data, itemsPerPage, tokensTotal]);\n\n\tconst closeModal = useCallback(() => setModal(null), [setModal]);\n\n\tconst header = useMemo(\n\t\t() =>\n\t\t\t[\n\t\t\t\t<GenericTable.HeaderCell key={'name'}>{t('API_Personal_Access_Token_Name')}</GenericTable.HeaderCell>,\n\t\t\t\tisMedium && <GenericTable.HeaderCell key={'createdAt'}>{t('Created_at')}</GenericTable.HeaderCell>,\n\t\t\t\t<GenericTable.HeaderCell key={'lastTokenPart'}>{t('Last_token_part')}</GenericTable.HeaderCell>,\n\t\t\t\t<GenericTable.HeaderCell key={'2fa'}>{t('Two Factor Authentication')}</GenericTable.HeaderCell>,\n\t\t\t\t<GenericTable.HeaderCell key={'actions'} />,\n\t\t\t].filter(Boolean),\n\t\t[isMedium, t],\n\t);\n\n\tconst onRegenerate = useCallback(\n\t\t(name) => {\n\t\t\tconst onConfirm = async () => {\n\t\t\t\ttry {\n\t\t\t\t\tsetModal(null);\n\n\t\t\t\t\tconst token = await regenerateToken({ tokenName: name });\n\n\t\t\t\t\tsetModal(\n\t\t\t\t\t\t<InfoModal\n\t\t\t\t\t\t\ttitle={t('API_Personal_Access_Token_Generated')}\n\t\t\t\t\t\t\tcontent={\n\t\t\t\t\t\t\t\t<Box\n\t\t\t\t\t\t\t\t\tdangerouslySetInnerHTML={{\n\t\t\t\t\t\t\t\t\t\t__html: t('API_Personal_Access_Token_Generated_Text_Token_s_UserId_s', {\n\t\t\t\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t\t\t\t\tuserId,\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconfirmText={t('ok')}\n\t\t\t\t\t\t\tonConfirm={closeModal}\n\t\t\t\t\t\t/>,\n\t\t\t\t\t);\n\n\t\t\t\t\treload();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tsetModal(null);\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: e });\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tsetModal(\n\t\t\t\t<InfoModal\n\t\t\t\t\ttitle={t('Are_you_sure')}\n\t\t\t\t\tcontent={t('API_Personal_Access_Tokens_Regenerate_Modal')}\n\t\t\t\t\tconfirmText={t('API_Personal_Access_Tokens_Regenerate_It')}\n\t\t\t\t\tonConfirm={onConfirm}\n\t\t\t\t\tcancelText={t('Cancel')}\n\t\t\t\t\tonClose={closeModal}\n\t\t\t\t/>,\n\t\t\t);\n\t\t},\n\t\t[closeModal, dispatchToastMessage, regenerateToken, reload, setModal, t, userId],\n\t);\n\n\tconst onRemove = useCallback(\n\t\t(name) => {\n\t\t\tconst onConfirm = async () => {\n\t\t\t\ttry {\n\t\t\t\t\tawait removeToken({ tokenName: name });\n\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Removed') });\n\t\t\t\t\treload();\n\t\t\t\t\tcloseModal();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: e });\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tsetModal(\n\t\t\t\t<InfoModal\n\t\t\t\t\ttitle={t('Are_you_sure')}\n\t\t\t\t\tcontent={t('API_Personal_Access_Tokens_Remove_Modal')}\n\t\t\t\t\tconfirmText={t('Yes')}\n\t\t\t\t\tonConfirm={onConfirm}\n\t\t\t\t\tcancelText={t('Cancel')}\n\t\t\t\t\tonClose={closeModal}\n\t\t\t\t/>,\n\t\t\t);\n\t\t},\n\t\t[closeModal, dispatchToastMessage, reload, removeToken, setModal, t],\n\t);\n\n\treturn (\n\t\t<GenericTable ref={ref} header={header} results={tokens} total={tokensTotal} setParams={setParams} params={params}>\n\t\t\t{useCallback(\n\t\t\t\t(props) => (\n\t\t\t\t\t<AccountTokensRow onRegenerate={onRegenerate} onRemove={onRemove} isMedium={isMedium} {...props} />\n\t\t\t\t),\n\t\t\t\t[isMedium, onRegenerate, onRemove],\n\t\t\t)}\n\t\t</GenericTable>\n\t);\n};\n\nexport default AccountTokensTable;\n"]}