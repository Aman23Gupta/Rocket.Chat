{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/apps/AppsProvider.tsx"],"names":[],"mappings":"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","file":"dynamic/client/views/admin/apps/AppsProvider.tsx","sourcesContent":["import { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, FC, useReducer, Reducer, useCallback } from 'react';\n\nimport { AppEvents } from '../../../../app/apps/client/communication';\nimport { Apps } from '../../../../app/apps/client/orchestrator';\nimport { AsyncState, AsyncStatePhase } from '../../../lib/asyncState';\nimport { AppsContext } from './AppsContext';\nimport { handleAPIError } from './helpers';\nimport { App } from './types';\n\ntype ListenersMapping = {\n\treadonly [P in keyof typeof AppEvents]?: (...args: any[]) => void;\n};\n\nconst registerListeners = (listeners: ListenersMapping): (() => void) => {\n\tconst entries = Object.entries(listeners) as Exclude<\n\t\t{\n\t\t\t[K in keyof ListenersMapping]: [K, ListenersMapping[K]];\n\t\t}[keyof ListenersMapping],\n\t\tundefined\n\t>[];\n\tfor (const [event, callback] of entries) {\n\t\tApps.getWsListener()?.registerListener(AppEvents[event], callback);\n\t}\n\treturn (): void => {\n\t\tfor (const [event, callback] of entries) {\n\t\t\tApps.getWsListener()?.unregisterListener(AppEvents[event], callback);\n\t\t}\n\t};\n};\n\ntype Action =\n\t| { type: 'request'; reload: () => Promise<void> }\n\t| { type: 'update'; app: App; reload: () => Promise<void> }\n\t| { type: 'delete'; appId: string; reload: () => Promise<void> }\n\t| { type: 'invalidate'; appId: string; reload: () => Promise<void> }\n\t| { type: 'success'; apps: App[]; reload: () => Promise<void> }\n\t| { type: 'failure'; error: Error; reload: () => Promise<void> };\n\nconst sortByName = (apps: App[]): App[] => apps.sort((a, b) => (a.name.toLowerCase() > b.name.toLowerCase() ? 1 : -1));\n\nconst reducer = (\n\tstate: AsyncState<{ apps: App[] }> & {\n\t\treload: () => Promise<void>;\n\t},\n\taction: Action,\n): AsyncState<{ apps: App[] }> & {\n\treload: () => Promise<void>;\n} => {\n\tswitch (action.type) {\n\t\tcase 'invalidate':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\treload: action.reload,\n\t\t\t\tvalue: {\n\t\t\t\t\tapps: sortByName(\n\t\t\t\t\t\tstate.value.apps.map((app) => {\n\t\t\t\t\t\t\tif (app.id === action.appId) {\n\t\t\t\t\t\t\t\treturn { ...app };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn app;\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'update':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\treload: async (): Promise<void> => undefined,\n\t\t\t\tvalue: {\n\t\t\t\t\tapps: sortByName(\n\t\t\t\t\t\tstate.value.apps.map((app) => {\n\t\t\t\t\t\t\tif (app.id === action.app.id) {\n\t\t\t\t\t\t\t\treturn action.app;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn app;\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'request':\n\t\t\treturn {\n\t\t\t\treload: async (): Promise<void> => undefined,\n\t\t\t\tphase: AsyncStatePhase.LOADING,\n\t\t\t\tvalue: undefined,\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'success':\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\tvalue: { apps: sortByName(action.apps) },\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'delete':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\tvalue: { apps: state.value.apps.filter(({ id }) => id !== action.appId) },\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'failure':\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.REJECTED,\n\t\t\t\tvalue: undefined,\n\t\t\t\terror: action.error,\n\t\t\t};\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nconst AppsProvider: FC = ({ children }) => {\n\tconst [marketplaceAppsState, dispatchMarketplaceApps] = useReducer<\n\t\tReducer<\n\t\t\tAsyncState<{ apps: App[] }> & {\n\t\t\t\treload: () => Promise<void>;\n\t\t\t},\n\t\t\tAction\n\t\t>\n\t>(reducer, {\n\t\tphase: AsyncStatePhase.LOADING,\n\t\tvalue: undefined,\n\t\terror: undefined,\n\t\treload: async () => undefined,\n\t});\n\n\tconst [installedAppsState, dispatchInstalledApps] = useReducer<\n\t\tReducer<\n\t\t\tAsyncState<{ apps: App[] }> & {\n\t\t\t\treload: () => Promise<void>;\n\t\t\t},\n\t\t\tAction\n\t\t>\n\t>(reducer, {\n\t\tphase: AsyncStatePhase.LOADING,\n\t\tvalue: undefined,\n\t\terror: undefined,\n\t\treload: async () => undefined,\n\t});\n\n\tconst fetch = useCallback(async (): Promise<void> => {\n\t\tdispatchMarketplaceApps({ type: 'request', reload: async () => undefined });\n\t\tdispatchInstalledApps({ type: 'request', reload: async () => undefined });\n\n\t\tlet installedApps: App[] = [];\n\t\tlet marketplaceApps: App[] = [];\n\t\tlet marketplaceError = false;\n\t\tlet installedAppsError = false;\n\n\t\ttry {\n\t\t\tmarketplaceApps = (await Apps.getAppsFromMarketplace()) as App[];\n\t\t} catch (e) {\n\t\t\tdispatchMarketplaceApps({\n\t\t\t\ttype: 'failure',\n\t\t\t\terror: e,\n\t\t\t\treload: fetch,\n\t\t\t});\n\t\t\tmarketplaceError = true;\n\t\t}\n\n\t\ttry {\n\t\t\tinstalledApps = await Apps.getApps().then((result: App[]) =>\n\t\t\t\tresult.map((current: App) => ({\n\t\t\t\t\t...current,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\tmarketplace: false,\n\t\t\t\t})),\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tdispatchInstalledApps({\n\t\t\t\ttype: 'failure',\n\t\t\t\terror: e,\n\t\t\t\treload: fetch,\n\t\t\t});\n\t\t\tinstalledAppsError = true;\n\t\t}\n\n\t\tconst installedAppsData: App[] = [];\n\t\tconst marketplaceAppsData: App[] = [];\n\n\t\tif (!marketplaceError) {\n\t\t\tmarketplaceApps.forEach((app) => {\n\t\t\t\tconst appIndex = installedApps.findIndex(({ id }) => id === app.id);\n\t\t\t\tif (!installedApps[appIndex]) {\n\t\t\t\t\tmarketplaceAppsData.push({\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus: undefined,\n\t\t\t\t\t\tmarketplaceVersion: app.version,\n\t\t\t\t\t\tbundledIn: app.bundledIn,\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst [installedApp] = installedApps.splice(appIndex, 1);\n\t\t\t\tconst appData = {\n\t\t\t\t\t...app,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\t...(installedApp && {\n\t\t\t\t\t\tstatus: installedApp.status,\n\t\t\t\t\t\tversion: installedApp.version,\n\t\t\t\t\t\tlicenseValidation: installedApp.licenseValidation,\n\t\t\t\t\t}),\n\t\t\t\t\tbundledIn: app.bundledIn,\n\t\t\t\t\tmarketplaceVersion: app.version,\n\t\t\t\t};\n\n\t\t\t\tinstalledAppsData.push(appData);\n\t\t\t\tmarketplaceAppsData.push(appData);\n\t\t\t});\n\t\t\tdispatchMarketplaceApps({\n\t\t\t\ttype: 'success',\n\t\t\t\treload: fetch,\n\t\t\t\tapps: marketplaceAppsData,\n\t\t\t});\n\t\t}\n\n\t\tif (!installedAppsError) {\n\t\t\tif (installedApps.length) {\n\t\t\t\tinstalledAppsData.push(...installedApps);\n\t\t\t}\n\n\t\t\tdispatchInstalledApps({\n\t\t\t\ttype: 'success',\n\t\t\t\treload: fetch,\n\t\t\t\tapps: installedAppsData,\n\t\t\t});\n\t\t}\n\t}, []);\n\n\tconst getCurrentData = useMutableCallback(function getCurrentData() {\n\t\treturn [marketplaceAppsState, installedAppsState];\n\t});\n\n\tuseEffect(() => {\n\t\tconst handleAppAddedOrUpdated = async (appId: string): Promise<void> => {\n\t\t\tlet marketplaceApp: App | undefined;\n\t\t\tlet installedApp: App;\n\n\t\t\ttry {\n\t\t\t\tinstalledApp = await Apps.getApp(appId);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t\tthrow error;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tmarketplaceApp = await Apps.getAppFromMarketplace(appId, installedApp.version);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\n\t\t\tif (marketplaceApp !== undefined) {\n\t\t\t\tconst { status, version, licenseValidation } = installedApp;\n\t\t\t\tconst record = {\n\t\t\t\t\t...marketplaceApp,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\tstatus,\n\t\t\t\t\tversion,\n\t\t\t\t\tlicenseValidation,\n\t\t\t\t\tmarketplaceVersion: marketplaceApp.version,\n\t\t\t\t};\n\n\t\t\t\tconst [, installedApps] = getCurrentData();\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: record,\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tif (installedApps.value) {\n\t\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\tapps: [...installedApps.value.apps, record],\n\t\t\t\t\t\treload: fetch,\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\tapps: [record],\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdispatchInstalledApps({ type: 'update', app: installedApp, reload: fetch });\n\t\t};\n\t\tconst listeners = {\n\t\t\tAPP_ADDED: handleAppAddedOrUpdated,\n\t\t\tAPP_UPDATED: handleAppAddedOrUpdated,\n\t\t\tAPP_REMOVED: (appId: string): void => {\n\t\t\t\tconst [updatedData] = getCurrentData();\n\t\t\t\tconst app = updatedData.value?.apps.find(({ id }: { id: string }) => id === appId);\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'delete',\n\t\t\t\t\tappId,\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tif (!app) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\treload: fetch,\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tversion: app?.marketplaceVersion,\n\t\t\t\t\t\tinstalled: false,\n\t\t\t\t\t\tmarketplaceVersion: app?.marketplaceVersion,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tAPP_STATUS_CHANGE: ({ appId, status }: { appId: string; status: AppStatus }): void => {\n\t\t\t\tconst [updatedData] = getCurrentData();\n\t\t\t\tconst app = updatedData.value?.apps.find(({ id }: { id: string }) => id === appId);\n\t\t\t\tif (!app) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tapp.status = status;\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t},\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t},\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\t\t\t},\n\t\t\tAPP_SETTING_UPDATED: ({ appId }: { appId: string }): void => {\n\t\t\t\tdispatchInstalledApps({ type: 'invalidate', appId, reload: fetch });\n\t\t\t\tdispatchMarketplaceApps({ type: 'invalidate', appId, reload: fetch });\n\t\t\t},\n\t\t};\n\t\tconst unregisterListeners = registerListeners(listeners);\n\t\ttry {\n\t\t\tfetch();\n\t\t} finally {\n\t\t\t// eslint-disable-next-line no-unsafe-finally\n\t\t\treturn unregisterListeners;\n\t\t}\n\t}, [fetch, getCurrentData]);\n\treturn (\n\t\t<AppsContext.Provider\n\t\t\tchildren={children}\n\t\t\tvalue={{ installedApps: installedAppsState, marketplaceApps: marketplaceAppsState, reload: fetch }}\n\t\t/>\n\t);\n};\nexport default AppsProvider;\n"]}