{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/PruneMessages/PruneMessagesWithData.js"],"names":["_regeneratorRuntime","module","link","default","v","_toConsumableArray","_slicedToArray","useMutableCallback","moment","React","useCallback","useEffect","useState","GenericModal","useSetModal","useEndpoint","useToastMessageDispatch","useTranslation","useUserRoom","useForm","PruneMessages","getTimeZoneOffset","offset","Date","getTimezoneOffset","absOffset","Math","abs","floor","slice","initialValues","newerDate","newerTime","olderDate","olderTime","users","inclusive","pinned","discussion","threads","attached","PruneMessagesWithData","rid","tabBar","t","room","type","name","usernames","setModal","onClickClose","close","closeModal","dispatchToastMessage","pruneMessages","fromDate","setFromDate","toDate","setToDate","callOutText","setCallOutText","validateText","setValidateText","counter","setCounter","values","handlers","reset","handleNewerDate","handleNewerTime","handleOlderDate","handleOlderTime","handleUsers","handleInclusive","handlePinned","handleDiscussion","handleThreads","handleAttached","onChangeUsers","value","action","includes","filter","current","handlePrune","limit","roomId","latest","oldest","excludePinned","filesOnly","ignoreDiscussion","ignoreThreads","count","Error","message","handleModal","exceptPinned","ifFrom","length","postProcess","sprintf","map","element","join","filesOrMessages","format","isNaN","getTime","date","time","exportDefault"],"mappings":";;;;;;;;AAAA,IAAIA,mBAAJ;;AAAwBC,MAAM,CAACC,IAAP,CAAY,4BAAZ,EAAyC;AAACC,SAAO,EAAC,UAASC,CAAT,EAAW;AAACJ,uBAAmB,GAACI,CAApB;AAAsB;AAA3C,CAAzC,EAAsF,CAAtF;;AAAyF,IAAIC,kBAAJ;;AAAuBJ,MAAM,CAACC,IAAP,CAAY,0CAAZ,EAAuD;AAACC,SAAO,EAAC,UAASC,CAAT,EAAW;AAACC,sBAAkB,GAACD,CAAnB;AAAqB;AAA1C,CAAvD,EAAmG,CAAnG;;AAAsG,IAAIE,cAAJ;;AAAmBL,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACC,SAAO,EAAC,UAASC,CAAT,EAAW;AAACE,kBAAc,GAACF,CAAf;AAAiB;AAAtC,CAAnD,EAA2F,CAA3F;AAAjQ,IAAIG,kBAAJ;AAAuBN,MAAM,CAACC,IAAP,CAAY,6BAAZ,EAA0C;AAACK,oBAAkB,EAAC,UAASH,CAAT,EAAW;AAACG,sBAAkB,GAACH,CAAnB;AAAqB;AAArD,CAA1C,EAAiG,CAAjG;AAAoG,IAAII,MAAJ;AAAWP,MAAM,CAACC,IAAP,CAAY,QAAZ,EAAqB;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACI,UAAM,GAACJ,CAAP;AAAS;AAA9B,CAArB,EAAqD,CAArD;AAAwD,IAAIK,KAAJ,EAAUC,WAAV,EAAsBC,SAAtB,EAAgCC,QAAhC;AAAyCX,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAoB;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACK,SAAK,GAACL,CAAN;AAAQ,GAA7B;AAA8BM,aAAW,EAAC,UAASN,CAAT,EAAW;AAACM,eAAW,GAACN,CAAZ;AAAc,GAApE;AAAqEO,WAAS,EAAC,UAASP,CAAT,EAAW;AAACO,aAAS,GAACP,CAAV;AAAY,GAAvG;AAAwGQ,UAAQ,EAAC,UAASR,CAAT,EAAW;AAACQ,YAAQ,GAACR,CAAT;AAAW;AAAxI,CAApB,EAA8J,CAA9J;AAAiK,IAAIS,YAAJ;AAAiBZ,MAAM,CAACC,IAAP,CAAY,qCAAZ,EAAkD;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACS,gBAAY,GAACT,CAAb;AAAe;AAApC,CAAlD,EAAwF,CAAxF;AAA2F,IAAIU,WAAJ;AAAgBb,MAAM,CAACC,IAAP,CAAY,mCAAZ,EAAgD;AAACY,aAAW,EAAC,UAASV,CAAT,EAAW;AAACU,eAAW,GAACV,CAAZ;AAAc;AAAvC,CAAhD,EAAyF,CAAzF;AAA4F,IAAIW,WAAJ;AAAgBd,MAAM,CAACC,IAAP,CAAY,oCAAZ,EAAiD;AAACa,aAAW,EAAC,UAASX,CAAT,EAAW;AAACW,eAAW,GAACX,CAAZ;AAAc;AAAvC,CAAjD,EAA0F,CAA1F;AAA6F,IAAIY,uBAAJ;AAA4Bf,MAAM,CAACC,IAAP,CAAY,2CAAZ,EAAwD;AAACc,yBAAuB,EAAC,UAASZ,CAAT,EAAW;AAACY,2BAAuB,GAACZ,CAAxB;AAA0B;AAA/D,CAAxD,EAAyH,CAAzH;AAA4H,IAAIa,cAAJ;AAAmBhB,MAAM,CAACC,IAAP,CAAY,yCAAZ,EAAsD;AAACe,gBAAc,EAAC,UAASb,CAAT,EAAW;AAACa,kBAAc,GAACb,CAAf;AAAiB;AAA7C,CAAtD,EAAqG,CAArG;AAAwG,IAAIc,WAAJ;AAAgBjB,MAAM,CAACC,IAAP,CAAY,kCAAZ,EAA+C;AAACgB,aAAW,EAAC,UAASd,CAAT,EAAW;AAACc,eAAW,GAACd,CAAZ;AAAc;AAAvC,CAA/C,EAAwF,CAAxF;AAA2F,IAAIe,OAAJ;AAAYlB,MAAM,CAACC,IAAP,CAAY,2BAAZ,EAAwC;AAACiB,SAAO,EAAC,UAASf,CAAT,EAAW;AAACe,WAAO,GAACf,CAAR;AAAU;AAA/B,CAAxC,EAAyE,CAAzE;AAA4E,IAAIgB,aAAJ;AAAkBnB,MAAM,CAACC,IAAP,CAAY,iBAAZ,EAA8B;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACgB,iBAAa,GAAChB,CAAd;AAAgB;AAArC,CAA9B,EAAqE,EAArE;;AAarrC,IAAMiB,iBAAiB,GAAG,YAAY;AACrC,MAAMC,MAAM,GAAG,IAAIC,IAAJ,GAAWC,iBAAX,EAAf;AACA,MAAMC,SAAS,GAAGC,IAAI,CAACC,GAAL,CAASL,MAAT,CAAlB;AACA,eAAUA,MAAM,GAAG,CAAT,GAAa,GAAb,GAAmB,GAA7B,IAAmC,QAAKI,IAAI,CAACE,KAAL,CAAWH,SAAS,GAAG,EAAvB,CAAL,EAAkCI,KAAlC,CAAwC,CAAC,CAAzC,CAAnC,SAAkF,QAAKJ,SAAS,GAAG,EAAjB,EAAsBI,KAAtB,CAA4B,CAAC,CAA7B,CAAlF;AACA,CAJD;;AAMA,IAAMC,aAAa,GAAG;AACrBC,WAAS,EAAE,EADU;AAErBC,WAAS,EAAE,EAFU;AAGrBC,WAAS,EAAE,EAHU;AAIrBC,WAAS,EAAE,EAJU;AAKrBC,OAAK,EAAE,EALc;AAMrBC,WAAS,EAAE,KANU;AAOrBC,QAAM,EAAE,KAPa;AAQrBC,YAAU,EAAE,KARS;AASrBC,SAAO,EAAE,KATY;AAUrBC,UAAQ,EAAE;AAVW,CAAtB;;AAaA,IAAMC,qBAAqB,GAAG,gBAAqB;AAAA,MAAlBC,GAAkB,QAAlBA,GAAkB;AAAA,MAAbC,MAAa,QAAbA,MAAa;AAClD,MAAMC,CAAC,GAAG3B,cAAc,EAAxB;AACA,MAAM4B,IAAI,GAAG3B,WAAW,CAACwB,GAAD,CAAxB;AACAG,MAAI,CAACC,IAAL,GAAYD,IAAI,CAACD,CAAjB;AACAC,MAAI,CAACH,GAAL,GAAWA,GAAX;AACA,MAAQK,IAAR,GAA4BF,IAA5B,CAAQE,IAAR;AAAA,MAAcC,SAAd,GAA4BH,IAA5B,CAAcG,SAAd;AAEA,MAAMC,QAAQ,GAAGnC,WAAW,EAA5B;AACA,MAAMoC,YAAY,GAAG3C,kBAAkB,CAAC;AAAA,WAAMoC,MAAM,IAAIA,MAAM,CAACQ,KAAP,EAAhB;AAAA,GAAD,CAAvC;AACA,MAAMC,UAAU,GAAG1C,WAAW,CAAC;AAAA,WAAMuC,QAAQ,CAAC,IAAD,CAAd;AAAA,GAAD,EAAuB,CAACA,QAAD,CAAvB,CAA9B;AACA,MAAMI,oBAAoB,GAAGrC,uBAAuB,EAApD;AACA,MAAMsC,aAAa,GAAGvC,WAAW,CAAC,MAAD,EAAS,oBAAT,CAAjC;;AAEA,kBAAgCH,QAAQ,CAAC,IAAIW,IAAJ,CAAS,sBAAT,CAAD,CAAxC;AAAA;AAAA,MAAOgC,QAAP;AAAA,MAAiBC,WAAjB;;AACA,mBAA4B5C,QAAQ,CAAC,IAAIW,IAAJ,CAAS,sBAAT,CAAD,CAApC;AAAA;AAAA,MAAOkC,MAAP;AAAA,MAAeC,SAAf;;AACA,mBAAsC9C,QAAQ,EAA9C;AAAA;AAAA,MAAO+C,WAAP;AAAA,MAAoBC,cAApB;;AACA,mBAAwChD,QAAQ,EAAhD;AAAA;AAAA,MAAOiD,YAAP;AAAA,MAAqBC,eAArB;;AACA,mBAA8BlD,QAAQ,CAAC,CAAD,CAAtC;AAAA;AAAA,MAAOmD,OAAP;AAAA,MAAgBC,UAAhB;;AAEA,iBAAoC7C,OAAO,CAACW,aAAD,CAA3C;AAAA,MAAQmC,MAAR,YAAQA,MAAR;AAAA,MAAgBC,QAAhB,YAAgBA,QAAhB;AAAA,MAA0BC,KAA1B,YAA0BA,KAA1B;;AACA,MAAQpC,SAAR,GAAgHkC,MAAhH,CAAQlC,SAAR;AAAA,MAAmBC,SAAnB,GAAgHiC,MAAhH,CAAmBjC,SAAnB;AAAA,MAA8BC,SAA9B,GAAgHgC,MAAhH,CAA8BhC,SAA9B;AAAA,MAAyCC,SAAzC,GAAgH+B,MAAhH,CAAyC/B,SAAzC;AAAA,MAAoDC,KAApD,GAAgH8B,MAAhH,CAAoD9B,KAApD;AAAA,MAA2DC,SAA3D,GAAgH6B,MAAhH,CAA2D7B,SAA3D;AAAA,MAAsEC,MAAtE,GAAgH4B,MAAhH,CAAsE5B,MAAtE;AAAA,MAA8EC,UAA9E,GAAgH2B,MAAhH,CAA8E3B,UAA9E;AAAA,MAA0FC,OAA1F,GAAgH0B,MAAhH,CAA0F1B,OAA1F;AAAA,MAAmGC,QAAnG,GAAgHyB,MAAhH,CAAmGzB,QAAnG;AAEA,MACC4B,eADD,GAWIF,QAXJ,CACCE,eADD;AAAA,MAECC,eAFD,GAWIH,QAXJ,CAECG,eAFD;AAAA,MAGCC,eAHD,GAWIJ,QAXJ,CAGCI,eAHD;AAAA,MAICC,eAJD,GAWIL,QAXJ,CAICK,eAJD;AAAA,MAKCC,WALD,GAWIN,QAXJ,CAKCM,WALD;AAAA,MAMCC,eAND,GAWIP,QAXJ,CAMCO,eAND;AAAA,MAOCC,YAPD,GAWIR,QAXJ,CAOCQ,YAPD;AAAA,MAQCC,gBARD,GAWIT,QAXJ,CAQCS,gBARD;AAAA,MASCC,aATD,GAWIV,QAXJ,CASCU,aATD;AAAA,MAUCC,cAVD,GAWIX,QAXJ,CAUCW,cAVD;AAaA,MAAMC,aAAa,GAAGvE,kBAAkB,CAAC,UAACwE,KAAD,EAAQC,MAAR,EAAmB;AAC3D,QAAI,CAACA,MAAL,EAAa;AACZ,UAAI7C,KAAK,CAAC8C,QAAN,CAAeF,KAAf,CAAJ,EAA2B;AAC1B;AACA;;AACD,aAAOP,WAAW,8BAAKrC,KAAL,IAAY4C,KAAZ,GAAlB;AACA;;AACDP,eAAW,CAACrC,KAAK,CAAC+C,MAAN,CAAa,UAACC,OAAD;AAAA,aAAaA,OAAO,KAAKJ,KAAzB;AAAA,KAAb,CAAD,CAAX;AACA,GARuC,CAAxC;AAUA,MAAMK,WAAW,GAAG7E,kBAAkB;AAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAChC8E,qBADgC,GACxB,IADwB;AAAA;;AAAA,sBAIjCtB,OAAO,KAAKsB,KAJqB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA,iDAQb/B,aAAa,CAAC;AACrCgC,wBAAM,EAAE5C,GAD6B;AAErC6C,wBAAM,EAAE9B,MAF6B;AAGrC+B,wBAAM,EAAEjC,QAH6B;AAIrCnB,2BAAS,EAATA,SAJqC;AAKrCiD,uBAAK,EAALA,KALqC;AAMrCI,+BAAa,EAAEpD,MANsB;AAOrCqD,2BAAS,EAAElD,QAP0B;AAQrCmD,kCAAgB,EAAErD,UARmB;AASrCsD,+BAAa,EAAErD,OATsB;AAUrCJ,uBAAK,EAALA;AAVqC,iBAAD,CARA;;AAAA;AAAA;AAQ7B0D,qBAR6B,wBAQ7BA,KAR6B;AAqBrC7B,0BAAU,CAAC6B,KAAD,CAAV;;AArBqC,sBAuBjCA,KAAK,GAAG,CAvByB;AAAA;AAAA;AAAA;;AAAA,sBAwB9B,IAAIC,KAAJ,CAAUlD,CAAC,CAAC,4BAAD,CAAX,CAxB8B;;AAAA;AA2BrCS,oCAAoB,CAAC;AAAEP,sBAAI,EAAE,SAAR;AAAmBiD,yBAAO,EAAKF,KAAL,SAAcjD,CAAC,CAAC,iBAAD;AAAzC,iBAAD,CAApB;AACAQ,0BAAU;AACVe,qBAAK;AA7BgC;AAAA;;AAAA;AAAA;AAAA;AA+BrCd,oCAAoB,CAAC;AAAEP,sBAAI,EAAE,OAAR;AAAiBiD,yBAAO;AAAxB,iBAAD,CAApB;AACA3C,0BAAU;;AAhC2B;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAD;AAAA,MAAtC;;AAoCA,MAAM4C,WAAW,GAAG,YAAM;AACzB/C,YAAQ,eACP,oBAAC,YAAD;AAAc,aAAO,EAAC,QAAtB;AAA+B,aAAO,EAAEG,UAAxC;AAAoD,cAAQ,EAAEA,UAA9D;AAA0E,eAAS,EAAEgC,WAArF;AAAkG,iBAAW,EAAExC,CAAC,CAAC,gBAAD;AAAhH,OACEA,CAAC,CAAC,aAAD,CADH,CADO,CAAR;AAKA,GAND;;AAQAjC,WAAS,CAAC,YAAM;AACf,QAAIoB,SAAJ,EAAe;AACdyB,iBAAW,CAAC,IAAIjC,IAAJ,CAAYQ,SAAZ,UAAyBC,SAAS,IAAI,OAAtC,YAAmDX,iBAAiB,EAApE,CAAD,CAAX;AACA;;AAED,QAAIY,SAAJ,EAAe;AACdyB,eAAS,CAAC,IAAInC,IAAJ,CAAYU,SAAZ,UAAyBC,SAAS,IAAI,OAAtC,YAAmDb,iBAAiB,EAApE,CAAD,CAAT;AACA;AACD,GARQ,EAQN,CAACU,SAAD,EAAYC,SAAZ,EAAuBC,SAAvB,EAAkCC,SAAlC,CARM,CAAT;AAUAvB,WAAS,CAAC,YAAM;AACf,QAAMsF,YAAY,GAAG5D,MAAM,SAAOO,CAAC,CAAC,eAAD,EAAkB,EAAlB,CAAR,GAAkC,EAA7D;AACA,QAAMsD,MAAM,GAAG/D,KAAK,CAACgE,MAAN,SACRvD,CAAC,CAAC,kBAAD,EAAqB;AAC1BwD,iBAAW,EAAE,SADa;AAE1BC,aAAO,EAAE,CAAClE,KAAK,CAACmE,GAAN,CAAU,UAACC,OAAD;AAAA,eAAaA,OAAb;AAAA,OAAV,EAAgCC,IAAhC,CAAqC,IAArC,CAAD;AAFiB,KAArB,CADO,GAKZ,EALH;AAMA,QAAMC,eAAe,GAAG7D,CAAC,CAACJ,QAAQ,GAAG,OAAH,GAAa,UAAtB,EAAkC,EAAlC,CAAzB;;AAEA,QAAIT,SAAS,IAAIE,SAAjB,EAA4B;AAC3B2B,oBAAc,CACbhB,CAAC,CAAC,uBAAD,EAA0B;AAC1BwD,mBAAW,EAAE,SADa;AAE1BC,eAAO,EAAE,CAACI,eAAD,EAAkB1D,IAAlB,EAAwBvC,MAAM,CAAC+C,QAAD,CAAN,CAAiBmD,MAAjB,CAAwB,MAAxB,CAAxB,EAAyDlG,MAAM,CAACiD,MAAD,CAAN,CAAeiD,MAAf,CAAsB,MAAtB,CAAzD;AAFiB,OAA1B,CAAD,GAICT,YAJD,GAKCC,MANY,CAAd;AAQA,KATD,MASO,IAAInE,SAAJ,EAAe;AACrB6B,oBAAc,CACbhB,CAAC,CAAC,qBAAD,EAAwB;AACxBwD,mBAAW,EAAE,SADW;AAExBC,eAAO,EAAE,CAACI,eAAD,EAAkB1D,IAAlB,EAAwBvC,MAAM,CAAC+C,QAAD,CAAN,CAAiBmD,MAAjB,CAAwB,MAAxB,CAAxB;AAFe,OAAxB,CAAD,GAICT,YAJD,GAKCC,MANY,CAAd;AAQA,KATM,MASA,IAAIjE,SAAJ,EAAe;AACrB2B,oBAAc,CACbhB,CAAC,CAAC,sBAAD,EAAyB;AACzBwD,mBAAW,EAAE,SADY;AAEzBC,eAAO,EAAE,CAACI,eAAD,EAAkB1D,IAAlB,EAAwBvC,MAAM,CAACiD,MAAD,CAAN,CAAeiD,MAAf,CAAsB,MAAtB,CAAxB;AAFgB,OAAzB,CAAD,GAICT,YAJD,GAKCC,MANY,CAAd;AAQA,KATM,MASA;AACNtC,oBAAc,CACbhB,CAAC,CAAC,mBAAD,EAAsB;AACtBwD,mBAAW,EAAE,SADS;AAEtBC,eAAO,EAAE,CAACI,eAAD,EAAkB1D,IAAI,KAAIC,SAAJ,aAAIA,SAAJ,uBAAIA,SAAS,CAAEwD,IAAX,CAAgB,KAAhB,CAAJ,CAAtB;AAFa,OAAtB,CAAD,GAICP,YAJD,GAKCC,MANY,CAAd;AAQA;;AAED,QAAI3C,QAAQ,GAAGE,MAAf,EAAuB;AACtB,aAAOK,eAAe,CACrBlB,CAAC,CAAC,sCAAD,EAAyC;AACzCwD,mBAAW,EAAE,SAD4B;AAEzCC,eAAO,EAAE;AAFgC,OAAzC,CADoB,CAAtB;AAMA;;AACD,QAAIM,KAAK,CAACpD,QAAQ,CAACqD,OAAT,EAAD,CAAL,IAA6BD,KAAK,CAAClD,MAAM,CAACmD,OAAP,EAAD,CAAtC,EAA0D;AACzD,aAAO9C,eAAe,CACrBlB,CAAC,CAAC,oBAAD,EAAuB;AACvBwD,mBAAW,EAAE,SADU;AAEvBC,eAAO,EAAE;AAFc,OAAvB,CADoB,CAAtB;AAMA;;AAEDvC,mBAAe;AACf,GAlEQ,EAkEN,CAAC/B,SAAD,EAAYE,SAAZ,EAAuBsB,QAAvB,EAAiCE,MAAjC,EAAyCjB,QAAzC,EAAmDO,IAAnD,EAAyDH,CAAzD,EAA4DP,MAA5D,EAAoEF,KAApE,EAA2Ea,SAA3E,CAlEM,CAAT;AAoEA,sBACC,oBAAC,aAAD;AACC,eAAW,EAAEW,WADd;AAEC,gBAAY,EAAEE,YAFf;AAGC,iBAAa,EAAE;AAAEgD,UAAI,EAAE9E,SAAR;AAAmB+E,UAAI,EAAE9E;AAAzB,KAHhB;AAIC,uBAAmB,EAAE;AAAE6E,UAAI,EAAEzC,eAAR;AAAyB0C,UAAI,EAAEzC;AAA/B,KAJtB;AAKC,iBAAa,EAAE;AAAEwC,UAAI,EAAE5E,SAAR;AAAmB6E,UAAI,EAAE5E;AAAzB,KALhB;AAMC,uBAAmB,EAAE;AAAE2E,UAAI,EAAEvC,eAAR;AAAyBwC,UAAI,EAAEvC;AAA/B,KANtB;AAOC,SAAK,EAAEpC,KAPR;AAQC,aAAS,EAAEC,SARZ;AASC,UAAM,EAAEC,MATT;AAUC,cAAU,EAAEC,UAVb;AAWC,WAAO,EAAEC,OAXV;AAYC,YAAQ,EAAEC,QAZX;AAaC,mBAAe,EAAEiC,eAblB;AAcC,gBAAY,EAAEC,YAdf;AAeC,oBAAgB,EAAEC,gBAfnB;AAgBC,iBAAa,EAAEC,aAhBhB;AAiBC,kBAAc,EAAEC,cAjBjB;AAkBC,gBAAY,EAAE3B,YAlBf;AAmBC,gBAAY,EAAE8C,WAnBf;AAoBC,iBAAa,EAAElB;AApBhB,IADD;AAwBA,CA/LD;;AAhCA7E,MAAM,CAAC8G,aAAP,CAiOetE,qBAjOf,E","file":"dynamic/client/views/room/contextualBar/PruneMessages/PruneMessagesWithData.js","sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport moment from 'moment';\nimport React, { useCallback, useEffect, useState } from 'react';\n\nimport GenericModal from '../../../../components/GenericModal';\nimport { useSetModal } from '../../../../contexts/ModalContext';\nimport { useEndpoint } from '../../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../../contexts/TranslationContext';\nimport { useUserRoom } from '../../../../contexts/UserContext';\nimport { useForm } from '../../../../hooks/useForm';\nimport PruneMessages from './PruneMessages';\n\nconst getTimeZoneOffset = function () {\n\tconst offset = new Date().getTimezoneOffset();\n\tconst absOffset = Math.abs(offset);\n\treturn `${offset < 0 ? '+' : '-'}${`00${Math.floor(absOffset / 60)}`.slice(-2)}:${`00${absOffset % 60}`.slice(-2)}`;\n};\n\nconst initialValues = {\n\tnewerDate: '',\n\tnewerTime: '',\n\tolderDate: '',\n\tolderTime: '',\n\tusers: [],\n\tinclusive: false,\n\tpinned: false,\n\tdiscussion: false,\n\tthreads: false,\n\tattached: false,\n};\n\nconst PruneMessagesWithData = ({ rid, tabBar }) => {\n\tconst t = useTranslation();\n\tconst room = useUserRoom(rid);\n\troom.type = room.t;\n\troom.rid = rid;\n\tconst { name, usernames } = room;\n\n\tconst setModal = useSetModal();\n\tconst onClickClose = useMutableCallback(() => tabBar && tabBar.close());\n\tconst closeModal = useCallback(() => setModal(null), [setModal]);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst pruneMessages = useEndpoint('POST', 'rooms.cleanHistory');\n\n\tconst [fromDate, setFromDate] = useState(new Date('0001-01-01T00:00:00Z'));\n\tconst [toDate, setToDate] = useState(new Date('9999-12-31T23:59:59Z'));\n\tconst [callOutText, setCallOutText] = useState();\n\tconst [validateText, setValidateText] = useState();\n\tconst [counter, setCounter] = useState(0);\n\n\tconst { values, handlers, reset } = useForm(initialValues);\n\tconst { newerDate, newerTime, olderDate, olderTime, users, inclusive, pinned, discussion, threads, attached } = values;\n\n\tconst {\n\t\thandleNewerDate,\n\t\thandleNewerTime,\n\t\thandleOlderDate,\n\t\thandleOlderTime,\n\t\thandleUsers,\n\t\thandleInclusive,\n\t\thandlePinned,\n\t\thandleDiscussion,\n\t\thandleThreads,\n\t\thandleAttached,\n\t} = handlers;\n\n\tconst onChangeUsers = useMutableCallback((value, action) => {\n\t\tif (!action) {\n\t\t\tif (users.includes(value)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn handleUsers([...users, value]);\n\t\t}\n\t\thandleUsers(users.filter((current) => current !== value));\n\t});\n\n\tconst handlePrune = useMutableCallback(async () => {\n\t\tconst limit = 2000;\n\n\t\ttry {\n\t\t\tif (counter === limit) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { count } = await pruneMessages({\n\t\t\t\troomId: rid,\n\t\t\t\tlatest: toDate,\n\t\t\t\toldest: fromDate,\n\t\t\t\tinclusive,\n\t\t\t\tlimit,\n\t\t\t\texcludePinned: pinned,\n\t\t\t\tfilesOnly: attached,\n\t\t\t\tignoreDiscussion: discussion,\n\t\t\t\tignoreThreads: threads,\n\t\t\t\tusers,\n\t\t\t});\n\n\t\t\tsetCounter(count);\n\n\t\t\tif (count < 1) {\n\t\t\t\tthrow new Error(t('No_messages_found_to_prune'));\n\t\t\t}\n\n\t\t\tdispatchToastMessage({ type: 'success', message: `${count} ${t('messages_pruned')}` });\n\t\t\tcloseModal();\n\t\t\treset();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\tcloseModal();\n\t\t}\n\t});\n\n\tconst handleModal = () => {\n\t\tsetModal(\n\t\t\t<GenericModal variant='danger' onClose={closeModal} onCancel={closeModal} onConfirm={handlePrune} confirmText={t('Yes_prune_them')}>\n\t\t\t\t{t('Prune_Modal')}\n\t\t\t</GenericModal>,\n\t\t);\n\t};\n\n\tuseEffect(() => {\n\t\tif (newerDate) {\n\t\t\tsetFromDate(new Date(`${newerDate}T${newerTime || '00:00'}:00${getTimeZoneOffset()}`));\n\t\t}\n\n\t\tif (olderDate) {\n\t\t\tsetToDate(new Date(`${olderDate}T${olderTime || '24:00'}:00${getTimeZoneOffset()}`));\n\t\t}\n\t}, [newerDate, newerTime, olderDate, olderTime]);\n\n\tuseEffect(() => {\n\t\tconst exceptPinned = pinned ? ` ${t('except_pinned', {})}` : '';\n\t\tconst ifFrom = users.length\n\t\t\t? ` ${t('if_they_are_from', {\n\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\tsprintf: [users.map((element) => element).join(', ')],\n\t\t\t  })}`\n\t\t\t: '';\n\t\tconst filesOrMessages = t(attached ? 'files' : 'messages', {});\n\n\t\tif (newerDate && olderDate) {\n\t\t\tsetCallOutText(\n\t\t\t\tt('Prune_Warning_between', {\n\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\tsprintf: [filesOrMessages, name, moment(fromDate).format('L LT'), moment(toDate).format('L LT')],\n\t\t\t\t}) +\n\t\t\t\t\texceptPinned +\n\t\t\t\t\tifFrom,\n\t\t\t);\n\t\t} else if (newerDate) {\n\t\t\tsetCallOutText(\n\t\t\t\tt('Prune_Warning_after', {\n\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\tsprintf: [filesOrMessages, name, moment(fromDate).format('L LT')],\n\t\t\t\t}) +\n\t\t\t\t\texceptPinned +\n\t\t\t\t\tifFrom,\n\t\t\t);\n\t\t} else if (olderDate) {\n\t\t\tsetCallOutText(\n\t\t\t\tt('Prune_Warning_before', {\n\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\tsprintf: [filesOrMessages, name, moment(toDate).format('L LT')],\n\t\t\t\t}) +\n\t\t\t\t\texceptPinned +\n\t\t\t\t\tifFrom,\n\t\t\t);\n\t\t} else {\n\t\t\tsetCallOutText(\n\t\t\t\tt('Prune_Warning_all', {\n\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\tsprintf: [filesOrMessages, name || usernames?.join(' x ')],\n\t\t\t\t}) +\n\t\t\t\t\texceptPinned +\n\t\t\t\t\tifFrom,\n\t\t\t);\n\t\t}\n\n\t\tif (fromDate > toDate) {\n\t\t\treturn setValidateText(\n\t\t\t\tt('Newer_than_may_not_exceed_Older_than', {\n\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\tsprintf: [],\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\t\tif (isNaN(fromDate.getTime()) || isNaN(toDate.getTime())) {\n\t\t\treturn setValidateText(\n\t\t\t\tt('error-invalid-date', {\n\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\tsprintf: [],\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tsetValidateText();\n\t}, [newerDate, olderDate, fromDate, toDate, attached, name, t, pinned, users, usernames]);\n\n\treturn (\n\t\t<PruneMessages\n\t\t\tcallOutText={callOutText}\n\t\t\tvalidateText={validateText}\n\t\t\tnewerDateTime={{ date: newerDate, time: newerTime }}\n\t\t\thandleNewerDateTime={{ date: handleNewerDate, time: handleNewerTime }}\n\t\t\tolderDateTime={{ date: olderDate, time: olderTime }}\n\t\t\thandleOlderDateTime={{ date: handleOlderDate, time: handleOlderTime }}\n\t\t\tusers={users}\n\t\t\tinclusive={inclusive}\n\t\t\tpinned={pinned}\n\t\t\tdiscussion={discussion}\n\t\t\tthreads={threads}\n\t\t\tattached={attached}\n\t\t\thandleInclusive={handleInclusive}\n\t\t\thandlePinned={handlePinned}\n\t\t\thandleDiscussion={handleDiscussion}\n\t\t\thandleThreads={handleThreads}\n\t\t\thandleAttached={handleAttached}\n\t\t\tonClickClose={onClickClose}\n\t\t\tonClickPrune={handleModal}\n\t\t\tonChangeUsers={onChangeUsers}\n\t\t/>\n\t);\n};\n\nexport default PruneMessagesWithData;\n"]}