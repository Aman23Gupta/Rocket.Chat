{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/apps/helpers.js"],"names":["module","export","appEnabledStatuses","apiCurlGetter","handleInstallError","handleAPIError","warnStatusChange","appButtonProps","appStatusSpanProps","formatPrice","formatPricingPlan","AppStatus","link","v","semver","Utilities","t","dispatchToastMessage","AUTO_ENABLED","MANUALLY_ENABLED","appErroredStatuses","COMPILER_ERROR_DISABLED","ERROR_DISABLED","INVALID_SETTINGS_DISABLED","INVALID_LICENSE_DISABLED","absoluteUrl","method","api","example","examples","curl","url","computedPath","params","query","content","headers","split","apiError","xhr","responseJSON","status","messages","error","payload","message","join","username","type","shouldHandleErrorAsWarning","warnings","includes","appName","installed","version","marketplaceVersion","isPurchased","price","purchaseType","subscriptionInfo","pricingPlans","isEnterpriseOnly","canUpdate","lt","action","icon","label","canDownload","canSubscribe","cannotTry","every","currentPricingPlan","trialDays","canBuy","isFailed","isEnabled","isOnTrialPeriod","Number","parseFloat","toFixed","strategy","tiers","Array","isArray","find","tier","perUnit","pricingPlanTranslationString","length","filter","Boolean"],"mappings":"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","file":"dynamic/client/views/admin/apps/helpers.js","sourcesContent":["import { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport semver from 'semver';\n\nimport { Utilities } from '../../../../app/apps/lib/misc/Utilities';\nimport { t } from '../../../../app/utils/client';\nimport { dispatchToastMessage } from '../../../lib/toast';\n\nexport const appEnabledStatuses = [AppStatus.AUTO_ENABLED, AppStatus.MANUALLY_ENABLED];\n\nconst appErroredStatuses = [\n\tAppStatus.COMPILER_ERROR_DISABLED,\n\tAppStatus.ERROR_DISABLED,\n\tAppStatus.INVALID_SETTINGS_DISABLED,\n\tAppStatus.INVALID_LICENSE_DISABLED,\n];\n\nexport const apiCurlGetter = (absoluteUrl) => (method, api) => {\n\tconst example = api.examples[method] || {};\n\treturn Utilities.curl({\n\t\turl: absoluteUrl(api.computedPath),\n\t\tmethod,\n\t\tparams: example.params,\n\t\tquery: example.query,\n\t\tcontent: example.content,\n\t\theaders: example.headers,\n\t}).split('\\n');\n};\n\nexport function handleInstallError(apiError) {\n\tif (!apiError.xhr || !apiError.xhr.responseJSON) {\n\t\treturn;\n\t}\n\n\tconst { status, messages, error, payload = null } = apiError.xhr.responseJSON;\n\n\tlet message;\n\n\tswitch (status) {\n\t\tcase 'storage_error':\n\t\t\tmessage = messages.join('');\n\t\t\tbreak;\n\t\tcase 'app_user_error':\n\t\t\tmessage = messages.join('');\n\t\t\tif (payload && payload.username) {\n\t\t\t\tmessage = t('Apps_User_Already_Exists', { username: payload.username });\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (error) {\n\t\t\t\tmessage = error;\n\t\t\t} else {\n\t\t\t\tmessage = 'There has been an error installing the app';\n\t\t\t}\n\t}\n\n\tdispatchToastMessage({ type: 'error', message });\n}\n\nconst shouldHandleErrorAsWarning = (message) => {\n\tconst warnings = ['Could not reach the Marketplace'];\n\n\treturn warnings.includes(message);\n};\n\nexport const handleAPIError = (error) => {\n\tconst message = (error.xhr && error.xhr.responseJSON && error.xhr.responseJSON.error) || error.message;\n\n\tif (shouldHandleErrorAsWarning(message)) {\n\t\tdispatchToastMessage({ type: 'warning', message });\n\t\treturn;\n\t}\n\n\tdispatchToastMessage({ type: 'error', message });\n};\n\nexport const warnStatusChange = (appName, status) => {\n\tif (appErroredStatuses.includes(status)) {\n\t\tdispatchToastMessage({ type: 'error', message: (t(`App_status_${status}`), appName) });\n\t\treturn;\n\t}\n\n\tdispatchToastMessage({ type: 'info', message: (t(`App_status_${status}`), appName) });\n};\n\nexport const appButtonProps = ({\n\tinstalled,\n\tversion,\n\tmarketplaceVersion,\n\tisPurchased,\n\tprice,\n\tpurchaseType,\n\tsubscriptionInfo,\n\tpricingPlans,\n\tisEnterpriseOnly,\n}) => {\n\tconst canUpdate = installed && version && marketplaceVersion && semver.lt(version, marketplaceVersion);\n\tif (canUpdate) {\n\t\treturn {\n\t\t\taction: 'update',\n\t\t\ticon: 'reload',\n\t\t\tlabel: 'Update',\n\t\t};\n\t}\n\n\tif (installed) {\n\t\treturn;\n\t}\n\n\tconst canDownload = isPurchased;\n\tif (canDownload) {\n\t\treturn {\n\t\t\taction: 'install',\n\t\t\tlabel: 'Install',\n\t\t};\n\t}\n\n\tconst canSubscribe = purchaseType === 'subscription' && !subscriptionInfo.status;\n\tif (canSubscribe) {\n\t\tconst cannotTry = pricingPlans.every((currentPricingPlan) => currentPricingPlan.trialDays === 0);\n\n\t\tif (cannotTry || isEnterpriseOnly) {\n\t\t\treturn {\n\t\t\t\taction: 'purchase',\n\t\t\t\tlabel: 'Subscribe',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Trial',\n\t\t};\n\t}\n\n\tconst canBuy = price > 0;\n\tif (canBuy) {\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Buy',\n\t\t};\n\t}\n\n\treturn {\n\t\taction: 'purchase',\n\t\tlabel: 'Install',\n\t};\n};\n\nexport const appStatusSpanProps = ({ installed, status, subscriptionInfo }) => {\n\tif (!installed) {\n\t\treturn;\n\t}\n\n\tconst isFailed = appErroredStatuses.includes(status);\n\tif (isFailed) {\n\t\treturn {\n\t\t\ttype: 'failed',\n\t\t\ticon: 'warning',\n\t\t\tlabel: status === AppStatus.INVALID_SETTINGS_DISABLED ? 'Config Needed' : 'Failed',\n\t\t};\n\t}\n\n\tconst isEnabled = appEnabledStatuses.includes(status);\n\tif (!isEnabled) {\n\t\treturn {\n\t\t\ttype: 'warning',\n\t\t\ticon: 'warning',\n\t\t\tlabel: 'Disabled',\n\t\t};\n\t}\n\n\tconst isOnTrialPeriod = subscriptionInfo && subscriptionInfo.status === 'trialing';\n\tif (isOnTrialPeriod) {\n\t\treturn {\n\t\t\ticon: 'checkmark-circled',\n\t\t\tlabel: 'Trial period',\n\t\t};\n\t}\n\n\treturn {\n\t\ticon: 'checkmark-circled',\n\t\tlabel: 'Enabled',\n\t};\n};\n\nexport const formatPrice = (price) => `\\$${Number.parseFloat(price).toFixed(2)}`;\n\nexport const formatPricingPlan = ({ strategy, price, tiers = [] }) => {\n\tconst { perUnit = false } = (Array.isArray(tiers) && tiers.find((tier) => tier.price === price)) || {};\n\n\tconst pricingPlanTranslationString = [\n\t\t'Apps_Marketplace_pricingPlan',\n\t\tArray.isArray(tiers) && tiers.length > 0 && 'startingAt',\n\t\tstrategy,\n\t\tperUnit && 'perUser',\n\t]\n\t\t.filter(Boolean)\n\t\t.join('_');\n\n\treturn t(pricingPlanTranslationString, {\n\t\tprice: formatPrice(price),\n\t});\n};\n"]}