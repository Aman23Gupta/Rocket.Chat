{"version":3,"sources":["meteor://ðŸ’»app/client/views/omnichannel/facebook/FacebookPageContainer.tsx"],"names":[],"mappings":"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","file":"dynamic/client/views/omnichannel/facebook/FacebookPageContainer.tsx","sourcesContent":["import { Callout } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { FC } from 'react';\n\nimport Page from '../../../components/Page';\nimport PageSkeleton from '../../../components/PageSkeleton';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { AsyncStatePhase } from '../../../hooks/useAsyncState';\nimport { useMethodData } from '../../../hooks/useMethodData';\nimport FacebookPage from './FacebookPage';\n\ntype PageItem = {\n\tname: string;\n\tsubscribed: boolean;\n\tid: string;\n};\n\ntype PageData = {\n\tpages: PageItem[];\n};\n\ntype InitialStateData = {\n\tenabled: boolean;\n\thasToken: boolean;\n};\n\nconst initialStateArgs = [\n\t{\n\t\taction: 'initialState',\n\t},\n];\n\nconst listPageArgs = [\n\t{\n\t\taction: 'list-pages',\n\t},\n];\n\nconst FacebookPageContainer: FC = () => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst {\n\t\tvalue: initialStateData,\n\t\tphase: state,\n\t\treload: reloadInitial,\n\t} = useMethodData<InitialStateData>('livechat:facebook', initialStateArgs);\n\n\tconst { value: pagesData, phase: listState, reload: reloadData } = useMethodData<PageData>('livechat:facebook', listPageArgs);\n\n\tconst { enabled, hasToken } = initialStateData || { enabled: false, hasToken: false };\n\tconst { pages } = pagesData || { pages: [] };\n\n\tconst livechatFacebook = useMethod('livechat:facebook');\n\n\tconst onToggle = useMutableCallback(async (id, isSubscribed, setSubscribed) => {\n\t\tsetSubscribed(!isSubscribed);\n\t\ttry {\n\t\t\tconst action = isSubscribed ? 'unsubscribe' : 'subscribe';\n\t\t\tawait livechatFacebook({\n\t\t\t\taction,\n\t\t\t\tpage: id,\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\tsetSubscribed(isSubscribed);\n\t\t}\n\t});\n\n\tconst onDisable = useMutableCallback(async () => {\n\t\ttry {\n\t\t\tawait livechatFacebook({ action: 'disable' });\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Integration_disabled') });\n\t\t\treloadInitial();\n\t\t\treloadData();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tconst openOauthWindow = (url: string, callback: () => void): void => {\n\t\tconst oauthWindow = window.open(url, 'facebook-integration-oauth', 'width=600,height=400');\n\t\tconst checkInterval = setInterval(() => {\n\t\t\tif (oauthWindow?.closed) {\n\t\t\t\tclearInterval(checkInterval);\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}, 300);\n\t};\n\n\tconst onEnable = useMutableCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await livechatFacebook({ action: 'enable' });\n\t\t\tif (result?.url) {\n\t\t\t\topenOauthWindow(result?.url, () => {\n\t\t\t\t\tonEnable();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treloadInitial();\n\t\t\t\treloadData();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tif (state === AsyncStatePhase.LOADING || listState === AsyncStatePhase.LOADING) {\n\t\treturn <PageSkeleton />;\n\t}\n\n\tif (state === AsyncStatePhase.REJECTED) {\n\t\treturn (\n\t\t\t<Page>\n\t\t\t\t<Page.Header title={t('Edit_Custom_Field')} />\n\t\t\t\t<Page.ScrollableContentWithShadow>\n\t\t\t\t\t<Callout type='danger'>{t('Error')}</Callout>\n\t\t\t\t</Page.ScrollableContentWithShadow>\n\t\t\t</Page>\n\t\t);\n\t}\n\n\tif (enabled && hasToken && listState === AsyncStatePhase.REJECTED) {\n\t\tonEnable();\n\t}\n\n\treturn (\n\t\t<FacebookPage\n\t\t\tpages={pages}\n\t\t\tenabled={enabled}\n\t\t\thasToken={hasToken}\n\t\t\tonToggle={onToggle}\n\t\t\tonRefresh={reloadData}\n\t\t\tonDisable={onDisable}\n\t\t\tonEnable={onEnable}\n\t\t/>\n\t);\n};\n\nexport default FacebookPageContainer;\n"]}