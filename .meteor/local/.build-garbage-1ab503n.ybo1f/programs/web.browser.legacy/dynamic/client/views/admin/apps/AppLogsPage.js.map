{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/apps/AppLogsPage.js"],"names":["_extends","module","link","default","v","_objectWithoutProperties","_regeneratorRuntime","_objectSpread","_slicedToArray","Box","Button","ButtonGroup","Icon","Accordion","Pagination","useSafely","React","useCallback","useState","useEffect","Page","useCurrentRoute","useRoute","useEndpoint","useTranslation","useFormatDateAndTime","LogItem","LogsLoading","useAppWithLogs","id","current","itemsPerPage","data","setData","getAppData","getAppLogs","fetchData","Promise","all","app","logs","error","sliceStart","length","total","filteredData","slice","AppLogsPage","props","t","formatDateAndTime","setItemsPerPage","setCurrent","logEntriesCount","currentRouteName","appLogsRoute","handleResetButtonClick","handleBackButtonClick","push","loading","Object","values","showData","showingResultsLabel","count","Math","min","itemsPerPageLabel","name","message","map","log","_createdAt","method","totalTime","instanceId","entries","exportDefault"],"mappings":"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","file":"dynamic/client/views/admin/apps/AppLogsPage.js","sourcesContent":["import { Box, Button, ButtonGroup, Icon, Accordion, Pagination } from '@rocket.chat/fuselage';\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\nimport React, { useCallback, useState, useEffect } from 'react';\n\nimport Page from '../../../components/Page';\nimport { useCurrentRoute, useRoute } from '../../../contexts/RouterContext';\nimport { useEndpoint } from '../../../contexts/ServerContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useFormatDateAndTime } from '../../../hooks/useFormatDateAndTime';\nimport LogItem from './LogItem';\nimport LogsLoading from './LogsLoading';\n\nconst useAppWithLogs = ({ id, current, itemsPerPage }) => {\n\tconst [data, setData] = useSafely(useState({}));\n\tconst getAppData = useEndpoint('GET', `/apps/${id}`);\n\tconst getAppLogs = useEndpoint('GET', `/apps/${id}/logs`);\n\n\tconst fetchData = useCallback(async () => {\n\t\ttry {\n\t\t\tconst [{ app }, { logs }] = await Promise.all([getAppData(), getAppLogs()]);\n\t\t\tsetData({ ...app, logs });\n\t\t} catch (error) {\n\t\t\tsetData({ error });\n\t\t}\n\t}, [getAppData, getAppLogs, setData]);\n\n\tuseEffect(() => {\n\t\tfetchData();\n\t}, [fetchData]);\n\n\tconst sliceStart = data.logs && current > data.logs.length ? 0 : current;\n\tconst total = data.logs ? data.logs.length : 0;\n\tconst filteredData = data.logs ? { ...data, logs: data.logs.slice(sliceStart, itemsPerPage + current) } : data;\n\n\treturn [filteredData, total, fetchData];\n};\n\nfunction AppLogsPage({ id, ...props }) {\n\tconst t = useTranslation();\n\tconst formatDateAndTime = useFormatDateAndTime();\n\tconst [itemsPerPage, setItemsPerPage] = useState(25);\n\tconst [current, setCurrent] = useState(0);\n\n\tconst [app, logEntriesCount, fetchData] = useAppWithLogs({ id, itemsPerPage, current });\n\n\tconst [currentRouteName] = useCurrentRoute();\n\tconst appLogsRoute = useRoute(currentRouteName);\n\n\tconst handleResetButtonClick = () => {\n\t\tfetchData();\n\t};\n\n\tconst handleBackButtonClick = () => {\n\t\tappLogsRoute.push();\n\t};\n\n\tconst loading = !Object.values(app).length;\n\tconst showData = !loading && !app.error;\n\n\tconst showingResultsLabel = useCallback(\n\t\t({ count, current, itemsPerPage }) => t('Showing_results_of', current + 1, Math.min(current + itemsPerPage, count), count),\n\t\t[t],\n\t);\n\tconst itemsPerPageLabel = useCallback(() => t('Items_per_page:'), [t]);\n\n\treturn (\n\t\t<Page flexDirection='column' {...props}>\n\t\t\t<Page.Header title={t('View_the_Logs_for', { name: app.name || '' })}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t<Button primary onClick={handleResetButtonClick}>\n\t\t\t\t\t\t<Icon name='undo' /> {t('Refresh')}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button onClick={handleBackButtonClick}>\n\t\t\t\t\t\t<Icon name='back' /> {t('Back')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Header>\n\t\t\t<Page.ScrollableContent>\n\t\t\t\t{loading && <LogsLoading />}\n\t\t\t\t{app.error && (\n\t\t\t\t\t<Box maxWidth='x600' alignSelf='center' fontScale='hh21'>\n\t\t\t\t\t\t{app.error.message}\n\t\t\t\t\t</Box>\n\t\t\t\t)}\n\t\t\t\t{showData && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<Accordion maxWidth='x600' alignSelf='center'>\n\t\t\t\t\t\t\t{app.logs &&\n\t\t\t\t\t\t\t\tapp.logs.map((log) => (\n\t\t\t\t\t\t\t\t\t<LogItem\n\t\t\t\t\t\t\t\t\t\tkey={log._createdAt}\n\t\t\t\t\t\t\t\t\t\ttitle={`${formatDateAndTime(log._createdAt)}: \"${log.method}\" (${log.totalTime}ms)`}\n\t\t\t\t\t\t\t\t\t\tinstanceId={log.instanceId}\n\t\t\t\t\t\t\t\t\t\tentries={log.entries}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</Accordion>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</Page.ScrollableContent>\n\n\t\t\t<Pagination\n\t\t\t\tmi='x24'\n\t\t\t\tdivider\n\t\t\t\tcurrent={current}\n\t\t\t\titemsPerPage={itemsPerPage}\n\t\t\t\titemsPerPageLabel={itemsPerPageLabel}\n\t\t\t\tshowingResultsLabel={showingResultsLabel}\n\t\t\t\tcount={logEntriesCount}\n\t\t\t\tonSetItemsPerPage={setItemsPerPage}\n\t\t\t\tonSetCurrent={setCurrent}\n\t\t\t/>\n\t\t</Page>\n\t);\n}\n\nexport default AppLogsPage;\n"]}