{"version":3,"sources":["meteor://ðŸ’»app/client/views/login/ResetPassword/ResetPassword.js"],"names":["_regeneratorRuntime","module","link","default","v","_toConsumableArray","_slicedToArray","Button","TextInput","Field","Modal","Box","Throbber","useSafely","Meteor","React","useState","useCallback","useMemo","useRouteParameter","useRoute","useMethod","useTranslation","useUser","useMethodData","LoginLayout","getChangePasswordReason","requirePasswordChange","requirePasswordChangeReason","ResetPassword","user","t","setUserPassword","resetPassword","token","params","value","policyEnabled","enabled","policies","policy","router","changePasswordReason","newPassword","setNewPassword","isLoading","setIsLoading","error","setError","handleOnChange","event","currentTarget","isSubmitDisabled","trim","handleSubmit","e","preventDefault","result","loginWithToken","push","reason","map","index","exportDefault"],"mappings":"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","file":"dynamic/client/views/login/ResetPassword/ResetPassword.js","sourcesContent":["import { Button, TextInput, Field, Modal, Box, Throbber } from '@rocket.chat/fuselage';\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\nimport { Meteor } from 'meteor/meteor';\nimport React, { useState, useCallback, useMemo } from 'react';\n\nimport { useRouteParameter, useRoute } from '../../../contexts/RouterContext';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useUser } from '../../../contexts/UserContext';\nimport { useMethodData } from '../../../hooks/useMethodData';\nimport LoginLayout from '../LoginLayout';\n\nconst getChangePasswordReason = ({\n\trequirePasswordChange,\n\trequirePasswordChangeReason = requirePasswordChange ? 'You_need_to_change_your_password' : 'Please_enter_your_new_password_below',\n} = {}) => requirePasswordChangeReason;\n\nconst ResetPassword = () => {\n\tconst user = useUser();\n\tconst t = useTranslation();\n\tconst setUserPassword = useMethod('setUserPassword');\n\tconst resetPassword = useMethod('resetPassword');\n\tconst token = useRouteParameter('token');\n\tconst params = useMemo(\n\t\t() => [\n\t\t\t{\n\t\t\t\ttoken,\n\t\t\t},\n\t\t],\n\t\t[token],\n\t);\n\n\tconst { value: { enabled: policyEnabled, policy: policies } = {} } = useMethodData('getPasswordPolicy', params);\n\n\tconst router = useRoute('home');\n\n\tconst changePasswordReason = getChangePasswordReason(user || {});\n\n\tconst [newPassword, setNewPassword] = useState('');\n\tconst [isLoading, setIsLoading] = useSafely(useState(false));\n\tconst [error, setError] = useSafely(useState());\n\n\tconst handleOnChange = useCallback((event) => setNewPassword(event.currentTarget.value), [setNewPassword]);\n\n\tconst isSubmitDisabled = !newPassword.trim() || isLoading;\n\n\tconst handleSubmit = useCallback(\n\t\tasync (e) => {\n\t\t\te.preventDefault();\n\t\t\tif (isSubmitDisabled) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetIsLoading(true);\n\t\t\ttry {\n\t\t\t\tif (token && resetPassword) {\n\t\t\t\t\tconst result = await resetPassword(token, newPassword);\n\t\t\t\t\tawait Meteor.loginWithToken(result.token);\n\t\t\t\t\trouter.push({});\n\t\t\t\t} else {\n\t\t\t\t\tawait setUserPassword(newPassword);\n\t\t\t\t}\n\t\t\t} catch ({ error, reason = error }) {\n\t\t\t\tsetError(reason);\n\t\t\t} finally {\n\t\t\t\tsetIsLoading(false);\n\t\t\t}\n\t\t},\n\t\t[isSubmitDisabled, setIsLoading, token, resetPassword, newPassword, router, setUserPassword, setError],\n\t);\n\n\treturn (\n\t\t<LoginLayout>\n\t\t\t<Modal is='form' onSubmit={handleSubmit}>\n\t\t\t\t<Modal.Header>\n\t\t\t\t\t<Modal.Title textAlign='start'>{t('Password')}</Modal.Title>\n\t\t\t\t</Modal.Header>\n\t\t\t\t<Modal.Content>\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<Field.Label>{t(changePasswordReason)}</Field.Label>\n\t\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\t\tplaceholder={t('Type_your_new_password')}\n\t\t\t\t\t\t\t\ttype='password'\n\t\t\t\t\t\t\t\tname='newPassword'\n\t\t\t\t\t\t\t\tid='newPassword'\n\t\t\t\t\t\t\t\tdir='auto'\n\t\t\t\t\t\t\t\tonChange={handleOnChange}\n\t\t\t\t\t\t\t\tautoComplete='off'\n\t\t\t\t\t\t\t\tvalue={newPassword}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Field.Row>\n\t\t\t\t\t\t{error && <Field.Error>{error}</Field.Error>}\n\t\t\t\t\t\t{policyEnabled && (\n\t\t\t\t\t\t\t<Field.Hint>\n\t\t\t\t\t\t\t\t{policies.map((policy, index) => (\n\t\t\t\t\t\t\t\t\t<Box is='p' textAlign='start' key={index}>\n\t\t\t\t\t\t\t\t\t\t{t(...policy)}\n\t\t\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</Field.Hint>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</Field>\n\t\t\t\t</Modal.Content>\n\t\t\t\t<Modal.Footer>\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t\t<Button primary disabled={isSubmitDisabled} type='submit'>\n\t\t\t\t\t\t\t\t{isLoading ? <Throbber size='x12' inheritColor /> : t('Reset')}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</Field.Row>\n\t\t\t\t\t</Field>\n\t\t\t\t</Modal.Footer>\n\t\t\t</Modal>\n\t\t</LoginLayout>\n\t);\n};\n\nexport default ResetPassword;\n"]}