{"version":3,"sources":["meteor://ðŸ’»app/client/views/account/security/TwoFactorTOTP.js"],"names":["_regeneratorRuntime","module","link","default","v","_extends","_slicedToArray","Box","Button","TextInput","Margins","useSafely","React","useState","useCallback","useEffect","qrcode","TextCopy","TwoFactorTotpModal","useSetModal","useMethod","useToastMessageDispatch","useTranslation","useUser","useForm","BackupCodesModal","TwoFactorTOTP","props","t","dispatchToastMessage","user","setModal","enableTotpFn","disableTotpFn","verifyCodeFn","checkCodesRemainingFn","regenerateCodesFn","registeringTotp","setRegisteringTotp","qrCode","setQrCode","totpSecret","setTotpSecret","codesRemaining","setCodesRemaining","authCode","values","handlers","handleAuthCode","totpEnabled","services","totp","enabled","closeModal","updateCodesRemaining","result","remaining","handleEnableTotp","secret","url","size","type","message","handleDisableTotp","onDisable","handleVerifyCode","codes","handleRegenerateCodes","onRegenerate","number","exportDefault"],"mappings":"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","file":"dynamic/client/views/account/security/TwoFactorTOTP.js","sourcesContent":["import { Box, Button, TextInput, Margins } from '@rocket.chat/fuselage';\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\nimport React, { useState, useCallback, useEffect } from 'react';\nimport qrcode from 'yaqrcode';\n\nimport TextCopy from '../../../components/TextCopy';\nimport TwoFactorTotpModal from '../../../components/TwoFactorModal/TwoFactorTotpModal';\nimport { useSetModal } from '../../../contexts/ModalContext';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useUser } from '../../../contexts/UserContext';\nimport { useForm } from '../../../hooks/useForm';\nimport BackupCodesModal from './BackupCodesModal';\n\nconst TwoFactorTOTP = (props) => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst user = useUser();\n\tconst setModal = useSetModal();\n\n\tconst enableTotpFn = useMethod('2fa:enable');\n\tconst disableTotpFn = useMethod('2fa:disable');\n\tconst verifyCodeFn = useMethod('2fa:validateTempToken');\n\tconst checkCodesRemainingFn = useMethod('2fa:checkCodesRemaining');\n\tconst regenerateCodesFn = useMethod('2fa:regenerateCodes');\n\n\tconst [registeringTotp, setRegisteringTotp] = useSafely(useState(false));\n\tconst [qrCode, setQrCode] = useSafely(useState());\n\tconst [totpSecret, setTotpSecret] = useSafely(useState());\n\tconst [codesRemaining, setCodesRemaining] = useSafely(useState());\n\n\tconst { values, handlers } = useForm({ authCode: '' });\n\n\tconst { authCode } = values;\n\tconst { handleAuthCode } = handlers;\n\n\tconst totpEnabled = user && user.services && user.services.totp && user.services.totp.enabled;\n\n\tconst closeModal = useCallback(() => setModal(null), [setModal]);\n\n\tuseEffect(() => {\n\t\tconst updateCodesRemaining = async () => {\n\t\t\tif (!totpEnabled) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst result = await checkCodesRemainingFn();\n\t\t\tsetCodesRemaining(result.remaining);\n\t\t};\n\t\tupdateCodesRemaining();\n\t}, [checkCodesRemainingFn, setCodesRemaining, totpEnabled]);\n\n\tconst handleEnableTotp = useCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await enableTotpFn();\n\n\t\t\tsetTotpSecret(result.secret);\n\t\t\tsetQrCode(qrcode(result.url, { size: 200 }));\n\n\t\t\tsetRegisteringTotp(true);\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [dispatchToastMessage, enableTotpFn, setQrCode, setRegisteringTotp, setTotpSecret]);\n\n\tconst handleDisableTotp = useCallback(async () => {\n\t\tconst onDisable = async (authCode) => {\n\t\t\ttry {\n\t\t\t\tconst result = await disableTotpFn(authCode);\n\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Invalid_two_factor_code') });\n\t\t\t\t}\n\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Two-factor_authentication_disabled') });\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t\tcloseModal();\n\t\t};\n\n\t\tsetModal(<TwoFactorTotpModal onConfirm={onDisable} onClose={closeModal} />);\n\t}, [closeModal, disableTotpFn, dispatchToastMessage, setModal, t]);\n\n\tconst handleVerifyCode = useCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await verifyCodeFn(authCode);\n\n\t\t\tif (!result) {\n\t\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Invalid_two_factor_code') });\n\t\t\t}\n\t\t\tsetModal(<BackupCodesModal codes={result.codes} onClose={closeModal} />);\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [authCode, closeModal, dispatchToastMessage, setModal, t, verifyCodeFn]);\n\n\tconst handleRegenerateCodes = useCallback(() => {\n\t\tconst onRegenerate = async (authCode) => {\n\t\t\ttry {\n\t\t\t\tconst result = await regenerateCodesFn(authCode);\n\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Invalid_two_factor_code') });\n\t\t\t\t}\n\t\t\t\tsetModal(<BackupCodesModal codes={result.codes} onClose={closeModal} />);\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t};\n\n\t\tsetModal(<TwoFactorTotpModal onConfirm={onRegenerate} onClose={closeModal} />);\n\t}, [closeModal, dispatchToastMessage, regenerateCodesFn, setModal, t]);\n\n\treturn (\n\t\t<Box display='flex' flexDirection='column' alignItems='flex-start' {...props}>\n\t\t\t<Margins blockEnd='x8'>\n\t\t\t\t<Box fontScale='h4'>{t('Two-factor_authentication')}</Box>\n\t\t\t\t{!totpEnabled && !registeringTotp && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<Box>{t('Two-factor_authentication_is_currently_disabled')}</Box>\n\t\t\t\t\t\t<Button primary onClick={handleEnableTotp}>\n\t\t\t\t\t\t\t{t('Enable_two-factor_authentication')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t\t{!totpEnabled && registeringTotp && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<Box>{t('Scan_QR_code')}</Box>\n\t\t\t\t\t\t<Box>{t('Scan_QR_code_alternative_s')}</Box>\n\t\t\t\t\t\t<TextCopy text={totpSecret} />\n\t\t\t\t\t\t<Box is='img' size='x200' src={qrCode} aria-hidden='true' />\n\t\t\t\t\t\t<Box display='flex' flexDirection='row' w='full'>\n\t\t\t\t\t\t\t<TextInput placeholder={t('Enter_authentication_code')} value={authCode} onChange={handleAuthCode} />\n\t\t\t\t\t\t\t<Button primary onClick={handleVerifyCode}>\n\t\t\t\t\t\t\t\t{t('Verify')}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t\t{totpEnabled && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<Button primary danger onClick={handleDisableTotp}>\n\t\t\t\t\t\t\t{t('Disable_two-factor_authentication')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Box fontScale='p2m' mbs='x8'>\n\t\t\t\t\t\t\t{t('Backup_codes')}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t<Box>{t('You_have_n_codes_remaining', { number: codesRemaining })}</Box>\n\t\t\t\t\t\t<Button onClick={handleRegenerateCodes}>{t('Regenerate_codes')}</Button>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</Margins>\n\t\t</Box>\n\t);\n};\n\nexport default TwoFactorTOTP;\n"]}