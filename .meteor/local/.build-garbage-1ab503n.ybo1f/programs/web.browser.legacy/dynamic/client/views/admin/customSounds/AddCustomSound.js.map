{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/customSounds/AddCustomSound.js"],"names":["_regeneratorRuntime","module","link","default","v","_slicedToArray","_objectWithoutProperties","Field","TextInput","Box","Icon","Margins","Button","ButtonGroup","React","useState","useCallback","VerticalBar","useMethod","useToastMessageDispatch","useTranslation","useFileInput","validate","createSoundData","AddCustomSound","goToNew","close","onChange","props","t","dispatchToastMessage","name","setName","sound","setSound","uploadCustomSound","insertOrUpdateSound","handleChangeFile","soundFile","clickUpload","saveAction","soundData","validation","length","soundId","type","message","_id","random","Math","round","reader","FileReader","readAsBinaryString","onloadend","result","error","forEach","Error","field","handleSave","e","currentTarget","value","exportDefault"],"mappings":";;;;;;;;;;AAAA,IAAIA,mBAAJ;;AAAwBC,MAAM,CAACC,IAAP,CAAY,4BAAZ,EAAyC;AAACC,SAAO,EAAC,UAASC,CAAT,EAAW;AAACJ,uBAAmB,GAACI,CAApB;AAAsB;AAA3C,CAAzC,EAAsF,CAAtF;;AAAyF,IAAIC,cAAJ;;AAAmBJ,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACC,SAAO,EAAC,UAASC,CAAT,EAAW;AAACC,kBAAc,GAACD,CAAf;AAAiB;AAAtC,CAAnD,EAA2F,CAA3F;;AAA8F,IAAIE,wBAAJ;;AAA6BL,MAAM,CAACC,IAAP,CAAY,gDAAZ,EAA6D;AAACC,SAAO,EAAC,UAASC,CAAT,EAAW;AAACE,4BAAwB,GAACF,CAAzB;AAA2B;AAAhD,CAA7D,EAA+G,CAA/G;AAA/P,IAAIG,KAAJ,EAAUC,SAAV,EAAoBC,GAApB,EAAwBC,IAAxB,EAA6BC,OAA7B,EAAqCC,MAArC,EAA4CC,WAA5C;AAAwDZ,MAAM,CAACC,IAAP,CAAY,uBAAZ,EAAoC;AAACK,OAAK,EAAC,UAASH,CAAT,EAAW;AAACG,SAAK,GAACH,CAAN;AAAQ,GAA3B;AAA4BI,WAAS,EAAC,UAASJ,CAAT,EAAW;AAACI,aAAS,GAACJ,CAAV;AAAY,GAA9D;AAA+DK,KAAG,EAAC,UAASL,CAAT,EAAW;AAACK,OAAG,GAACL,CAAJ;AAAM,GAArF;AAAsFM,MAAI,EAAC,UAASN,CAAT,EAAW;AAACM,QAAI,GAACN,CAAL;AAAO,GAA9G;AAA+GO,SAAO,EAAC,UAASP,CAAT,EAAW;AAACO,WAAO,GAACP,CAAR;AAAU,GAA7I;AAA8IQ,QAAM,EAAC,UAASR,CAAT,EAAW;AAACQ,UAAM,GAACR,CAAP;AAAS,GAA1K;AAA2KS,aAAW,EAAC,UAAST,CAAT,EAAW;AAACS,eAAW,GAACT,CAAZ;AAAc;AAAjN,CAApC,EAAuP,CAAvP;AAA0P,IAAIU,KAAJ,EAAUC,QAAV,EAAmBC,WAAnB;AAA+Bf,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAoB;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACU,SAAK,GAACV,CAAN;AAAQ,GAA7B;AAA8BW,UAAQ,EAAC,UAASX,CAAT,EAAW;AAACW,YAAQ,GAACX,CAAT;AAAW,GAA9D;AAA+DY,aAAW,EAAC,UAASZ,CAAT,EAAW;AAACY,eAAW,GAACZ,CAAZ;AAAc;AAArG,CAApB,EAA2H,CAA3H;AAA8H,IAAIa,WAAJ;AAAgBhB,MAAM,CAACC,IAAP,CAAY,iCAAZ,EAA8C;AAAC,aAAQ,UAASE,CAAT,EAAW;AAACa,eAAW,GAACb,CAAZ;AAAc;AAAnC,CAA9C,EAAmF,CAAnF;AAAsF,IAAIc,SAAJ;AAAcjB,MAAM,CAACC,IAAP,CAAY,iCAAZ,EAA8C;AAACgB,WAAS,EAAC,UAASd,CAAT,EAAW;AAACc,aAAS,GAACd,CAAV;AAAY;AAAnC,CAA9C,EAAmF,CAAnF;AAAsF,IAAIe,uBAAJ;AAA4BlB,MAAM,CAACC,IAAP,CAAY,wCAAZ,EAAqD;AAACiB,yBAAuB,EAAC,UAASf,CAAT,EAAW;AAACe,2BAAuB,GAACf,CAAxB;AAA0B;AAA/D,CAArD,EAAsH,CAAtH;AAAyH,IAAIgB,cAAJ;AAAmBnB,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACkB,gBAAc,EAAC,UAAShB,CAAT,EAAW;AAACgB,kBAAc,GAAChB,CAAf;AAAiB;AAA7C,CAAnD,EAAkG,CAAlG;AAAqG,IAAIiB,YAAJ;AAAiBpB,MAAM,CAACC,IAAP,CAAY,6BAAZ,EAA0C;AAACmB,cAAY,EAAC,UAASjB,CAAT,EAAW;AAACiB,gBAAY,GAACjB,CAAb;AAAe;AAAzC,CAA1C,EAAqF,CAArF;AAAwF,IAAIkB,QAAJ,EAAaC,eAAb;AAA6BtB,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAoB;AAACoB,UAAQ,EAAC,UAASlB,CAAT,EAAW;AAACkB,YAAQ,GAAClB,CAAT;AAAW,GAAjC;AAAkCmB,iBAAe,EAAC,UAASnB,CAAT,EAAW;AAACmB,mBAAe,GAACnB,CAAhB;AAAkB;AAAhF,CAApB,EAAsG,CAAtG;;AAU5iC,SAASoB,cAAT,OAAgE;AAAA,MAAtCC,OAAsC,QAAtCA,OAAsC;AAAA,MAA7BC,KAA6B,QAA7BA,KAA6B;AAAA,MAAtBC,QAAsB,QAAtBA,QAAsB;AAAA,MAATC,KAAS;;AAC/D,MAAMC,CAAC,GAAGT,cAAc,EAAxB;AACA,MAAMU,oBAAoB,GAAGX,uBAAuB,EAApD;;AAEA,kBAAwBJ,QAAQ,CAAC,EAAD,CAAhC;AAAA;AAAA,MAAOgB,IAAP;AAAA,MAAaC,OAAb;;AACA,mBAA0BjB,QAAQ,EAAlC;AAAA;AAAA,MAAOkB,KAAP;AAAA,MAAcC,QAAd;;AAEA,MAAMC,iBAAiB,GAAGjB,SAAS,CAAC,mBAAD,CAAnC;AAEA,MAAMkB,mBAAmB,GAAGlB,SAAS,CAAC,qBAAD,CAArC;AAEA,MAAMmB,gBAAgB,GAAGrB,WAAW,CAAC,UAACsB,SAAD,EAAe;AACnDJ,YAAQ,CAACI,SAAD,CAAR;AACA,GAFmC,EAEjC,EAFiC,CAApC;;AAIA,sBAAsBjB,YAAY,CAACgB,gBAAD,EAAmB,WAAnB,CAAlC;AAAA;AAAA,MAAOE,WAAP;;AAEA,MAAMC,UAAU,GAAGxB,WAAW;AAC7B,qBAAOe,IAAP,EAAaO,SAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACOG,yBADP,GACmBlB,eAAe,CAACe,SAAD,EAAYP,IAAZ,CADlC;AAEOW,0BAFP,GAEoBpB,QAAQ,CAACmB,SAAD,EAAYH,SAAZ,CAF5B;;AAAA,sBAGKI,UAAU,CAACC,MAAX,KAAsB,CAH3B;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,iDAMmBP,mBAAmB,CAACK,SAAD,CANtC;;AAAA;AAMGG,uBANH;AAAA;AAAA;;AAAA;AAAA;AAAA;AAQGd,oCAAoB,CAAC;AAAEe,sBAAI,EAAE,OAAR;AAAiBC,yBAAO;AAAxB,iBAAD,CAApB;;AARH;AAWEL,yBAAS,CAACM,GAAV,GAAgBH,OAAhB;AACAH,yBAAS,CAACO,MAAV,GAAmBC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACD,MAAL,KAAgB,IAA3B,CAAnB;;AAEA,oBAAIJ,OAAJ,EAAa;AACZd,sCAAoB,CAAC;AAAEe,wBAAI,EAAE,SAAR;AAAmBC,2BAAO,EAAEjB,CAAC,CAAC,gBAAD;AAA7B,mBAAD,CAApB;AAEMsB,wBAHM,GAGG,IAAIC,UAAJ,EAHH;AAIZD,wBAAM,CAACE,kBAAP,CAA0Bf,SAA1B;;AACAa,wBAAM,CAACG,SAAP,GAAmB,YAAM;AACxB,wBAAI;AACHnB,uCAAiB,CAACgB,MAAM,CAACI,MAAR,EAAgBjB,SAAS,CAACO,IAA1B,EAAgCJ,SAAhC,CAAjB;AACAX,0CAAoB,CAAC;AAAEe,4BAAI,EAAE,SAAR;AAAmBC,+BAAO,EAAEjB,CAAC,CAAC,eAAD;AAA7B,uBAAD,CAApB;AACA,qBAHD,CAGE,OAAO2B,KAAP,EAAc;AACf1B,0CAAoB,CAAC;AAAEe,4BAAI,EAAE,OAAR;AAAiBC,+BAAO,EAAEU;AAA1B,uBAAD,CAApB;AACA;AACD,mBAPD;AAQA;;AA3BH,iDA4BSZ,OA5BT;;AAAA;AA8BCF,0BAAU,CAACe,OAAX,CAAmB,UAACD,KAAD,EAAW;AAC7B,wBAAM,IAAIE,KAAJ,CAAU;AACfb,wBAAI,EAAE,OADS;AAEfC,2BAAO,EAAEjB,CAAC,CAAC,6BAAD,EAAgC;AAAE8B,2BAAK,EAAE9B,CAAC,CAAC2B,KAAD;AAAV,qBAAhC;AAFK,mBAAV,CAAN;AAIA,iBALD;;AA9BD;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAD6B;AAAA,OAsC7B,CAAC1B,oBAAD,EAAuBM,mBAAvB,EAA4CP,CAA5C,EAA+CM,iBAA/C,CAtC6B,CAA9B;AAyCA,MAAMyB,UAAU,GAAG5C,WAAW;AAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iDAERwB,UAAU,CAACT,IAAD,EAAOE,KAAP,CAFF;;AAAA;AAEvBsB,sBAFuB;AAG7BzB,oCAAoB,CAAC;AAAEe,sBAAI,EAAE,SAAR;AAAmBC,yBAAO,EAAEjB,CAAC,CAAC,iCAAD;AAA7B,iBAAD,CAApB;AACAJ,uBAAO,CAAC8B,MAAD,CAAP;AACA5B,wBAAQ;AALqB;AAAA;;AAAA;AAAA;AAAA;AAO7BG,oCAAoB,CAAC;AAAEe,sBAAI,EAAE,OAAR;AAAiBC,yBAAO;AAAxB,iBAAD,CAApB;;AAP6B;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAD;AAAA,OAS3B,CAAChB,oBAAD,EAAuBL,OAAvB,EAAgCM,IAAhC,EAAsCJ,QAAtC,EAAgDa,UAAhD,EAA4DP,KAA5D,EAAmEJ,CAAnE,CAT2B,CAA9B;AAWA,sBACC,oBAAC,WAAD,CAAa,iBAAb,EAAmCD,KAAnC,eACC,oBAAC,KAAD,qBACC,oBAAC,KAAD,CAAO,KAAP,QAAcC,CAAC,CAAC,MAAD,CAAf,CADD,eAEC,oBAAC,KAAD,CAAO,GAAP,qBACC,oBAAC,SAAD;AAAW,SAAK,EAAEE,IAAlB;AAAwB,YAAQ,EAAE,UAAC8B,CAAD;AAAA,aAAO7B,OAAO,CAAC6B,CAAC,CAACC,aAAF,CAAgBC,KAAjB,CAAd;AAAA,KAAlC;AAAyE,eAAW,EAAElC,CAAC,CAAC,MAAD;AAAvF,IADD,CAFD,CADD,eAOC,oBAAC,KAAD,qBACC,oBAAC,KAAD,CAAO,KAAP;AAAa,aAAS,EAAC;AAAvB,KAAkCA,CAAC,CAAC,gBAAD,CAAnC,CADD,eAEC,oBAAC,GAAD;AAAK,WAAO,EAAC,MAAb;AAAoB,iBAAa,EAAC,KAAlC;AAAwC,OAAG,EAAC;AAA5C,kBACC,oBAAC,OAAD;AAAS,UAAM,EAAC;AAAhB,kBACC,oBAAC,MAAD;AAAQ,UAAM,MAAd;AAAe,WAAO,EAAEU;AAAxB,kBACC,oBAAC,IAAD;AAAM,QAAI,EAAC,QAAX;AAAoB,QAAI,EAAC;AAAzB,IADD,CADD,EAIGN,KAAK,IAAIA,KAAK,CAACF,IAAhB,IAAyB,MAJ3B,CADD,CAFD,CAPD,eAkBC,oBAAC,KAAD,qBACC,oBAAC,KAAD,CAAO,GAAP,qBACC,oBAAC,WAAD;AAAa,WAAO,MAApB;AAAqB,KAAC,EAAC;AAAvB,kBACC,oBAAC,MAAD;AAAQ,OAAG,EAAC,IAAZ;AAAiB,WAAO,EAAEL;AAA1B,KACEG,CAAC,CAAC,QAAD,CADH,CADD,eAIC,oBAAC,MAAD;AAAQ,WAAO,MAAf;AAAgB,WAAO,EAAE+B,UAAzB;AAAqC,YAAQ,EAAE7B,IAAI,KAAK;AAAxD,KACEF,CAAC,CAAC,MAAD,CADH,CAJD,CADD,CADD,CAlBD,CADD;AAiCA;;AAhHD5B,MAAM,CAAC+D,aAAP,CAkHexC,cAlHf,E","file":"dynamic/client/views/admin/customSounds/AddCustomSound.js","sourcesContent":["import { Field, TextInput, Box, Icon, Margins, Button, ButtonGroup } from '@rocket.chat/fuselage';\nimport React, { useState, useCallback } from 'react';\n\nimport VerticalBar from '../../../components/VerticalBar';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useFileInput } from '../../../hooks/useFileInput';\nimport { validate, createSoundData } from './lib';\n\nfunction AddCustomSound({ goToNew, close, onChange, ...props }) {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst [name, setName] = useState('');\n\tconst [sound, setSound] = useState();\n\n\tconst uploadCustomSound = useMethod('uploadCustomSound');\n\n\tconst insertOrUpdateSound = useMethod('insertOrUpdateSound');\n\n\tconst handleChangeFile = useCallback((soundFile) => {\n\t\tsetSound(soundFile);\n\t}, []);\n\n\tconst [clickUpload] = useFileInput(handleChangeFile, 'audio/mp3');\n\n\tconst saveAction = useCallback(\n\t\tasync (name, soundFile) => {\n\t\t\tconst soundData = createSoundData(soundFile, name);\n\t\t\tconst validation = validate(soundData, soundFile);\n\t\t\tif (validation.length === 0) {\n\t\t\t\tlet soundId;\n\t\t\t\ttry {\n\t\t\t\t\tsoundId = await insertOrUpdateSound(soundData);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t}\n\n\t\t\t\tsoundData._id = soundId;\n\t\t\t\tsoundData.random = Math.round(Math.random() * 1000);\n\n\t\t\t\tif (soundId) {\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Uploading_file') });\n\n\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\treader.readAsBinaryString(soundFile);\n\t\t\t\t\treader.onloadend = () => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tuploadCustomSound(reader.result, soundFile.type, soundData);\n\t\t\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('File_uploaded') });\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn soundId;\n\t\t\t}\n\t\t\tvalidation.forEach((error) => {\n\t\t\t\tthrow new Error({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\tmessage: t('error-the-field-is-required', { field: t(error) }),\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t[dispatchToastMessage, insertOrUpdateSound, t, uploadCustomSound],\n\t);\n\n\tconst handleSave = useCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await saveAction(name, sound);\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Custom_Sound_Saved_Successfully') });\n\t\t\tgoToNew(result)();\n\t\t\tonChange();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [dispatchToastMessage, goToNew, name, onChange, saveAction, sound, t]);\n\n\treturn (\n\t\t<VerticalBar.ScrollableContent {...props}>\n\t\t\t<Field>\n\t\t\t\t<Field.Label>{t('Name')}</Field.Label>\n\t\t\t\t<Field.Row>\n\t\t\t\t\t<TextInput value={name} onChange={(e) => setName(e.currentTarget.value)} placeholder={t('Name')} />\n\t\t\t\t</Field.Row>\n\t\t\t</Field>\n\t\t\t<Field>\n\t\t\t\t<Field.Label alignSelf='stretch'>{t('Sound_File_mp3')}</Field.Label>\n\t\t\t\t<Box display='flex' flexDirection='row' mbs='none'>\n\t\t\t\t\t<Margins inline='x4'>\n\t\t\t\t\t\t<Button square onClick={clickUpload}>\n\t\t\t\t\t\t\t<Icon name='upload' size='x20' />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t{(sound && sound.name) || 'none'}\n\t\t\t\t\t</Margins>\n\t\t\t\t</Box>\n\t\t\t</Field>\n\t\t\t<Field>\n\t\t\t\t<Field.Row>\n\t\t\t\t\t<ButtonGroup stretch w='full'>\n\t\t\t\t\t\t<Button mie='x4' onClick={close}>\n\t\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button primary onClick={handleSave} disabled={name === ''}>\n\t\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Field.Row>\n\t\t\t</Field>\n\t\t</VerticalBar.ScrollableContent>\n\t);\n}\n\nexport default AddCustomSound;\n"]}