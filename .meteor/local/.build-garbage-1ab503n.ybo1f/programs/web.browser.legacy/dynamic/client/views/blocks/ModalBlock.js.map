{"version":3,"sources":["meteor://ðŸ’»app/client/views/blocks/ModalBlock.js"],"names":["_slicedToArray","module","link","default","v","export","modalParser","Modal","AnimatedVisibility","ButtonGroup","Button","Box","useUniqueId","UiKitComponent","UiKitModal","React","useCallback","useEffect","useMemo","useRef","getURL","focusableElementsString","focusableElementsStringInvalid","ModalBlock","view","errors","appId","onSubmit","onClose","onCancel","id","ref","current","Object","keys","length","element","querySelector","focus","previousFocus","document","activeElement","handleKeyDown","event","keyCode","target","nodeName","stopPropagation","preventDefault","elements","Array","from","querySelectorAll","first","last","pop","contains","shiftKey","container","close","e","ignoreIfnotContains","addEventListener","removeEventListener","UNHIDING","showIcon","text","title","blocks","submit","exportDefault"],"mappings":"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","file":"dynamic/client/views/blocks/ModalBlock.js","sourcesContent":["import { Modal, AnimatedVisibility, ButtonGroup, Button, Box } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { UiKitComponent, UiKitModal, modalParser } from '@rocket.chat/fuselage-ui-kit';\nimport React, { useCallback, useEffect, useMemo, useRef } from 'react';\n\nimport { getURL } from '../../../app/utils/lib/getURL';\nimport './textParsers';\n\nconst focusableElementsString = `\n\ta[href]:not([tabindex=\"-1\"]),\n\tarea[href]:not([tabindex=\"-1\"]),\n\tinput:not([disabled]):not([tabindex=\"-1\"]),\n\tselect:not([disabled]):not([tabindex=\"-1\"]),\n\ttextarea:not([disabled]):not([tabindex=\"-1\"]),\n\tbutton:not([disabled]):not([tabindex=\"-1\"]),\n\tiframe,\n\tobject,\n\tembed,\n\t[tabindex]:not([tabindex=\"-1\"]),\n\t[contenteditable]`;\n\nconst focusableElementsStringInvalid = `\n\ta[href]:not([tabindex=\"-1\"]):invalid,\n\tarea[href]:not([tabindex=\"-1\"]):invalid,\n\tinput:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tselect:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\ttextarea:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tbutton:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tiframe:invalid,\n\tobject:invalid,\n\tembed:invalid,\n\t[tabindex]:not([tabindex=\"-1\"]):invalid,\n\t[contenteditable]:invalid`;\n\nfunction ModalBlock({ view, errors, appId, onSubmit, onClose, onCancel }) {\n\tconst id = `modal_id_${useUniqueId()}`;\n\tconst ref = useRef();\n\n\t// Auto focus\n\tuseEffect(() => {\n\t\tif (!ref.current) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (errors && Object.keys(errors).length) {\n\t\t\tconst element = ref.current.querySelector(focusableElementsStringInvalid);\n\t\t\telement && element.focus();\n\t\t} else {\n\t\t\tconst element = ref.current.querySelector(focusableElementsString);\n\t\t\telement && element.focus();\n\t\t}\n\t}, [errors]);\n\t// save focus to restore after close\n\tconst previousFocus = useMemo(() => document.activeElement, []);\n\t// restore the focus after the component unmount\n\tuseEffect(() => () => previousFocus && previousFocus.focus(), [previousFocus]);\n\t// Handle Tab, Shift + Tab, Enter and Escape\n\tconst handleKeyDown = useCallback(\n\t\t(event) => {\n\t\t\tif (event.keyCode === 13) {\n\t\t\t\t// ENTER\n\t\t\t\tif (event?.target?.nodeName !== 'TEXTAREA') {\n\t\t\t\t\treturn onSubmit(event);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (event.keyCode === 27) {\n\t\t\t\t// ESC\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tonClose();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (event.keyCode === 9) {\n\t\t\t\t// TAB\n\t\t\t\tconst elements = Array.from(ref.current.querySelectorAll(focusableElementsString));\n\t\t\t\tconst [first] = elements;\n\t\t\t\tconst last = elements.pop();\n\n\t\t\t\tif (!ref.current.contains(document.activeElement)) {\n\t\t\t\t\treturn first.focus();\n\t\t\t\t}\n\n\t\t\t\tif (event.shiftKey) {\n\t\t\t\t\tif (!first || first === document.activeElement) {\n\t\t\t\t\t\tlast.focus();\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!last || last === document.activeElement) {\n\t\t\t\t\tfirst.focus();\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[onClose, onSubmit],\n\t);\n\t// Clean the events\n\tuseEffect(() => {\n\t\tconst element = document.querySelector('.rc-modal-wrapper');\n\t\tconst container = element.querySelector('.rcx-modal__content');\n\t\tconst close = (e) => {\n\t\t\tif (e.target !== element) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tonClose();\n\t\t\treturn false;\n\t\t};\n\n\t\tconst ignoreIfnotContains = (e) => {\n\t\t\tif (!container.contains(e.target)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn handleKeyDown(e);\n\t\t};\n\n\t\tdocument.addEventListener('keydown', ignoreIfnotContains);\n\t\telement.addEventListener('click', close);\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('keydown', ignoreIfnotContains);\n\t\t\telement.removeEventListener('click', close);\n\t\t};\n\t}, [handleKeyDown, onClose]);\n\n\treturn (\n\t\t<AnimatedVisibility visibility={AnimatedVisibility.UNHIDING}>\n\t\t\t<Modal open id={id} ref={ref}>\n\t\t\t\t<Modal.Header>\n\t\t\t\t\t{view.showIcon ? <Modal.Thumb url={getURL(`/api/apps/${appId}/icon`)} /> : null}\n\t\t\t\t\t<Modal.Title>{modalParser.text(view.title)}</Modal.Title>\n\t\t\t\t\t<Modal.Close tabIndex={-1} onClick={onClose} />\n\t\t\t\t</Modal.Header>\n\t\t\t\t<Modal.Content>\n\t\t\t\t\t<Box is='form' method='post' action='#' onSubmit={onSubmit}>\n\t\t\t\t\t\t<UiKitComponent render={UiKitModal} blocks={view.blocks} />\n\t\t\t\t\t</Box>\n\t\t\t\t</Modal.Content>\n\t\t\t\t<Modal.Footer>\n\t\t\t\t\t<ButtonGroup align='end'>\n\t\t\t\t\t\t{view.close && <Button onClick={onCancel}>{modalParser.text(view.close.text)}</Button>}\n\t\t\t\t\t\t{view.submit && (\n\t\t\t\t\t\t\t<Button primary onClick={onSubmit}>\n\t\t\t\t\t\t\t\t{modalParser.text(view.submit.text)}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Modal.Footer>\n\t\t\t</Modal>\n\t\t</AnimatedVisibility>\n\t);\n}\n\nexport default ModalBlock;\nexport { modalParser };\n"]}