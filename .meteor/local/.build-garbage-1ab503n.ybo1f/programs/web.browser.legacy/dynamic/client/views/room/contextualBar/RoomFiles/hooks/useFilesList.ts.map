{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/RoomFiles/hooks/useFilesList.ts"],"names":[],"mappings":"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","file":"dynamic/client/views/room/contextualBar/RoomFiles/hooks/useFilesList.ts","sourcesContent":["import { useCallback, useEffect, useMemo, useState } from 'react';\n\nimport { useEndpoint } from '../../../../../contexts/ServerContext';\nimport { useUserRoom, useUserId } from '../../../../../contexts/UserContext';\nimport { useScrollableMessageList } from '../../../../../hooks/lists/useScrollableMessageList';\nimport { useStreamUpdatesForMessageList } from '../../../../../hooks/lists/useStreamUpdatesForMessageList';\nimport { useComponentDidUpdate } from '../../../../../hooks/useComponentDidUpdate';\nimport { FilesList, FilesListOptions } from '../../../../../lib/lists/FilesList';\nimport { getConfig } from '../../../../../lib/utils/getConfig';\n\nexport const useFilesList = (\n\toptions: FilesListOptions,\n): {\n\tfilesList: FilesList;\n\tinitialItemCount: number;\n\treload: () => void;\n\tloadMoreItems: (start: number, end: number) => void;\n} => {\n\tconst [filesList, setFilesList] = useState(() => new FilesList(options));\n\tconst reload = useCallback(() => setFilesList(new FilesList(options)), [options]);\n\tconst room = useUserRoom(options.rid);\n\tconst uid = useUserId();\n\n\tuseComponentDidUpdate(() => {\n\t\toptions && reload();\n\t}, [options, reload]);\n\n\tuseEffect(() => {\n\t\tif (filesList.options !== options) {\n\t\t\tfilesList.updateFilters(options);\n\t\t}\n\t}, [filesList, options]);\n\n\tconst roomTypes = {\n\t\tc: 'channels.files',\n\t\tl: 'channels.files',\n\t\td: 'im.files',\n\t\tp: 'groups.files',\n\t} as const;\n\n\tconst apiEndPoint = room ? roomTypes[room.t] : 'channels.files';\n\n\tconst getFiles = useEndpoint('GET', apiEndPoint);\n\n\tconst fetchMessages = useCallback(\n\t\tasync (start, end) => {\n\t\t\tconst { files, total } = await getFiles({\n\t\t\t\troomId: options.rid,\n\t\t\t\toffset: start,\n\t\t\t\tcount: end,\n\t\t\t\tsort: JSON.stringify({ uploadedAt: -1 }),\n\t\t\t\tquery: JSON.stringify({\n\t\t\t\t\tname: { $regex: options.text || '', $options: 'i' },\n\t\t\t\t\t...(options.type !== 'all' && {\n\t\t\t\t\t\ttypeGroup: options.type,\n\t\t\t\t\t}),\n\t\t\t\t}),\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\titems: files,\n\t\t\t\titemCount: total,\n\t\t\t};\n\t\t},\n\t\t[getFiles, options.rid, options.type, options.text],\n\t);\n\n\tconst { loadMoreItems, initialItemCount } = useScrollableMessageList(\n\t\tfilesList,\n\t\tfetchMessages,\n\t\tuseMemo(() => {\n\t\t\tconst filesListSize = getConfig('discussionListSize');\n\t\t\treturn filesListSize ? parseInt(filesListSize, 10) : undefined;\n\t\t}, []),\n\t);\n\tuseStreamUpdatesForMessageList(filesList, uid, options.rid);\n\n\treturn {\n\t\treload,\n\t\tfilesList,\n\t\tloadMoreItems,\n\t\tinitialItemCount,\n\t};\n};\n"]}