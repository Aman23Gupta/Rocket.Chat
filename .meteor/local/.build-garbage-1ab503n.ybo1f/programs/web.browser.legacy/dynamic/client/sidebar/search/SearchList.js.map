{"version":3,"sources":["meteor://ðŸ’»app/client/sidebar/search/SearchList.js"],"names":["_extends","module","link","default","v","_taggedTemplateLiteralLoose","_objectWithoutProperties","_toConsumableArray","_objectSpread","_slicedToArray","css","Sidebar","TextInput","Box","Icon","useMutableCallback","useDebouncedValue","useStableArray","useAutoFocus","useUniqueId","escapeRegExp","Meteor","React","forwardRef","useState","useMemo","useEffect","useRef","Virtuoso","tinykeys","useSetting","useTranslation","useUserPreference","useUserSubscriptions","AsyncStatePhase","useMethodData","useAvatarTemplate","useTemplateByViewMode","Row","ScrollerWithCustomProps","shortcut","Device","isDesktop","window","navigator","platform","toLowerCase","includes","useSpotlight","filterText","usernames","expression","match","mention","name","searchForChannels","searchForDMs","type","users","rooms","args","value","data","status","phase","options","sort","lm","useSearchItems","teste","query","filterRegex","RegExp","$or","fname","t","$ne","localRooms","usernamesFromClient","map","filter","Boolean","spotlight","resultsFromServer","filterUsersUnique","index","arr","_id","findIndex","user","roomFilter","room","find","item","uids","length","rid","usersfilter","userMap","username","avatarETag","exact","usernamame","push","Array","from","Set","useInput","initial","setValue","onChange","e","currentTarget","toggleSelectionState","next","current","input","setAttribute","id","classList","add","remove","SearchList","ref","onClose","listId","setFilterValue","autofocus","listRef","boxRef","selectedElement","itemIndexRef","sidebarViewMode","showRealName","sideBarItemTemplate","avatarTemplate","extended","placeholder","join","items","itemData","SideBarItemTemplate","changeSelection","dir","nextSelectedElement","parentElement","previousSibling","querySelector","nextSibling","resetCursor","scrollToIndex","undefined","unsubscribe","Escape","event","preventDefault","Tab","ArrowUp","currentElement","Math","max","ArrowDown","min","Enter","click","RESOLVED","height","width","Scroller","exportDefault"],"mappings":"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","file":"dynamic/client/sidebar/search/SearchList.js","sourcesContent":["import { css } from '@rocket.chat/css-in-js';\nimport { Sidebar, TextInput, Box, Icon } from '@rocket.chat/fuselage';\nimport { useMutableCallback, useDebouncedValue, useStableArray, useAutoFocus, useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport { Meteor } from 'meteor/meteor';\nimport React, { forwardRef, useState, useMemo, useEffect, useRef } from 'react';\nimport { Virtuoso } from 'react-virtuoso';\nimport tinykeys from 'tinykeys';\n\nimport { useSetting } from '../../contexts/SettingsContext';\nimport { useTranslation } from '../../contexts/TranslationContext';\nimport { useUserPreference, useUserSubscriptions } from '../../contexts/UserContext';\nimport { AsyncStatePhase } from '../../hooks/useAsyncState';\nimport { useMethodData } from '../../hooks/useMethodData';\nimport { useAvatarTemplate } from '../hooks/useAvatarTemplate';\nimport { useTemplateByViewMode } from '../hooks/useTemplateByViewMode';\nimport Row from './Row';\nimport ScrollerWithCustomProps from './ScrollerWithCustomProps';\n\nconst shortcut = (() => {\n\tif (!Meteor.Device.isDesktop()) {\n\t\treturn '';\n\t}\n\tif (window.navigator.platform.toLowerCase().includes('mac')) {\n\t\treturn '(\\u2318+K)';\n\t}\n\treturn '(\\u2303+K)';\n})();\n\nconst useSpotlight = (filterText = '', usernames) => {\n\tconst expression = /(@|#)?(.*)/i;\n\tconst [, mention, name] = filterText.match(expression);\n\n\tconst searchForChannels = mention === '#';\n\tconst searchForDMs = mention === '@';\n\n\tconst type = useMemo(() => {\n\t\tif (searchForChannels) {\n\t\t\treturn { users: false, rooms: true };\n\t\t}\n\t\tif (searchForDMs) {\n\t\t\treturn { users: true, rooms: false };\n\t\t}\n\t\treturn { users: true, rooms: true };\n\t}, [searchForChannels, searchForDMs]);\n\tconst args = useMemo(() => [name, usernames, type], [type, name, usernames]);\n\n\tconst { value: data = { users: [], rooms: [] }, phase: status } = useMethodData('spotlight', args);\n\n\treturn useMemo(() => {\n\t\tif (!data) {\n\t\t\treturn { data: { users: [], rooms: [] }, status: 'loading' };\n\t\t}\n\t\treturn { data, status };\n\t}, [data, status]);\n};\n\nconst options = {\n\tsort: {\n\t\tlm: -1,\n\t\tname: 1,\n\t},\n};\n\nconst useSearchItems = (filterText) => {\n\tconst expression = /(@|#)?(.*)/i;\n\tconst teste = filterText.match(expression);\n\n\tconst [, type, name] = teste;\n\tconst query = useMemo(() => {\n\t\tconst filterRegex = new RegExp(escapeRegExp(name), 'i');\n\n\t\treturn {\n\t\t\t$or: [{ name: filterRegex }, { fname: filterRegex }],\n\t\t\t...(type && {\n\t\t\t\tt: type === '@' ? 'd' : { $ne: 'd' },\n\t\t\t}),\n\t\t};\n\t}, [name, type]);\n\n\tconst localRooms = useUserSubscriptions(query, options);\n\n\tconst usernamesFromClient = useStableArray([...localRooms?.map(({ t, name }) => (t === 'd' ? name : null))].filter(Boolean));\n\n\tconst { data: spotlight, status } = useSpotlight(filterText, usernamesFromClient);\n\n\treturn useMemo(() => {\n\t\tconst resultsFromServer = [];\n\n\t\tconst filterUsersUnique = ({ _id }, index, arr) => index === arr.findIndex((user) => _id === user._id);\n\t\tconst roomFilter = (room) =>\n\t\t\t!localRooms.find(\n\t\t\t\t(item) => (room.t === 'd' && room.uids?.length > 1 && room.uids.includes(item._id)) || [item.rid, item._id].includes(room._id),\n\t\t\t);\n\t\tconst usersfilter = (user) => !localRooms.find((room) => room.t === 'd' && room.uids?.length === 2 && room.uids.includes(user._id));\n\n\t\tconst userMap = (user) => ({\n\t\t\t_id: user._id,\n\t\t\tt: 'd',\n\t\t\tname: user.username,\n\t\t\tfname: user.name,\n\t\t\tavatarETag: user.avatarETag,\n\t\t});\n\n\t\tconst exact = resultsFromServer.filter((item) => [item.usernamame, item.name, item.fname].includes(name));\n\n\t\tresultsFromServer.push(...spotlight.users.filter(filterUsersUnique).filter(usersfilter).map(userMap));\n\t\tresultsFromServer.push(...spotlight.rooms.filter(roomFilter));\n\n\t\treturn { data: Array.from(new Set([...exact, ...localRooms, ...resultsFromServer])), status };\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [localRooms, name, spotlight]);\n};\n\nconst useInput = (initial) => {\n\tconst [value, setValue] = useState(initial);\n\tconst onChange = useMutableCallback((e) => {\n\t\tsetValue(e.currentTarget.value);\n\t});\n\treturn { value, onChange, setValue };\n};\n\nconst toggleSelectionState = (next, current, input) => {\n\tinput.setAttribute('aria-activedescendant', next.id);\n\tnext.setAttribute('aria-selected', true);\n\tnext.classList.add('rcx-sidebar-item--selected');\n\tif (current) {\n\t\tcurrent.setAttribute('aria-selected', false);\n\t\tcurrent.classList.remove('rcx-sidebar-item--selected');\n\t}\n};\n\n/**\n * @type import('react').ForwardRefExoticComponent<{ onClose: unknown } & import('react').RefAttributes<HTMLElement>>\n */\nconst SearchList = forwardRef(function SearchList({ onClose }, ref) {\n\tconst listId = useUniqueId();\n\tconst t = useTranslation();\n\tconst { setValue: setFilterValue, ...filter } = useInput('');\n\n\tconst autofocus = useAutoFocus();\n\n\tconst listRef = useRef();\n\tconst boxRef = useRef();\n\n\tconst selectedElement = useRef();\n\tconst itemIndexRef = useRef(0);\n\n\tconst sidebarViewMode = useUserPreference('sidebarViewMode');\n\tconst showRealName = useSetting('UI_Use_Real_Name');\n\n\tconst sideBarItemTemplate = useTemplateByViewMode();\n\tconst avatarTemplate = useAvatarTemplate();\n\n\tconst extended = sidebarViewMode === 'extended';\n\n\tconst filterText = useDebouncedValue(filter.value, 100);\n\n\tconst placeholder = [t('Search'), shortcut].filter(Boolean).join(' ');\n\n\tconst { data: items, status } = useSearchItems(filterText);\n\n\tconst itemData = useMemo(\n\t\t() => ({\n\t\t\titems,\n\t\t\tt,\n\t\t\tSideBarItemTemplate: sideBarItemTemplate,\n\t\t\tavatarTemplate,\n\t\t\tshowRealName,\n\t\t\textended,\n\t\t\tsidebarViewMode,\n\t\t}),\n\t\t[avatarTemplate, extended, items, showRealName, sideBarItemTemplate, sidebarViewMode, t],\n\t);\n\n\tconst changeSelection = useMutableCallback((dir) => {\n\t\tlet nextSelectedElement = null;\n\n\t\tif (dir === 'up') {\n\t\t\tnextSelectedElement = selectedElement.current.parentElement.previousSibling.querySelector('a');\n\t\t} else {\n\t\t\tnextSelectedElement = selectedElement.current.parentElement.nextSibling.querySelector('a');\n\t\t}\n\n\t\tif (nextSelectedElement) {\n\t\t\ttoggleSelectionState(nextSelectedElement, selectedElement.current, autofocus.current);\n\t\t\treturn nextSelectedElement;\n\t\t}\n\t\treturn selectedElement.current;\n\t});\n\n\tconst resetCursor = useMutableCallback(() => {\n\t\titemIndexRef.current = 0;\n\t\tlistRef.current.scrollToIndex({ index: itemIndexRef.current });\n\n\t\tselectedElement.current = boxRef.current?.querySelector('a.rcx-sidebar-item');\n\n\t\tif (selectedElement.current) {\n\t\t\ttoggleSelectionState(selectedElement.current, undefined, autofocus.current);\n\t\t}\n\t});\n\n\tuseEffect(() => {\n\t\tresetCursor();\n\t});\n\n\tuseEffect(() => {\n\t\tresetCursor();\n\t}, [filterText, resetCursor]);\n\n\tuseEffect(() => {\n\t\tif (!autofocus.current) {\n\t\t\treturn;\n\t\t}\n\t\tconst unsubscribe = tinykeys(autofocus.current, {\n\t\t\tEscape: (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tsetFilterValue((value) => {\n\t\t\t\t\tif (!value) {\n\t\t\t\t\t\tonClose();\n\t\t\t\t\t}\n\t\t\t\t\tresetCursor();\n\t\t\t\t\treturn '';\n\t\t\t\t});\n\t\t\t},\n\t\t\tTab: onClose,\n\t\t\tArrowUp: () => {\n\t\t\t\tconst currentElement = changeSelection('up');\n\t\t\t\titemIndexRef.current = Math.max(itemIndexRef.current - 1, 0);\n\t\t\t\tlistRef.current.scrollToIndex({ index: itemIndexRef.current });\n\t\t\t\tselectedElement.current = currentElement;\n\t\t\t},\n\t\t\tArrowDown: () => {\n\t\t\t\tconst currentElement = changeSelection('down');\n\t\t\t\titemIndexRef.current = Math.min(itemIndexRef.current + 1, items?.length + 1);\n\t\t\t\tlistRef.current.scrollToIndex({ index: itemIndexRef.current });\n\t\t\t\tselectedElement.current = currentElement;\n\t\t\t},\n\t\t\tEnter: () => {\n\t\t\t\tif (selectedElement.current) {\n\t\t\t\t\tselectedElement.current.click();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\treturn () => {\n\t\t\tunsubscribe();\n\t\t};\n\t}, [autofocus, changeSelection, items.length, onClose, resetCursor, setFilterValue]);\n\n\treturn (\n\t\t<Box\n\t\t\tposition='absolute'\n\t\t\trcx-sidebar\n\t\t\th='full'\n\t\t\tdisplay='flex'\n\t\t\tflexDirection='column'\n\t\t\tzIndex={99}\n\t\t\tw='full'\n\t\t\tclassName={css`\n\t\t\t\tleft: 0;\n\t\t\t\ttop: 0;\n\t\t\t`}\n\t\t\tref={ref}\n\t\t>\n\t\t\t<Sidebar.TopBar.Section role='search' is='form'>\n\t\t\t\t<TextInput\n\t\t\t\t\taria-owns={listId}\n\t\t\t\t\tdata-qa='sidebar-search-input'\n\t\t\t\t\tref={autofocus}\n\t\t\t\t\t{...filter}\n\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\taddon={<Icon name='cross' size='x20' onClick={onClose} />}\n\t\t\t\t/>\n\t\t\t</Sidebar.TopBar.Section>\n\t\t\t<Box\n\t\t\t\tref={boxRef}\n\t\t\t\taria-expanded='true'\n\t\t\t\trole='listbox'\n\t\t\t\tid={listId}\n\t\t\t\ttabIndex={-1}\n\t\t\t\tflexShrink={1}\n\t\t\t\th='full'\n\t\t\t\tw='full'\n\t\t\t\tdata-qa='sidebar-search-result'\n\t\t\t\tonClick={onClose}\n\t\t\t\taria-busy={status !== AsyncStatePhase.RESOLVED}\n\t\t\t>\n\t\t\t\t<Virtuoso\n\t\t\t\t\tstyle={{ height: '100%', width: '100%' }}\n\t\t\t\t\ttotalCount={items?.length}\n\t\t\t\t\tdata={items}\n\t\t\t\t\tcomponents={{ Scroller: ScrollerWithCustomProps }}\n\t\t\t\t\titemContent={(index, data) => <Row data={itemData} item={data} />}\n\t\t\t\t\tref={listRef}\n\t\t\t\t/>\n\t\t\t</Box>\n\t\t</Box>\n\t);\n});\n\nexport default SearchList;\n"]}