{"version":3,"sources":["meteor://ðŸ’»app/client/components/Omnichannel/modals/CloseChatModal.js"],"names":["_slicedToArray","module","link","default","v","Field","Button","TextInput","Icon","ButtonGroup","Modal","Box","useAutoFocus","React","useCallback","useState","useMemo","useEffect","useSetting","useTranslation","useComponentDidUpdate","useForm","GenericModal","Tags","CloseChatModal","department","onCancel","onConfirm","t","inputRef","comment","tags","values","handlers","commentRequired","handleComment","handleTags","commentError","setCommentError","tagError","setTagError","tagRequired","setTagRequired","handleConfirm","canConfirm","canConfirmTag","length","canConfirmComment","requestTagBeforeClosingChat","exportDefault"],"mappings":"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","file":"dynamic/client/components/Omnichannel/modals/CloseChatModal.js","sourcesContent":["import { Field, Button, TextInput, Icon, ButtonGroup, Modal, Box } from '@rocket.chat/fuselage';\nimport { useAutoFocus } from '@rocket.chat/fuselage-hooks';\nimport React, { useCallback, useState, useMemo, useEffect } from 'react';\n\nimport { useSetting } from '../../../contexts/SettingsContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useComponentDidUpdate } from '../../../hooks/useComponentDidUpdate';\nimport { useForm } from '../../../hooks/useForm';\nimport GenericModal from '../../GenericModal';\nimport Tags from '../Tags';\n\nconst CloseChatModal = ({ department = {}, onCancel, onConfirm }) => {\n\tconst t = useTranslation();\n\n\tconst inputRef = useAutoFocus(true);\n\n\tconst { values, handlers } = useForm({ comment: '', tags: [] });\n\n\tconst commentRequired = useSetting('Livechat_request_comment_when_closing_conversation');\n\n\tconst { comment, tags } = values;\n\tconst { handleComment, handleTags } = handlers;\n\tconst [commentError, setCommentError] = useState('');\n\tconst [tagError, setTagError] = useState('');\n\tconst [tagRequired, setTagRequired] = useState(false);\n\n\tconst handleConfirm = useCallback(() => {\n\t\tonConfirm(comment, tags);\n\t}, [comment, onConfirm, tags]);\n\n\tuseComponentDidUpdate(() => {\n\t\tsetCommentError(!comment && commentRequired ? t('The_field_is_required', t('Comment')) : '');\n\t}, [commentRequired, comment, t]);\n\n\tconst canConfirm = useMemo(() => {\n\t\tconst canConfirmTag = !tagError && (tagRequired ? tags.length > 0 : true);\n\t\tconst canConfirmComment = !commentError && (commentRequired ? !!comment : true);\n\t\treturn canConfirmTag && canConfirmComment;\n\t}, [comment, commentError, commentRequired, tagError, tagRequired, tags.length]);\n\n\tuseEffect(() => {\n\t\tdepartment?.requestTagBeforeClosingChat && setTagRequired(true);\n\t\tsetTagError(tagRequired && (!tags || tags.length === 0) ? t('error-tags-must-be-assigned-before-closing-chat') : '');\n\t}, [department, tagRequired, t, tags]);\n\n\tif (!commentRequired && !tagRequired) {\n\t\treturn (\n\t\t\t<GenericModal\n\t\t\t\tvariant='warning'\n\t\t\t\ttitle={t('Are_you_sure_you_want_to_close_this_chat')}\n\t\t\t\tonConfirm={handleConfirm}\n\t\t\t\tonCancel={onCancel}\n\t\t\t\tonClose={onCancel}\n\t\t\t\tconfirmText={t('Confirm')}\n\t\t\t></GenericModal>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Modal>\n\t\t\t<Modal.Header>\n\t\t\t\t<Icon name='baloon-close-top-right' size={20} />\n\t\t\t\t<Modal.Title>{t('Closing_chat')}</Modal.Title>\n\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t<Box color='neutral-600'>{t('Close_room_description')}</Box>\n\t\t\t\t<Field marginBlock='x15'>\n\t\t\t\t\t<Field.Label required={commentRequired}>{t('Comment')}</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\tref={inputRef}\n\t\t\t\t\t\t\terror={commentError}\n\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\tvalue={comment}\n\t\t\t\t\t\t\tonChange={handleComment}\n\t\t\t\t\t\t\tplaceholder={t('Please_add_a_comment')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Field.Row>\n\t\t\t\t\t<Field.Error>{commentError}</Field.Error>\n\t\t\t\t</Field>\n\t\t\t\t{Tags && (\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<Tags tagRequired={tagRequired} tags={tags} handler={handleTags} error={tagError} />\n\t\t\t\t\t\t<Field.Error>{tagError}</Field.Error>\n\t\t\t\t\t</Field>\n\t\t\t\t)}\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<ButtonGroup align='end'>\n\t\t\t\t\t<Button onClick={onCancel}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button disabled={!canConfirm} primary onClick={handleConfirm}>\n\t\t\t\t\t\t{t('Confirm')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\n\nexport default CloseChatModal;\n"]}