{"version":3,"sources":["meteor://ðŸ’»app/app/webdav/client/selectWebdavAccount.js"],"names":["Meteor","module","link","v","Template","modal","t","WebdavAccounts","dispatchToastMessage","selectWebdavAccount","helpers","webdavAccounts","find","fetch","usernamePlusServer","account","name","username","server_url","replace","events","close","accountId","_id","url","instance","data","attachment","title","fileRequest","XMLHttpRequest","open","responseType","onload","arrayBuffer","response","fileData","Uint8Array","call","error","type","message","success","send"],"mappings":"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","file":"dynamic/app/webdav/client/selectWebdavAccount.js","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Template } from 'meteor/templating';\n\nimport { modal } from '../../ui-utils';\nimport { t } from '../../utils';\nimport { WebdavAccounts } from '../../models/client';\nimport { dispatchToastMessage } from '../../../client/lib/toast';\n\nTemplate.selectWebdavAccount.helpers({\n\twebdavAccounts() {\n\t\treturn WebdavAccounts.find().fetch();\n\t},\n\tusernamePlusServer(account) {\n\t\treturn account.name || `${account.username}@${account.server_url.replace(/^https?\\:\\/\\//i, '')}`;\n\t},\n});\nTemplate.selectWebdavAccount.events({\n\t'click .webdav-account'() {\n\t\tmodal.close();\n\t\tconst accountId = this._id;\n\t\tconst { url } = Template.instance().data;\n\t\tconst name = Template.instance().data.attachment.title;\n\n\t\tconst fileRequest = new XMLHttpRequest();\n\t\tfileRequest.open('GET', url, true);\n\t\tfileRequest.responseType = 'arraybuffer';\n\t\tfileRequest.onload = function () {\n\t\t\tconst arrayBuffer = fileRequest.response;\n\t\t\tif (arrayBuffer) {\n\t\t\t\tconst fileData = new Uint8Array(arrayBuffer);\n\t\t\t\tMeteor.call('uploadFileToWebdav', accountId, fileData, name, (error, response) => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\treturn dispatchToastMessage({ type: 'error', message: t(error.error) });\n\t\t\t\t\t}\n\t\t\t\t\tif (!response.success) {\n\t\t\t\t\t\treturn dispatchToastMessage({ type: 'error', message: t(response.message) });\n\t\t\t\t\t}\n\t\t\t\t\treturn dispatchToastMessage({ type: 'success', message: t('File_uploaded') });\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tfileRequest.send(null);\n\t},\n});\n"]}