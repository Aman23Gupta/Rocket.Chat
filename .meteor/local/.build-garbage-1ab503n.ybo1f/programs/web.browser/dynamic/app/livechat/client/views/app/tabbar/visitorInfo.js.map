{"version":3,"sources":["meteor://ðŸ’»app/app/livechat/client/views/app/tabbar/visitorInfo.js"],"names":["TAPi18n","module","link","v","Meteor","ReactiveVar","FlowRouter","Session","Template","_","default","moment","UAParser","modal","Subscriptions","settings","t","roomTypes","hasRole","hasPermission","hasAtLeastOnePermission","APIClient","RoomManager","getCustomFormTemplate","Markdown","handleError","formatDateAndTime","isSubscribedToRoom","data","currentData","rid","subscription","findOne","undefined","closingDialogRequired","department","get","requestTagBeforeClosingChat","visitorInfo","helpers","user","instance","userAgent","ua","setUA","os","getOS","name","version","indexOf","osIcon","toLowerCase","browser","getBrowser","browserIcon","status","getUserStatus","room","joinTags","tags","join","customRoomFields","customFields","length","fields","livechatData","Object","keys","forEach","key","field","findWhere","_id","visibility","scope","push","label","value","customVisitorFields","createdAt","format","lastLogin","editing","action","forwarding","sendingTranscript","roomInfoData","visitorId","roomId","save","set","cancel","roomOpen","uid","userId","open","servedBy","canReturnQueue","config","routingConfig","returnQueue","showDetail","canSeeButtons","canEditRoom","canCloseRoom","canForwardGuest","canSendTranscript","email","canPlaceChatOnHold","onHold","lastMessage","token","roomClosedDateTime","closedAt","roomClosedBy","closedBy","closer","username","closerLabel","charAt","toUpperCase","slice","customInfoTemplate","roomDataContext","transcriptRequest","transcriptRequestedDateTime","requestedAt","markdown","text","parse","events","event","preventDefault","comment","__","call","clientAction","error","title","type","timer","showConfirmButton","modifier","content","confirmOnEnter","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","go","success","v1","post","onCreated","departmentId","updateVisitor","visitor","updateRoom","err","loadRoomData","roomStream","on","autorun","onDestroyed","removeListener"],"mappings":"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","file":"dynamic/app/livechat/client/views/app/tabbar/visitorInfo.js","sourcesContent":["import { TAPi18n } from 'meteor/rocketchat:tap-i18n';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\nimport { Session } from 'meteor/session';\nimport { Template } from 'meteor/templating';\nimport _ from 'underscore';\nimport moment from 'moment';\nimport UAParser from 'ua-parser-js';\n\nimport { modal } from '../../../../../ui-utils';\nimport { Subscriptions } from '../../../../../models';\nimport { settings } from '../../../../../settings';\nimport { t, roomTypes } from '../../../../../utils';\nimport { hasRole, hasPermission, hasAtLeastOnePermission } from '../../../../../authorization';\nimport './visitorInfo.html';\nimport { APIClient } from '../../../../../utils/client';\nimport { RoomManager } from '../../../../../ui-utils/client';\nimport { getCustomFormTemplate } from '../customTemplates/register';\nimport { Markdown } from '../../../../../markdown/client';\nimport { handleError } from '../../../../../../client/lib/utils/handleError';\nimport { formatDateAndTime } from '../../../../../../client/lib/utils/formatDateAndTime';\n\nconst isSubscribedToRoom = () => {\n\tconst data = Template.currentData();\n\tif (!data || !data.rid) {\n\t\treturn false;\n\t}\n\n\tconst subscription = Subscriptions.findOne({ rid: data.rid });\n\treturn subscription !== undefined;\n};\n\nconst closingDialogRequired = (department) => {\n\tif (settings.get('Livechat_request_comment_when_closing_conversation')) {\n\t\treturn true;\n\t}\n\n\treturn department && department.requestTagBeforeClosingChat;\n};\n\nTemplate.visitorInfo.helpers({\n\tuser() {\n\t\tconst user = Template.instance().user.get();\n\t\tif (user && user.userAgent) {\n\t\t\tconst ua = new UAParser();\n\t\t\tua.setUA(user.userAgent);\n\n\t\t\tuser.os = `${ua.getOS().name} ${ua.getOS().version}`;\n\t\t\tif (['Mac OS', 'iOS'].indexOf(ua.getOS().name) !== -1) {\n\t\t\t\tuser.osIcon = 'icon-apple';\n\t\t\t} else {\n\t\t\t\tuser.osIcon = `icon-${ua.getOS().name.toLowerCase()}`;\n\t\t\t}\n\t\t\tuser.browser = `${ua.getBrowser().name} ${ua.getBrowser().version}`;\n\t\t\tuser.browserIcon = `icon-${ua.getBrowser().name.toLowerCase()}`;\n\n\t\t\tuser.status = roomTypes.getUserStatus('l', this.rid) || 'offline';\n\t\t}\n\t\treturn user;\n\t},\n\n\troom() {\n\t\treturn Template.instance().room.get();\n\t},\n\n\tdepartment() {\n\t\treturn Template.instance().department.get();\n\t},\n\n\tjoinTags() {\n\t\tconst tags = Template.instance().tags.get();\n\t\treturn tags && tags.join(', ');\n\t},\n\n\tcustomRoomFields() {\n\t\tconst customFields = Template.instance().customFields.get();\n\t\tif (!customFields || customFields.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst fields = [];\n\t\tconst room = Template.instance().room.get();\n\t\tconst { livechatData = {} } = room || {};\n\n\t\tObject.keys(livechatData).forEach((key) => {\n\t\t\tconst field = _.findWhere(customFields, { _id: key });\n\t\t\tif (field && field.visibility !== 'hidden' && field.scope === 'room') {\n\t\t\t\tfields.push({ label: field.label, value: livechatData[key] });\n\t\t\t}\n\t\t});\n\n\t\treturn fields;\n\t},\n\n\tcustomVisitorFields() {\n\t\tconst customFields = Template.instance().customFields.get();\n\t\tif (!hasAtLeastOnePermission(['view-livechat-room-customfields', 'edit-livechat-room-customfields'])) {\n\t\t\treturn;\n\t\t}\n\t\tif (!customFields || customFields.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst fields = [];\n\t\tconst user = Template.instance().user.get();\n\t\tconst { livechatData = {} } = user || {};\n\n\t\tObject.keys(livechatData).forEach((key) => {\n\t\t\tconst field = _.findWhere(customFields, { _id: key });\n\t\t\tif (field && field.visibility !== 'hidden' && field.scope === 'visitor') {\n\t\t\t\tfields.push({ label: field.label, value: livechatData[key] });\n\t\t\t}\n\t\t});\n\n\t\treturn fields;\n\t},\n\n\tcreatedAt() {\n\t\tif (!this.createdAt) {\n\t\t\treturn '';\n\t\t}\n\t\treturn moment(this.createdAt).format('L LTS');\n\t},\n\n\tlastLogin() {\n\t\tif (!this.lastLogin) {\n\t\t\treturn '';\n\t\t}\n\t\treturn moment(this.lastLogin).format('L LTS');\n\t},\n\n\tediting() {\n\t\treturn Template.instance().action.get() === 'edit';\n\t},\n\n\tforwarding() {\n\t\treturn Template.instance().action.get() === 'forward';\n\t},\n\n\tsendingTranscript() {\n\t\treturn Template.instance().action.get() === 'transcript';\n\t},\n\n\troomInfoData() {\n\t\tconst instance = Template.instance();\n\t\tconst user = instance.user.get();\n\t\treturn {\n\t\t\tvisitorId: user ? user._id : null,\n\t\t\troomId: this.rid,\n\t\t\tsave() {\n\t\t\t\tinstance.action.set();\n\t\t\t},\n\t\t\tcancel() {\n\t\t\t\tinstance.action.set();\n\t\t\t},\n\t\t};\n\t},\n\n\troomOpen() {\n\t\tconst room = Template.instance().room.get();\n\t\tconst uid = Meteor.userId();\n\t\treturn room && room.open && ((room.servedBy && room.servedBy._id === uid) || hasRole(uid, 'livechat-manager'));\n\t},\n\n\tcanReturnQueue() {\n\t\tconst config = Template.instance().routingConfig.get();\n\t\treturn config.returnQueue;\n\t},\n\n\tshowDetail() {\n\t\tif (Template.instance().action.get()) {\n\t\t\treturn 'hidden';\n\t\t}\n\t},\n\n\tcanSeeButtons() {\n\t\tif (hasAtLeastOnePermission(['close-others-livechat-room', 'transfer-livechat-guest'])) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isSubscribedToRoom();\n\t},\n\n\tcanEditRoom() {\n\t\tif (hasPermission('save-others-livechat-room-info')) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isSubscribedToRoom();\n\t},\n\n\tcanCloseRoom() {\n\t\tif (hasPermission('close-others-livechat-room')) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isSubscribedToRoom();\n\t},\n\n\tcanForwardGuest() {\n\t\treturn hasPermission('transfer-livechat-guest');\n\t},\n\n\tcanSendTranscript() {\n\t\tconst room = Template.instance().room.get();\n\t\treturn !room.email && hasPermission('send-omnichannel-chat-transcript');\n\t},\n\n\tcanPlaceChatOnHold() {\n\t\tconst room = Template.instance().room.get();\n\t\treturn (\n\t\t\troom.open &&\n\t\t\t!room.onHold &&\n\t\t\troom.servedBy &&\n\t\t\troom.lastMessage &&\n\t\t\t!room.lastMessage?.token &&\n\t\t\tsettings.get('Livechat_allow_manual_on_hold')\n\t\t);\n\t},\n\n\troomClosedDateTime() {\n\t\tconst { closedAt } = this;\n\t\treturn formatDateAndTime(closedAt);\n\t},\n\n\troomClosedBy() {\n\t\tconst { closedBy = {}, servedBy = {} } = this;\n\t\tlet { closer } = this;\n\n\t\tif (closer === 'user') {\n\t\t\tif (servedBy._id !== closedBy._id) {\n\t\t\t\treturn closedBy.username;\n\t\t\t}\n\n\t\t\tcloser = 'agent';\n\t\t}\n\n\t\tconst closerLabel = closer.charAt(0).toUpperCase() + closer.slice(1);\n\t\treturn t(`${closerLabel}`);\n\t},\n\n\tcustomInfoTemplate() {\n\t\treturn getCustomFormTemplate('livechatVisitorInfo');\n\t},\n\n\troomDataContext() {\n\t\t// To make the dynamic template reactive we need to pass a ReactiveVar through the data property\n\t\t// because only the dynamic template data will be reloaded\n\t\treturn Template.instance().room;\n\t},\n\n\ttranscriptRequest() {\n\t\tconst room = Template.instance().room.get();\n\t\treturn room?.transcriptRequest;\n\t},\n\n\ttranscriptRequestedDateTime() {\n\t\tconst { requestedAt } = this;\n\t\treturn formatDateAndTime(requestedAt);\n\t},\n\n\tmarkdown(text) {\n\t\treturn Markdown.parse(text);\n\t},\n});\n\nTemplate.visitorInfo.events({\n\t'click .edit-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('edit');\n\t},\n\t'click .close-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tif (!closingDialogRequired(instance.department.get())) {\n\t\t\tconst comment = TAPi18n.__('Chat_closed_by_agent');\n\t\t\treturn Meteor.call('livechat:closeRoom', this.rid, comment, { clientAction: true }, function (error /* , result*/) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\n\t\t\t\tmodal.open({\n\t\t\t\t\ttitle: t('Chat_closed'),\n\t\t\t\t\ttext: t('Chat_closed_successfully'),\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimer: 1000,\n\t\t\t\t\tshowConfirmButton: false,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tmodal.open({\n\t\t\ttitle: t('Closing_chat'),\n\t\t\tmodifier: 'modal',\n\t\t\tcontent: 'closeRoom',\n\t\t\tdata: {\n\t\t\t\trid: this.rid,\n\t\t\t},\n\t\t\tconfirmOnEnter: false,\n\t\t\tshowConfirmButton: false,\n\t\t\tshowCancelButton: false,\n\t\t});\n\t},\n\n\t'click .return-inquiry'(event) {\n\t\tevent.preventDefault();\n\n\t\tmodal.open(\n\t\t\t{\n\t\t\t\ttitle: t('Would_you_like_to_return_the_inquiry'),\n\t\t\t\ttype: 'warning',\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tconfirmButtonColor: '#3085d6',\n\t\t\t\tcancelButtonColor: '#d33',\n\t\t\t\tconfirmButtonText: t('Yes'),\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tMeteor.call('livechat:returnAsInquiry', this.rid, function (error /* , result*/) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\thandleError(error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tSession.set('openedRoom');\n\t\t\t\t\t\tFlowRouter.go('/home');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\t},\n\n\t'click .forward-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('forward');\n\t},\n\n\t'click .send-transcript'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('transcript');\n\t},\n\n\t'click .on-hold'(event) {\n\t\tevent.preventDefault();\n\n\t\tmodal.open(\n\t\t\t{\n\t\t\t\ttitle: t('Would_you_like_to_place_chat_on_hold'),\n\t\t\t\ttype: 'warning',\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tconfirmButtonColor: '#3085d6',\n\t\t\t\tcancelButtonColor: '#d33',\n\t\t\t\tconfirmButtonText: t('Yes'),\n\t\t\t},\n\t\t\tasync () => {\n\t\t\t\tconst { success } = await APIClient.v1.post('livechat/room.onHold', { roomId: this.rid });\n\t\t\t\tif (success) {\n\t\t\t\t\tmodal.open({\n\t\t\t\t\t\ttitle: t('Chat_On_Hold'),\n\t\t\t\t\t\ttext: t('Chat_On_Hold_Successfully'),\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\ttimer: 1500,\n\t\t\t\t\t\tshowConfirmButton: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t},\n});\n\nTemplate.visitorInfo.onCreated(function () {\n\tthis.visitorId = new ReactiveVar(null);\n\tthis.customFields = new ReactiveVar([]);\n\tthis.action = new ReactiveVar();\n\tthis.user = new ReactiveVar();\n\tthis.departmentId = new ReactiveVar(null);\n\tthis.tags = new ReactiveVar(null);\n\tthis.routingConfig = new ReactiveVar({});\n\tthis.department = new ReactiveVar({});\n\tthis.room = new ReactiveVar({});\n\n\tthis.updateVisitor = async (visitorId) => {\n\t\tconst { visitor } = await APIClient.v1.get(`livechat/visitors.info?visitorId=${visitorId}`);\n\t\tthis.user.set(visitor);\n\t};\n\n\tthis.updateRoom = (room) => {\n\t\tthis.departmentId.set(room && room.departmentId);\n\t\tthis.tags.set(room && room.tags);\n\t\tthis.room.set(room);\n\t\tconst visitorId = room && room.v && room.v._id;\n\t\tthis.visitorId.set(visitorId);\n\t\tthis.updateVisitor(visitorId);\n\t};\n\n\tMeteor.call('livechat:getCustomFields', (err, customFields) => {\n\t\tif (customFields) {\n\t\t\tthis.customFields.set(customFields);\n\t\t}\n\t});\n\n\tconst { rid } = Template.currentData();\n\tMeteor.call('livechat:getRoutingConfig', (err, config) => {\n\t\tif (config) {\n\t\t\tthis.routingConfig.set(config);\n\t\t}\n\t});\n\n\tconst loadRoomData = async (rid) => {\n\t\tconst { room } = await APIClient.v1.get(`rooms.info?roomId=${rid}`);\n\t\tthis.updateRoom(room);\n\t};\n\n\tif (rid) {\n\t\tRoomManager.roomStream.on(rid, this.updateRoom);\n\t\tloadRoomData(rid);\n\t}\n\n\tthis.autorun(async () => {\n\t\tif (this.departmentId.get()) {\n\t\t\tconst { department } = await APIClient.v1.get(`livechat/department/${this.departmentId.get()}?includeAgents=false`);\n\t\t\tthis.department.set(department);\n\t\t}\n\t});\n\n\tthis.autorun(() => {\n\t\tconst visitorId = this.visitorId.get();\n\t\tif (visitorId) {\n\t\t\tthis.updateVisitor(visitorId);\n\t\t}\n\t});\n});\n\nTemplate.visitorInfo.onDestroyed(function () {\n\tconst { rid } = Template.currentData();\n\tRoomManager.roomStream.removeListener(rid, this.updateRoom);\n});\n"]}