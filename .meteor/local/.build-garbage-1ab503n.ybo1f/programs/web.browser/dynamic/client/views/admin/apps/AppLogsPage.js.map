{"version":3,"sources":["meteor://ğŸ’»app/client/views/admin/apps/AppLogsPage.js"],"names":["_extends","module","link","default","v","_objectWithoutProperties","_objectSpread","Box","Button","ButtonGroup","Icon","Accordion","Pagination","useSafely","React","useCallback","useState","useEffect","Page","useCurrentRoute","useRoute","useEndpoint","useTranslation","useFormatDateAndTime","LogItem","LogsLoading","useAppWithLogs","id","current","itemsPerPage","data","setData","getAppData","getAppLogs","fetchData","app","logs","Promise","all","error","sliceStart","length","total","filteredData","slice","AppLogsPage","props","t","formatDateAndTime","setItemsPerPage","setCurrent","logEntriesCount","currentRouteName","appLogsRoute","handleResetButtonClick","handleBackButtonClick","push","loading","Object","values","showData","showingResultsLabel","count","Math","min","itemsPerPageLabel","name","message","map","log","_createdAt","method","totalTime","instanceId","entries","exportDefault"],"mappings":"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","file":"dynamic/client/views/admin/apps/AppLogsPage.js","sourcesContent":["import { Box, Button, ButtonGroup, Icon, Accordion, Pagination } from '@rocket.chat/fuselage';\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\nimport React, { useCallback, useState, useEffect } from 'react';\n\nimport Page from '../../../components/Page';\nimport { useCurrentRoute, useRoute } from '../../../contexts/RouterContext';\nimport { useEndpoint } from '../../../contexts/ServerContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useFormatDateAndTime } from '../../../hooks/useFormatDateAndTime';\nimport LogItem from './LogItem';\nimport LogsLoading from './LogsLoading';\n\nconst useAppWithLogs = ({ id, current, itemsPerPage }) => {\n\tconst [data, setData] = useSafely(useState({}));\n\tconst getAppData = useEndpoint('GET', `/apps/${id}`);\n\tconst getAppLogs = useEndpoint('GET', `/apps/${id}/logs`);\n\n\tconst fetchData = useCallback(async () => {\n\t\ttry {\n\t\t\tconst [{ app }, { logs }] = await Promise.all([getAppData(), getAppLogs()]);\n\t\t\tsetData({ ...app, logs });\n\t\t} catch (error) {\n\t\t\tsetData({ error });\n\t\t}\n\t}, [getAppData, getAppLogs, setData]);\n\n\tuseEffect(() => {\n\t\tfetchData();\n\t}, [fetchData]);\n\n\tconst sliceStart = data.logs && current > data.logs.length ? 0 : current;\n\tconst total = data.logs ? data.logs.length : 0;\n\tconst filteredData = data.logs ? { ...data, logs: data.logs.slice(sliceStart, itemsPerPage + current) } : data;\n\n\treturn [filteredData, total, fetchData];\n};\n\nfunction AppLogsPage({ id, ...props }) {\n\tconst t = useTranslation();\n\tconst formatDateAndTime = useFormatDateAndTime();\n\tconst [itemsPerPage, setItemsPerPage] = useState(25);\n\tconst [current, setCurrent] = useState(0);\n\n\tconst [app, logEntriesCount, fetchData] = useAppWithLogs({ id, itemsPerPage, current });\n\n\tconst [currentRouteName] = useCurrentRoute();\n\tconst appLogsRoute = useRoute(currentRouteName);\n\n\tconst handleResetButtonClick = () => {\n\t\tfetchData();\n\t};\n\n\tconst handleBackButtonClick = () => {\n\t\tappLogsRoute.push();\n\t};\n\n\tconst loading = !Object.values(app).length;\n\tconst showData = !loading && !app.error;\n\n\tconst showingResultsLabel = useCallback(\n\t\t({ count, current, itemsPerPage }) => t('Showing_results_of', current + 1, Math.min(current + itemsPerPage, count), count),\n\t\t[t],\n\t);\n\tconst itemsPerPageLabel = useCallback(() => t('Items_per_page:'), [t]);\n\n\treturn (\n\t\t<Page flexDirection='column' {...props}>\n\t\t\t<Page.Header title={t('View_the_Logs_for', { name: app.name || '' })}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t<Button primary onClick={handleResetButtonClick}>\n\t\t\t\t\t\t<Icon name='undo' /> {t('Refresh')}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button onClick={handleBackButtonClick}>\n\t\t\t\t\t\t<Icon name='back' /> {t('Back')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Header>\n\t\t\t<Page.ScrollableContent>\n\t\t\t\t{loading && <LogsLoading />}\n\t\t\t\t{app.error && (\n\t\t\t\t\t<Box maxWidth='x600' alignSelf='center' fontScale='hh21'>\n\t\t\t\t\t\t{app.error.message}\n\t\t\t\t\t</Box>\n\t\t\t\t)}\n\t\t\t\t{showData && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<Accordion maxWidth='x600' alignSelf='center'>\n\t\t\t\t\t\t\t{app.logs &&\n\t\t\t\t\t\t\t\tapp.logs.map((log) => (\n\t\t\t\t\t\t\t\t\t<LogItem\n\t\t\t\t\t\t\t\t\t\tkey={log._createdAt}\n\t\t\t\t\t\t\t\t\t\ttitle={`${formatDateAndTime(log._createdAt)}: \"${log.method}\" (${log.totalTime}ms)`}\n\t\t\t\t\t\t\t\t\t\tinstanceId={log.instanceId}\n\t\t\t\t\t\t\t\t\t\tentries={log.entries}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</Accordion>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</Page.ScrollableContent>\n\n\t\t\t<Pagination\n\t\t\t\tmi='x24'\n\t\t\t\tdivider\n\t\t\t\tcurrent={current}\n\t\t\t\titemsPerPage={itemsPerPage}\n\t\t\t\titemsPerPageLabel={itemsPerPageLabel}\n\t\t\t\tshowingResultsLabel={showingResultsLabel}\n\t\t\t\tcount={logEntriesCount}\n\t\t\t\tonSetItemsPerPage={setItemsPerPage}\n\t\t\t\tonSetCurrent={setCurrent}\n\t\t\t/>\n\t\t</Page>\n\t);\n}\n\nexport default AppLogsPage;\n"]}