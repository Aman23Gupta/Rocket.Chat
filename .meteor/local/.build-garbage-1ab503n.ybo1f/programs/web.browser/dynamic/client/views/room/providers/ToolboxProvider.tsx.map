{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/providers/ToolboxProvider.tsx"],"names":[],"mappings":"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","file":"dynamic/client/views/room/providers/ToolboxProvider.tsx","sourcesContent":["import { useDebouncedState, useMutableCallback, useSafely } from '@rocket.chat/fuselage-hooks';\nimport React, { ReactNode, useContext, useMemo, useState, useLayoutEffect, MouseEventHandler } from 'react';\n\nimport { IRoom } from '../../../../definition/IRoom';\nimport { useCurrentRoute, useRoute } from '../../../contexts/RouterContext';\nimport { useSession } from '../../../contexts/SessionContext';\nimport { useSetting } from '../../../contexts/SettingsContext';\nimport { useUserId } from '../../../contexts/UserContext';\nimport { ToolboxContext, ToolboxEventHandler } from '../lib/Toolbox/ToolboxContext';\nimport { Store } from '../lib/Toolbox/generator';\nimport { ToolboxAction, ToolboxActionConfig } from '../lib/Toolbox/index';\nimport VirtualAction from './VirtualAction';\n\nconst useToolboxActions = (room: IRoom): { listen: ToolboxEventHandler; actions: Array<[string, ToolboxAction]> } => {\n\tconst { listen, actions } = useContext(ToolboxContext);\n\tconst [state, setState] = useState<Array<[string, ToolboxAction]>>(Array.from(actions.entries()));\n\n\tuseLayoutEffect(() => {\n\t\tconst stop = listen((actions) => {\n\t\t\tsetState(Array.from(actions.entries()));\n\t\t});\n\t\treturn (): void => {\n\t\t\tstop();\n\t\t};\n\t}, [listen, room, setState]);\n\n\treturn { listen, actions: state };\n};\n\nconst ToolboxProvider = ({ children, room }: { children: ReactNode; room: IRoom }): JSX.Element => {\n\tconst allowAnonymousRead = useSetting('Accounts_AllowAnonymousRead');\n\tconst uid = useUserId();\n\tconst [activeTabBar, setActiveTabBar] = useState<[ToolboxActionConfig | undefined, string?]>([undefined]);\n\tconst [list, setList] = useSafely(useDebouncedState<Store<ToolboxAction>>(new Map(), 5));\n\tconst handleChange = useMutableCallback((fn) => {\n\t\tfn(list);\n\t\tsetList((list) => new Map(list));\n\t});\n\tconst { listen, actions } = useToolboxActions(room);\n\n\tconst [routeName, params] = useCurrentRoute();\n\tconst router = useRoute(routeName || '');\n\n\tconst currentRoom = useSession('openedRoom');\n\n\tconst tab = params?.tab;\n\tconst context = params?.context;\n\n\tconst close = useMutableCallback(() => {\n\t\trouter.push({\n\t\t\t...params,\n\t\t\ttab: '',\n\t\t\tcontext: '',\n\t\t});\n\t});\n\n\tconst open = useMutableCallback((actionId, context) => {\n\t\tif (actionId === activeTabBar[0]?.id && context === undefined) {\n\t\t\treturn close();\n\t\t}\n\t\trouter.push({\n\t\t\t...params,\n\t\t\ttab: actionId,\n\t\t\tcontext,\n\t\t});\n\t});\n\n\tconst openUserInfo = useMutableCallback((username) => {\n\t\tswitch (room.t) {\n\t\t\tcase 'l':\n\t\t\t\topen('room-info', username);\n\t\t\t\tbreak;\n\t\t\tcase 'd':\n\t\t\t\troom.uids?.length > 2 ? open('user-info-group', username) : open('user-info', username);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\topen('members-list', username);\n\t\t\t\tbreak;\n\t\t}\n\t});\n\n\tuseLayoutEffect(() => {\n\t\tif (!tab) {\n\t\t\tsetActiveTabBar([undefined, undefined]);\n\t\t}\n\n\t\tsetActiveTabBar([list.get(tab as string) as ToolboxActionConfig, context]);\n\t}, [tab, list, currentRoom, context]);\n\n\tconst contextValue = useMemo(\n\t\t() => ({\n\t\t\tlisten,\n\t\t\tactions: new Map(list),\n\t\t\tactiveTabBar: activeTabBar[0],\n\t\t\tcontext: activeTabBar[1],\n\t\t\topen,\n\t\t\tclose,\n\t\t\topenUserInfo,\n\t\t}),\n\t\t[listen, list, activeTabBar, open, close, openUserInfo],\n\t);\n\n\treturn (\n\t\t<ToolboxContext.Provider value={contextValue}>\n\t\t\t{actions\n\t\t\t\t.filter(\n\t\t\t\t\t([, action]) => uid || (allowAnonymousRead && action.hasOwnProperty('anonymous') && (action as ToolboxActionConfig).anonymous),\n\t\t\t\t)\n\t\t\t\t.map(([id, item]) => (\n\t\t\t\t\t<VirtualAction action={item} room={room} id={id} key={id + room._id} handleChange={handleChange} />\n\t\t\t\t))}\n\t\t\t{children}\n\t\t</ToolboxContext.Provider>\n\t);\n};\n\nexport const useTabContext = (): unknown | undefined => useContext(ToolboxContext).context;\nexport const useTab = (): ToolboxActionConfig | undefined => useContext(ToolboxContext).activeTabBar;\nexport const useTabBarOpen = (): Function => useContext(ToolboxContext).open;\nexport const useTabBarClose = (): MouseEventHandler<HTMLOrSVGElement> => useContext(ToolboxContext).close;\nexport const useTabBarOpenUserInfo = (): Function => useContext(ToolboxContext).openUserInfo;\n\nexport default ToolboxProvider;\n"]}