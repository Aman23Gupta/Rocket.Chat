{"version":3,"sources":["meteor://ðŸ’»app/client/views/omnichannel/analytics/InterchangeableChart.js"],"names":["_extends","module","link","default","v","_objectSpread","_objectWithoutProperties","useMutableCallback","React","useRef","useEffect","drawLineChart","secondsToHHMMSS","useMethod","useToastMessageDispatch","useTranslation","Chart","getChartTooltips","chartName","callbacks","title","tooltipItem","data","labels","index","label","datasets","InterchangeableChart","departmentId","dateRange","props","t","dispatchToastMessage","canvas","context","start","end","loadData","draw","params","tooltipCallbacks","daterange","from","to","result","chartLabel","dataLabels","dataPoints","Error","current","error","type","message","chartOptions","name","exportDefault"],"mappings":"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","file":"dynamic/client/views/omnichannel/analytics/InterchangeableChart.js","sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { useRef, useEffect } from 'react';\n\nimport { drawLineChart } from '../../../../app/livechat/client/lib/chartHandler';\nimport { secondsToHHMMSS } from '../../../../app/utils/lib/timeConverter';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport Chart from '../realTimeMonitoring/charts/Chart';\n\nconst getChartTooltips = (chartName) => {\n\tswitch (chartName) {\n\t\tcase 'Avg_chat_duration':\n\t\tcase 'Avg_first_response_time':\n\t\tcase 'Best_first_response_time':\n\t\tcase 'Avg_response_time':\n\t\tcase 'Avg_reaction_time':\n\t\t\treturn {\n\t\t\t\tcallbacks: {\n\t\t\t\t\ttitle(tooltipItem, data) {\n\t\t\t\t\t\treturn data.labels[tooltipItem[0].index];\n\t\t\t\t\t},\n\t\t\t\t\tlabel(tooltipItem, data) {\n\t\t\t\t\t\treturn secondsToHHMMSS(data.datasets[0].data[tooltipItem.index]);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\tdefault:\n\t\t\treturn {};\n\t}\n};\n\nconst InterchangeableChart = ({ departmentId, dateRange, chartName, ...props }) => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst canvas = useRef();\n\tconst context = useRef();\n\n\tconst { start, end } = dateRange;\n\n\tconst loadData = useMethod('livechat:getAnalyticsChartData');\n\n\tconst draw = useMutableCallback(async (params) => {\n\t\ttry {\n\t\t\tconst tooltipCallbacks = getChartTooltips(chartName);\n\t\t\tif (!params?.daterange?.from || !params?.daterange?.to) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst result = await loadData(params);\n\t\t\tif (!result?.chartLabel || !result?.dataLabels || !result?.dataPoints) {\n\t\t\t\tthrow new Error('Error! fetching chart data. Details: livechat:getAnalyticsChartData => Missing Data');\n\t\t\t}\n\t\t\tcontext.current = await drawLineChart(canvas.current, context.current, [result.chartLabel], result.dataLabels, [result.dataPoints], {\n\t\t\t\ttooltipCallbacks,\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tuseEffect(() => {\n\t\tdraw({\n\t\t\tdaterange: {\n\t\t\t\tfrom: start,\n\t\t\t\tto: end,\n\t\t\t},\n\t\t\tchartOptions: { name: chartName },\n\t\t\t...(departmentId && { departmentId }),\n\t\t});\n\t}, [chartName, departmentId, draw, end, start, t, loadData]);\n\n\treturn <Chart border='none' pi='none' ref={canvas} {...props} />;\n};\n\nexport default InterchangeableChart;\n"]}