{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/OTR/OTRWithData.js"],"names":["useMutableCallback","module","link","v","React","useEffect","useMemo","useCallback","default","ORTInstance","OTR","useSetModal","usePresence","useReactiveValue","OTRModal","OTRWithData","rid","tabBar","onClickClose","close","setModal","closeModal","otr","getInstanceByRoomId","isEstablished","isEstablishing","established","get","establishing","userStatus","peerId","status","isOnline","includes","handleStart","handshake","handleEnd","end","handleReset","reset","timeout","setTimeout","set","clearTimeout","exportDefault"],"mappings":";;;;;;;;AAAA,IAAIA,kBAAJ;AAAuBC,MAAM,CAACC,IAAP,CAAY,6BAAZ,EAA0C;AAACF,oBAAkB,CAACG,CAAD,EAAG;AAACH,sBAAkB,GAACG,CAAnB;AAAqB;;AAA5C,CAA1C,EAAwF,CAAxF;AAA2F,IAAIC,KAAJ,EAAUC,SAAV,EAAoBC,OAApB,EAA4BC,WAA5B;AAAwCN,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAoB;AAACM,SAAO,CAACL,CAAD,EAAG;AAACC,SAAK,GAACD,CAAN;AAAQ,GAApB;;AAAqBE,WAAS,CAACF,CAAD,EAAG;AAACE,aAAS,GAACF,CAAV;AAAY,GAA9C;;AAA+CG,SAAO,CAACH,CAAD,EAAG;AAACG,WAAO,GAACH,CAAR;AAAU,GAApE;;AAAqEI,aAAW,CAACJ,CAAD,EAAG;AAACI,eAAW,GAACJ,CAAZ;AAAc;;AAAlG,CAApB,EAAwH,CAAxH;AAA2H,IAAIM,WAAJ;AAAgBR,MAAM,CAACC,IAAP,CAAY,8CAAZ,EAA2D;AAACQ,KAAG,CAACP,CAAD,EAAG;AAACM,eAAW,GAACN,CAAZ;AAAc;;AAAtB,CAA3D,EAAmF,CAAnF;AAAsF,IAAIQ,WAAJ;AAAgBV,MAAM,CAACC,IAAP,CAAY,mCAAZ,EAAgD;AAACS,aAAW,CAACR,CAAD,EAAG;AAACQ,eAAW,GAACR,CAAZ;AAAc;;AAA9B,CAAhD,EAAgF,CAAhF;AAAmF,IAAIS,WAAJ;AAAgBX,MAAM,CAACC,IAAP,CAAY,+BAAZ,EAA4C;AAACU,aAAW,CAACT,CAAD,EAAG;AAACS,eAAW,GAACT,CAAZ;AAAc;;AAA9B,CAA5C,EAA4E,CAA5E;AAA+E,IAAIU,gBAAJ;AAAqBZ,MAAM,CAACC,IAAP,CAAY,oCAAZ,EAAiD;AAACW,kBAAgB,CAACV,CAAD,EAAG;AAACU,oBAAgB,GAACV,CAAjB;AAAmB;;AAAxC,CAAjD,EAA2F,CAA3F;AAA8F,IAAIO,GAAJ;AAAQT,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAoB;AAACM,SAAO,CAACL,CAAD,EAAG;AAACO,OAAG,GAACP,CAAJ;AAAM;;AAAlB,CAApB,EAAwC,CAAxC;AAA2C,IAAIW,QAAJ;AAAab,MAAM,CAACC,IAAP,CAAY,YAAZ,EAAyB;AAACM,SAAO,CAACL,CAAD,EAAG;AAACW,YAAQ,GAACX,CAAT;AAAW;;AAAvB,CAAzB,EAAkD,CAAlD;;AAUhvB,MAAMY,WAAW,GAAG,QAAqB;AAAA;;AAAA,MAApB;AAAEC,OAAF;AAAOC;AAAP,GAAoB;AACxC,QAAMC,YAAY,GAAGlB,kBAAkB,CAAC,MAAMiB,MAAM,IAAIA,MAAM,CAACE,KAAP,EAAjB,CAAvC;AAEA,QAAMC,QAAQ,GAAGT,WAAW,EAA5B;AACA,QAAMU,UAAU,GAAGrB,kBAAkB,CAAC,MAAMoB,QAAQ,EAAf,CAArC;AACA,QAAME,GAAG,GAAGhB,OAAO,CAAC,MAAMG,WAAW,CAACc,mBAAZ,CAAgCP,GAAhC,CAAP,EAA6C,CAACA,GAAD,CAA7C,CAAnB;AAEA,QAAM,CAACQ,aAAD,EAAgBC,cAAhB,IAAkCZ,gBAAgB,CACvDN,WAAW,CAAC,MAAOe,GAAG,GAAG,CAACA,GAAG,CAACI,WAAJ,CAAgBC,GAAhB,EAAD,EAAwBL,GAAG,CAACM,YAAJ,CAAiBD,GAAjB,EAAxB,CAAH,GAAqD,CAAC,KAAD,EAAQ,KAAR,CAAhE,EAAiF,CAACL,GAAD,CAAjF,CAD4C,CAAxD;AAIA,QAAMO,UAAU,mBAAGjB,WAAW,CAACU,GAAG,CAACQ,MAAL,CAAd,iDAAG,aAAyBC,MAA5C;AAEA,QAAMC,QAAQ,GAAG,CAAC,CAAC,SAAD,EAAY,SAAZ,EAAuBC,QAAvB,CAAgCJ,UAAhC,CAAlB;;AAEA,QAAMK,WAAW,GAAG,MAAM;AACzBZ,OAAG,CAACa,SAAJ;AACA,GAFD;;AAIA,QAAMC,SAAS,GAAG,MAAMd,GAAN,aAAMA,GAAN,uBAAMA,GAAG,CAAEe,GAAL,EAAxB;;AAEA,QAAMC,WAAW,GAAG,MAAM;AACzBhB,OAAG,CAACiB,KAAJ;AACAjB,OAAG,CAACa,SAAJ,CAAc,IAAd;AACA,GAHD;;AAKA9B,WAAS,CAAC,MAAM;AACf,QAAImB,aAAJ,EAAmB;AAClB,aAAOH,UAAU,EAAjB;AACA;;AAED,QAAI,CAACI,cAAL,EAAqB;AACpB;AACA;;AAED,UAAMe,OAAO,GAAGC,UAAU,CAAC,MAAM;AAChCnB,SAAG,CAACM,YAAJ,CAAiBc,GAAjB,CAAqB,KAArB;AACAtB,cAAQ,eAAC,oBAAC,QAAD;AAAU,iBAAS,EAAEC,UAArB;AAAiC,gBAAQ,EAAEA;AAA3C,QAAD,CAAR;AACA,KAHyB,EAGvB,KAHuB,CAA1B;AAKA,WAAO,MAAMsB,YAAY,CAACH,OAAD,CAAzB;AACA,GAfQ,EAeN,CAACnB,UAAD,EAAaG,aAAb,EAA4BC,cAA5B,EAA4CL,QAA5C,EAAsDE,GAAtD,CAfM,CAAT;AAiBA,sBACC,oBAAC,GAAD;AACC,YAAQ,EAAEU,QADX;AAEC,kBAAc,EAAEP,cAFjB;AAGC,iBAAa,EAAED,aAHhB;AAIC,gBAAY,EAAEN,YAJf;AAKC,gBAAY,EAAEgB,WALf;AAMC,cAAU,EAAEE,SANb;AAOC,kBAAc,EAAEE;AAPjB,IADD;AAWA,CAtDD;;AAVArC,MAAM,CAAC2C,aAAP,CAkEe7B,WAlEf,E","file":"dynamic/client/views/room/contextualBar/OTR/OTRWithData.js","sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, useMemo, useCallback } from 'react';\n\nimport { OTR as ORTInstance } from '../../../../../app/otr/client/rocketchat.otr';\nimport { useSetModal } from '../../../../contexts/ModalContext';\nimport { usePresence } from '../../../../hooks/usePresence';\nimport { useReactiveValue } from '../../../../hooks/useReactiveValue';\nimport OTR from './OTR';\nimport OTRModal from './OTRModal';\n\nconst OTRWithData = ({ rid, tabBar }) => {\n\tconst onClickClose = useMutableCallback(() => tabBar && tabBar.close());\n\n\tconst setModal = useSetModal();\n\tconst closeModal = useMutableCallback(() => setModal());\n\tconst otr = useMemo(() => ORTInstance.getInstanceByRoomId(rid), [rid]);\n\n\tconst [isEstablished, isEstablishing] = useReactiveValue(\n\t\tuseCallback(() => (otr ? [otr.established.get(), otr.establishing.get()] : [false, false]), [otr]),\n\t);\n\n\tconst userStatus = usePresence(otr.peerId)?.status;\n\n\tconst isOnline = !['offline', 'loading'].includes(userStatus);\n\n\tconst handleStart = () => {\n\t\totr.handshake();\n\t};\n\n\tconst handleEnd = () => otr?.end();\n\n\tconst handleReset = () => {\n\t\totr.reset();\n\t\totr.handshake(true);\n\t};\n\n\tuseEffect(() => {\n\t\tif (isEstablished) {\n\t\t\treturn closeModal();\n\t\t}\n\n\t\tif (!isEstablishing) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeout = setTimeout(() => {\n\t\t\totr.establishing.set(false);\n\t\t\tsetModal(<OTRModal onConfirm={closeModal} onCancel={closeModal} />);\n\t\t}, 10000);\n\n\t\treturn () => clearTimeout(timeout);\n\t}, [closeModal, isEstablished, isEstablishing, setModal, otr]);\n\n\treturn (\n\t\t<OTR\n\t\t\tisOnline={isOnline}\n\t\t\tisEstablishing={isEstablishing}\n\t\t\tisEstablished={isEstablished}\n\t\t\tonClickClose={onClickClose}\n\t\t\tonClickStart={handleStart}\n\t\t\tonClickEnd={handleEnd}\n\t\t\tonClickRefresh={handleReset}\n\t\t/>\n\t);\n};\n\nexport default OTRWithData;\n"]}