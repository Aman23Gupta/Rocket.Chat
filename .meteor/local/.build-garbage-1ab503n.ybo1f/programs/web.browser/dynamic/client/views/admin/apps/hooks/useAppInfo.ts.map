{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/apps/hooks/useAppInfo.ts"],"names":[],"mappings":"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","file":"dynamic/client/views/admin/apps/hooks/useAppInfo.ts","sourcesContent":["import { IApiEndpointMetadata } from '@rocket.chat/apps-engine/definition/api';\nimport { AppSettingsManager } from '@rocket.chat/apps-engine/server/managers/AppSettingsManager';\nimport { useState, useEffect, useContext } from 'react';\n\nimport { Apps } from '../../../../../app/apps/client/orchestrator';\nimport { AppsContext } from '../AppsContext';\nimport { AppInfo } from '../definitions/AppInfo';\nimport { handleAPIError } from '../helpers';\nimport { App } from '../types';\n\nconst getBundledIn = async (appId: string, appVersion: string): Promise<App['bundledIn']> => {\n\ttry {\n\t\tconst { bundledIn } = (await Apps.getLatestAppFromMarketplace(appId, appVersion)) as App;\n\t\tif (!bundledIn) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn await Promise.all(\n\t\t\tbundledIn.map(async (bundle) => {\n\t\t\t\tconst apps = await Apps.getAppsOnBundle(bundle.bundleId);\n\t\t\t\tbundle.apps = apps.slice(0, 4);\n\t\t\t\treturn bundle;\n\t\t\t}),\n\t\t);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn [];\n\t}\n};\n\nconst getSettings = async (appId: string, installed: boolean): Promise<ReturnType<AppSettingsManager['getAppSettings']>> => {\n\tif (!installed) {\n\t\treturn {};\n\t}\n\n\ttry {\n\t\treturn Apps.getAppSettings(appId);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn {};\n\t}\n};\n\nconst getApis = async (appId: string, installed: boolean): Promise<Array<IApiEndpointMetadata>> => {\n\tif (!installed) {\n\t\treturn [];\n\t}\n\n\ttry {\n\t\treturn Apps.getAppApis(appId);\n\t} catch (e) {\n\t\thandleAPIError(e);\n\t\treturn [];\n\t}\n};\n\nexport const useAppInfo = (appId: string): AppInfo | undefined => {\n\tconst { installedApps, marketplaceApps } = useContext(AppsContext);\n\n\tconst [appData, setAppData] = useState<AppInfo>();\n\n\tuseEffect(() => {\n\t\tconst apps: App[] = [];\n\n\t\tif (marketplaceApps.value) {\n\t\t\tapps.push(...marketplaceApps.value.apps);\n\t\t}\n\n\t\tif (installedApps.value) {\n\t\t\tapps.push(...installedApps.value.apps);\n\t\t}\n\n\t\tconst fetchAppInfo = async (): Promise<void> => {\n\t\t\tif (!apps?.length || !appId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst app = apps.find((app) => app.id === appId) ?? {\n\t\t\t\t...(await Apps.getApp(appId)),\n\t\t\t\tinstalled: true,\n\t\t\t\tmarketplace: false,\n\t\t\t};\n\n\t\t\tconst [bundledIn, settings, apis] = await Promise.all([\n\t\t\t\tapp.marketplace === false ? [] : getBundledIn(app.id, app.version),\n\t\t\t\tgetSettings(app.id, app.installed),\n\t\t\t\tgetApis(app.id, app.installed),\n\t\t\t]);\n\t\t\tsetAppData({ ...app, bundledIn, settings, apis });\n\t\t};\n\n\t\tfetchAppInfo();\n\t}, [appId, installedApps, marketplaceApps]);\n\n\treturn appData;\n};\n"]}