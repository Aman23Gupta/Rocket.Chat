{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/customSounds/AddCustomSound.js"],"names":["_objectWithoutProperties","module","link","default","v","Field","TextInput","Box","Icon","Margins","Button","ButtonGroup","React","useState","useCallback","VerticalBar","useMethod","useToastMessageDispatch","useTranslation","useFileInput","validate","createSoundData","AddCustomSound","goToNew","close","onChange","props","t","dispatchToastMessage","name","setName","sound","setSound","uploadCustomSound","insertOrUpdateSound","handleChangeFile","soundFile","clickUpload","saveAction","soundData","validation","length","soundId","error","type","message","_id","random","Math","round","reader","FileReader","readAsBinaryString","onloadend","result","forEach","Error","field","handleSave","e","currentTarget","value","exportDefault"],"mappings":"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","file":"dynamic/client/views/admin/customSounds/AddCustomSound.js","sourcesContent":["import { Field, TextInput, Box, Icon, Margins, Button, ButtonGroup } from '@rocket.chat/fuselage';\nimport React, { useState, useCallback } from 'react';\n\nimport VerticalBar from '../../../components/VerticalBar';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useFileInput } from '../../../hooks/useFileInput';\nimport { validate, createSoundData } from './lib';\n\nfunction AddCustomSound({ goToNew, close, onChange, ...props }) {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst [name, setName] = useState('');\n\tconst [sound, setSound] = useState();\n\n\tconst uploadCustomSound = useMethod('uploadCustomSound');\n\n\tconst insertOrUpdateSound = useMethod('insertOrUpdateSound');\n\n\tconst handleChangeFile = useCallback((soundFile) => {\n\t\tsetSound(soundFile);\n\t}, []);\n\n\tconst [clickUpload] = useFileInput(handleChangeFile, 'audio/mp3');\n\n\tconst saveAction = useCallback(\n\t\tasync (name, soundFile) => {\n\t\t\tconst soundData = createSoundData(soundFile, name);\n\t\t\tconst validation = validate(soundData, soundFile);\n\t\t\tif (validation.length === 0) {\n\t\t\t\tlet soundId;\n\t\t\t\ttry {\n\t\t\t\t\tsoundId = await insertOrUpdateSound(soundData);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t}\n\n\t\t\t\tsoundData._id = soundId;\n\t\t\t\tsoundData.random = Math.round(Math.random() * 1000);\n\n\t\t\t\tif (soundId) {\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Uploading_file') });\n\n\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\treader.readAsBinaryString(soundFile);\n\t\t\t\t\treader.onloadend = () => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tuploadCustomSound(reader.result, soundFile.type, soundData);\n\t\t\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('File_uploaded') });\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn soundId;\n\t\t\t}\n\t\t\tvalidation.forEach((error) => {\n\t\t\t\tthrow new Error({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\tmessage: t('error-the-field-is-required', { field: t(error) }),\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t[dispatchToastMessage, insertOrUpdateSound, t, uploadCustomSound],\n\t);\n\n\tconst handleSave = useCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await saveAction(name, sound);\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Custom_Sound_Saved_Successfully') });\n\t\t\tgoToNew(result)();\n\t\t\tonChange();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [dispatchToastMessage, goToNew, name, onChange, saveAction, sound, t]);\n\n\treturn (\n\t\t<VerticalBar.ScrollableContent {...props}>\n\t\t\t<Field>\n\t\t\t\t<Field.Label>{t('Name')}</Field.Label>\n\t\t\t\t<Field.Row>\n\t\t\t\t\t<TextInput value={name} onChange={(e) => setName(e.currentTarget.value)} placeholder={t('Name')} />\n\t\t\t\t</Field.Row>\n\t\t\t</Field>\n\t\t\t<Field>\n\t\t\t\t<Field.Label alignSelf='stretch'>{t('Sound_File_mp3')}</Field.Label>\n\t\t\t\t<Box display='flex' flexDirection='row' mbs='none'>\n\t\t\t\t\t<Margins inline='x4'>\n\t\t\t\t\t\t<Button square onClick={clickUpload}>\n\t\t\t\t\t\t\t<Icon name='upload' size='x20' />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t{(sound && sound.name) || 'none'}\n\t\t\t\t\t</Margins>\n\t\t\t\t</Box>\n\t\t\t</Field>\n\t\t\t<Field>\n\t\t\t\t<Field.Row>\n\t\t\t\t\t<ButtonGroup stretch w='full'>\n\t\t\t\t\t\t<Button mie='x4' onClick={close}>\n\t\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button primary onClick={handleSave} disabled={name === ''}>\n\t\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Field.Row>\n\t\t\t</Field>\n\t\t</VerticalBar.ScrollableContent>\n\t);\n}\n\nexport default AddCustomSound;\n"]}