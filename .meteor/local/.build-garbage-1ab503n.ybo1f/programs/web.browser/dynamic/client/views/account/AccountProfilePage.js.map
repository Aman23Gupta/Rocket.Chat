{"version":3,"sources":["meteor://ðŸ’»app/client/views/account/AccountProfilePage.js"],"names":["_objectSpread","module","link","default","v","ButtonGroup","Button","Box","Icon","SHA256","React","useMemo","useState","useCallback","getUserEmailAddress","ConfirmOwnerChangeWarningModal","Page","useSetModal","useEndpoint","useMethod","useSetting","useToastMessageDispatch","useTranslation","useUser","useLogout","useForm","useUpdateAvatar","AccountProfileForm","ActionConfirmModal","getInitialValues","user","realname","name","email","username","password","confirmationPassword","avatar","url","avatarUrl","statusText","statusType","status","bio","customFields","nickname","AccountProfilePage","t","dispatchToastMessage","values","handlers","hasUnsavedChanges","commit","reset","canSave","setCanSave","setModal","logout","loggingOut","setLoggingOut","logoutOtherClients","deleteOwnAccount","saveFn","closeModal","localPassword","Boolean","services","exists","erasureType","allowRealNameChange","allowUserStatusMessageChange","canChangeUsername","allowEmailChange","allowPasswordChange","allowOAuthPasswordChange","allowUserAvatarChange","allowDeleteOwnAccount","requireName","namesRegexSetting","namesRegex","RegExp","settings","handleAvatar","handlePassword","handleConfirmationPassword","updateAvatar","_id","onSave","save","typedPassword","newPassword","avatarResult","type","message","error","handleLogoutOtherLocations","handleConfirmOwnerChange","passwordOrUsername","shouldChangeOwner","shouldBeRemoved","handleConfirm","handleDeleteOwnAccount","details","emails","exportDefault"],"mappings":"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","file":"dynamic/client/views/account/AccountProfilePage.js","sourcesContent":["import { ButtonGroup, Button, Box, Icon } from '@rocket.chat/fuselage';\nimport { SHA256 } from 'meteor/sha';\nimport React, { useMemo, useState, useCallback } from 'react';\n\nimport { getUserEmailAddress } from '../../../lib/getUserEmailAddress';\nimport ConfirmOwnerChangeWarningModal from '../../components/ConfirmOwnerChangeWarningModal';\nimport Page from '../../components/Page';\nimport { useSetModal } from '../../contexts/ModalContext';\nimport { useEndpoint, useMethod } from '../../contexts/ServerContext';\nimport { useSetting } from '../../contexts/SettingsContext';\nimport { useToastMessageDispatch } from '../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../contexts/TranslationContext';\nimport { useUser, useLogout } from '../../contexts/UserContext';\nimport { useForm } from '../../hooks/useForm';\nimport { useUpdateAvatar } from '../../hooks/useUpdateAvatar';\nimport AccountProfileForm from './AccountProfileForm';\nimport ActionConfirmModal from './ActionConfirmModal';\n\nconst getInitialValues = (user) => ({\n\trealname: user.name ?? '',\n\temail: getUserEmailAddress(user) ?? '',\n\tusername: user.username ?? '',\n\tpassword: '',\n\tconfirmationPassword: '',\n\tavatar: '',\n\turl: user.avatarUrl ?? '',\n\tstatusText: user.statusText ?? '',\n\tstatusType: user.status ?? '',\n\tbio: user.bio ?? '',\n\tcustomFields: user.customFields ?? {},\n\tnickname: user.nickname ?? '',\n});\n\nconst AccountProfilePage = () => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst user = useUser();\n\n\tconst { values, handlers, hasUnsavedChanges, commit, reset } = useForm(getInitialValues(user ?? {}));\n\tconst [canSave, setCanSave] = useState(true);\n\tconst setModal = useSetModal();\n\tconst logout = useLogout();\n\tconst [loggingOut, setLoggingOut] = useState(false);\n\n\tconst logoutOtherClients = useEndpoint('POST', 'users.logoutOtherClients');\n\tconst deleteOwnAccount = useMethod('deleteUserOwnAccount');\n\tconst saveFn = useMethod('saveUserProfile');\n\n\tconst closeModal = useCallback(() => setModal(null), [setModal]);\n\n\tconst localPassword = Boolean(user?.services?.password?.exists);\n\n\tconst erasureType = useSetting('Message_ErasureType');\n\tconst allowRealNameChange = useSetting('Accounts_AllowRealNameChange');\n\tconst allowUserStatusMessageChange = useSetting('Accounts_AllowUserStatusMessageChange');\n\tconst canChangeUsername = useSetting('Accounts_AllowUsernameChange');\n\tconst allowEmailChange = useSetting('Accounts_AllowEmailChange');\n\tlet allowPasswordChange = useSetting('Accounts_AllowPasswordChange');\n\tconst allowOAuthPasswordChange = useSetting('Accounts_AllowPasswordChangeForOAuthUsers');\n\tconst allowUserAvatarChange = useSetting('Accounts_AllowUserAvatarChange');\n\tconst allowDeleteOwnAccount = useSetting('Accounts_AllowDeleteOwnAccount');\n\tconst requireName = useSetting('Accounts_RequireNameForSignUp');\n\tconst namesRegexSetting = useSetting('UTF8_User_Names_Validation');\n\n\tif (allowPasswordChange && !allowOAuthPasswordChange) {\n\t\tallowPasswordChange = localPassword;\n\t}\n\n\tconst namesRegex = useMemo(() => new RegExp(`^${namesRegexSetting}$`), [namesRegexSetting]);\n\n\tconst settings = useMemo(\n\t\t() => ({\n\t\t\tallowRealNameChange,\n\t\t\tallowUserStatusMessageChange,\n\t\t\tallowEmailChange,\n\t\t\tallowPasswordChange,\n\t\t\tallowUserAvatarChange,\n\t\t\tallowDeleteOwnAccount,\n\t\t\tcanChangeUsername,\n\t\t\trequireName,\n\t\t\tnamesRegex,\n\t\t}),\n\t\t[\n\t\t\tallowDeleteOwnAccount,\n\t\t\tallowEmailChange,\n\t\t\tallowPasswordChange,\n\t\t\tallowRealNameChange,\n\t\t\tallowUserAvatarChange,\n\t\t\tallowUserStatusMessageChange,\n\t\t\tcanChangeUsername,\n\t\t\trequireName,\n\t\t\tnamesRegex,\n\t\t],\n\t);\n\n\tconst { realname, email, avatar, username, password, statusText, statusType, customFields, bio, nickname } = values;\n\n\tconst { handleAvatar, handlePassword, handleConfirmationPassword } = handlers;\n\n\tconst updateAvatar = useUpdateAvatar(avatar, user?._id);\n\n\tconst onSave = useCallback(async () => {\n\t\tconst save = async (typedPassword) => {\n\t\t\ttry {\n\t\t\t\tawait saveFn(\n\t\t\t\t\t{\n\t\t\t\t\t\t...(allowRealNameChange && { realname }),\n\t\t\t\t\t\t...(allowEmailChange && getUserEmailAddress(user) !== email && { email }),\n\t\t\t\t\t\t...(allowPasswordChange && { newPassword: password }),\n\t\t\t\t\t\t...(canChangeUsername && { username }),\n\t\t\t\t\t\t...(allowUserStatusMessageChange && { statusText }),\n\t\t\t\t\t\t...(typedPassword && { typedPassword: SHA256(typedPassword) }),\n\t\t\t\t\t\tstatusType,\n\t\t\t\t\t\tnickname,\n\t\t\t\t\t\tbio: bio || '',\n\t\t\t\t\t},\n\t\t\t\t\tcustomFields,\n\t\t\t\t);\n\t\t\t\thandlePassword('');\n\t\t\t\thandleConfirmationPassword('');\n\t\t\t\tconst avatarResult = await updateAvatar();\n\t\t\t\tif (avatarResult) {\n\t\t\t\t\thandleAvatar('');\n\t\t\t\t}\n\t\t\t\tcommit();\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Profile_saved_successfully') });\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t};\n\n\t\tsave();\n\t}, [\n\t\tsaveFn,\n\t\tallowEmailChange,\n\t\tallowPasswordChange,\n\t\tallowRealNameChange,\n\t\tallowUserStatusMessageChange,\n\t\tbio,\n\t\tcanChangeUsername,\n\t\temail,\n\t\tpassword,\n\t\trealname,\n\t\tstatusText,\n\t\tusername,\n\t\tuser,\n\t\tupdateAvatar,\n\t\thandleAvatar,\n\t\tdispatchToastMessage,\n\t\tt,\n\t\tcustomFields,\n\t\tstatusType,\n\t\tcommit,\n\t\tnickname,\n\t\thandlePassword,\n\t\thandleConfirmationPassword,\n\t]);\n\n\tconst handleLogoutOtherLocations = useCallback(async () => {\n\t\tsetLoggingOut(true);\n\t\ttry {\n\t\t\tawait logoutOtherClients();\n\t\t\tdispatchToastMessage({\n\t\t\t\ttype: 'success',\n\t\t\t\tmessage: t('Logged_out_of_other_clients_successfully'),\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t\tsetLoggingOut(false);\n\t}, [logoutOtherClients, dispatchToastMessage, t]);\n\n\tconst handleConfirmOwnerChange = useCallback(\n\t\t(passwordOrUsername, shouldChangeOwner, shouldBeRemoved) => {\n\t\t\tconst handleConfirm = async () => {\n\t\t\t\ttry {\n\t\t\t\t\tawait deleteOwnAccount(SHA256(passwordOrUsername), true);\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('User_has_been_deleted') });\n\t\t\t\t\tcloseModal();\n\t\t\t\t\tlogout();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn setModal(() => (\n\t\t\t\t<ConfirmOwnerChangeWarningModal\n\t\t\t\t\tonConfirm={handleConfirm}\n\t\t\t\t\tonCancel={closeModal}\n\t\t\t\t\tcontentTitle={t(`Delete_User_Warning_${erasureType}`)}\n\t\t\t\t\tconfirmLabel={t('Delete')}\n\t\t\t\t\tshouldChangeOwner={shouldChangeOwner}\n\t\t\t\t\tshouldBeRemoved={shouldBeRemoved}\n\t\t\t\t/>\n\t\t\t));\n\t\t},\n\t\t[closeModal, erasureType, setModal, t, deleteOwnAccount, dispatchToastMessage, logout],\n\t);\n\n\tconst handleDeleteOwnAccount = useCallback(async () => {\n\t\tconst handleConfirm = async (passwordOrUsername) => {\n\t\t\ttry {\n\t\t\t\tawait deleteOwnAccount(SHA256(passwordOrUsername));\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('User_has_been_deleted') });\n\t\t\t\tlogout();\n\t\t\t} catch (error) {\n\t\t\t\tif (error.error === 'user-last-owner') {\n\t\t\t\t\tconst { shouldChangeOwner, shouldBeRemoved } = error.details;\n\t\t\t\t\treturn handleConfirmOwnerChange(passwordOrUsername, shouldChangeOwner, shouldBeRemoved);\n\t\t\t\t}\n\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t};\n\n\t\treturn setModal(() => <ActionConfirmModal onConfirm={handleConfirm} onCancel={closeModal} isPassword={localPassword} />);\n\t}, [closeModal, dispatchToastMessage, localPassword, setModal, handleConfirmOwnerChange, deleteOwnAccount, logout, t]);\n\n\treturn (\n\t\t<Page>\n\t\t\t<Page.Header title={t('Profile')}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t<Button primary danger disabled={!hasUnsavedChanges} onClick={reset}>\n\t\t\t\t\t\t{t('Reset')}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button primary disabled={!hasUnsavedChanges || !canSave || loggingOut} onClick={onSave}>\n\t\t\t\t\t\t{t('Save_changes')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Header>\n\t\t\t<Page.ScrollableContentWithShadow>\n\t\t\t\t<Box maxWidth='600px' w='full' alignSelf='center'>\n\t\t\t\t\t<AccountProfileForm\n\t\t\t\t\t\tvalues={values}\n\t\t\t\t\t\thandlers={handlers}\n\t\t\t\t\t\tuser={user ?? { emails: [] }}\n\t\t\t\t\t\tsettings={settings}\n\t\t\t\t\t\tonSaveStateChange={setCanSave}\n\t\t\t\t\t/>\n\t\t\t\t\t<ButtonGroup stretch mb='x12'>\n\t\t\t\t\t\t<Button onClick={handleLogoutOtherLocations} flexGrow={0} disabled={loggingOut}>\n\t\t\t\t\t\t\t{t('Logout_Others')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t{allowDeleteOwnAccount && (\n\t\t\t\t\t\t\t<Button danger onClick={handleDeleteOwnAccount}>\n\t\t\t\t\t\t\t\t<Icon name='trash' size='x20' mie='x4' />\n\t\t\t\t\t\t\t\t{t('Delete_my_account')}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Box>\n\t\t\t</Page.ScrollableContentWithShadow>\n\t\t</Page>\n\t);\n};\n\nexport default AccountProfilePage;\n"]}