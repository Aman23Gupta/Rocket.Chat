{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/users/UsersPage.js"],"names":["_objectSpread","module","link","default","v","useDebouncedValue","React","useEffect","useMemo","useState","UserPageHeaderContentWithSeatsCap","useSeatsCap","Page","VerticalBar","useRoute","useRouteParameter","useTranslation","useEndpointData","AddUser","EditUserWithData","InviteUsers","UserInfoWithData","UserPageHeaderContent","UsersTable","sortDir","useQuery","sortFields","text","itemsPerPage","current","fields","JSON","stringify","name","username","emails","roles","status","avatarETag","active","query","$or","$regex","$options","sort","reduce","agg","column","direction","count","offset","UsersPage","context","id","seatsCap","usersRoute","activeUsers","maxActiveUsers","includes","push","t","handleVerticalBarCloseButtonClick","params","setParams","setSort","debouncedParams","debouncedSort","value","data","reload","reloadList","Number","POSITIVE_INFINITY","users","total","exportDefault"],"mappings":"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","file":"dynamic/client/views/admin/users/UsersPage.js","sourcesContent":["import { useDebouncedValue } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, useMemo, useState } from 'react';\n\nimport UserPageHeaderContentWithSeatsCap from '../../../../ee/client/views/admin/users/UserPageHeaderContentWithSeatsCap';\nimport { useSeatsCap } from '../../../../ee/client/views/admin/users/useSeatsCap';\nimport Page from '../../../components/Page';\nimport VerticalBar from '../../../components/VerticalBar';\nimport { useRoute, useRouteParameter } from '../../../contexts/RouterContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useEndpointData } from '../../../hooks/useEndpointData';\nimport { AddUser } from './AddUser';\nimport EditUserWithData from './EditUserWithData';\nimport { InviteUsers } from './InviteUsers';\nimport { UserInfoWithData } from './UserInfo';\nimport UserPageHeaderContent from './UserPageHeaderContent';\nimport UsersTable from './UsersTable';\n\nconst sortDir = (sortDir) => (sortDir === 'asc' ? 1 : -1);\n\nconst useQuery = ({ text, itemsPerPage, current }, sortFields) =>\n\tuseMemo(\n\t\t() => ({\n\t\t\tfields: JSON.stringify({\n\t\t\t\tname: 1,\n\t\t\t\tusername: 1,\n\t\t\t\temails: 1,\n\t\t\t\troles: 1,\n\t\t\t\tstatus: 1,\n\t\t\t\tavatarETag: 1,\n\t\t\t\tactive: 1,\n\t\t\t}),\n\t\t\tquery: JSON.stringify({\n\t\t\t\t$or: [\n\t\t\t\t\t{ 'emails.address': { $regex: text || '', $options: 'i' } },\n\t\t\t\t\t{ username: { $regex: text || '', $options: 'i' } },\n\t\t\t\t\t{ name: { $regex: text || '', $options: 'i' } },\n\t\t\t\t],\n\t\t\t}),\n\t\t\tsort: JSON.stringify(\n\t\t\t\tsortFields.reduce((agg, [column, direction]) => {\n\t\t\t\t\tagg[column] = sortDir(direction);\n\t\t\t\t\treturn agg;\n\t\t\t\t}, {}),\n\t\t\t),\n\t\t\t...(itemsPerPage && { count: itemsPerPage }),\n\t\t\t...(current && { offset: current }),\n\t\t}),\n\t\t[text, itemsPerPage, current, sortFields],\n\t);\n\nfunction UsersPage() {\n\tconst context = useRouteParameter('context');\n\tconst id = useRouteParameter('id');\n\tconst seatsCap = useSeatsCap();\n\tconst usersRoute = useRoute('admin-users');\n\n\tuseEffect(() => {\n\t\tif (!context || !seatsCap) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (seatsCap.activeUsers >= seatsCap.maxActiveUsers && !['edit', 'info'].includes(context)) {\n\t\t\tusersRoute.push({});\n\t\t}\n\t}, [context, seatsCap, usersRoute]);\n\n\tconst t = useTranslation();\n\n\tconst handleVerticalBarCloseButtonClick = () => {\n\t\tusersRoute.push({});\n\t};\n\tconst [params, setParams] = useState({ text: '', current: 0, itemsPerPage: 25 });\n\tconst [sort, setSort] = useState([\n\t\t['name', 'asc'],\n\t\t['usernames', 'asc'],\n\t]);\n\n\tconst debouncedParams = useDebouncedValue(params, 500);\n\tconst debouncedSort = useDebouncedValue(sort, 500);\n\tconst query = useQuery(debouncedParams, debouncedSort);\n\tconst { value: data = {}, reload: reloadList } = useEndpointData('users.list', query);\n\n\tconst reload = () => {\n\t\tseatsCap?.reload();\n\t\treloadList();\n\t};\n\n\treturn (\n\t\t<Page flexDirection='row'>\n\t\t\t<Page>\n\t\t\t\t<Page.Header title={t('Users')}>\n\t\t\t\t\t{seatsCap &&\n\t\t\t\t\t\t(seatsCap.maxActiveUsers < Number.POSITIVE_INFINITY ? (\n\t\t\t\t\t\t\t<UserPageHeaderContentWithSeatsCap {...seatsCap} />\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<UserPageHeaderContent />\n\t\t\t\t\t\t))}\n\t\t\t\t</Page.Header>\n\t\t\t\t<Page.Content>\n\t\t\t\t\t<UsersTable users={data.users} total={data.total} params={params} onChangeParams={setParams} sort={sort} onChangeSort={setSort} />\n\t\t\t\t</Page.Content>\n\t\t\t</Page>\n\t\t\t{context && (\n\t\t\t\t<VerticalBar>\n\t\t\t\t\t<VerticalBar.Header>\n\t\t\t\t\t\t{context === 'info' && t('User_Info')}\n\t\t\t\t\t\t{context === 'edit' && t('Edit_User')}\n\t\t\t\t\t\t{context === 'new' && t('Add_User')}\n\t\t\t\t\t\t{context === 'invite' && t('Invite_Users')}\n\t\t\t\t\t\t<VerticalBar.Close onClick={handleVerticalBarCloseButtonClick} />\n\t\t\t\t\t</VerticalBar.Header>\n\n\t\t\t\t\t{context === 'info' && id && <UserInfoWithData uid={id} onReload={reload} />}\n\t\t\t\t\t{context === 'edit' && <EditUserWithData uid={id} onReload={reload} />}\n\t\t\t\t\t{context === 'new' && <AddUser onReload={reload} />}\n\t\t\t\t\t{context === 'invite' && <InviteUsers />}\n\t\t\t\t</VerticalBar>\n\t\t\t)}\n\t\t</Page>\n\t);\n}\n\nexport default UsersPage;\n"]}