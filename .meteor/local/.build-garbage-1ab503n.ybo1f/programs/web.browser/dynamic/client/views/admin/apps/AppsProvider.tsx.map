{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/apps/AppsProvider.tsx"],"names":[],"mappings":";;;;;;;;AACA;;AAAS,YAAoB,sCAApB,EAAwD;AAAA;AAAA;AAAA;;AAAA,CAAxD,EAAwD,CAAxD;AAAT;AAAS,MAAoB,KAApB,CAA0B,6BAA1B,EAAwD;AAAA;AAAA;AAAA;;AAAA,CAAxD,EAAwD,CAAxD;AAAwD;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAcjE,MAAM,iBAAiB,GAAI,SAAD,IAA8C;AACvE,QAAM,OAAO,GAAG,MAAM,CAAC,OAAP,CAAe,SAAf,CAAhB;;AAMA,OAAK,MAAM,CAAC,KAAD,EAAQ,QAAR,CAAX,IAAgC,OAAhC,EAAyC;AAAA;;AACxC,+BAAI,CAAC,aAAL,8EAAsB,gBAAtB,CAAuC,SAAS,CAAC,KAAD,CAAhD,EAAyD,QAAzD;AACA;;AACD,SAAO,MAAW;AACjB,SAAK,MAAM,CAAC,KAAD,EAAQ,QAAR,CAAX,IAAgC,OAAhC,EAAyC;AAAA;;AACxC,kCAAI,CAAC,aAAL,gFAAsB,kBAAtB,CAAyC,SAAS,CAAC,KAAD,CAAlD,EAA2D,QAA3D;AACA;AACD,GAJD;AAKA,CAfD;;AAyBA,MAAM,UAAU,GAAI,IAAD,IAAwB,IAAI,CAAC,IAAL,CAAU,CAAC,CAAD,EAAI,CAAJ,KAAW,CAAC,CAAC,IAAF,CAAO,WAAP,KAAuB,CAAC,CAAC,IAAF,CAAO,WAAP,EAAvB,GAA8C,CAA9C,GAAkD,CAAC,CAAxE,CAA3C;;AAEA,MAAM,OAAO,GAAG,CACf,KADe,EAIf,MAJe,KAOZ;AACH,UAAQ,MAAM,CAAC,IAAf;AACC,SAAK,YAAL;AACC,UAAI,KAAK,CAAC,KAAN,KAAgB,eAAe,CAAC,QAApC,EAA8C;AAC7C,eAAO,KAAP;AACA;;AACD,aAAO;AACN,aAAK,EAAE,eAAe,CAAC,QADjB;AAEN,cAAM,EAAE,MAAM,CAAC,MAFT;AAGN,aAAK,EAAE;AACN,cAAI,EAAE,UAAU,CACf,KAAK,CAAC,KAAN,CAAY,IAAZ,CAAiB,GAAjB,CAAsB,GAAD,IAAQ;AAC5B,gBAAI,GAAG,CAAC,EAAJ,KAAW,MAAM,CAAC,KAAtB,EAA6B;AAC5B,uCAAY,GAAZ;AACA;;AACD,mBAAO,GAAP;AACA,WALD,CADe;AADV,SAHD;AAaN,aAAK,EAAE;AAbD,OAAP;;AAeD,SAAK,QAAL;AACC,UAAI,KAAK,CAAC,KAAN,KAAgB,eAAe,CAAC,QAApC,EAA8C;AAC7C,eAAO,KAAP;AACA;;AACD,aAAO;AACN,aAAK,EAAE,eAAe,CAAC,QADjB;AAEN,cAAM,EAAE,YAA2B,SAF7B;AAGN,aAAK,EAAE;AACN,cAAI,EAAE,UAAU,CACf,KAAK,CAAC,KAAN,CAAY,IAAZ,CAAiB,GAAjB,CAAsB,GAAD,IAAQ;AAC5B,gBAAI,GAAG,CAAC,EAAJ,KAAW,MAAM,CAAC,GAAP,CAAW,EAA1B,EAA8B;AAC7B,qBAAO,MAAM,CAAC,GAAd;AACA;;AACD,mBAAO,GAAP;AACA,WALD,CADe;AADV,SAHD;AAaN,aAAK,EAAE;AAbD,OAAP;;AAeD,SAAK,SAAL;AACC,aAAO;AACN,cAAM,EAAE,YAA2B,SAD7B;AAEN,aAAK,EAAE,eAAe,CAAC,OAFjB;AAGN,aAAK,EAAE,SAHD;AAIN,aAAK,EAAE;AAJD,OAAP;;AAMD,SAAK,SAAL;AACC,aAAO;AACN,cAAM,EAAE,MAAM,CAAC,MADT;AAEN,aAAK,EAAE,eAAe,CAAC,QAFjB;AAGN,aAAK,EAAE;AAAE,cAAI,EAAE,UAAU,CAAC,MAAM,CAAC,IAAR;AAAlB,SAHD;AAIN,aAAK,EAAE;AAJD,OAAP;;AAMD,SAAK,QAAL;AACC,UAAI,KAAK,CAAC,KAAN,KAAgB,eAAe,CAAC,QAApC,EAA8C;AAC7C,eAAO,KAAP;AACA;;AACD,aAAO;AACN,cAAM,EAAE,MAAM,CAAC,MADT;AAEN,aAAK,EAAE,eAAe,CAAC,QAFjB;AAGN,aAAK,EAAE;AAAE,cAAI,EAAE,KAAK,CAAC,KAAN,CAAY,IAAZ,CAAiB,MAAjB,CAAwB;AAAA,gBAAC;AAAE;AAAF,aAAD;AAAA,mBAAY,EAAE,KAAK,MAAM,CAAC,KAA1B;AAAA,WAAxB;AAAR,SAHD;AAIN,aAAK,EAAE;AAJD,OAAP;;AAMD,SAAK,SAAL;AACC,aAAO;AACN,cAAM,EAAE,MAAM,CAAC,MADT;AAEN,aAAK,EAAE,eAAe,CAAC,QAFjB;AAGN,aAAK,EAAE,SAHD;AAIN,aAAK,EAAE,MAAM,CAAC;AAJR,OAAP;;AAMD;AACC,aAAO,KAAP;AAvEF;AAyEA,CAjFD;;AAmFA,MAAM,YAAY,GAAO,SAAiB;AAAA,MAAhB;AAAE;AAAF,GAAgB;AACzC,QAAM,CAAC,oBAAD,EAAuB,uBAAvB,IAAkD,UAAU,CAOhE,OAPgE,EAOvD;AACV,SAAK,EAAE,eAAe,CAAC,OADb;AAEV,SAAK,EAAE,SAFG;AAGV,SAAK,EAAE,SAHG;AAIV,UAAM,EAAE,YAAY;AAJV,GAPuD,CAAlE;AAcA,QAAM,CAAC,kBAAD,EAAqB,qBAArB,IAA8C,UAAU,CAO5D,OAP4D,EAOnD;AACV,SAAK,EAAE,eAAe,CAAC,OADb;AAEV,SAAK,EAAE,SAFG;AAGV,SAAK,EAAE,SAHG;AAIV,UAAM,EAAE,YAAY;AAJV,GAPmD,CAA9D;AAcA,QAAM,KAAK,GAAG,WAAW,CAAC,YAA0B;AACnD,2BAAuB,CAAC;AAAE,UAAI,EAAE,SAAR;AAAmB,YAAM,EAAE,YAAY;AAAvC,KAAD,CAAvB;AACA,yBAAqB,CAAC;AAAE,UAAI,EAAE,SAAR;AAAmB,YAAM,EAAE,YAAY;AAAvC,KAAD,CAArB;AAEA,QAAI,aAAa,GAAU,EAA3B;AACA,QAAI,eAAe,GAAU,EAA7B;AACA,QAAI,gBAAgB,GAAG,KAAvB;AACA,QAAI,kBAAkB,GAAG,KAAzB;;AAEA,QAAI;AACH,qBAAe,GAAI,MAAM,IAAI,CAAC,sBAAL,EAAzB;AACA,KAFD,CAEE,OAAO,CAAP,EAAU;AACX,6BAAuB,CAAC;AACvB,YAAI,EAAE,SADiB;AAEvB,aAAK,EAAE,CAFgB;AAGvB,cAAM,EAAE;AAHe,OAAD,CAAvB;AAKA,sBAAgB,GAAG,IAAnB;AACA;;AAED,QAAI;AACH,mBAAa,GAAG,MAAM,IAAI,CAAC,OAAL,GAAe,IAAf,CAAqB,MAAD,IACzC,MAAM,CAAC,GAAP,CAAY,OAAD,oCACP,OADO;AAEV,iBAAS,EAAE,IAFD;AAGV,mBAAW,EAAE;AAHH,QAAX,CADqB,CAAtB;AAOA,KARD,CAQE,OAAO,CAAP,EAAU;AACX,2BAAqB,CAAC;AACrB,YAAI,EAAE,SADe;AAErB,aAAK,EAAE,CAFc;AAGrB,cAAM,EAAE;AAHa,OAAD,CAArB;AAKA,wBAAkB,GAAG,IAArB;AACA;;AAED,UAAM,iBAAiB,GAAU,EAAjC;AACA,UAAM,mBAAmB,GAAU,EAAnC;;AAEA,QAAI,CAAC,gBAAL,EAAuB;AACtB,qBAAe,CAAC,OAAhB,CAAyB,GAAD,IAAQ;AAC/B,cAAM,QAAQ,GAAG,aAAa,CAAC,SAAd,CAAwB;AAAA,cAAC;AAAE;AAAF,WAAD;AAAA,iBAAY,EAAE,KAAK,GAAG,CAAC,EAAvB;AAAA,SAAxB,CAAjB;;AACA,YAAI,CAAC,aAAa,CAAC,QAAD,CAAlB,EAA8B;AAC7B,6BAAmB,CAAC,IAApB,iCACI,GADJ;AAEC,kBAAM,EAAE,SAFT;AAGC,8BAAkB,EAAE,GAAG,CAAC,OAHzB;AAIC,qBAAS,EAAE,GAAG,CAAC;AAJhB;AAOA;AACA;;AACD,cAAM,CAAC,YAAD,IAAiB,aAAa,CAAC,MAAd,CAAqB,QAArB,EAA+B,CAA/B,CAAvB;;AACA,cAAM,OAAO,iDACT,GADS;AAEZ,mBAAS,EAAE;AAFC,WAGR,YAAY,IAAI;AACnB,gBAAM,EAAE,YAAY,CAAC,MADF;AAEnB,iBAAO,EAAE,YAAY,CAAC,OAFH;AAGnB,2BAAiB,EAAE,YAAY,CAAC;AAHb,SAHR;AAQZ,mBAAS,EAAE,GAAG,CAAC,SARH;AASZ,4BAAkB,EAAE,GAAG,CAAC;AATZ,UAAb;;AAYA,yBAAiB,CAAC,IAAlB,CAAuB,OAAvB;AACA,2BAAmB,CAAC,IAApB,CAAyB,OAAzB;AACA,OA3BD;AA4BA,6BAAuB,CAAC;AACvB,YAAI,EAAE,SADiB;AAEvB,cAAM,EAAE,KAFe;AAGvB,YAAI,EAAE;AAHiB,OAAD,CAAvB;AAKA;;AAED,QAAI,CAAC,kBAAL,EAAyB;AACxB,UAAI,aAAa,CAAC,MAAlB,EAA0B;AACzB,yBAAiB,CAAC,IAAlB,CAAuB,GAAG,aAA1B;AACA;;AAED,2BAAqB,CAAC;AACrB,YAAI,EAAE,SADe;AAErB,cAAM,EAAE,KAFa;AAGrB,YAAI,EAAE;AAHe,OAAD,CAArB;AAKA;AACD,GAvFwB,EAuFtB,EAvFsB,CAAzB;AAyFA,QAAM,cAAc,GAAG,kBAAkB,CAAC,SAAS,cAAT,GAAuB;AAChE,WAAO,CAAC,oBAAD,EAAuB,kBAAvB,CAAP;AACA,GAFwC,CAAzC;AAIA,WAAS,CAAC,MAAK;AACd,UAAM,uBAAuB,GAAG,MAAO,KAAP,IAAuC;AACtE,UAAI,cAAJ;AACA,UAAI,YAAJ;;AAEA,UAAI;AACH,oBAAY,GAAG,MAAM,IAAI,CAAC,MAAL,CAAY,KAAZ,CAArB;AACA,OAFD,CAEE,OAAO,KAAP,EAAc;AACf,sBAAc,CAAC,KAAD,CAAd;AACA,cAAM,KAAN;AACA;;AAED,UAAI;AACH,sBAAc,GAAG,MAAM,IAAI,CAAC,qBAAL,CAA2B,KAA3B,EAAkC,YAAY,CAAC,OAA/C,CAAvB;AACA,OAFD,CAEE,OAAO,KAAP,EAAc;AACf,sBAAc,CAAC,KAAD,CAAd;AACA;;AAED,UAAI,cAAc,KAAK,SAAvB,EAAkC;AACjC,cAAM;AAAE,gBAAF;AAAU,iBAAV;AAAmB;AAAnB,YAAyC,YAA/C;;AACA,cAAM,MAAM,mCACR,cADQ;AAEX,mBAAS,EAAE,IAFA;AAGX,gBAHW;AAIX,iBAJW;AAKX,2BALW;AAMX,4BAAkB,EAAE,cAAc,CAAC;AANxB,UAAZ;;AASA,cAAM,GAAG,aAAH,IAAoB,cAAc,EAAxC;AAEA,+BAAuB,CAAC;AACvB,cAAI,EAAE,QADiB;AAEvB,aAAG,EAAE,MAFkB;AAGvB,gBAAM,EAAE;AAHe,SAAD,CAAvB;;AAMA,YAAI,aAAa,CAAC,KAAlB,EAAyB;AACxB,+BAAqB,CAAC;AACrB,gBAAI,EAAE,SADe;AAErB,gBAAI,EAAE,CAAC,GAAG,aAAa,CAAC,KAAd,CAAoB,IAAxB,EAA8B,MAA9B,CAFe;AAGrB,kBAAM,EAAE;AAHa,WAAD,CAArB;AAKA;AACA;;AAED,6BAAqB,CAAC;AACrB,cAAI,EAAE,SADe;AAErB,cAAI,EAAE,CAAC,MAAD,CAFe;AAGrB,gBAAM,EAAE;AAHa,SAAD,CAArB;AAMA;AACA;;AAED,2BAAqB,CAAC;AAAE,YAAI,EAAE,QAAR;AAAkB,WAAG,EAAE,YAAvB;AAAqC,cAAM,EAAE;AAA7C,OAAD,CAArB;AACA,KAvDD;;AAwDA,UAAM,SAAS,GAAG;AACjB,eAAS,EAAE,uBADM;AAEjB,iBAAW,EAAE,uBAFI;AAGjB,iBAAW,EAAG,KAAD,IAAwB;AAAA;;AACpC,cAAM,CAAC,WAAD,IAAgB,cAAc,EAApC;AACA,cAAM,GAAG,yBAAG,WAAW,CAAC,KAAf,uDAAG,mBAAmB,IAAnB,CAAwB,IAAxB,CAA6B;AAAA,cAAC;AAAE;AAAF,WAAD;AAAA,iBAA4B,EAAE,KAAK,KAAnC;AAAA,SAA7B,CAAZ;AAEA,6BAAqB,CAAC;AACrB,cAAI,EAAE,QADe;AAErB,eAFqB;AAGrB,gBAAM,EAAE;AAHa,SAAD,CAArB;;AAMA,YAAI,CAAC,GAAL,EAAU;AACT;AACA;;AAED,+BAAuB,CAAC;AACvB,cAAI,EAAE,QADiB;AAEvB,gBAAM,EAAE,KAFe;AAGvB,aAAG,kCACC,GADD;AAEF,mBAAO,EAAE,GAAF,aAAE,GAAF,uBAAE,GAAG,CAAE,kBAFZ;AAGF,qBAAS,EAAE,KAHT;AAIF,8BAAkB,EAAE,GAAF,aAAE,GAAF,uBAAE,GAAG,CAAE;AAJvB;AAHoB,SAAD,CAAvB;AAUA,OA3BgB;AA4BjB,uBAAiB,EAAE,SAAkE;AAAA;;AAAA,YAAjE;AAAE,eAAF;AAAS;AAAT,SAAiE;AACpF,cAAM,CAAC,WAAD,IAAgB,cAAc,EAApC;AACA,cAAM,GAAG,0BAAG,WAAW,CAAC,KAAf,wDAAG,oBAAmB,IAAnB,CAAwB,IAAxB,CAA6B;AAAA,cAAC;AAAE;AAAF,WAAD;AAAA,iBAA4B,EAAE,KAAK,KAAnC;AAAA,SAA7B,CAAZ;;AACA,YAAI,CAAC,GAAL,EAAU;AACT;AACA;;AAED,WAAG,CAAC,MAAJ,GAAa,MAAb;AAEA,6BAAqB,CAAC;AACrB,cAAI,EAAE,QADe;AAErB,aAAG,kCACC,GADD;AAEF;AAFE,YAFkB;AAMrB,gBAAM,EAAE;AANa,SAAD,CAArB;AASA,+BAAuB,CAAC;AACvB,cAAI,EAAE,QADiB;AAEvB,aAAG,kCACC,GADD;AAEF;AAFE,YAFoB;AAMvB,gBAAM,EAAE;AANe,SAAD,CAAvB;AAQA,OAtDgB;AAuDjB,yBAAmB,EAAE,SAAuC;AAAA,YAAtC;AAAE;AAAF,SAAsC;AAC3D,6BAAqB,CAAC;AAAE,cAAI,EAAE,YAAR;AAAsB,eAAtB;AAA6B,gBAAM,EAAE;AAArC,SAAD,CAArB;AACA,+BAAuB,CAAC;AAAE,cAAI,EAAE,YAAR;AAAsB,eAAtB;AAA6B,gBAAM,EAAE;AAArC,SAAD,CAAvB;AACA;AA1DgB,KAAlB;AA4DA,UAAM,mBAAmB,GAAG,iBAAiB,CAAC,SAAD,CAA7C;;AACA,QAAI;AACH,WAAK;AACL,KAFD,SAEU;AACT;AACA,aAAO,mBAAP;AACA;AACD,GA5HQ,EA4HN,CAAC,KAAD,EAAQ,cAAR,CA5HM,CAAT;AA6HA,sBACC,oBAAC,WAAD,CAAa,QAAb;AACC,YAAQ,EAAE,QADX;AAEC,SAAK,EAAE;AAAE,mBAAa,EAAE,kBAAjB;AAAqC,qBAAe,EAAE,oBAAtD;AAA4E,YAAM,EAAE;AAApF;AAFR,IADD;AAMA,CA7PD;;AA5HA,OAAO,aAAP,CA0Xe,YA1Xf,E","file":"dynamic/client/views/admin/apps/AppsProvider.tsx","sourcesContent":["import { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, FC, useReducer, Reducer, useCallback } from 'react';\n\nimport { AppEvents } from '../../../../app/apps/client/communication';\nimport { Apps } from '../../../../app/apps/client/orchestrator';\nimport { AsyncState, AsyncStatePhase } from '../../../lib/asyncState';\nimport { AppsContext } from './AppsContext';\nimport { handleAPIError } from './helpers';\nimport { App } from './types';\n\ntype ListenersMapping = {\n\treadonly [P in keyof typeof AppEvents]?: (...args: any[]) => void;\n};\n\nconst registerListeners = (listeners: ListenersMapping): (() => void) => {\n\tconst entries = Object.entries(listeners) as Exclude<\n\t\t{\n\t\t\t[K in keyof ListenersMapping]: [K, ListenersMapping[K]];\n\t\t}[keyof ListenersMapping],\n\t\tundefined\n\t>[];\n\tfor (const [event, callback] of entries) {\n\t\tApps.getWsListener()?.registerListener(AppEvents[event], callback);\n\t}\n\treturn (): void => {\n\t\tfor (const [event, callback] of entries) {\n\t\t\tApps.getWsListener()?.unregisterListener(AppEvents[event], callback);\n\t\t}\n\t};\n};\n\ntype Action =\n\t| { type: 'request'; reload: () => Promise<void> }\n\t| { type: 'update'; app: App; reload: () => Promise<void> }\n\t| { type: 'delete'; appId: string; reload: () => Promise<void> }\n\t| { type: 'invalidate'; appId: string; reload: () => Promise<void> }\n\t| { type: 'success'; apps: App[]; reload: () => Promise<void> }\n\t| { type: 'failure'; error: Error; reload: () => Promise<void> };\n\nconst sortByName = (apps: App[]): App[] => apps.sort((a, b) => (a.name.toLowerCase() > b.name.toLowerCase() ? 1 : -1));\n\nconst reducer = (\n\tstate: AsyncState<{ apps: App[] }> & {\n\t\treload: () => Promise<void>;\n\t},\n\taction: Action,\n): AsyncState<{ apps: App[] }> & {\n\treload: () => Promise<void>;\n} => {\n\tswitch (action.type) {\n\t\tcase 'invalidate':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\treload: action.reload,\n\t\t\t\tvalue: {\n\t\t\t\t\tapps: sortByName(\n\t\t\t\t\t\tstate.value.apps.map((app) => {\n\t\t\t\t\t\t\tif (app.id === action.appId) {\n\t\t\t\t\t\t\t\treturn { ...app };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn app;\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'update':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\treload: async (): Promise<void> => undefined,\n\t\t\t\tvalue: {\n\t\t\t\t\tapps: sortByName(\n\t\t\t\t\t\tstate.value.apps.map((app) => {\n\t\t\t\t\t\t\tif (app.id === action.app.id) {\n\t\t\t\t\t\t\t\treturn action.app;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn app;\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'request':\n\t\t\treturn {\n\t\t\t\treload: async (): Promise<void> => undefined,\n\t\t\t\tphase: AsyncStatePhase.LOADING,\n\t\t\t\tvalue: undefined,\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'success':\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\tvalue: { apps: sortByName(action.apps) },\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'delete':\n\t\t\tif (state.phase !== AsyncStatePhase.RESOLVED) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\tvalue: { apps: state.value.apps.filter(({ id }) => id !== action.appId) },\n\t\t\t\terror: undefined,\n\t\t\t};\n\t\tcase 'failure':\n\t\t\treturn {\n\t\t\t\treload: action.reload,\n\t\t\t\tphase: AsyncStatePhase.REJECTED,\n\t\t\t\tvalue: undefined,\n\t\t\t\terror: action.error,\n\t\t\t};\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nconst AppsProvider: FC = ({ children }) => {\n\tconst [marketplaceAppsState, dispatchMarketplaceApps] = useReducer<\n\t\tReducer<\n\t\t\tAsyncState<{ apps: App[] }> & {\n\t\t\t\treload: () => Promise<void>;\n\t\t\t},\n\t\t\tAction\n\t\t>\n\t>(reducer, {\n\t\tphase: AsyncStatePhase.LOADING,\n\t\tvalue: undefined,\n\t\terror: undefined,\n\t\treload: async () => undefined,\n\t});\n\n\tconst [installedAppsState, dispatchInstalledApps] = useReducer<\n\t\tReducer<\n\t\t\tAsyncState<{ apps: App[] }> & {\n\t\t\t\treload: () => Promise<void>;\n\t\t\t},\n\t\t\tAction\n\t\t>\n\t>(reducer, {\n\t\tphase: AsyncStatePhase.LOADING,\n\t\tvalue: undefined,\n\t\terror: undefined,\n\t\treload: async () => undefined,\n\t});\n\n\tconst fetch = useCallback(async (): Promise<void> => {\n\t\tdispatchMarketplaceApps({ type: 'request', reload: async () => undefined });\n\t\tdispatchInstalledApps({ type: 'request', reload: async () => undefined });\n\n\t\tlet installedApps: App[] = [];\n\t\tlet marketplaceApps: App[] = [];\n\t\tlet marketplaceError = false;\n\t\tlet installedAppsError = false;\n\n\t\ttry {\n\t\t\tmarketplaceApps = (await Apps.getAppsFromMarketplace()) as App[];\n\t\t} catch (e) {\n\t\t\tdispatchMarketplaceApps({\n\t\t\t\ttype: 'failure',\n\t\t\t\terror: e,\n\t\t\t\treload: fetch,\n\t\t\t});\n\t\t\tmarketplaceError = true;\n\t\t}\n\n\t\ttry {\n\t\t\tinstalledApps = await Apps.getApps().then((result: App[]) =>\n\t\t\t\tresult.map((current: App) => ({\n\t\t\t\t\t...current,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\tmarketplace: false,\n\t\t\t\t})),\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tdispatchInstalledApps({\n\t\t\t\ttype: 'failure',\n\t\t\t\terror: e,\n\t\t\t\treload: fetch,\n\t\t\t});\n\t\t\tinstalledAppsError = true;\n\t\t}\n\n\t\tconst installedAppsData: App[] = [];\n\t\tconst marketplaceAppsData: App[] = [];\n\n\t\tif (!marketplaceError) {\n\t\t\tmarketplaceApps.forEach((app) => {\n\t\t\t\tconst appIndex = installedApps.findIndex(({ id }) => id === app.id);\n\t\t\t\tif (!installedApps[appIndex]) {\n\t\t\t\t\tmarketplaceAppsData.push({\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus: undefined,\n\t\t\t\t\t\tmarketplaceVersion: app.version,\n\t\t\t\t\t\tbundledIn: app.bundledIn,\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst [installedApp] = installedApps.splice(appIndex, 1);\n\t\t\t\tconst appData = {\n\t\t\t\t\t...app,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\t...(installedApp && {\n\t\t\t\t\t\tstatus: installedApp.status,\n\t\t\t\t\t\tversion: installedApp.version,\n\t\t\t\t\t\tlicenseValidation: installedApp.licenseValidation,\n\t\t\t\t\t}),\n\t\t\t\t\tbundledIn: app.bundledIn,\n\t\t\t\t\tmarketplaceVersion: app.version,\n\t\t\t\t};\n\n\t\t\t\tinstalledAppsData.push(appData);\n\t\t\t\tmarketplaceAppsData.push(appData);\n\t\t\t});\n\t\t\tdispatchMarketplaceApps({\n\t\t\t\ttype: 'success',\n\t\t\t\treload: fetch,\n\t\t\t\tapps: marketplaceAppsData,\n\t\t\t});\n\t\t}\n\n\t\tif (!installedAppsError) {\n\t\t\tif (installedApps.length) {\n\t\t\t\tinstalledAppsData.push(...installedApps);\n\t\t\t}\n\n\t\t\tdispatchInstalledApps({\n\t\t\t\ttype: 'success',\n\t\t\t\treload: fetch,\n\t\t\t\tapps: installedAppsData,\n\t\t\t});\n\t\t}\n\t}, []);\n\n\tconst getCurrentData = useMutableCallback(function getCurrentData() {\n\t\treturn [marketplaceAppsState, installedAppsState];\n\t});\n\n\tuseEffect(() => {\n\t\tconst handleAppAddedOrUpdated = async (appId: string): Promise<void> => {\n\t\t\tlet marketplaceApp: App | undefined;\n\t\t\tlet installedApp: App;\n\n\t\t\ttry {\n\t\t\t\tinstalledApp = await Apps.getApp(appId);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t\tthrow error;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tmarketplaceApp = await Apps.getAppFromMarketplace(appId, installedApp.version);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\n\t\t\tif (marketplaceApp !== undefined) {\n\t\t\t\tconst { status, version, licenseValidation } = installedApp;\n\t\t\t\tconst record = {\n\t\t\t\t\t...marketplaceApp,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t\tstatus,\n\t\t\t\t\tversion,\n\t\t\t\t\tlicenseValidation,\n\t\t\t\t\tmarketplaceVersion: marketplaceApp.version,\n\t\t\t\t};\n\n\t\t\t\tconst [, installedApps] = getCurrentData();\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: record,\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tif (installedApps.value) {\n\t\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\tapps: [...installedApps.value.apps, record],\n\t\t\t\t\t\treload: fetch,\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\tapps: [record],\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdispatchInstalledApps({ type: 'update', app: installedApp, reload: fetch });\n\t\t};\n\t\tconst listeners = {\n\t\t\tAPP_ADDED: handleAppAddedOrUpdated,\n\t\t\tAPP_UPDATED: handleAppAddedOrUpdated,\n\t\t\tAPP_REMOVED: (appId: string): void => {\n\t\t\t\tconst [updatedData] = getCurrentData();\n\t\t\t\tconst app = updatedData.value?.apps.find(({ id }: { id: string }) => id === appId);\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'delete',\n\t\t\t\t\tappId,\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tif (!app) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\treload: fetch,\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tversion: app?.marketplaceVersion,\n\t\t\t\t\t\tinstalled: false,\n\t\t\t\t\t\tmarketplaceVersion: app?.marketplaceVersion,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tAPP_STATUS_CHANGE: ({ appId, status }: { appId: string; status: AppStatus }): void => {\n\t\t\t\tconst [updatedData] = getCurrentData();\n\t\t\t\tconst app = updatedData.value?.apps.find(({ id }: { id: string }) => id === appId);\n\t\t\t\tif (!app) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tapp.status = status;\n\n\t\t\t\tdispatchInstalledApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t},\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\n\t\t\t\tdispatchMarketplaceApps({\n\t\t\t\t\ttype: 'update',\n\t\t\t\t\tapp: {\n\t\t\t\t\t\t...app,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t},\n\t\t\t\t\treload: fetch,\n\t\t\t\t});\n\t\t\t},\n\t\t\tAPP_SETTING_UPDATED: ({ appId }: { appId: string }): void => {\n\t\t\t\tdispatchInstalledApps({ type: 'invalidate', appId, reload: fetch });\n\t\t\t\tdispatchMarketplaceApps({ type: 'invalidate', appId, reload: fetch });\n\t\t\t},\n\t\t};\n\t\tconst unregisterListeners = registerListeners(listeners);\n\t\ttry {\n\t\t\tfetch();\n\t\t} finally {\n\t\t\t// eslint-disable-next-line no-unsafe-finally\n\t\t\treturn unregisterListeners;\n\t\t}\n\t}, [fetch, getCurrentData]);\n\treturn (\n\t\t<AppsContext.Provider\n\t\t\tchildren={children}\n\t\t\tvalue={{ installedApps: installedAppsState, marketplaceApps: marketplaceAppsState, reload: fetch }}\n\t\t/>\n\t);\n};\nexport default AppsProvider;\n"]}