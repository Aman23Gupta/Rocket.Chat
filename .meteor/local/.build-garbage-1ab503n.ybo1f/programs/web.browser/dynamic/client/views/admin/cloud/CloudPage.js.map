{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/cloud/CloudPage.js"],"names":["Box","Button","ButtonGroup","Margins","module","link","v","useMutableCallback","useSafely","React","useState","useEffect","default","Page","useSetModal","useQueryStringParameter","useRoute","useRouteParameter","useMethod","useToastMessageDispatch","useTranslation","ConnectToCloudSection","ManualWorkspaceRegistrationModal","TroubleshootingSection","WhatIsItSection","WorkspaceLoginSection","WorkspaceRegistrationSection","cloudConsoleUrl","CloudPage","t","dispatchToastMessage","cloudRoute","page","errorCode","code","state","token","finishOAuthAuthorization","checkRegisterStatus","connectWorkspace","acceptOAuthAuthorization","type","title","message","push","error","registerStatus","setRegisterStatus","setModal","fetchRegisterStatus","acceptWorkspaceToken","isConnected","Error","handleManualWorkspaceRegistrationButtonClick","handleModalClose","isConnectToCloudDesired","connectToCloud","isWorkspaceRegistered","workspaceRegistered","email","workspaceId","uniqueId","exportDefault"],"mappings":"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","file":"dynamic/client/views/admin/cloud/CloudPage.js","sourcesContent":["import { Box, Button, ButtonGroup, Margins } from '@rocket.chat/fuselage';\nimport { useMutableCallback, useSafely } from '@rocket.chat/fuselage-hooks';\nimport React, { useState, useEffect } from 'react';\n\nimport Page from '../../../components/Page';\nimport { useSetModal } from '../../../contexts/ModalContext';\nimport { useQueryStringParameter, useRoute, useRouteParameter } from '../../../contexts/RouterContext';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport ConnectToCloudSection from './ConnectToCloudSection';\nimport ManualWorkspaceRegistrationModal from './ManualWorkspaceRegistrationModal';\nimport TroubleshootingSection from './TroubleshootingSection';\nimport WhatIsItSection from './WhatIsItSection';\nimport WorkspaceLoginSection from './WorkspaceLoginSection';\nimport WorkspaceRegistrationSection from './WorkspaceRegistrationSection';\nimport { cloudConsoleUrl } from './constants';\n\nfunction CloudPage() {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst cloudRoute = useRoute('cloud');\n\n\tconst page = useRouteParameter('page');\n\n\tconst errorCode = useQueryStringParameter('error_code');\n\tconst code = useQueryStringParameter('code');\n\tconst state = useQueryStringParameter('state');\n\tconst token = useQueryStringParameter('token');\n\n\tconst finishOAuthAuthorization = useMethod('cloud:finishOAuthAuthorization');\n\tconst checkRegisterStatus = useMethod('cloud:checkRegisterStatus');\n\tconst connectWorkspace = useMethod('cloud:connectWorkspace');\n\n\tuseEffect(() => {\n\t\tconst acceptOAuthAuthorization = async () => {\n\t\t\tif (page !== 'oauth-callback') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (errorCode) {\n\t\t\t\tdispatchToastMessage({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\ttitle: t('Cloud_error_in_authenticating'),\n\t\t\t\t\tmessage: t('Cloud_error_code', { errorCode }),\n\t\t\t\t});\n\t\t\t\tcloudRoute.push();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait finishOAuthAuthorization(code, state);\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t} finally {\n\t\t\t\tcloudRoute.push();\n\t\t\t}\n\t\t};\n\n\t\tacceptOAuthAuthorization();\n\t}, [errorCode, code, state, page, dispatchToastMessage, t, cloudRoute, finishOAuthAuthorization]);\n\n\tconst [registerStatus, setRegisterStatus] = useSafely(useState());\n\tconst setModal = useSetModal();\n\n\tconst fetchRegisterStatus = useMutableCallback(async () => {\n\t\ttry {\n\t\t\tconst registerStatus = await checkRegisterStatus();\n\t\t\tsetRegisterStatus(registerStatus);\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tuseEffect(() => {\n\t\tconst acceptWorkspaceToken = async () => {\n\t\t\ttry {\n\t\t\t\tif (token) {\n\t\t\t\t\tconst isConnected = await connectWorkspace(token);\n\n\t\t\t\t\tif (!isConnected) {\n\t\t\t\t\t\tthrow Error(t('An error occured connecting'));\n\t\t\t\t\t}\n\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Connected') });\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t} finally {\n\t\t\t\tawait fetchRegisterStatus();\n\t\t\t}\n\t\t};\n\n\t\tacceptWorkspaceToken();\n\t}, [connectWorkspace, dispatchToastMessage, fetchRegisterStatus, t, token]);\n\n\tconst handleManualWorkspaceRegistrationButtonClick = () => {\n\t\tconst handleModalClose = () => {\n\t\t\tsetModal(null);\n\t\t\tfetchRegisterStatus();\n\t\t};\n\t\tsetModal(<ManualWorkspaceRegistrationModal onClose={handleModalClose} />);\n\t};\n\n\tconst isConnectToCloudDesired = registerStatus?.connectToCloud;\n\tconst isWorkspaceRegistered = registerStatus?.workspaceRegistered;\n\n\treturn (\n\t\t<Page>\n\t\t\t<Page.Header title={t('Connectivity_Services')}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t{!isWorkspaceRegistered && <Button onClick={handleManualWorkspaceRegistrationButtonClick}>{t('Cloud_Register_manually')}</Button>}\n\t\t\t\t\t<Button is='a' primary href={cloudConsoleUrl} target='_blank' rel='noopener noreferrer'>\n\t\t\t\t\t\t{t('Cloud_console')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Header>\n\t\t\t<Page.ScrollableContentWithShadow>\n\t\t\t\t<Box marginInline='auto' marginBlock='neg-x24' width='full' maxWidth='x580'>\n\t\t\t\t\t<Margins block='x24'>\n\t\t\t\t\t\t<WhatIsItSection />\n\n\t\t\t\t\t\t{isConnectToCloudDesired && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t{isWorkspaceRegistered ? (\n\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t<WorkspaceLoginSection onRegisterStatusChange={fetchRegisterStatus} />\n\t\t\t\t\t\t\t\t\t\t<TroubleshootingSection onRegisterStatusChange={fetchRegisterStatus} />\n\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<WorkspaceRegistrationSection\n\t\t\t\t\t\t\t\t\t\temail={registerStatus?.email}\n\t\t\t\t\t\t\t\t\t\ttoken={registerStatus?.token}\n\t\t\t\t\t\t\t\t\t\tworkspaceId={registerStatus?.workspaceId}\n\t\t\t\t\t\t\t\t\t\tuniqueId={registerStatus?.uniqueId}\n\t\t\t\t\t\t\t\t\t\tonRegisterStatusChange={fetchRegisterStatus}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{!isConnectToCloudDesired && <ConnectToCloudSection onRegisterStatusChange={fetchRegisterStatus} />}\n\t\t\t\t\t</Margins>\n\t\t\t\t</Box>\n\t\t\t</Page.ScrollableContentWithShadow>\n\t\t</Page>\n\t);\n}\n\nexport default CloudPage;\n"]}