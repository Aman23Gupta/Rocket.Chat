{"version":3,"sources":["meteor://ðŸ’»app/client/views/omnichannel/triggers/EditTriggerPage.js"],"names":["_objectSpread","module","link","default","v","_objectWithoutProperties","Margins","FieldGroup","Box","Button","useMutableCallback","React","useRoute","useMethod","useToastMessageDispatch","useTranslation","useForm","TriggersForm","getInitialValues","name","description","enabled","runOnce","conditions","condName","value","condValue","actions","action","actName","params","sender","actSender","msg","actMsg","actSenderName","EditTriggerPage","data","onSave","dispatchToastMessage","t","router","save","values","handlers","hasUnsavedChanges","handleSave","restValues","_id","type","message","push","error","canSave","exportDefault"],"mappings":"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","file":"dynamic/client/views/omnichannel/triggers/EditTriggerPage.js","sourcesContent":["import { Margins, FieldGroup, Box, Button } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React from 'react';\n\nimport { useRoute } from '../../../contexts/RouterContext';\nimport { useMethod } from '../../../contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useForm } from '../../../hooks/useForm';\nimport TriggersForm from './TriggersForm';\n\nconst getInitialValues = ({\n\tname,\n\tdescription,\n\tenabled,\n\trunOnce,\n\tconditions: [{ name: condName, value: condValue }],\n\tactions: [\n\t\t{\n\t\t\taction: actName,\n\t\t\tparams: { sender: actSender, msg: actMsg, name: actSenderName },\n\t\t},\n\t],\n}) => ({\n\tname: name ?? '',\n\tdescription: description ?? '',\n\tenabled: !!enabled,\n\trunOnce: !!runOnce,\n\tconditions: {\n\t\tname: condName ?? 'page-url',\n\t\tvalue: condValue ?? '',\n\t},\n\tactions: {\n\t\tname: actName ?? '',\n\t\tparams: {\n\t\t\tsender: actSender ?? 'queue',\n\t\t\tmsg: actMsg ?? '',\n\t\t\tname: actSenderName ?? '',\n\t\t},\n\t},\n});\n\nconst EditTriggerPage = ({ data, onSave }) => {\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst t = useTranslation();\n\n\tconst router = useRoute('omnichannel-triggers');\n\n\tconst save = useMethod('livechat:saveTrigger');\n\n\tconst { values, handlers, hasUnsavedChanges } = useForm(getInitialValues(data));\n\n\tconst handleSave = useMutableCallback(async () => {\n\t\ttry {\n\t\t\tconst {\n\t\t\t\tactions: {\n\t\t\t\t\tparams: { sender, msg, name },\n\t\t\t\t},\n\t\t\t\t...restValues\n\t\t\t} = values;\n\t\t\tawait save({\n\t\t\t\t_id: data._id,\n\t\t\t\t...restValues,\n\t\t\t\tconditions: [values.conditions],\n\t\t\t\tactions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'send-message',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tsender,\n\t\t\t\t\t\t\tmsg,\n\t\t\t\t\t\t\t...(sender === 'custom' && { name }),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Saved') });\n\t\t\tonSave();\n\t\t\trouter.push({});\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tconst { name } = values;\n\n\tconst canSave = name && hasUnsavedChanges;\n\n\treturn (\n\t\t<>\n\t\t\t<FieldGroup>\n\t\t\t\t<TriggersForm values={values} handlers={handlers} />\n\t\t\t</FieldGroup>\n\t\t\t<Box display='flex' flexDirection='row' justifyContent='space-between' w='full'>\n\t\t\t\t<Margins inlineEnd='x4'>\n\t\t\t\t\t<Button flexGrow={1} primary onClick={handleSave} disabled={!canSave}>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t</Margins>\n\t\t\t</Box>\n\t\t</>\n\t);\n};\n\nexport default EditTriggerPage;\n"]}