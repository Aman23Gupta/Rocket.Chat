{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/Call/Jitsi/CallJitsiWithData.js"],"names":["Skeleton","module","link","v","useMutableCallback","useSafely","clear","React","useRef","useEffect","useState","useMemo","useLayoutEffect","memo","default","HEARTBEAT","TIMEOUT","DEBOUNCE","useConnectionStatus","useSetModal","useMethod","useSettings","useToastMessageDispatch","useTranslation","useUser","useRoom","useTabBarClose","CallJitsi","CallModal","JitsiBridge","querySettings","_id","CallJitsiWithData","rid","user","connected","accessToken","setAccessToken","accepted","setAccepted","room","setModal","handleClose","closeModal","generateAccessToken","updateTimeout","dispatchToastMessage","t","handleCancel","ref","Jitsi_Open_New_Window","openNewWindow","Jitsi_Domain","domain","Jitsi_SSL","ssl","Jitsi_Chrome_Extension","desktopSharingChromeExtId","Jitsi_URL_Room_Hash","useHashName","uniqueID","Jitsi_URL_Room_Prefix","prefix","Jitsi_URL_Room_Suffix","sufix","Jitsi_Enabled_TokenAuth","isEnabledTokenAuth","Object","fromEntries","map","value","ignore","rname","encodeURIComponent","usernames","join","name","jitsi","jitsiRoomName","username","testAndHandleTimeout","window","closed","dispose","error","type","message","reason","Date","jitsiTimeout","off","needsStart","start","current","on","handleYes","exportDefault"],"mappings":";;;;;;;;AAAA,IAAIA,QAAJ;AAAaC,MAAM,CAACC,IAAP,CAAY,uBAAZ,EAAoC;AAACF,UAAQ,CAACG,CAAD,EAAG;AAACH,YAAQ,GAACG,CAAT;AAAW;;AAAxB,CAApC,EAA8D,CAA9D;AAAiE,IAAIC,kBAAJ,EAAuBC,SAAvB;AAAiCJ,MAAM,CAACC,IAAP,CAAY,6BAAZ,EAA0C;AAACE,oBAAkB,CAACD,CAAD,EAAG;AAACC,sBAAkB,GAACD,CAAnB;AAAqB,GAA5C;;AAA6CE,WAAS,CAACF,CAAD,EAAG;AAACE,aAAS,GAACF,CAAV;AAAY;;AAAtE,CAA1C,EAAkH,CAAlH;AAAqH,IAAIG,KAAJ;AAAUL,MAAM,CAACC,IAAP,CAAY,mBAAZ,EAAgC;AAACI,OAAK,CAACH,CAAD,EAAG;AAACG,SAAK,GAACH,CAAN;AAAQ;;AAAlB,CAAhC,EAAoD,CAApD;AAAuD,IAAII,KAAJ,EAAUC,MAAV,EAAiBC,SAAjB,EAA2BC,QAA3B,EAAoCC,OAApC,EAA4CC,eAA5C,EAA4DC,IAA5D;AAAiEZ,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAoB;AAACY,SAAO,CAACX,CAAD,EAAG;AAACI,SAAK,GAACJ,CAAN;AAAQ,GAApB;;AAAqBK,QAAM,CAACL,CAAD,EAAG;AAACK,UAAM,GAACL,CAAP;AAAS,GAAxC;;AAAyCM,WAAS,CAACN,CAAD,EAAG;AAACM,aAAS,GAACN,CAAV;AAAY,GAAlE;;AAAmEO,UAAQ,CAACP,CAAD,EAAG;AAACO,YAAQ,GAACP,CAAT;AAAW,GAA1F;;AAA2FQ,SAAO,CAACR,CAAD,EAAG;AAACQ,WAAO,GAACR,CAAR;AAAU,GAAhH;;AAAiHS,iBAAe,CAACT,CAAD,EAAG;AAACS,mBAAe,GAACT,CAAhB;AAAkB,GAAtJ;;AAAuJU,MAAI,CAACV,CAAD,EAAG;AAACU,QAAI,GAACV,CAAL;AAAO;;AAAtK,CAApB,EAA4L,CAA5L;AAA+L,IAAIY,SAAJ,EAAcC,OAAd,EAAsBC,QAAtB;AAA+BhB,MAAM,CAACC,IAAP,CAAY,6CAAZ,EAA0D;AAACa,WAAS,CAACZ,CAAD,EAAG;AAACY,aAAS,GAACZ,CAAV;AAAY,GAA1B;;AAA2Ba,SAAO,CAACb,CAAD,EAAG;AAACa,WAAO,GAACb,CAAR;AAAU,GAAhD;;AAAiDc,UAAQ,CAACd,CAAD,EAAG;AAACc,YAAQ,GAACd,CAAT;AAAW;;AAAxE,CAA1D,EAAoI,CAApI;AAAuI,IAAIe,mBAAJ;AAAwBjB,MAAM,CAACC,IAAP,CAAY,iDAAZ,EAA8D;AAACgB,qBAAmB,CAACf,CAAD,EAAG;AAACe,uBAAmB,GAACf,CAApB;AAAsB;;AAA9C,CAA9D,EAA8G,CAA9G;AAAiH,IAAIgB,WAAJ;AAAgBlB,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACiB,aAAW,CAAChB,CAAD,EAAG;AAACgB,eAAW,GAAChB,CAAZ;AAAc;;AAA9B,CAAnD,EAAmF,CAAnF;AAAsF,IAAIiB,SAAJ;AAAcnB,MAAM,CAACC,IAAP,CAAY,uCAAZ,EAAoD;AAACkB,WAAS,CAACjB,CAAD,EAAG;AAACiB,aAAS,GAACjB,CAAV;AAAY;;AAA1B,CAApD,EAAgF,CAAhF;AAAmF,IAAIkB,WAAJ;AAAgBpB,MAAM,CAACC,IAAP,CAAY,yCAAZ,EAAsD;AAACmB,aAAW,CAAClB,CAAD,EAAG;AAACkB,eAAW,GAAClB,CAAZ;AAAc;;AAA9B,CAAtD,EAAsF,CAAtF;AAAyF,IAAImB,uBAAJ;AAA4BrB,MAAM,CAACC,IAAP,CAAY,8CAAZ,EAA2D;AAACoB,yBAAuB,CAACnB,CAAD,EAAG;AAACmB,2BAAuB,GAACnB,CAAxB;AAA0B;;AAAtD,CAA3D,EAAmH,CAAnH;AAAsH,IAAIoB,cAAJ;AAAmBtB,MAAM,CAACC,IAAP,CAAY,4CAAZ,EAAyD;AAACqB,gBAAc,CAACpB,CAAD,EAAG;AAACoB,kBAAc,GAACpB,CAAf;AAAiB;;AAApC,CAAzD,EAA+F,EAA/F;AAAmG,IAAIqB,OAAJ;AAAYvB,MAAM,CAACC,IAAP,CAAY,qCAAZ,EAAkD;AAACsB,SAAO,CAACrB,CAAD,EAAG;AAACqB,WAAO,GAACrB,CAAR;AAAU;;AAAtB,CAAlD,EAA0E,EAA1E;AAA8E,IAAIsB,OAAJ;AAAYxB,MAAM,CAACC,IAAP,CAAY,+BAAZ,EAA4C;AAACuB,SAAO,CAACtB,CAAD,EAAG;AAACsB,WAAO,GAACtB,CAAR;AAAU;;AAAtB,CAA5C,EAAoE,EAApE;AAAwE,IAAIuB,cAAJ;AAAmBzB,MAAM,CAACC,IAAP,CAAY,oCAAZ,EAAiD;AAACwB,gBAAc,CAACvB,CAAD,EAAG;AAACuB,kBAAc,GAACvB,CAAf;AAAiB;;AAApC,CAAjD,EAAuF,EAAvF;AAA2F,IAAIwB,SAAJ;AAAc1B,MAAM,CAACC,IAAP,CAAY,aAAZ,EAA0B;AAACY,SAAO,CAACX,CAAD,EAAG;AAACwB,aAAS,GAACxB,CAAV;AAAY;;AAAxB,CAA1B,EAAoD,EAApD;AAAwD,IAAIyB,SAAJ;AAAc3B,MAAM,CAACC,IAAP,CAAY,wBAAZ,EAAqC;AAACY,SAAO,CAACX,CAAD,EAAG;AAACyB,aAAS,GAACzB,CAAV;AAAY;;AAAxB,CAArC,EAA+D,EAA/D;AAAmE,IAAI0B,WAAJ;AAAgB5B,MAAM,CAACC,IAAP,CAAY,mBAAZ,EAAgC;AAAC2B,aAAW,CAAC1B,CAAD,EAAG;AAAC0B,eAAW,GAAC1B,CAAZ;AAAc;;AAA9B,CAAhC,EAAgE,EAAhE;AAAoEF,MAAM,CAACC,IAAP,CAAY,aAAZ,EAA0B;AAACY,SAAO,EAAC;AAAT,CAA1B,EAAgD,EAAhD;AAqBn5D,MAAMgB,aAAa,GAAG;AACrBC,KAAG,EAAE,CACJ,uBADI,EAEJ,cAFI,EAGJ,qBAHI,EAIJ,UAJI,EAKJ,uBALI,EAMJ,uBANI,EAOJ,wBAPI,EAQJ,WARI,EASJ,yBATI;AADgB,CAAtB;;AAcA,MAAMC,iBAAiB,GAAG,QAAa;AAAA,MAAZ;AAAEC;AAAF,GAAY;AACtC,QAAMC,IAAI,GAAGV,OAAO,EAApB;AACA,QAAM;AAAEW;AAAF,MAAgBjB,mBAAmB,EAAzC;AACA,QAAM,CAACkB,WAAD,EAAcC,cAAd,IAAgChC,SAAS,CAACK,QAAQ,EAAT,CAA/C;AACA,QAAM,CAAC4B,QAAD,EAAWC,WAAX,IAA0B7B,QAAQ,CAAC,KAAD,CAAxC;AACA,QAAM8B,IAAI,GAAGf,OAAO,EAApB;AACA,QAAMgB,QAAQ,GAAGtB,WAAW,EAA5B;AACA,QAAMuB,WAAW,GAAGhB,cAAc,EAAlC;AACA,QAAMiB,UAAU,GAAGvC,kBAAkB,CAAC,MAAMqC,QAAQ,CAAC,IAAD,CAAf,CAArC;AACA,QAAMG,mBAAmB,GAAGxB,SAAS,CAAC,2BAAD,CAArC;AACA,QAAMyB,aAAa,GAAGzB,SAAS,CAAC,qBAAD,CAA/B;AACA,QAAM0B,oBAAoB,GAAGxB,uBAAuB,EAApD;AACA,QAAMyB,CAAC,GAAGxB,cAAc,EAAxB;AAEA,QAAMyB,YAAY,GAAG5C,kBAAkB,CAAC,MAAM;AAC7CuC,cAAU;AACVD,eAAW;AACX,GAHsC,CAAvC;AAKA,QAAMO,GAAG,GAAGzC,MAAM,EAAlB;AAEA,QAAM;AACL0C,yBAAqB,EAAEC,aADlB;AAELC,gBAAY,EAAEC,MAFT;AAGLC,aAAS,EAAEC,GAHN;AAILC,0BAAsB,EAAEC,yBAJnB;AAKLC,uBAAmB,EAAEC,WALhB;AAMLC,YANK;AAOLC,yBAAqB,EAAEC,MAPlB;AAQLC,yBAAqB,EAAEC,KARlB;AASLC,2BAAuB,EAAEC;AATpB,MAUFC,MAAM,CAACC,WAAP,CAAmB/C,WAAW,CAACS,aAAD,CAAX,CAA2BuC,GAA3B,CAA+B;AAAA,QAAC;AAAEtC,SAAF;AAAOuC;AAAP,KAAD;AAAA,WAAoB,CAACvC,GAAD,EAAMuC,KAAN,CAApB;AAAA,GAA/B,CAAnB,CAVJ;AAYA7D,WAAS,CAAC,MAAM;AACf,QAAI8D,MAAM,GAAG,KAAb;;AACA,QAAI,CAACL,kBAAL,EAAyB;AACxB7B,oBAAc;AACd;AACA;;AACD,KAAC,YAAY;AACZ,YAAMD,WAAW,GAAG,MAAMQ,mBAAmB,CAACX,GAAD,CAA7C;AACA,OAACsC,MAAD,IAAWlC,cAAc,CAACD,WAAD,CAAzB;AACA,KAHD;;AAIA,WAAO,MAAM;AACZmC,YAAM,GAAG,IAAT;AACA,KAFD;AAGA,GAbQ,EAaN,CAAC3B,mBAAD,EAAsBsB,kBAAtB,EAA0CjC,GAA1C,EAA+CI,cAA/C,CAbM,CAAT;AAeAzB,iBAAe,CAAC,MAAM;AACrB,QAAI,CAACuB,SAAL,EAAgB;AACfO,iBAAW;AACX;AACD,GAJc,EAIZ,CAACP,SAAD,EAAYO,WAAZ,CAJY,CAAf;AAMA,QAAM8B,KAAK,GAAGb,WAAW,GAAGC,QAAQ,GAAG3B,GAAd,GAAoBwC,kBAAkB,CAACjC,IAAI,CAACO,CAAL,KAAW,GAAX,GAAiBP,IAAI,CAACkC,SAAL,CAAeC,IAAf,CAAoB,KAApB,CAAjB,GAA8CnC,IAAI,CAACoC,IAApD,CAA/D;AAEA,QAAMC,KAAK,GAAGlE,OAAO,CAAC,MAAM;AAC3B,QAAIuD,kBAAkB,IAAI,CAAC9B,WAA3B,EAAwC;AACvC;AACA;;AAED,UAAM0C,aAAa,GAAGhB,MAAM,GAAGU,KAAT,GAAiBR,KAAvC;AAEA,WAAO,IAAInC,WAAJ,CACN;AACCsB,mBADD;AAECI,SAFD;AAGCF,YAHD;AAICyB,mBAJD;AAKC1C,iBALD;AAMCqB,+BAND;AAOCmB,UAAI,EAAE1C,IAAI,CAAC0C,IAAL,IAAa1C,IAAI,CAAC6C;AAPzB,KADM,EAUNhE,SAVM,CAAP;AAYA,GAnBoB,EAmBlB,CACFqB,WADE,EAEFqB,yBAFE,EAGFJ,MAHE,EAIFa,kBAJE,EAKFf,aALE,EAMFW,MANE,EAOFU,KAPE,EAQFjB,GARE,EASFS,KATE,EAUF9B,IAAI,CAAC0C,IAVH,EAWF1C,IAAI,CAAC6C,QAXH,CAnBkB,CAArB;AAiCA,QAAMC,oBAAoB,GAAG5E,kBAAkB,CAAC,MAAM;AACrD,QAAIyE,KAAK,CAAC1B,aAAV,EAAyB;AAAA;;AACxB,2BAAI0B,KAAK,CAACI,MAAV,0CAAI,cAAcC,MAAlB,EAA0B;AACzB,eAAOL,KAAK,CAACM,OAAN,EAAP;AACA;;AACD,UAAI;AACH,eAAOtC,aAAa,CAACZ,GAAD,EAAM,KAAN,CAApB;AACA,OAFD,CAEE,OAAOmD,KAAP,EAAc;AACftC,4BAAoB,CAAC;AAAEuC,cAAI,EAAE,OAAR;AAAiBC,iBAAO,EAAEvC,CAAC,CAACqC,KAAK,CAACG,MAAP;AAA3B,SAAD,CAApB;AACAjF,aAAK;AACLoC,mBAAW;AACX,eAAOmC,KAAK,CAACM,OAAN,EAAP;AACA;AACD;;AACD,QAAI,IAAIK,IAAJ,KAAa,IAAIA,IAAJ,CAAShD,IAAI,CAACiD,YAAd,CAAb,GAA2CzE,OAA/C,EAAwD;AACvD,aAAO6D,KAAK,CAACM,OAAN,EAAP;AACA;;AAED,QAAI,IAAIK,IAAJ,KAAa,IAAIA,IAAJ,CAAShD,IAAI,CAACiD,YAAd,CAAb,GAA2CzE,OAA3C,GAAqDC,QAAzD,EAAmE;AAClE,UAAI;AACH,eAAO4B,aAAa,CAACZ,GAAD,EAAM,KAAN,CAApB;AACA,OAFD,CAEE,OAAOmD,KAAP,EAAc;AACftC,4BAAoB,CAAC;AAAEuC,cAAI,EAAE,OAAR;AAAiBC,iBAAO,EAAEvC,CAAC,CAACqC,KAAK,CAACG,MAAP;AAA3B,SAAD,CAApB;AACAjF,aAAK;AACLoC,mBAAW;AACX,eAAOmC,KAAK,CAACM,OAAN,EAAP;AACA;AACD;AACD,GA5B8C,CAA/C;AA8BA1E,WAAS,CAAC,MAAM;AACf,QAAI,CAAC6B,QAAD,IAAa,CAACuC,KAAlB,EAAyB;AACxB;AACA;;AAED,UAAMvE,KAAK,GAAG,MAAM;AACnBuE,WAAK,CAACa,GAAN,CAAU,WAAV,EAAuBV,oBAAvB;AACAH,WAAK,CAACM,OAAN;AACA,KAHD;;AAKA,QAAI;AACH,UAAIN,KAAK,CAACc,UAAV,EAAsB;AACrBd,aAAK,CAACe,KAAN,CAAY3C,GAAG,CAAC4C,OAAhB;AACAhD,qBAAa,CAACZ,GAAD,EAAM,IAAN,CAAb;AACA,OAHD,MAGO;AACNY,qBAAa,CAACZ,GAAD,EAAM,KAAN,CAAb;AACA;AACD,KAPD,CAOE,OAAOmD,KAAP,EAAc;AACftC,0BAAoB,CAAC;AAAEuC,YAAI,EAAE,OAAR;AAAiBC,eAAO,EAAEvC,CAAC,CAACqC,KAAK,CAACG,MAAP;AAA3B,OAAD,CAApB;AACAjF,WAAK;AACLoC,iBAAW;AACX;;AACDmC,SAAK,CAACiB,EAAN,CAAS,WAAT,EAAsBd,oBAAtB;AAEA,WAAO,MAAM;AACZ,UAAI,CAACH,KAAK,CAAC1B,aAAX,EAA0B7C,KAAK;AAC/B,KAFD;AAGA,GA3BQ,EA2BN,CAACgC,QAAD,EAAWuC,KAAX,EAAkB5C,GAAlB,EAAuB+C,oBAAvB,EAA6CnC,aAA7C,EAA4DC,oBAA5D,EAAkFJ,WAAlF,EAA+FK,CAA/F,CA3BM,CAAT;AA6BA,QAAMgD,SAAS,GAAG3F,kBAAkB,CAAC,MAAM;AAC1C,QAAIyE,KAAJ,EAAW;AACVA,WAAK,CAACc,UAAN,GAAmB,IAAnB;AACA;;AAEDpD,eAAW,CAAC,IAAD,CAAX;;AAEA,QAAIY,aAAJ,EAAmB;AAClBT,iBAAW;AACX;AACD,GAVmC,CAApC;AAYA9B,iBAAe,CAAC,MAAM;AACrB,QAAI,CAAC0B,QAAL,EAAe;AACdG,cAAQ,CAAC,mBAAM,oBAAC,SAAD;AAAW,iBAAS,EAAEsD,SAAtB;AAAiC,oBAAY,EAAE/C;AAA/C,QAAP,CAAR;AACA;AACA;;AACDL,cAAU;AACV,GANc,EAMZ,CAACL,QAAD,EAAWK,UAAX,EAAuBK,YAAvB,EAAqC+C,SAArC,EAAgDtD,QAAhD,CANY,CAAf;AAQA,sBACC,oBAAC,SAAD;AAAW,eAAW,EAAEC,WAAxB;AAAqC,iBAAa,EAAES,aAApD;AAAmE,cAAU,EAAEF;AAA/E,KACE,CAACX,QAAD,iBAAa,oBAAC,QAAD,OADf,CADD;AAKA,CA7KD;;AAnCArC,MAAM,CAAC+F,aAAP,eAkNenF,IAAI,CAACmB,iBAAD,CAlNnB,E","file":"dynamic/client/views/room/contextualBar/Call/Jitsi/CallJitsiWithData.js","sourcesContent":["import { Skeleton } from '@rocket.chat/fuselage';\nimport { useMutableCallback, useSafely } from '@rocket.chat/fuselage-hooks';\nimport { clear } from '@rocket.chat/memo';\nimport React, { useRef, useEffect, useState, useMemo, useLayoutEffect, memo } from 'react';\n\nimport { HEARTBEAT, TIMEOUT, DEBOUNCE } from '../../../../../../app/videobridge/constants';\nimport { useConnectionStatus } from '../../../../../contexts/ConnectionStatusContext';\nimport { useSetModal } from '../../../../../contexts/ModalContext';\nimport { useMethod } from '../../../../../contexts/ServerContext';\nimport { useSettings } from '../../../../../contexts/SettingsContext';\nimport { useToastMessageDispatch } from '../../../../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../../../contexts/TranslationContext';\nimport { useUser } from '../../../../../contexts/UserContext';\nimport { useRoom } from '../../../contexts/RoomContext';\nimport { useTabBarClose } from '../../../providers/ToolboxProvider';\nimport CallJitsi from './CallJitsi';\nimport CallModal from './components/CallModal';\nimport { JitsiBridge } from './lib/JitsiBridge';\n\nexport { default as CallJitsi } from './CallJitsi';\n\nconst querySettings = {\n\t_id: [\n\t\t'Jitsi_Open_New_Window',\n\t\t'Jitsi_Domain',\n\t\t'Jitsi_URL_Room_Hash',\n\t\t'uniqueID',\n\t\t'Jitsi_URL_Room_Prefix',\n\t\t'Jitsi_URL_Room_Suffix',\n\t\t'Jitsi_Chrome_Extension',\n\t\t'Jitsi_SSL',\n\t\t'Jitsi_Enabled_TokenAuth',\n\t],\n};\n\nconst CallJitsiWithData = ({ rid }) => {\n\tconst user = useUser();\n\tconst { connected } = useConnectionStatus();\n\tconst [accessToken, setAccessToken] = useSafely(useState());\n\tconst [accepted, setAccepted] = useState(false);\n\tconst room = useRoom();\n\tconst setModal = useSetModal();\n\tconst handleClose = useTabBarClose();\n\tconst closeModal = useMutableCallback(() => setModal(null));\n\tconst generateAccessToken = useMethod('jitsi:generateAccessToken');\n\tconst updateTimeout = useMethod('jitsi:updateTimeout');\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst t = useTranslation();\n\n\tconst handleCancel = useMutableCallback(() => {\n\t\tcloseModal();\n\t\thandleClose();\n\t});\n\n\tconst ref = useRef();\n\n\tconst {\n\t\tJitsi_Open_New_Window: openNewWindow,\n\t\tJitsi_Domain: domain,\n\t\tJitsi_SSL: ssl,\n\t\tJitsi_Chrome_Extension: desktopSharingChromeExtId,\n\t\tJitsi_URL_Room_Hash: useHashName,\n\t\tuniqueID,\n\t\tJitsi_URL_Room_Prefix: prefix,\n\t\tJitsi_URL_Room_Suffix: sufix,\n\t\tJitsi_Enabled_TokenAuth: isEnabledTokenAuth,\n\t} = Object.fromEntries(useSettings(querySettings).map(({ _id, value }) => [_id, value]));\n\n\tuseEffect(() => {\n\t\tlet ignore = false;\n\t\tif (!isEnabledTokenAuth) {\n\t\t\tsetAccessToken();\n\t\t\treturn;\n\t\t}\n\t\t(async () => {\n\t\t\tconst accessToken = await generateAccessToken(rid);\n\t\t\t!ignore && setAccessToken(accessToken);\n\t\t})();\n\t\treturn () => {\n\t\t\tignore = true;\n\t\t};\n\t}, [generateAccessToken, isEnabledTokenAuth, rid, setAccessToken]);\n\n\tuseLayoutEffect(() => {\n\t\tif (!connected) {\n\t\t\thandleClose();\n\t\t}\n\t}, [connected, handleClose]);\n\n\tconst rname = useHashName ? uniqueID + rid : encodeURIComponent(room.t === 'd' ? room.usernames.join(' x ') : room.name);\n\n\tconst jitsi = useMemo(() => {\n\t\tif (isEnabledTokenAuth && !accessToken) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst jitsiRoomName = prefix + rname + sufix;\n\n\t\treturn new JitsiBridge(\n\t\t\t{\n\t\t\t\topenNewWindow,\n\t\t\t\tssl,\n\t\t\t\tdomain,\n\t\t\t\tjitsiRoomName,\n\t\t\t\taccessToken,\n\t\t\t\tdesktopSharingChromeExtId,\n\t\t\t\tname: user.name || user.username,\n\t\t\t},\n\t\t\tHEARTBEAT,\n\t\t);\n\t}, [\n\t\taccessToken,\n\t\tdesktopSharingChromeExtId,\n\t\tdomain,\n\t\tisEnabledTokenAuth,\n\t\topenNewWindow,\n\t\tprefix,\n\t\trname,\n\t\tssl,\n\t\tsufix,\n\t\tuser.name,\n\t\tuser.username,\n\t]);\n\n\tconst testAndHandleTimeout = useMutableCallback(() => {\n\t\tif (jitsi.openNewWindow) {\n\t\t\tif (jitsi.window?.closed) {\n\t\t\t\treturn jitsi.dispose();\n\t\t\t}\n\t\t\ttry {\n\t\t\t\treturn updateTimeout(rid, false);\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t(error.reason) });\n\t\t\t\tclear();\n\t\t\t\thandleClose();\n\t\t\t\treturn jitsi.dispose();\n\t\t\t}\n\t\t}\n\t\tif (new Date() - new Date(room.jitsiTimeout) > TIMEOUT) {\n\t\t\treturn jitsi.dispose();\n\t\t}\n\n\t\tif (new Date() - new Date(room.jitsiTimeout) + TIMEOUT > DEBOUNCE) {\n\t\t\ttry {\n\t\t\t\treturn updateTimeout(rid, false);\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t(error.reason) });\n\t\t\t\tclear();\n\t\t\t\thandleClose();\n\t\t\t\treturn jitsi.dispose();\n\t\t\t}\n\t\t}\n\t});\n\n\tuseEffect(() => {\n\t\tif (!accepted || !jitsi) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst clear = () => {\n\t\t\tjitsi.off('HEARTBEAT', testAndHandleTimeout);\n\t\t\tjitsi.dispose();\n\t\t};\n\n\t\ttry {\n\t\t\tif (jitsi.needsStart) {\n\t\t\t\tjitsi.start(ref.current);\n\t\t\t\tupdateTimeout(rid, true);\n\t\t\t} else {\n\t\t\t\tupdateTimeout(rid, false);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: t(error.reason) });\n\t\t\tclear();\n\t\t\thandleClose();\n\t\t}\n\t\tjitsi.on('HEARTBEAT', testAndHandleTimeout);\n\n\t\treturn () => {\n\t\t\tif (!jitsi.openNewWindow) clear();\n\t\t};\n\t}, [accepted, jitsi, rid, testAndHandleTimeout, updateTimeout, dispatchToastMessage, handleClose, t]);\n\n\tconst handleYes = useMutableCallback(() => {\n\t\tif (jitsi) {\n\t\t\tjitsi.needsStart = true;\n\t\t}\n\n\t\tsetAccepted(true);\n\n\t\tif (openNewWindow) {\n\t\t\thandleClose();\n\t\t}\n\t});\n\n\tuseLayoutEffect(() => {\n\t\tif (!accepted) {\n\t\t\tsetModal(() => <CallModal handleYes={handleYes} handleCancel={handleCancel} />);\n\t\t\treturn;\n\t\t}\n\t\tcloseModal();\n\t}, [accepted, closeModal, handleCancel, handleYes, setModal]);\n\n\treturn (\n\t\t<CallJitsi handleClose={handleClose} openNewWindow={openNewWindow} refContent={ref}>\n\t\t\t{!accepted && <Skeleton />}\n\t\t</CallJitsi>\n\t);\n};\n\nexport default memo(CallJitsiWithData);\n"]}