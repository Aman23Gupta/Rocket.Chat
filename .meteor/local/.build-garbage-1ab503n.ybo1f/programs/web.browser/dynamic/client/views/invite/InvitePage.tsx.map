{"version":3,"sources":["meteor://ðŸ’»app/client/views/invite/InvitePage.tsx"],"names":[],"mappings":";;;;;;;;AAAA;AAAO,MAAuB,KAAvB,CAA6B,OAA7B,EAAqC;AAAA;AAAA;AAAA;;AAAA,CAArC,EAAqC,CAArC;AAAqC;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAa5C,MAAM,UAAU,GAAG,MAAmB;AACrC,QAAM,CAAC,GAAG,cAAc,EAAxB;AACA,QAAM,oBAAoB,GAAG,uBAAuB,EAApD;AAEA,QAAM,KAAK,GAAG,iBAAiB,CAAC,MAAD,CAA/B;AACA,QAAM,gBAAgB,GAAG,UAAU,CAAC,2BAAD,CAAnC;AACA,QAAM,oBAAoB,GAAG,kBAAkB,CAAC,mBAAD,CAA/C;AACA,QAAM,MAAM,GAAG,SAAS,EAAxB;AACA,QAAM,SAAS,GAAG,QAAQ,CAAC,GAAD,CAA1B;AACA,QAAM,UAAU,GAAG,QAAQ,CAAC,8BAAD,CAA3B;AACA,QAAM,YAAY,GAAG,QAAQ,CAAC,gCAAD,CAA7B;AAEA,QAAM;AAAE;AAAF,MAAgB,QAAQ,CAC7B,CAAC,QAAD,EAAW,KAAX,CAD6B,EAE7B,YAAW;AACV,QAAI,CAAC,KAAL,EAAY;AACX,aAAO,KAAP;AACA;;AAED,QAAI;AACH,YAAM;AAAE;AAAF,UAAY,MAAM,SAAS,CAAC,EAAV,CAAa,IAAb,CAItB,qBAJsB,EAIC;AAAE;AAAF,OAJD,CAAxB;AAMA,aAAO,KAAP;AACA,KARD,CAQE,OAAO,KAAP,EAAc;AACf,0BAAoB,CAAC;AAAE,YAAI,EAAE,OAAR;AAAiB,eAAO,EAAE,CAAC,CAAC,iCAAD;AAA3B,OAAD,CAApB;AACA,aAAO,KAAP;AACA;AACD,GAnB4B,EAoB7B;AACC,aAAS,EAAE,MAAO,KAAP,IAAgB;AAC1B,UAAI,CAAC,KAAL,EAAY;AACX;AACA;;AAED,UAAI,gBAAgB,KAAK,UAAzB,EAAqC;AACpC,4BAAoB,CAAC,UAAD,CAApB;AACA,OAFD,MAEO;AACN,4BAAoB,CAAC,OAAD,CAApB;AACA;;AAED,UAAI,CAAC,KAAD,IAAU,CAAC,MAAf,EAAuB;AACtB;AACA;;AAED,UAAI;AACH,cAAM,MAAM,GAAG,MAAM,SAAS,CAAC,EAAV,CAAa,IAAb,CAInB,gBAJmB,EAID;AAAE;AAAF,SAJC,CAArB;;AAKA,YAAI,EAAC,MAAD,aAAC,MAAD,eAAC,MAAM,CAAE,IAAR,CAAa,IAAd,CAAJ,EAAwB;AACvB,8BAAoB,CAAC;AAAE,gBAAI,EAAE,OAAR;AAAiB,mBAAO,EAAE,CAAC,CAAC,iCAAD;AAA3B,WAAD,CAApB;AACA,mBAAS,CAAC,IAAV;AACA;AACA;;AAED,YAAI,MAAM,CAAC,IAAP,CAAY,CAAZ,KAAkB,GAAtB,EAA2B;AAC1B,oBAAU,CAAC,IAAX,CAAgB;AAAE,gBAAI,EAAE,MAAM,CAAC,IAAP,CAAY;AAApB,WAAhB;AACA;AACA;;AAED,oBAAY,CAAC,IAAb,CAAkB;AAAE,cAAI,EAAE,MAAM,CAAC,IAAP,CAAY;AAApB,SAAlB;AACA,OAlBD,CAkBE,OAAO,KAAP,EAAc;AACf,4BAAoB,CAAC;AAAE,cAAI,EAAE,OAAR;AAAiB,iBAAO,EAAE,CAAC,CAAC,iCAAD;AAA3B,SAAD,CAApB;AACA,iBAAS,CAAC,IAAV;AACA;AACD;AAtCF,GApB6B,CAA9B;;AA8DA,MAAI,SAAJ,EAAe;AACd,wBAAO,oBAAC,WAAD,OAAP;AACA;;AAED,sBACC;AAAS,aAAS,EAAC;AAAnB,kBACC;AAAK,aAAS,EAAC;AAAf,kBACC,iDACC;AAAG,aAAS,EAAC,MAAb;AAAoB,QAAI,EAAC;AAAzB,kBACC;AAAK,OAAG,EAAC;AAAT,IADD,CADD,CADD,eAMC;AAAK,aAAS,EAAC;AAAf,kBACC;AAAK,aAAS,EAAC;AAAf,kBACC;AAAG,aAAS,EAAC;AAAb,IADD,EAEE,CAAC,CAAC,iCAAD,CAFH,CADD,CAND,CADD,CADD;AAiBA,CA/FD;;AAbA,OAAO,aAAP,CA8Ge,UA9Gf,E","file":"dynamic/client/views/invite/InvitePage.tsx","sourcesContent":["import React, { ReactElement } from 'react';\nimport { useQuery } from 'react-query';\n\nimport { APIClient } from '../../../app/utils/client';\nimport { OperationParams, OperationResult } from '../../../definition/rest';\nimport { useRoute, useRouteParameter } from '../../contexts/RouterContext';\nimport { useSessionDispatch } from '../../contexts/SessionContext';\nimport { useSetting } from '../../contexts/SettingsContext';\nimport { useToastMessageDispatch } from '../../contexts/ToastMessagesContext';\nimport { useTranslation } from '../../contexts/TranslationContext';\nimport { useUserId } from '../../contexts/UserContext';\nimport PageLoading from '../root/PageLoading';\n\nconst InvitePage = (): ReactElement => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst token = useRouteParameter('hash');\n\tconst registrationForm = useSetting('Accounts_RegistrationForm');\n\tconst setLoginDefaultState = useSessionDispatch('loginDefaultState');\n\tconst userId = useUserId();\n\tconst homeRoute = useRoute('/');\n\tconst groupRoute = useRoute('/group/:name/:tab?/:context?');\n\tconst channelRoute = useRoute('/channel/:name/:tab?/:context?');\n\n\tconst { isLoading } = useQuery(\n\t\t['invite', token],\n\t\tasync () => {\n\t\t\tif (!token) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst { valid } = await APIClient.v1.post<\n\t\t\t\t\tOperationParams<'POST', '/v1/validateInviteToken'>,\n\t\t\t\t\tnever,\n\t\t\t\t\tOperationResult<'POST', '/v1/validateInviteToken'>\n\t\t\t\t>('validateInviteToken', { token });\n\n\t\t\t\treturn valid;\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Failed_to_validate_invite_token') });\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tonSuccess: async (valid) => {\n\t\t\t\tif (!token) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (registrationForm !== 'Disabled') {\n\t\t\t\t\tsetLoginDefaultState('register');\n\t\t\t\t} else {\n\t\t\t\t\tsetLoginDefaultState('login');\n\t\t\t\t}\n\n\t\t\t\tif (!valid || !userId) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tconst result = await APIClient.v1.post<\n\t\t\t\t\t\tOperationParams<'POST', '/v1/useInviteToken'>,\n\t\t\t\t\t\tnever,\n\t\t\t\t\t\tOperationResult<'POST', '/v1/useInviteToken'>\n\t\t\t\t\t>('useInviteToken', { token });\n\t\t\t\t\tif (!result?.room.name) {\n\t\t\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Failed_to_activate_invite_token') });\n\t\t\t\t\t\thomeRoute.push();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (result.room.t === 'p') {\n\t\t\t\t\t\tgroupRoute.push({ name: result.room.name });\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tchannelRoute.push({ name: result.room.name });\n\t\t\t\t} catch (error) {\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Failed_to_activate_invite_token') });\n\t\t\t\t\thomeRoute.push();\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t);\n\n\tif (isLoading) {\n\t\treturn <PageLoading />;\n\t}\n\n\treturn (\n\t\t<section className='rc-old full-page color-tertiary-font-color'>\n\t\t\t<div className='wrapper'>\n\t\t\t\t<header>\n\t\t\t\t\t<a className='logo' href='/'>\n\t\t\t\t\t\t<img src='images/logo/logo.svg?v=3' />\n\t\t\t\t\t</a>\n\t\t\t\t</header>\n\t\t\t\t<div className='content'>\n\t\t\t\t\t<div className='attention-message'>\n\t\t\t\t\t\t<i className='icon-attention'></i>\n\t\t\t\t\t\t{t('Invalid_or_expired_invite_token')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</section>\n\t);\n};\n\nexport default InvitePage;\n"]}