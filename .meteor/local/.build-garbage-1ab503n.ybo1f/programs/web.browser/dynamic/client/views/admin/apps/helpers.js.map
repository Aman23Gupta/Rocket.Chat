{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/apps/helpers.js"],"names":["module","export","appEnabledStatuses","apiCurlGetter","handleInstallError","handleAPIError","warnStatusChange","appButtonProps","appStatusSpanProps","formatPrice","formatPricingPlan","AppStatus","link","v","semver","default","Utilities","t","dispatchToastMessage","AUTO_ENABLED","MANUALLY_ENABLED","appErroredStatuses","COMPILER_ERROR_DISABLED","ERROR_DISABLED","INVALID_SETTINGS_DISABLED","INVALID_LICENSE_DISABLED","absoluteUrl","method","api","example","examples","curl","url","computedPath","params","query","content","headers","split","apiError","xhr","responseJSON","status","messages","error","payload","message","join","username","type","shouldHandleErrorAsWarning","warnings","includes","appName","installed","version","marketplaceVersion","isPurchased","price","purchaseType","subscriptionInfo","pricingPlans","isEnterpriseOnly","canUpdate","lt","action","icon","label","canDownload","canSubscribe","cannotTry","every","currentPricingPlan","trialDays","canBuy","isFailed","isEnabled","isOnTrialPeriod","Number","parseFloat","toFixed","strategy","tiers","perUnit","Array","isArray","find","tier","pricingPlanTranslationString","length","filter","Boolean"],"mappings":"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","file":"dynamic/client/views/admin/apps/helpers.js","sourcesContent":["import { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport semver from 'semver';\n\nimport { Utilities } from '../../../../app/apps/lib/misc/Utilities';\nimport { t } from '../../../../app/utils/client';\nimport { dispatchToastMessage } from '../../../lib/toast';\n\nexport const appEnabledStatuses = [AppStatus.AUTO_ENABLED, AppStatus.MANUALLY_ENABLED];\n\nconst appErroredStatuses = [\n\tAppStatus.COMPILER_ERROR_DISABLED,\n\tAppStatus.ERROR_DISABLED,\n\tAppStatus.INVALID_SETTINGS_DISABLED,\n\tAppStatus.INVALID_LICENSE_DISABLED,\n];\n\nexport const apiCurlGetter = (absoluteUrl) => (method, api) => {\n\tconst example = api.examples[method] || {};\n\treturn Utilities.curl({\n\t\turl: absoluteUrl(api.computedPath),\n\t\tmethod,\n\t\tparams: example.params,\n\t\tquery: example.query,\n\t\tcontent: example.content,\n\t\theaders: example.headers,\n\t}).split('\\n');\n};\n\nexport function handleInstallError(apiError) {\n\tif (!apiError.xhr || !apiError.xhr.responseJSON) {\n\t\treturn;\n\t}\n\n\tconst { status, messages, error, payload = null } = apiError.xhr.responseJSON;\n\n\tlet message;\n\n\tswitch (status) {\n\t\tcase 'storage_error':\n\t\t\tmessage = messages.join('');\n\t\t\tbreak;\n\t\tcase 'app_user_error':\n\t\t\tmessage = messages.join('');\n\t\t\tif (payload && payload.username) {\n\t\t\t\tmessage = t('Apps_User_Already_Exists', { username: payload.username });\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (error) {\n\t\t\t\tmessage = error;\n\t\t\t} else {\n\t\t\t\tmessage = 'There has been an error installing the app';\n\t\t\t}\n\t}\n\n\tdispatchToastMessage({ type: 'error', message });\n}\n\nconst shouldHandleErrorAsWarning = (message) => {\n\tconst warnings = ['Could not reach the Marketplace'];\n\n\treturn warnings.includes(message);\n};\n\nexport const handleAPIError = (error) => {\n\tconst message = (error.xhr && error.xhr.responseJSON && error.xhr.responseJSON.error) || error.message;\n\n\tif (shouldHandleErrorAsWarning(message)) {\n\t\tdispatchToastMessage({ type: 'warning', message });\n\t\treturn;\n\t}\n\n\tdispatchToastMessage({ type: 'error', message });\n};\n\nexport const warnStatusChange = (appName, status) => {\n\tif (appErroredStatuses.includes(status)) {\n\t\tdispatchToastMessage({ type: 'error', message: (t(`App_status_${status}`), appName) });\n\t\treturn;\n\t}\n\n\tdispatchToastMessage({ type: 'info', message: (t(`App_status_${status}`), appName) });\n};\n\nexport const appButtonProps = ({\n\tinstalled,\n\tversion,\n\tmarketplaceVersion,\n\tisPurchased,\n\tprice,\n\tpurchaseType,\n\tsubscriptionInfo,\n\tpricingPlans,\n\tisEnterpriseOnly,\n}) => {\n\tconst canUpdate = installed && version && marketplaceVersion && semver.lt(version, marketplaceVersion);\n\tif (canUpdate) {\n\t\treturn {\n\t\t\taction: 'update',\n\t\t\ticon: 'reload',\n\t\t\tlabel: 'Update',\n\t\t};\n\t}\n\n\tif (installed) {\n\t\treturn;\n\t}\n\n\tconst canDownload = isPurchased;\n\tif (canDownload) {\n\t\treturn {\n\t\t\taction: 'install',\n\t\t\tlabel: 'Install',\n\t\t};\n\t}\n\n\tconst canSubscribe = purchaseType === 'subscription' && !subscriptionInfo.status;\n\tif (canSubscribe) {\n\t\tconst cannotTry = pricingPlans.every((currentPricingPlan) => currentPricingPlan.trialDays === 0);\n\n\t\tif (cannotTry || isEnterpriseOnly) {\n\t\t\treturn {\n\t\t\t\taction: 'purchase',\n\t\t\t\tlabel: 'Subscribe',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Trial',\n\t\t};\n\t}\n\n\tconst canBuy = price > 0;\n\tif (canBuy) {\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Buy',\n\t\t};\n\t}\n\n\treturn {\n\t\taction: 'purchase',\n\t\tlabel: 'Install',\n\t};\n};\n\nexport const appStatusSpanProps = ({ installed, status, subscriptionInfo }) => {\n\tif (!installed) {\n\t\treturn;\n\t}\n\n\tconst isFailed = appErroredStatuses.includes(status);\n\tif (isFailed) {\n\t\treturn {\n\t\t\ttype: 'failed',\n\t\t\ticon: 'warning',\n\t\t\tlabel: status === AppStatus.INVALID_SETTINGS_DISABLED ? 'Config Needed' : 'Failed',\n\t\t};\n\t}\n\n\tconst isEnabled = appEnabledStatuses.includes(status);\n\tif (!isEnabled) {\n\t\treturn {\n\t\t\ttype: 'warning',\n\t\t\ticon: 'warning',\n\t\t\tlabel: 'Disabled',\n\t\t};\n\t}\n\n\tconst isOnTrialPeriod = subscriptionInfo && subscriptionInfo.status === 'trialing';\n\tif (isOnTrialPeriod) {\n\t\treturn {\n\t\t\ticon: 'checkmark-circled',\n\t\t\tlabel: 'Trial period',\n\t\t};\n\t}\n\n\treturn {\n\t\ticon: 'checkmark-circled',\n\t\tlabel: 'Enabled',\n\t};\n};\n\nexport const formatPrice = (price) => `\\$${Number.parseFloat(price).toFixed(2)}`;\n\nexport const formatPricingPlan = ({ strategy, price, tiers = [] }) => {\n\tconst { perUnit = false } = (Array.isArray(tiers) && tiers.find((tier) => tier.price === price)) || {};\n\n\tconst pricingPlanTranslationString = [\n\t\t'Apps_Marketplace_pricingPlan',\n\t\tArray.isArray(tiers) && tiers.length > 0 && 'startingAt',\n\t\tstrategy,\n\t\tperUnit && 'perUser',\n\t]\n\t\t.filter(Boolean)\n\t\t.join('_');\n\n\treturn t(pricingPlanTranslationString, {\n\t\tprice: formatPrice(price),\n\t});\n};\n"]}