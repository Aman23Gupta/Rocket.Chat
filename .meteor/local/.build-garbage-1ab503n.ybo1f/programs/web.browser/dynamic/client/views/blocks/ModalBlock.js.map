{"version":3,"sources":["meteor://ðŸ’»app/client/views/blocks/ModalBlock.js"],"names":["module","export","modalParser","Modal","AnimatedVisibility","ButtonGroup","Button","Box","link","v","useUniqueId","UiKitComponent","UiKitModal","React","useCallback","useEffect","useMemo","useRef","default","getURL","focusableElementsString","focusableElementsStringInvalid","ModalBlock","view","errors","appId","onSubmit","onClose","onCancel","id","ref","current","Object","keys","length","element","querySelector","focus","previousFocus","document","activeElement","handleKeyDown","event","keyCode","target","nodeName","stopPropagation","preventDefault","elements","Array","from","querySelectorAll","first","last","pop","contains","shiftKey","container","close","e","ignoreIfnotContains","addEventListener","removeEventListener","UNHIDING","showIcon","text","title","blocks","submit","exportDefault"],"mappings":"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","file":"dynamic/client/views/blocks/ModalBlock.js","sourcesContent":["import { Modal, AnimatedVisibility, ButtonGroup, Button, Box } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { UiKitComponent, UiKitModal, modalParser } from '@rocket.chat/fuselage-ui-kit';\nimport React, { useCallback, useEffect, useMemo, useRef } from 'react';\n\nimport { getURL } from '../../../app/utils/lib/getURL';\nimport './textParsers';\n\nconst focusableElementsString = `\n\ta[href]:not([tabindex=\"-1\"]),\n\tarea[href]:not([tabindex=\"-1\"]),\n\tinput:not([disabled]):not([tabindex=\"-1\"]),\n\tselect:not([disabled]):not([tabindex=\"-1\"]),\n\ttextarea:not([disabled]):not([tabindex=\"-1\"]),\n\tbutton:not([disabled]):not([tabindex=\"-1\"]),\n\tiframe,\n\tobject,\n\tembed,\n\t[tabindex]:not([tabindex=\"-1\"]),\n\t[contenteditable]`;\n\nconst focusableElementsStringInvalid = `\n\ta[href]:not([tabindex=\"-1\"]):invalid,\n\tarea[href]:not([tabindex=\"-1\"]):invalid,\n\tinput:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tselect:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\ttextarea:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tbutton:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tiframe:invalid,\n\tobject:invalid,\n\tembed:invalid,\n\t[tabindex]:not([tabindex=\"-1\"]):invalid,\n\t[contenteditable]:invalid`;\n\nfunction ModalBlock({ view, errors, appId, onSubmit, onClose, onCancel }) {\n\tconst id = `modal_id_${useUniqueId()}`;\n\tconst ref = useRef();\n\n\t// Auto focus\n\tuseEffect(() => {\n\t\tif (!ref.current) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (errors && Object.keys(errors).length) {\n\t\t\tconst element = ref.current.querySelector(focusableElementsStringInvalid);\n\t\t\telement && element.focus();\n\t\t} else {\n\t\t\tconst element = ref.current.querySelector(focusableElementsString);\n\t\t\telement && element.focus();\n\t\t}\n\t}, [errors]);\n\t// save focus to restore after close\n\tconst previousFocus = useMemo(() => document.activeElement, []);\n\t// restore the focus after the component unmount\n\tuseEffect(() => () => previousFocus && previousFocus.focus(), [previousFocus]);\n\t// Handle Tab, Shift + Tab, Enter and Escape\n\tconst handleKeyDown = useCallback(\n\t\t(event) => {\n\t\t\tif (event.keyCode === 13) {\n\t\t\t\t// ENTER\n\t\t\t\tif (event?.target?.nodeName !== 'TEXTAREA') {\n\t\t\t\t\treturn onSubmit(event);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (event.keyCode === 27) {\n\t\t\t\t// ESC\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tonClose();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (event.keyCode === 9) {\n\t\t\t\t// TAB\n\t\t\t\tconst elements = Array.from(ref.current.querySelectorAll(focusableElementsString));\n\t\t\t\tconst [first] = elements;\n\t\t\t\tconst last = elements.pop();\n\n\t\t\t\tif (!ref.current.contains(document.activeElement)) {\n\t\t\t\t\treturn first.focus();\n\t\t\t\t}\n\n\t\t\t\tif (event.shiftKey) {\n\t\t\t\t\tif (!first || first === document.activeElement) {\n\t\t\t\t\t\tlast.focus();\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!last || last === document.activeElement) {\n\t\t\t\t\tfirst.focus();\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[onClose, onSubmit],\n\t);\n\t// Clean the events\n\tuseEffect(() => {\n\t\tconst element = document.querySelector('.rc-modal-wrapper');\n\t\tconst container = element.querySelector('.rcx-modal__content');\n\t\tconst close = (e) => {\n\t\t\tif (e.target !== element) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tonClose();\n\t\t\treturn false;\n\t\t};\n\n\t\tconst ignoreIfnotContains = (e) => {\n\t\t\tif (!container.contains(e.target)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn handleKeyDown(e);\n\t\t};\n\n\t\tdocument.addEventListener('keydown', ignoreIfnotContains);\n\t\telement.addEventListener('click', close);\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('keydown', ignoreIfnotContains);\n\t\t\telement.removeEventListener('click', close);\n\t\t};\n\t}, [handleKeyDown, onClose]);\n\n\treturn (\n\t\t<AnimatedVisibility visibility={AnimatedVisibility.UNHIDING}>\n\t\t\t<Modal open id={id} ref={ref}>\n\t\t\t\t<Modal.Header>\n\t\t\t\t\t{view.showIcon ? <Modal.Thumb url={getURL(`/api/apps/${appId}/icon`)} /> : null}\n\t\t\t\t\t<Modal.Title>{modalParser.text(view.title)}</Modal.Title>\n\t\t\t\t\t<Modal.Close tabIndex={-1} onClick={onClose} />\n\t\t\t\t</Modal.Header>\n\t\t\t\t<Modal.Content>\n\t\t\t\t\t<Box is='form' method='post' action='#' onSubmit={onSubmit}>\n\t\t\t\t\t\t<UiKitComponent render={UiKitModal} blocks={view.blocks} />\n\t\t\t\t\t</Box>\n\t\t\t\t</Modal.Content>\n\t\t\t\t<Modal.Footer>\n\t\t\t\t\t<ButtonGroup align='end'>\n\t\t\t\t\t\t{view.close && <Button onClick={onCancel}>{modalParser.text(view.close.text)}</Button>}\n\t\t\t\t\t\t{view.submit && (\n\t\t\t\t\t\t\t<Button primary onClick={onSubmit}>\n\t\t\t\t\t\t\t\t{modalParser.text(view.submit.text)}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Modal.Footer>\n\t\t\t</Modal>\n\t\t</AnimatedVisibility>\n\t);\n}\n\nexport default ModalBlock;\nexport { modalParser };\n"]}