{"version":3,"sources":["meteor://ðŸ’»app/client/sidebar/header/CreateChannelWithData.js"],"names":["_objectSpread","module","link","default","v","useMutableCallback","React","memo","useCallback","useMemo","usePermission","useSetting","useEndpointActionExperimental","useForm","goToRoomById","CreateChannel","CreateChannelWithData","onClose","teamId","reload","createChannel","createPrivateChannel","canCreateChannel","canCreatePrivateChannel","e2eEnabledForPrivateByDefault","canOnlyCreateOneType","initialValues","users","name","description","type","readOnly","encrypted","broadcast","values","handlers","hasUnsavedChanges","handleUsers","handleEncrypted","handleType","handleBroadcast","handleReadOnly","onChangeUsers","value","action","includes","filter","current","onChangeType","onChangeBroadcast","onCreate","goToRoom","rid","params","members","extraData","roomData","group","_id","channel","exportDefault"],"mappings":"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","file":"dynamic/client/sidebar/header/CreateChannelWithData.js","sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { memo, useCallback, useMemo } from 'react';\n\nimport { usePermission } from '../../contexts/AuthorizationContext';\nimport { useSetting } from '../../contexts/SettingsContext';\nimport { useEndpointActionExperimental } from '../../hooks/useEndpointActionExperimental';\nimport { useForm } from '../../hooks/useForm';\nimport { goToRoomById } from '../../lib/utils/goToRoomById';\nimport CreateChannel from './CreateChannel';\n\nconst CreateChannelWithData = ({ onClose, teamId = '', reload }) => {\n\tconst createChannel = useEndpointActionExperimental('POST', 'channels.create');\n\tconst createPrivateChannel = useEndpointActionExperimental('POST', 'groups.create');\n\tconst canCreateChannel = usePermission('create-c');\n\tconst canCreatePrivateChannel = usePermission('create-p');\n\tconst e2eEnabledForPrivateByDefault = useSetting('E2E_Enabled_Default_PrivateRooms');\n\tconst canOnlyCreateOneType = useMemo(() => {\n\t\tif (!canCreateChannel && canCreatePrivateChannel) {\n\t\t\treturn 'p';\n\t\t}\n\t\tif (canCreateChannel && !canCreatePrivateChannel) {\n\t\t\treturn 'c';\n\t\t}\n\t\treturn false;\n\t}, [canCreateChannel, canCreatePrivateChannel]);\n\n\tconst initialValues = {\n\t\tusers: [],\n\t\tname: '',\n\t\tdescription: '',\n\t\ttype: canOnlyCreateOneType ? canOnlyCreateOneType === 'p' : true,\n\t\treadOnly: false,\n\t\tencrypted: e2eEnabledForPrivateByDefault ?? false,\n\t\tbroadcast: false,\n\t};\n\tconst { values, handlers, hasUnsavedChanges } = useForm(initialValues);\n\n\tconst { users, name, description, type, readOnly, broadcast, encrypted } = values;\n\tconst { handleUsers, handleEncrypted, handleType, handleBroadcast, handleReadOnly } = handlers;\n\n\tconst onChangeUsers = useMutableCallback((value, action) => {\n\t\tif (!action) {\n\t\t\tif (users.includes(value)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn handleUsers([...users, value]);\n\t\t}\n\t\thandleUsers(users.filter((current) => current !== value));\n\t});\n\n\tconst onChangeType = useMutableCallback((value) => {\n\t\thandleEncrypted(!value);\n\t\treturn handleType(value);\n\t});\n\n\tconst onChangeBroadcast = useMutableCallback((value) => {\n\t\thandleEncrypted(!value);\n\t\thandleReadOnly(value);\n\t\treturn handleBroadcast(value);\n\t});\n\n\tconst onCreate = useCallback(async () => {\n\t\tconst goToRoom = (rid) => {\n\t\t\tgoToRoomById(rid);\n\t\t};\n\n\t\tconst params = {\n\t\t\tname,\n\t\t\tmembers: users,\n\t\t\treadOnly,\n\t\t\textraData: {\n\t\t\t\tdescription,\n\t\t\t\tbroadcast,\n\t\t\t\tencrypted,\n\t\t\t\t...(teamId && { teamId }),\n\t\t\t},\n\t\t};\n\t\tlet roomData;\n\n\t\tif (type) {\n\t\t\troomData = await createPrivateChannel(params);\n\t\t\t!teamId && goToRoom(roomData.group._id);\n\t\t} else {\n\t\t\troomData = await createChannel(params);\n\t\t\t!teamId && goToRoom(roomData.channel._id);\n\t\t}\n\n\t\tonClose();\n\t\treload();\n\t}, [broadcast, createChannel, createPrivateChannel, description, encrypted, name, onClose, readOnly, teamId, type, users, reload]);\n\n\treturn (\n\t\t<CreateChannel\n\t\t\tvalues={values}\n\t\t\thandlers={handlers}\n\t\t\thasUnsavedChanges={hasUnsavedChanges}\n\t\t\tonChangeUsers={onChangeUsers}\n\t\t\tonChangeType={onChangeType}\n\t\t\tonChangeBroadcast={onChangeBroadcast}\n\t\t\tcanOnlyCreateOneType={canOnlyCreateOneType}\n\t\t\te2eEnabledForPrivateByDefault={e2eEnabledForPrivateByDefault}\n\t\t\tonClose={onClose}\n\t\t\tonCreate={onCreate}\n\t\t/>\n\t);\n};\n\nexport default memo(CreateChannelWithData);\n"]}