{"version":3,"sources":["meteor://ðŸ’»app/client/sidebar/search/SearchList.js"],"names":["_extends","module","link","default","v","_taggedTemplateLiteral","_objectWithoutProperties","_objectSpread","css","Sidebar","TextInput","Box","Icon","useMutableCallback","useDebouncedValue","useStableArray","useAutoFocus","useUniqueId","escapeRegExp","Meteor","React","forwardRef","useState","useMemo","useEffect","useRef","Virtuoso","tinykeys","useSetting","useTranslation","useUserPreference","useUserSubscriptions","AsyncStatePhase","useMethodData","useAvatarTemplate","useTemplateByViewMode","Row","ScrollerWithCustomProps","shortcut","Device","isDesktop","window","navigator","platform","toLowerCase","includes","useSpotlight","filterText","usernames","expression","mention","name","match","searchForChannels","searchForDMs","type","users","rooms","args","value","data","phase","status","options","sort","lm","useSearchItems","teste","query","filterRegex","RegExp","$or","fname","t","$ne","localRooms","usernamesFromClient","map","filter","Boolean","spotlight","resultsFromServer","filterUsersUnique","index","arr","_id","findIndex","user","roomFilter","room","find","item","uids","length","rid","usersfilter","userMap","username","avatarETag","exact","usernamame","push","Array","from","Set","useInput","initial","setValue","onChange","e","currentTarget","toggleSelectionState","next","current","input","setAttribute","id","classList","add","remove","SearchList","ref","onClose","listId","setFilterValue","autofocus","listRef","boxRef","selectedElement","itemIndexRef","sidebarViewMode","showRealName","sideBarItemTemplate","avatarTemplate","extended","placeholder","join","items","itemData","SideBarItemTemplate","changeSelection","dir","nextSelectedElement","parentElement","previousSibling","querySelector","nextSibling","resetCursor","scrollToIndex","undefined","unsubscribe","Escape","event","preventDefault","Tab","ArrowUp","currentElement","Math","max","ArrowDown","min","Enter","click","RESOLVED","height","width","Scroller","exportDefault"],"mappings":"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","file":"dynamic/client/sidebar/search/SearchList.js","sourcesContent":["import { css } from '@rocket.chat/css-in-js';\nimport { Sidebar, TextInput, Box, Icon } from '@rocket.chat/fuselage';\nimport { useMutableCallback, useDebouncedValue, useStableArray, useAutoFocus, useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport { Meteor } from 'meteor/meteor';\nimport React, { forwardRef, useState, useMemo, useEffect, useRef } from 'react';\nimport { Virtuoso } from 'react-virtuoso';\nimport tinykeys from 'tinykeys';\n\nimport { useSetting } from '../../contexts/SettingsContext';\nimport { useTranslation } from '../../contexts/TranslationContext';\nimport { useUserPreference, useUserSubscriptions } from '../../contexts/UserContext';\nimport { AsyncStatePhase } from '../../hooks/useAsyncState';\nimport { useMethodData } from '../../hooks/useMethodData';\nimport { useAvatarTemplate } from '../hooks/useAvatarTemplate';\nimport { useTemplateByViewMode } from '../hooks/useTemplateByViewMode';\nimport Row from './Row';\nimport ScrollerWithCustomProps from './ScrollerWithCustomProps';\n\nconst shortcut = (() => {\n\tif (!Meteor.Device.isDesktop()) {\n\t\treturn '';\n\t}\n\tif (window.navigator.platform.toLowerCase().includes('mac')) {\n\t\treturn '(\\u2318+K)';\n\t}\n\treturn '(\\u2303+K)';\n})();\n\nconst useSpotlight = (filterText = '', usernames) => {\n\tconst expression = /(@|#)?(.*)/i;\n\tconst [, mention, name] = filterText.match(expression);\n\n\tconst searchForChannels = mention === '#';\n\tconst searchForDMs = mention === '@';\n\n\tconst type = useMemo(() => {\n\t\tif (searchForChannels) {\n\t\t\treturn { users: false, rooms: true };\n\t\t}\n\t\tif (searchForDMs) {\n\t\t\treturn { users: true, rooms: false };\n\t\t}\n\t\treturn { users: true, rooms: true };\n\t}, [searchForChannels, searchForDMs]);\n\tconst args = useMemo(() => [name, usernames, type], [type, name, usernames]);\n\n\tconst { value: data = { users: [], rooms: [] }, phase: status } = useMethodData('spotlight', args);\n\n\treturn useMemo(() => {\n\t\tif (!data) {\n\t\t\treturn { data: { users: [], rooms: [] }, status: 'loading' };\n\t\t}\n\t\treturn { data, status };\n\t}, [data, status]);\n};\n\nconst options = {\n\tsort: {\n\t\tlm: -1,\n\t\tname: 1,\n\t},\n};\n\nconst useSearchItems = (filterText) => {\n\tconst expression = /(@|#)?(.*)/i;\n\tconst teste = filterText.match(expression);\n\n\tconst [, type, name] = teste;\n\tconst query = useMemo(() => {\n\t\tconst filterRegex = new RegExp(escapeRegExp(name), 'i');\n\n\t\treturn {\n\t\t\t$or: [{ name: filterRegex }, { fname: filterRegex }],\n\t\t\t...(type && {\n\t\t\t\tt: type === '@' ? 'd' : { $ne: 'd' },\n\t\t\t}),\n\t\t};\n\t}, [name, type]);\n\n\tconst localRooms = useUserSubscriptions(query, options);\n\n\tconst usernamesFromClient = useStableArray([...localRooms?.map(({ t, name }) => (t === 'd' ? name : null))].filter(Boolean));\n\n\tconst { data: spotlight, status } = useSpotlight(filterText, usernamesFromClient);\n\n\treturn useMemo(() => {\n\t\tconst resultsFromServer = [];\n\n\t\tconst filterUsersUnique = ({ _id }, index, arr) => index === arr.findIndex((user) => _id === user._id);\n\t\tconst roomFilter = (room) =>\n\t\t\t!localRooms.find(\n\t\t\t\t(item) => (room.t === 'd' && room.uids?.length > 1 && room.uids.includes(item._id)) || [item.rid, item._id].includes(room._id),\n\t\t\t);\n\t\tconst usersfilter = (user) => !localRooms.find((room) => room.t === 'd' && room.uids?.length === 2 && room.uids.includes(user._id));\n\n\t\tconst userMap = (user) => ({\n\t\t\t_id: user._id,\n\t\t\tt: 'd',\n\t\t\tname: user.username,\n\t\t\tfname: user.name,\n\t\t\tavatarETag: user.avatarETag,\n\t\t});\n\n\t\tconst exact = resultsFromServer.filter((item) => [item.usernamame, item.name, item.fname].includes(name));\n\n\t\tresultsFromServer.push(...spotlight.users.filter(filterUsersUnique).filter(usersfilter).map(userMap));\n\t\tresultsFromServer.push(...spotlight.rooms.filter(roomFilter));\n\n\t\treturn { data: Array.from(new Set([...exact, ...localRooms, ...resultsFromServer])), status };\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [localRooms, name, spotlight]);\n};\n\nconst useInput = (initial) => {\n\tconst [value, setValue] = useState(initial);\n\tconst onChange = useMutableCallback((e) => {\n\t\tsetValue(e.currentTarget.value);\n\t});\n\treturn { value, onChange, setValue };\n};\n\nconst toggleSelectionState = (next, current, input) => {\n\tinput.setAttribute('aria-activedescendant', next.id);\n\tnext.setAttribute('aria-selected', true);\n\tnext.classList.add('rcx-sidebar-item--selected');\n\tif (current) {\n\t\tcurrent.setAttribute('aria-selected', false);\n\t\tcurrent.classList.remove('rcx-sidebar-item--selected');\n\t}\n};\n\n/**\n * @type import('react').ForwardRefExoticComponent<{ onClose: unknown } & import('react').RefAttributes<HTMLElement>>\n */\nconst SearchList = forwardRef(function SearchList({ onClose }, ref) {\n\tconst listId = useUniqueId();\n\tconst t = useTranslation();\n\tconst { setValue: setFilterValue, ...filter } = useInput('');\n\n\tconst autofocus = useAutoFocus();\n\n\tconst listRef = useRef();\n\tconst boxRef = useRef();\n\n\tconst selectedElement = useRef();\n\tconst itemIndexRef = useRef(0);\n\n\tconst sidebarViewMode = useUserPreference('sidebarViewMode');\n\tconst showRealName = useSetting('UI_Use_Real_Name');\n\n\tconst sideBarItemTemplate = useTemplateByViewMode();\n\tconst avatarTemplate = useAvatarTemplate();\n\n\tconst extended = sidebarViewMode === 'extended';\n\n\tconst filterText = useDebouncedValue(filter.value, 100);\n\n\tconst placeholder = [t('Search'), shortcut].filter(Boolean).join(' ');\n\n\tconst { data: items, status } = useSearchItems(filterText);\n\n\tconst itemData = useMemo(\n\t\t() => ({\n\t\t\titems,\n\t\t\tt,\n\t\t\tSideBarItemTemplate: sideBarItemTemplate,\n\t\t\tavatarTemplate,\n\t\t\tshowRealName,\n\t\t\textended,\n\t\t\tsidebarViewMode,\n\t\t}),\n\t\t[avatarTemplate, extended, items, showRealName, sideBarItemTemplate, sidebarViewMode, t],\n\t);\n\n\tconst changeSelection = useMutableCallback((dir) => {\n\t\tlet nextSelectedElement = null;\n\n\t\tif (dir === 'up') {\n\t\t\tnextSelectedElement = selectedElement.current.parentElement.previousSibling.querySelector('a');\n\t\t} else {\n\t\t\tnextSelectedElement = selectedElement.current.parentElement.nextSibling.querySelector('a');\n\t\t}\n\n\t\tif (nextSelectedElement) {\n\t\t\ttoggleSelectionState(nextSelectedElement, selectedElement.current, autofocus.current);\n\t\t\treturn nextSelectedElement;\n\t\t}\n\t\treturn selectedElement.current;\n\t});\n\n\tconst resetCursor = useMutableCallback(() => {\n\t\titemIndexRef.current = 0;\n\t\tlistRef.current.scrollToIndex({ index: itemIndexRef.current });\n\n\t\tselectedElement.current = boxRef.current?.querySelector('a.rcx-sidebar-item');\n\n\t\tif (selectedElement.current) {\n\t\t\ttoggleSelectionState(selectedElement.current, undefined, autofocus.current);\n\t\t}\n\t});\n\n\tuseEffect(() => {\n\t\tresetCursor();\n\t});\n\n\tuseEffect(() => {\n\t\tresetCursor();\n\t}, [filterText, resetCursor]);\n\n\tuseEffect(() => {\n\t\tif (!autofocus.current) {\n\t\t\treturn;\n\t\t}\n\t\tconst unsubscribe = tinykeys(autofocus.current, {\n\t\t\tEscape: (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tsetFilterValue((value) => {\n\t\t\t\t\tif (!value) {\n\t\t\t\t\t\tonClose();\n\t\t\t\t\t}\n\t\t\t\t\tresetCursor();\n\t\t\t\t\treturn '';\n\t\t\t\t});\n\t\t\t},\n\t\t\tTab: onClose,\n\t\t\tArrowUp: () => {\n\t\t\t\tconst currentElement = changeSelection('up');\n\t\t\t\titemIndexRef.current = Math.max(itemIndexRef.current - 1, 0);\n\t\t\t\tlistRef.current.scrollToIndex({ index: itemIndexRef.current });\n\t\t\t\tselectedElement.current = currentElement;\n\t\t\t},\n\t\t\tArrowDown: () => {\n\t\t\t\tconst currentElement = changeSelection('down');\n\t\t\t\titemIndexRef.current = Math.min(itemIndexRef.current + 1, items?.length + 1);\n\t\t\t\tlistRef.current.scrollToIndex({ index: itemIndexRef.current });\n\t\t\t\tselectedElement.current = currentElement;\n\t\t\t},\n\t\t\tEnter: () => {\n\t\t\t\tif (selectedElement.current) {\n\t\t\t\t\tselectedElement.current.click();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\treturn () => {\n\t\t\tunsubscribe();\n\t\t};\n\t}, [autofocus, changeSelection, items.length, onClose, resetCursor, setFilterValue]);\n\n\treturn (\n\t\t<Box\n\t\t\tposition='absolute'\n\t\t\trcx-sidebar\n\t\t\th='full'\n\t\t\tdisplay='flex'\n\t\t\tflexDirection='column'\n\t\t\tzIndex={99}\n\t\t\tw='full'\n\t\t\tclassName={css`\n\t\t\t\tleft: 0;\n\t\t\t\ttop: 0;\n\t\t\t`}\n\t\t\tref={ref}\n\t\t>\n\t\t\t<Sidebar.TopBar.Section role='search' is='form'>\n\t\t\t\t<TextInput\n\t\t\t\t\taria-owns={listId}\n\t\t\t\t\tdata-qa='sidebar-search-input'\n\t\t\t\t\tref={autofocus}\n\t\t\t\t\t{...filter}\n\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\taddon={<Icon name='cross' size='x20' onClick={onClose} />}\n\t\t\t\t/>\n\t\t\t</Sidebar.TopBar.Section>\n\t\t\t<Box\n\t\t\t\tref={boxRef}\n\t\t\t\taria-expanded='true'\n\t\t\t\trole='listbox'\n\t\t\t\tid={listId}\n\t\t\t\ttabIndex={-1}\n\t\t\t\tflexShrink={1}\n\t\t\t\th='full'\n\t\t\t\tw='full'\n\t\t\t\tdata-qa='sidebar-search-result'\n\t\t\t\tonClick={onClose}\n\t\t\t\taria-busy={status !== AsyncStatePhase.RESOLVED}\n\t\t\t>\n\t\t\t\t<Virtuoso\n\t\t\t\t\tstyle={{ height: '100%', width: '100%' }}\n\t\t\t\t\ttotalCount={items?.length}\n\t\t\t\t\tdata={items}\n\t\t\t\t\tcomponents={{ Scroller: ScrollerWithCustomProps }}\n\t\t\t\t\titemContent={(index, data) => <Row data={itemData} item={data} />}\n\t\t\t\t\tref={listRef}\n\t\t\t\t/>\n\t\t\t</Box>\n\t\t</Box>\n\t);\n});\n\nexport default SearchList;\n"]}