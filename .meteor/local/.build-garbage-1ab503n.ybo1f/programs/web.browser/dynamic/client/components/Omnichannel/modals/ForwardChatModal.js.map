{"version":3,"sources":["meteor://ðŸ’»app/client/components/Omnichannel/modals/ForwardChatModal.js"],"names":["_objectWithoutProperties","module","link","default","v","Field","Button","TextAreaInput","Icon","ButtonGroup","Modal","Box","PaginatedSelectFiltered","useMutableCallback","useAutoFocus","useDebouncedValue","React","useEffect","useMemo","useState","useEndpoint","useTranslation","useRecordList","AsyncStatePhase","useForm","UserAutoComplete","useDepartmentsList","ModalSeparator","ForwardChatModal","onForward","onCancel","room","props","t","inputRef","values","handlers","username","comment","department","userId","setUserId","handleUsername","handleComment","handleDepartment","getUserData","departmentsFilter","setDepartmentsFilter","debouncedDepartmentsFilter","itemsList","departmentsList","loadMoreItems","loadMoreDepartments","filter","phase","departmentsPhase","items","departmentsItems","itemCount","departmentsTotal","handleSend","value","onChangeUsername","fetchData","user","_id","canForward","departments","hasDepartments","length","servedBy","agentId","$ne","conditions","status","statusLivechat","LOADING","start","Math","min","exportDefault"],"mappings":"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","file":"dynamic/client/components/Omnichannel/modals/ForwardChatModal.js","sourcesContent":["import { Field, Button, TextAreaInput, Icon, ButtonGroup, Modal, Box, PaginatedSelectFiltered } from '@rocket.chat/fuselage';\nimport { useMutableCallback, useAutoFocus, useDebouncedValue } from '@rocket.chat/fuselage-hooks';\nimport React, { useEffect, useMemo, useState } from 'react';\n\nimport { useEndpoint } from '../../../contexts/ServerContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useRecordList } from '../../../hooks/lists/useRecordList';\nimport { AsyncStatePhase } from '../../../hooks/useAsyncState';\nimport { useForm } from '../../../hooks/useForm';\nimport UserAutoComplete from '../../UserAutoComplete';\nimport { useDepartmentsList } from '../hooks/useDepartmentsList';\nimport ModalSeparator from './ModalSeparator';\n\nconst ForwardChatModal = ({ onForward, onCancel, room, ...props }) => {\n\tconst t = useTranslation();\n\n\tconst inputRef = useAutoFocus(true);\n\n\tconst { values, handlers } = useForm({\n\t\tusername: '',\n\t\tcomment: '',\n\t\tdepartment: {},\n\t});\n\tconst { username, comment, department } = values;\n\tconst [userId, setUserId] = useState('');\n\n\tconst { handleUsername, handleComment, handleDepartment } = handlers;\n\tconst getUserData = useEndpoint('GET', `users.info?username=${username}`);\n\n\tconst [departmentsFilter, setDepartmentsFilter] = useState('');\n\n\tconst debouncedDepartmentsFilter = useDebouncedValue(departmentsFilter, 500);\n\n\tconst { itemsList: departmentsList, loadMoreItems: loadMoreDepartments } = useDepartmentsList(\n\t\tuseMemo(() => ({ filter: debouncedDepartmentsFilter }), [debouncedDepartmentsFilter]),\n\t);\n\n\tconst { phase: departmentsPhase, items: departmentsItems, itemCount: departmentsTotal } = useRecordList(departmentsList);\n\n\tconst handleSend = useMutableCallback(() => {\n\t\tonForward(department?.value, userId, comment);\n\t}, [onForward, department.value, userId, comment]);\n\n\tconst onChangeUsername = useMutableCallback((username) => {\n\t\thandleUsername(username);\n\t});\n\n\tuseEffect(() => {\n\t\tif (!username) {\n\t\t\treturn;\n\t\t}\n\t\tconst fetchData = async () => {\n\t\t\tconst { user } = await getUserData();\n\t\t\tsetUserId(user._id);\n\t\t};\n\t\tfetchData();\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [username]);\n\n\tconst canForward = department || username;\n\n\tconst departments = departmentsItems;\n\n\tconst hasDepartments = departments && departments.length > 0;\n\n\tconst { servedBy: { _id: agentId } = {} } = room || {};\n\n\tconst _id = agentId && { $ne: agentId };\n\n\tconst conditions = { _id, status: { $ne: 'offline' }, statusLivechat: 'available' };\n\n\treturn (\n\t\t<Modal {...props}>\n\t\t\t<Modal.Header>\n\t\t\t\t<Icon name='baloon-arrow-top-right' size={20} />\n\t\t\t\t<Modal.Title>{t('Forward_chat')}</Modal.Title>\n\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t<Field mbe={'x30'}>\n\t\t\t\t\t<Field.Label>{t('Forward_to_department')}</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<PaginatedSelectFiltered\n\t\t\t\t\t\t\twithTitle\n\t\t\t\t\t\t\tfilter={departmentsFilter}\n\t\t\t\t\t\t\tsetFilter={setDepartmentsFilter}\n\t\t\t\t\t\t\toptions={departmentsItems}\n\t\t\t\t\t\t\tvalue={department}\n\t\t\t\t\t\t\tmaxWidth='100%'\n\t\t\t\t\t\t\tplaceholder={t('Select_an_option')}\n\t\t\t\t\t\t\tonChange={handleDepartment}\n\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\tendReached={\n\t\t\t\t\t\t\t\tdepartmentsPhase === AsyncStatePhase.LOADING\n\t\t\t\t\t\t\t\t\t? () => {}\n\t\t\t\t\t\t\t\t\t: (start) => loadMoreDepartments(start, Math.min(50, departmentsTotal))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Field.Row>\n\t\t\t\t</Field>\n\t\t\t\t<ModalSeparator text={t('or')} />\n\t\t\t\t<Field mbs={hasDepartments && 'x30'}>\n\t\t\t\t\t<Field.Label>{t('Forward_to_user')}</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<UserAutoComplete\n\t\t\t\t\t\t\tconditions={conditions}\n\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\tvalue={username}\n\t\t\t\t\t\t\tonChange={onChangeUsername}\n\t\t\t\t\t\t\tplaceholder={t('Username')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Field.Row>\n\t\t\t\t</Field>\n\t\t\t\t<Field marginBlock='x15'>\n\t\t\t\t\t<Field.Label>\n\t\t\t\t\t\t{t('Leave_a_comment')}{' '}\n\t\t\t\t\t\t<Box is='span' color='neutral-600'>\n\t\t\t\t\t\t\t({t('Optional')})\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<TextAreaInput ref={inputRef} rows={8} flexGrow={1} value={comment} onChange={handleComment} />\n\t\t\t\t\t</Field.Row>\n\t\t\t\t</Field>\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<ButtonGroup align='end'>\n\t\t\t\t\t<Button onClick={onCancel}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button disabled={!canForward} primary onClick={handleSend}>\n\t\t\t\t\t\t{t('Forward')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\n\nexport default ForwardChatModal;\n"]}