{"version":3,"sources":["meteor://ðŸ’»app/client/components/Omnichannel/modals/CloseChatModal.js"],"names":["Field","Button","TextInput","Icon","ButtonGroup","Modal","Box","module","link","v","useAutoFocus","React","useCallback","useState","useMemo","useEffect","default","useSetting","useTranslation","useComponentDidUpdate","useForm","GenericModal","Tags","CloseChatModal","department","onCancel","onConfirm","t","inputRef","values","handlers","comment","tags","commentRequired","handleComment","handleTags","commentError","setCommentError","tagError","setTagError","tagRequired","setTagRequired","handleConfirm","canConfirm","canConfirmTag","length","canConfirmComment","requestTagBeforeClosingChat","exportDefault"],"mappings":";;;;;;;;AAAA,IAAIA,KAAJ,EAAUC,MAAV,EAAiBC,SAAjB,EAA2BC,IAA3B,EAAgCC,WAAhC,EAA4CC,KAA5C,EAAkDC,GAAlD;AAAsDC,MAAM,CAACC,IAAP,CAAY,uBAAZ,EAAoC;AAACR,OAAK,CAACS,CAAD,EAAG;AAACT,SAAK,GAACS,CAAN;AAAQ,GAAlB;;AAAmBR,QAAM,CAACQ,CAAD,EAAG;AAACR,UAAM,GAACQ,CAAP;AAAS,GAAtC;;AAAuCP,WAAS,CAACO,CAAD,EAAG;AAACP,aAAS,GAACO,CAAV;AAAY,GAAhE;;AAAiEN,MAAI,CAACM,CAAD,EAAG;AAACN,QAAI,GAACM,CAAL;AAAO,GAAhF;;AAAiFL,aAAW,CAACK,CAAD,EAAG;AAACL,eAAW,GAACK,CAAZ;AAAc,GAA9G;;AAA+GJ,OAAK,CAACI,CAAD,EAAG;AAACJ,SAAK,GAACI,CAAN;AAAQ,GAAhI;;AAAiIH,KAAG,CAACG,CAAD,EAAG;AAACH,OAAG,GAACG,CAAJ;AAAM;;AAA9I,CAApC,EAAoL,CAApL;AAAuL,IAAIC,YAAJ;AAAiBH,MAAM,CAACC,IAAP,CAAY,6BAAZ,EAA0C;AAACE,cAAY,CAACD,CAAD,EAAG;AAACC,gBAAY,GAACD,CAAb;AAAe;;AAAhC,CAA1C,EAA4E,CAA5E;AAA+E,IAAIE,KAAJ,EAAUC,WAAV,EAAsBC,QAAtB,EAA+BC,OAA/B,EAAuCC,SAAvC;AAAiDR,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAoB;AAACQ,SAAO,CAACP,CAAD,EAAG;AAACE,SAAK,GAACF,CAAN;AAAQ,GAApB;;AAAqBG,aAAW,CAACH,CAAD,EAAG;AAACG,eAAW,GAACH,CAAZ;AAAc,GAAlD;;AAAmDI,UAAQ,CAACJ,CAAD,EAAG;AAACI,YAAQ,GAACJ,CAAT;AAAW,GAA1E;;AAA2EK,SAAO,CAACL,CAAD,EAAG;AAACK,WAAO,GAACL,CAAR;AAAU,GAAhG;;AAAiGM,WAAS,CAACN,CAAD,EAAG;AAACM,aAAS,GAACN,CAAV;AAAY;;AAA1H,CAApB,EAAgJ,CAAhJ;AAAmJ,IAAIQ,UAAJ;AAAeV,MAAM,CAACC,IAAP,CAAY,mCAAZ,EAAgD;AAACS,YAAU,CAACR,CAAD,EAAG;AAACQ,cAAU,GAACR,CAAX;AAAa;;AAA5B,CAAhD,EAA8E,CAA9E;AAAiF,IAAIS,cAAJ;AAAmBX,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACU,gBAAc,CAACT,CAAD,EAAG;AAACS,kBAAc,GAACT,CAAf;AAAiB;;AAApC,CAAnD,EAAyF,CAAzF;AAA4F,IAAIU,qBAAJ;AAA0BZ,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACW,uBAAqB,CAACV,CAAD,EAAG;AAACU,yBAAqB,GAACV,CAAtB;AAAwB;;AAAlD,CAAnD,EAAuG,CAAvG;AAA0G,IAAIW,OAAJ;AAAYb,MAAM,CAACC,IAAP,CAAY,wBAAZ,EAAqC;AAACY,SAAO,CAACX,CAAD,EAAG;AAACW,WAAO,GAACX,CAAR;AAAU;;AAAtB,CAArC,EAA6D,CAA7D;AAAgE,IAAIY,YAAJ;AAAiBd,MAAM,CAACC,IAAP,CAAY,oBAAZ,EAAiC;AAACQ,SAAO,CAACP,CAAD,EAAG;AAACY,gBAAY,GAACZ,CAAb;AAAe;;AAA3B,CAAjC,EAA8D,CAA9D;AAAiE,IAAIa,IAAJ;AAASf,MAAM,CAACC,IAAP,CAAY,SAAZ,EAAsB;AAACQ,SAAO,CAACP,CAAD,EAAG;AAACa,QAAI,GAACb,CAAL;AAAO;;AAAnB,CAAtB,EAA2C,CAA3C;;AAW3gC,MAAMc,cAAc,GAAG,QAA8C;AAAA,MAA7C;AAAEC,cAAU,GAAG,EAAf;AAAmBC,YAAnB;AAA6BC;AAA7B,GAA6C;AACpE,QAAMC,CAAC,GAAGT,cAAc,EAAxB;AAEA,QAAMU,QAAQ,GAAGlB,YAAY,CAAC,IAAD,CAA7B;AAEA,QAAM;AAAEmB,UAAF;AAAUC;AAAV,MAAuBV,OAAO,CAAC;AAAEW,WAAO,EAAE,EAAX;AAAeC,QAAI,EAAE;AAArB,GAAD,CAApC;AAEA,QAAMC,eAAe,GAAGhB,UAAU,CAAC,oDAAD,CAAlC;AAEA,QAAM;AAAEc,WAAF;AAAWC;AAAX,MAAoBH,MAA1B;AACA,QAAM;AAAEK,iBAAF;AAAiBC;AAAjB,MAAgCL,QAAtC;AACA,QAAM,CAACM,YAAD,EAAeC,eAAf,IAAkCxB,QAAQ,CAAC,EAAD,CAAhD;AACA,QAAM,CAACyB,QAAD,EAAWC,WAAX,IAA0B1B,QAAQ,CAAC,EAAD,CAAxC;AACA,QAAM,CAAC2B,WAAD,EAAcC,cAAd,IAAgC5B,QAAQ,CAAC,KAAD,CAA9C;AAEA,QAAM6B,aAAa,GAAG9B,WAAW,CAAC,MAAM;AACvCc,aAAS,CAACK,OAAD,EAAUC,IAAV,CAAT;AACA,GAFgC,EAE9B,CAACD,OAAD,EAAUL,SAAV,EAAqBM,IAArB,CAF8B,CAAjC;AAIAb,uBAAqB,CAAC,MAAM;AAC3BkB,mBAAe,CAAC,CAACN,OAAD,IAAYE,eAAZ,GAA8BN,CAAC,CAAC,uBAAD,EAA0BA,CAAC,CAAC,SAAD,CAA3B,CAA/B,GAAyE,EAA1E,CAAf;AACA,GAFoB,EAElB,CAACM,eAAD,EAAkBF,OAAlB,EAA2BJ,CAA3B,CAFkB,CAArB;AAIA,QAAMgB,UAAU,GAAG7B,OAAO,CAAC,MAAM;AAChC,UAAM8B,aAAa,GAAG,CAACN,QAAD,KAAcE,WAAW,GAAGR,IAAI,CAACa,MAAL,GAAc,CAAjB,GAAqB,IAA9C,CAAtB;AACA,UAAMC,iBAAiB,GAAG,CAACV,YAAD,KAAkBH,eAAe,GAAG,CAAC,CAACF,OAAL,GAAe,IAAhD,CAA1B;AACA,WAAOa,aAAa,IAAIE,iBAAxB;AACA,GAJyB,EAIvB,CAACf,OAAD,EAAUK,YAAV,EAAwBH,eAAxB,EAAyCK,QAAzC,EAAmDE,WAAnD,EAAgER,IAAI,CAACa,MAArE,CAJuB,CAA1B;AAMA9B,WAAS,CAAC,MAAM;AACf,KAAAS,UAAU,SAAV,IAAAA,UAAU,WAAV,YAAAA,UAAU,CAAEuB,2BAAZ,KAA2CN,cAAc,CAAC,IAAD,CAAzD;AACAF,eAAW,CAACC,WAAW,KAAK,CAACR,IAAD,IAASA,IAAI,CAACa,MAAL,KAAgB,CAA9B,CAAX,GAA8ClB,CAAC,CAAC,iDAAD,CAA/C,GAAqG,EAAtG,CAAX;AACA,GAHQ,EAGN,CAACH,UAAD,EAAagB,WAAb,EAA0Bb,CAA1B,EAA6BK,IAA7B,CAHM,CAAT;;AAKA,MAAI,CAACC,eAAD,IAAoB,CAACO,WAAzB,EAAsC;AACrC,wBACC,oBAAC,YAAD;AACC,aAAO,EAAC,SADT;AAEC,WAAK,EAAEb,CAAC,CAAC,0CAAD,CAFT;AAGC,eAAS,EAAEe,aAHZ;AAIC,cAAQ,EAAEjB,QAJX;AAKC,aAAO,EAAEA,QALV;AAMC,iBAAW,EAAEE,CAAC,CAAC,SAAD;AANf,MADD;AAUA;;AAED,sBACC,oBAAC,KAAD,qBACC,oBAAC,KAAD,CAAO,MAAP,qBACC,oBAAC,IAAD;AAAM,QAAI,EAAC,wBAAX;AAAoC,QAAI,EAAE;AAA1C,IADD,eAEC,oBAAC,KAAD,CAAO,KAAP,QAAcA,CAAC,CAAC,cAAD,CAAf,CAFD,eAGC,oBAAC,KAAD,CAAO,KAAP;AAAa,WAAO,EAAEF;AAAtB,IAHD,CADD,eAMC,oBAAC,KAAD,CAAO,OAAP;AAAe,aAAS,EAAC;AAAzB,kBACC,oBAAC,GAAD;AAAK,SAAK,EAAC;AAAX,KAA0BE,CAAC,CAAC,wBAAD,CAA3B,CADD,eAEC,oBAAC,KAAD;AAAO,eAAW,EAAC;AAAnB,kBACC,oBAAC,KAAD,CAAO,KAAP;AAAa,YAAQ,EAAEM;AAAvB,KAAyCN,CAAC,CAAC,SAAD,CAA1C,CADD,eAEC,oBAAC,KAAD,CAAO,GAAP,qBACC,oBAAC,SAAD;AACC,OAAG,EAAEC,QADN;AAEC,SAAK,EAAEQ,YAFR;AAGC,YAAQ,EAAE,CAHX;AAIC,SAAK,EAAEL,OAJR;AAKC,YAAQ,EAAEG,aALX;AAMC,eAAW,EAAEP,CAAC,CAAC,sBAAD;AANf,IADD,CAFD,eAYC,oBAAC,KAAD,CAAO,KAAP,QAAcS,YAAd,CAZD,CAFD,EAgBEd,IAAI,iBACJ,oBAAC,KAAD,qBACC,oBAAC,IAAD;AAAM,eAAW,EAAEkB,WAAnB;AAAgC,QAAI,EAAER,IAAtC;AAA4C,WAAO,EAAEG,UAArD;AAAiE,SAAK,EAAEG;AAAxE,IADD,eAEC,oBAAC,KAAD,CAAO,KAAP,QAAcA,QAAd,CAFD,CAjBF,CAND,eA6BC,oBAAC,KAAD,CAAO,MAAP,qBACC,oBAAC,WAAD;AAAa,SAAK,EAAC;AAAnB,kBACC,oBAAC,MAAD;AAAQ,WAAO,EAAEb;AAAjB,KAA4BE,CAAC,CAAC,QAAD,CAA7B,CADD,eAEC,oBAAC,MAAD;AAAQ,YAAQ,EAAE,CAACgB,UAAnB;AAA+B,WAAO,MAAtC;AAAuC,WAAO,EAAED;AAAhD,KACEf,CAAC,CAAC,SAAD,CADH,CAFD,CADD,CA7BD,CADD;AAwCA,CAvFD;;AAXApB,MAAM,CAACyC,aAAP,CAoGezB,cApGf,E","file":"dynamic/client/components/Omnichannel/modals/CloseChatModal.js","sourcesContent":["import { Field, Button, TextInput, Icon, ButtonGroup, Modal, Box } from '@rocket.chat/fuselage';\nimport { useAutoFocus } from '@rocket.chat/fuselage-hooks';\nimport React, { useCallback, useState, useMemo, useEffect } from 'react';\n\nimport { useSetting } from '../../../contexts/SettingsContext';\nimport { useTranslation } from '../../../contexts/TranslationContext';\nimport { useComponentDidUpdate } from '../../../hooks/useComponentDidUpdate';\nimport { useForm } from '../../../hooks/useForm';\nimport GenericModal from '../../GenericModal';\nimport Tags from '../Tags';\n\nconst CloseChatModal = ({ department = {}, onCancel, onConfirm }) => {\n\tconst t = useTranslation();\n\n\tconst inputRef = useAutoFocus(true);\n\n\tconst { values, handlers } = useForm({ comment: '', tags: [] });\n\n\tconst commentRequired = useSetting('Livechat_request_comment_when_closing_conversation');\n\n\tconst { comment, tags } = values;\n\tconst { handleComment, handleTags } = handlers;\n\tconst [commentError, setCommentError] = useState('');\n\tconst [tagError, setTagError] = useState('');\n\tconst [tagRequired, setTagRequired] = useState(false);\n\n\tconst handleConfirm = useCallback(() => {\n\t\tonConfirm(comment, tags);\n\t}, [comment, onConfirm, tags]);\n\n\tuseComponentDidUpdate(() => {\n\t\tsetCommentError(!comment && commentRequired ? t('The_field_is_required', t('Comment')) : '');\n\t}, [commentRequired, comment, t]);\n\n\tconst canConfirm = useMemo(() => {\n\t\tconst canConfirmTag = !tagError && (tagRequired ? tags.length > 0 : true);\n\t\tconst canConfirmComment = !commentError && (commentRequired ? !!comment : true);\n\t\treturn canConfirmTag && canConfirmComment;\n\t}, [comment, commentError, commentRequired, tagError, tagRequired, tags.length]);\n\n\tuseEffect(() => {\n\t\tdepartment?.requestTagBeforeClosingChat && setTagRequired(true);\n\t\tsetTagError(tagRequired && (!tags || tags.length === 0) ? t('error-tags-must-be-assigned-before-closing-chat') : '');\n\t}, [department, tagRequired, t, tags]);\n\n\tif (!commentRequired && !tagRequired) {\n\t\treturn (\n\t\t\t<GenericModal\n\t\t\t\tvariant='warning'\n\t\t\t\ttitle={t('Are_you_sure_you_want_to_close_this_chat')}\n\t\t\t\tonConfirm={handleConfirm}\n\t\t\t\tonCancel={onCancel}\n\t\t\t\tonClose={onCancel}\n\t\t\t\tconfirmText={t('Confirm')}\n\t\t\t></GenericModal>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Modal>\n\t\t\t<Modal.Header>\n\t\t\t\t<Icon name='baloon-close-top-right' size={20} />\n\t\t\t\t<Modal.Title>{t('Closing_chat')}</Modal.Title>\n\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t<Box color='neutral-600'>{t('Close_room_description')}</Box>\n\t\t\t\t<Field marginBlock='x15'>\n\t\t\t\t\t<Field.Label required={commentRequired}>{t('Comment')}</Field.Label>\n\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\tref={inputRef}\n\t\t\t\t\t\t\terror={commentError}\n\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\tvalue={comment}\n\t\t\t\t\t\t\tonChange={handleComment}\n\t\t\t\t\t\t\tplaceholder={t('Please_add_a_comment')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Field.Row>\n\t\t\t\t\t<Field.Error>{commentError}</Field.Error>\n\t\t\t\t</Field>\n\t\t\t\t{Tags && (\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<Tags tagRequired={tagRequired} tags={tags} handler={handleTags} error={tagError} />\n\t\t\t\t\t\t<Field.Error>{tagError}</Field.Error>\n\t\t\t\t\t</Field>\n\t\t\t\t)}\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<ButtonGroup align='end'>\n\t\t\t\t\t<Button onClick={onCancel}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button disabled={!canConfirm} primary onClick={handleConfirm}>\n\t\t\t\t\t\t{t('Confirm')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\n\nexport default CloseChatModal;\n"]}