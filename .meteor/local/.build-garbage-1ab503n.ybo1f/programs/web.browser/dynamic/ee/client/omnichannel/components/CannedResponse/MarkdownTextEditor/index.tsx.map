{"version":3,"sources":["meteor://ðŸ’»app/ee/client/omnichannel/components/CannedResponse/MarkdownTextEditor/index.tsx"],"names":[],"mappings":"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","file":"dynamic/ee/client/omnichannel/components/CannedResponse/MarkdownTextEditor/index.tsx","sourcesContent":["import { Box, Divider, PositionAnimated, Tile } from '@rocket.chat/fuselage';\nimport React, { FC, memo, useCallback, useRef, useState } from 'react';\n\nimport { EmojiPicker } from '../../../../../../app/emoji/client';\nimport { Backdrop } from '../../../../../../client/components/Backdrop';\nimport { useUserPreference } from '../../../../../../client/contexts/UserContext';\nimport TextEditor from '../TextEditor';\nimport InsertPlaceholderDropdown from './InsertPlaceholderDropdown';\n\nconst MarkdownTextEditor: FC<{ onChange: any; value: string }> = ({ onChange, value }) => {\n\tconst useEmojisPreference = useUserPreference('useEmojis');\n\n\tconst textAreaRef = useRef<HTMLTextAreaElement>(null);\n\tconst ref = useRef<HTMLButtonElement>(null);\n\n\tconst [visible, setVisible] = useState(false);\n\n\tconst useMarkdownSyntax = (char: '*' | '_' | '~' | '[]()'): (() => void) =>\n\t\tuseCallback(() => {\n\t\t\tif (textAreaRef?.current) {\n\t\t\t\tconst text = textAreaRef.current.value;\n\t\t\t\tconst startPos = textAreaRef.current.selectionStart;\n\t\t\t\tconst endPos = textAreaRef.current.selectionEnd;\n\n\t\t\t\tif (char === '[]()') {\n\t\t\t\t\tif (startPos !== endPos) {\n\t\t\t\t\t\ttextAreaRef.current.value = `${text.slice(0, startPos)}[${text.slice(startPos, endPos)}]()${text.slice(endPos)}`;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttextAreaRef.current.value = `${text.slice(0, startPos)}${char}${text.slice(startPos, endPos)}${char}${text.slice(endPos)}`;\n\t\t\t\t}\n\t\t\t\ttextAreaRef.current.focus();\n\n\t\t\t\tif (char === '[]()') {\n\t\t\t\t\tif (startPos === endPos) {\n\t\t\t\t\t\ttextAreaRef.current.setSelectionRange(startPos, endPos);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttextAreaRef.current.setSelectionRange(endPos + 3, endPos + 3);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttextAreaRef.current.setSelectionRange(startPos + 1, endPos + 1);\n\t\t\t\t}\n\n\t\t\t\tonChange(textAreaRef.current.value);\n\t\t\t}\n\t\t}, [char]);\n\n\tconst onClickEmoji = (emoji: string): void => {\n\t\tif (textAreaRef?.current) {\n\t\t\tconst text = textAreaRef.current.value;\n\t\t\tconst startPos = textAreaRef.current.selectionStart;\n\t\t\tconst emojiValue = `:${emoji}: `;\n\n\t\t\ttextAreaRef.current.value = text.slice(0, startPos) + emojiValue + text.slice(startPos);\n\n\t\t\ttextAreaRef.current.focus();\n\t\t\ttextAreaRef.current.setSelectionRange(startPos + emojiValue.length, startPos + emojiValue.length);\n\n\t\t\tonChange(textAreaRef.current.value);\n\t\t}\n\t};\n\n\tconst openEmojiPicker = (): void => {\n\t\tif (!useEmojisPreference) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (EmojiPicker.isOpened()) {\n\t\t\tEmojiPicker.close();\n\t\t\treturn;\n\t\t}\n\n\t\tEmojiPicker.open(textAreaRef.current, (emoji: string): void => {\n\t\t\tonClickEmoji(emoji);\n\t\t});\n\t};\n\n\tconst openPlaceholderSelect = (): void => {\n\t\ttextAreaRef?.current && textAreaRef.current.focus();\n\t\tsetVisible(!visible);\n\t};\n\n\treturn (\n\t\t<TextEditor>\n\t\t\t<TextEditor.Toolbox>\n\t\t\t\t<Box display='flex' flexDirection='row'>\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='bold' action={useMarkdownSyntax('*')} />\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='italic' action={useMarkdownSyntax('_')} />\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='strike' action={useMarkdownSyntax('~')} />\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='link' action={useMarkdownSyntax('[]()')} />\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='emoji' action={openEmojiPicker} />\n\t\t\t\t</Box>\n\t\t\t\t<TextEditor.Toolbox.TextButton text='Insert_Placeholder' action={openPlaceholderSelect} ref={ref} />\n\t\t\t\t<Backdrop\n\t\t\t\t\tdisplay={visible ? 'block' : 'none'}\n\t\t\t\t\tonClick={(): void => {\n\t\t\t\t\t\ttextAreaRef?.current && textAreaRef.current.focus();\n\t\t\t\t\t\tsetVisible(false);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<PositionAnimated visible={visible ? 'visible' : 'hidden'} anchor={ref}>\n\t\t\t\t\t<Tile elevation='1' w='224px'>\n\t\t\t\t\t\t<InsertPlaceholderDropdown onChange={onChange} textAreaRef={textAreaRef} setVisible={setVisible} />\n\t\t\t\t\t</Tile>\n\t\t\t\t</PositionAnimated>\n\t\t\t</TextEditor.Toolbox>\n\t\t\t<Divider w='full' mbe='16px' />\n\t\t\t<TextEditor.Textarea value={value} onChange={onChange} rows={10} ref={textAreaRef} />\n\t\t</TextEditor>\n\t);\n};\n\nexport default memo(MarkdownTextEditor);\n"]}