{"version":3,"sources":["meteor://ðŸ’»app/ee/client/omnichannel/units/UnitEdit.js"],"names":["_extends","module","link","default","v","_objectWithoutProperties","Field","TextInput","Button","PaginatedMultiSelectFiltered","Select","ButtonGroup","Icon","FieldGroup","useMutableCallback","useDebouncedValue","React","useMemo","useState","Page","useRoute","useMethod","useToastMessageDispatch","useTranslation","useRecordList","AsyncStatePhase","useForm","useDepartmentsByUnitsList","useMonitorsList","UnitEdit","title","data","unitId","isNew","unitMonitors","unitDepartments","reload","props","t","unitsRoute","monitorsFilter","setMonitorsFilter","debouncedMonitorsFilter","departmentsFilter","setDepartmentsFilter","debouncedDepartmentsFilter","itemsList","monitorsList","loadMoreItems","loadMoreMonitors","filter","phase","monitorsPhase","items","monitorsItems","itemCount","monitorsTotal","departmentsList","loadMoreDepartments","departmentsPhase","departmentsItems","departmentsTotal","departmentsSortedByName","sort","a","b","name","unit","currUnitMonitors","monitors","map","monitorId","username","value","label","visibilityOpts","currUnitDepartments","departments","_id","values","handlers","hasUnsavedChanges","visibility","handleName","handleVisibility","handleDepartments","handleMonitors","nameError","length","undefined","visibilityError","departmentError","unitMonitorsError","saveUnit","dispatchToastMessage","handleReturn","push","canSave","handleSave","unitData","departmentsData","department","departmentId","monitorsData","monitor","type","message","error","LOADING","start","Math","min","exportDefault"],"mappings":";;;;;;;;;;AAAA,IAAIA,QAAJ;;AAAaC,MAAM,CAACC,IAAP,CAAY,gCAAZ,EAA6C;AAACC,SAAO,CAACC,CAAD,EAAG;AAACJ,YAAQ,GAACI,CAAT;AAAW;;AAAvB,CAA7C,EAAsE,CAAtE;;AAAyE,IAAIC,wBAAJ;;AAA6BJ,MAAM,CAACC,IAAP,CAAY,gDAAZ,EAA6D;AAACC,SAAO,CAACC,CAAD,EAAG;AAACC,4BAAwB,GAACD,CAAzB;AAA2B;;AAAvC,CAA7D,EAAsG,CAAtG;AAAnH,IAAIE,KAAJ,EAAUC,SAAV,EAAoBC,MAApB,EAA2BC,4BAA3B,EAAwDC,MAAxD,EAA+DC,WAA/D,EAA2EC,IAA3E,EAAgFC,UAAhF;AAA2FZ,MAAM,CAACC,IAAP,CAAY,uBAAZ,EAAoC;AAACI,OAAK,CAACF,CAAD,EAAG;AAACE,SAAK,GAACF,CAAN;AAAQ,GAAlB;;AAAmBG,WAAS,CAACH,CAAD,EAAG;AAACG,aAAS,GAACH,CAAV;AAAY,GAA5C;;AAA6CI,QAAM,CAACJ,CAAD,EAAG;AAACI,UAAM,GAACJ,CAAP;AAAS,GAAhE;;AAAiEK,8BAA4B,CAACL,CAAD,EAAG;AAACK,gCAA4B,GAACL,CAA7B;AAA+B,GAAhI;;AAAiIM,QAAM,CAACN,CAAD,EAAG;AAACM,UAAM,GAACN,CAAP;AAAS,GAApJ;;AAAqJO,aAAW,CAACP,CAAD,EAAG;AAACO,eAAW,GAACP,CAAZ;AAAc,GAAlL;;AAAmLQ,MAAI,CAACR,CAAD,EAAG;AAACQ,QAAI,GAACR,CAAL;AAAO,GAAlM;;AAAmMS,YAAU,CAACT,CAAD,EAAG;AAACS,cAAU,GAACT,CAAX;AAAa;;AAA9N,CAApC,EAAoQ,CAApQ;AAAuQ,IAAIU,kBAAJ,EAAuBC,iBAAvB;AAAyCd,MAAM,CAACC,IAAP,CAAY,6BAAZ,EAA0C;AAACY,oBAAkB,CAACV,CAAD,EAAG;AAACU,sBAAkB,GAACV,CAAnB;AAAqB,GAA5C;;AAA6CW,mBAAiB,CAACX,CAAD,EAAG;AAACW,qBAAiB,GAACX,CAAlB;AAAoB;;AAAtF,CAA1C,EAAkI,CAAlI;AAAqI,IAAIY,KAAJ,EAAUC,OAAV,EAAkBC,QAAlB;AAA2BjB,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAoB;AAACC,SAAO,CAACC,CAAD,EAAG;AAACY,SAAK,GAACZ,CAAN;AAAQ,GAApB;;AAAqBa,SAAO,CAACb,CAAD,EAAG;AAACa,WAAO,GAACb,CAAR;AAAU,GAA1C;;AAA2Cc,UAAQ,CAACd,CAAD,EAAG;AAACc,YAAQ,GAACd,CAAT;AAAW;;AAAlE,CAApB,EAAwF,CAAxF;AAA2F,IAAIe,IAAJ;AAASlB,MAAM,CAACC,IAAP,CAAY,oCAAZ,EAAiD;AAACC,SAAO,CAACC,CAAD,EAAG;AAACe,QAAI,GAACf,CAAL;AAAO;;AAAnB,CAAjD,EAAsE,CAAtE;AAAyE,IAAIgB,QAAJ;AAAanB,MAAM,CAACC,IAAP,CAAY,2CAAZ,EAAwD;AAACkB,UAAQ,CAAChB,CAAD,EAAG;AAACgB,YAAQ,GAAChB,CAAT;AAAW;;AAAxB,CAAxD,EAAkF,CAAlF;AAAqF,IAAIiB,SAAJ;AAAcpB,MAAM,CAACC,IAAP,CAAY,2CAAZ,EAAwD;AAACmB,WAAS,CAACjB,CAAD,EAAG;AAACiB,aAAS,GAACjB,CAAV;AAAY;;AAA1B,CAAxD,EAAoF,CAApF;AAAuF,IAAIkB,uBAAJ;AAA4BrB,MAAM,CAACC,IAAP,CAAY,kDAAZ,EAA+D;AAACoB,yBAAuB,CAAClB,CAAD,EAAG;AAACkB,2BAAuB,GAAClB,CAAxB;AAA0B;;AAAtD,CAA/D,EAAuH,CAAvH;AAA0H,IAAImB,cAAJ;AAAmBtB,MAAM,CAACC,IAAP,CAAY,gDAAZ,EAA6D;AAACqB,gBAAc,CAACnB,CAAD,EAAG;AAACmB,kBAAc,GAACnB,CAAf;AAAiB;;AAApC,CAA7D,EAAmG,CAAnG;AAAsG,IAAIoB,aAAJ;AAAkBvB,MAAM,CAACC,IAAP,CAAY,8CAAZ,EAA2D;AAACsB,eAAa,CAACpB,CAAD,EAAG;AAACoB,iBAAa,GAACpB,CAAd;AAAgB;;AAAlC,CAA3D,EAA+F,CAA/F;AAAkG,IAAIqB,eAAJ;AAAoBxB,MAAM,CAACC,IAAP,CAAY,wCAAZ,EAAqD;AAACuB,iBAAe,CAACrB,CAAD,EAAG;AAACqB,mBAAe,GAACrB,CAAhB;AAAkB;;AAAtC,CAArD,EAA6F,CAA7F;AAAgG,IAAIsB,OAAJ;AAAYzB,MAAM,CAACC,IAAP,CAAY,kCAAZ,EAA+C;AAACwB,SAAO,CAACtB,CAAD,EAAG;AAACsB,WAAO,GAACtB,CAAR;AAAU;;AAAtB,CAA/C,EAAuE,EAAvE;AAA2E,IAAIuB,yBAAJ;AAA8B1B,MAAM,CAACC,IAAP,CAAY,0DAAZ,EAAuE;AAACyB,2BAAyB,CAACvB,CAAD,EAAG;AAACuB,6BAAyB,GAACvB,CAA1B;AAA4B;;AAA1D,CAAvE,EAAmI,EAAnI;AAAuI,IAAIwB,eAAJ;AAAoB3B,MAAM,CAACC,IAAP,CAAY,gDAAZ,EAA6D;AAAC0B,iBAAe,CAACxB,CAAD,EAAG;AAACwB,mBAAe,GAACxB,CAAhB;AAAkB;;AAAtC,CAA7D,EAAqG,EAArG;;AAetqD,SAASyB,QAAT,OAAmG;AAAA,MAAjF;AAAEC,SAAF;AAASC,QAAT;AAAeC,UAAf;AAAuBC,SAAvB;AAA8BC,gBAA9B;AAA4CC,mBAA5C;AAA6DC;AAA7D,GAAiF;AAAA,MAATC,KAAS;;AAClG,QAAMC,CAAC,GAAGf,cAAc,EAAxB;AACA,QAAMgB,UAAU,GAAGnB,QAAQ,CAAC,mBAAD,CAA3B;AACA,QAAM,CAACoB,cAAD,EAAiBC,iBAAjB,IAAsCvB,QAAQ,CAAC,EAAD,CAApD;AAEA,QAAMwB,uBAAuB,GAAG3B,iBAAiB,CAACyB,cAAD,EAAiB,GAAjB,CAAjD;AAEA,QAAM,CAACG,iBAAD,EAAoBC,oBAApB,IAA4C1B,QAAQ,CAAC,EAAD,CAA1D;AAEA,QAAM2B,0BAA0B,GAAG9B,iBAAiB,CAAC4B,iBAAD,EAAoB,GAApB,CAApD;AAEA,QAAM;AAAEG,aAAS,EAAEC,YAAb;AAA2BC,iBAAa,EAAEC;AAA1C,MAA+DrB,eAAe,CACnFX,OAAO,CAAC,OAAO;AAAEiC,UAAM,EAAER;AAAV,GAAP,CAAD,EAA8C,CAACA,uBAAD,CAA9C,CAD4E,CAApF;AAIA,QAAM;AAAES,SAAK,EAAEC,aAAT;AAAwBC,SAAK,EAAEC,aAA/B;AAA8CC,aAAS,EAAEC;AAAzD,MAA2EhC,aAAa,CAACuB,YAAD,CAA9F;AAEA,QAAM;AAAED,aAAS,EAAEW,eAAb;AAA8BT,iBAAa,EAAEU;AAA7C,MAAqE/B,yBAAyB,CACnGV,OAAO,CAAC,OAAO;AAAEiC,UAAM,EAAEL,0BAAV;AAAsCb;AAAtC,GAAP,CAAD,EAAyD,CAACa,0BAAD,EAA6Bb,MAA7B,CAAzD,CAD4F,CAApG;AAIA,QAAM;AAAEmB,SAAK,EAAEQ,gBAAT;AAA2BN,SAAK,EAAEO,gBAAlC;AAAoDL,aAAS,EAAEM;AAA/D,MAAoFrC,aAAa,CAACiC,eAAD,CAAvG;AAEA,QAAMK,uBAAuB,GAAGF,gBAAgB,CAACG,IAAjB,CAAsB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AAC/D,QAAID,CAAC,CAACE,IAAF,GAASD,CAAC,CAACC,IAAf,EAAqB;AACpB,aAAO,CAAP;AACA;;AACD,QAAIF,CAAC,CAACE,IAAF,GAASD,CAAC,CAACC,IAAf,EAAqB;AACpB,aAAO,CAAC,CAAR;AACA;;AAED,WAAO,CAAP;AACA,GAT+B,CAAhC;AAWA,QAAMC,IAAI,GAAGpC,IAAI,IAAI,EAArB;AAEA,QAAMqC,gBAAgB,GAAGnD,OAAO,CAC/B,MACCiB,YAAY,IAAIA,YAAY,CAACmC,QAA7B,GACGnC,YAAY,CAACmC,QAAb,CAAsBC,GAAtB,CAA0B;AAAA,QAAC;AAAEC,eAAF;AAAaC;AAAb,KAAD;AAAA,WAA8B;AACxDC,WAAK,EAAEF,SADiD;AAExDG,WAAK,EAAEF;AAFiD,KAA9B;AAAA,GAA1B,CADH,GAKG,EAP2B,EAQ/B,CAACtC,YAAD,CAR+B,CAAhC;AAUA,QAAMyC,cAAc,GAAG,CACtB,CAAC,QAAD,EAAWrC,CAAC,CAAC,QAAD,CAAZ,CADsB,EAEtB,CAAC,SAAD,EAAYA,CAAC,CAAC,SAAD,CAAb,CAFsB,CAAvB;AAKA,QAAMsC,mBAAmB,GAAG3D,OAAO,CAClC,MACCkB,eAAe,IAAIA,eAAe,CAAC0C,WAAnC,IAAkD7C,MAAlD,GACGG,eAAe,CAAC0C,WAAhB,CAA4BP,GAA5B,CAAgC;AAAA,QAAC;AAAEQ,SAAF;AAAOZ;AAAP,KAAD;AAAA,WAAoB;AACpDO,WAAK,EAAEK,GAD6C;AAEpDJ,WAAK,EAAER;AAF6C,KAApB;AAAA,GAAhC,CADH,GAKG,EAP8B,EAQlC,CAAC/B,eAAD,EAAkBH,MAAlB,CARkC,CAAnC;AAWA,QAAM;AAAE+C,UAAF;AAAUC,YAAV;AAAoBC;AAApB,MAA0CvD,OAAO,CAAC;AACvDwC,QAAI,EAAEC,IAAI,CAACD,IAD4C;AAEvDgB,cAAU,EAAEf,IAAI,CAACe,UAFsC;AAGvDL,eAAW,EAAED,mBAH0C;AAIvDP,YAAQ,EAAED;AAJ6C,GAAD,CAAvD;AAOA,QAAM;AAAEe,cAAF;AAAcC,oBAAd;AAAgCC,qBAAhC;AAAmDC;AAAnD,MAAsEN,QAA5E;AACA,QAAM;AAAEd,QAAF;AAAQgB,cAAR;AAAoBL,eAApB;AAAiCR;AAAjC,MAA8CU,MAApD;AAEA,QAAMQ,SAAS,GAAGtE,OAAO,CAAC,MAAO,CAACiD,IAAD,IAASA,IAAI,CAACsB,MAAL,KAAgB,CAAzB,GAA6BlD,CAAC,CAAC,uBAAD,EAA0BA,CAAC,CAAC,MAAD,CAA3B,CAA9B,GAAqEmD,SAA7E,EAAyF,CAACvB,IAAD,EAAO5B,CAAP,CAAzF,CAAzB;AACA,QAAMoD,eAAe,GAAGzE,OAAO,CAC9B,MAAO,CAACiE,UAAD,IAAeA,UAAU,CAACM,MAAX,KAAsB,CAArC,GAAyClD,CAAC,CAAC,uBAAD,EAA0BA,CAAC,CAAC,aAAD,CAA3B,CAA1C,GAAwFmD,SADjE,EAE9B,CAACP,UAAD,EAAa5C,CAAb,CAF8B,CAA/B;AAIA,QAAMqD,eAAe,GAAG1E,OAAO,CAC9B,MAAO,CAAC4D,WAAD,IAAgBA,WAAW,CAACW,MAAZ,KAAuB,CAAvC,GAA2ClD,CAAC,CAAC,uBAAD,EAA0BA,CAAC,CAAC,aAAD,CAA3B,CAA5C,GAA0FmD,SADnE,EAE9B,CAACZ,WAAD,EAAcvC,CAAd,CAF8B,CAA/B;AAIA,QAAMsD,iBAAiB,GAAG3E,OAAO,CAChC,MAAO,CAACoD,QAAD,IAAaA,QAAQ,CAACmB,MAAT,KAAoB,CAAjC,GAAqClD,CAAC,CAAC,uBAAD,EAA0BA,CAAC,CAAC,UAAD,CAA3B,CAAtC,GAAiFmD,SADxD,EAEhC,CAACpB,QAAD,EAAW/B,CAAX,CAFgC,CAAjC;AAKA,QAAMuD,QAAQ,GAAGxE,SAAS,CAAC,mBAAD,CAA1B;AAEA,QAAMyE,oBAAoB,GAAGxE,uBAAuB,EAApD;AAEA,QAAMyE,YAAY,GAAGjF,kBAAkB,CAAC,MAAM;AAC7CyB,cAAU,CAACyD,IAAX,CAAgB,EAAhB;AACA,GAFsC,CAAvC;AAIA,QAAMC,OAAO,GAAGhF,OAAO,CACtB,MAAM,CAACsE,SAAD,IAAc,CAACG,eAAf,IAAkC,CAACC,eAAnC,IAAsD,CAACC,iBADvC,EAEtB,CAACL,SAAD,EAAYG,eAAZ,EAA6BC,eAA7B,EAA8CC,iBAA9C,CAFsB,CAAvB;AAKA,QAAMM,UAAU,GAAGpF,kBAAkB,CAAC,YAAY;AACjD,UAAMqF,QAAQ,GAAG;AAAEjC,UAAF;AAAQgB;AAAR,KAAjB;AACA,UAAMkB,eAAe,GAAGvB,WAAW,CAACP,GAAZ,CAAiB+B,UAAD,KAAiB;AAAEC,kBAAY,EAAED,UAAU,CAAC5B;AAA3B,KAAjB,CAAhB,CAAxB;AACA,UAAM8B,YAAY,GAAGlC,QAAQ,CAACC,GAAT,CAAckC,OAAD,KAAc;AAC/CjC,eAAS,EAAEiC,OAAO,CAAC/B,KAD4B;AAE/CD,cAAQ,EAAEgC,OAAO,CAAC9B;AAF6B,KAAd,CAAb,CAArB;;AAKA,QAAI,CAACuB,OAAL,EAAc;AACb,aAAOH,oBAAoB,CAAC;AAAEW,YAAI,EAAE,OAAR;AAAiBC,eAAO,EAAEpE,CAAC,CAAC,uBAAD;AAA3B,OAAD,CAA3B;AACA;;AAED,QAAI;AACH,YAAMuD,QAAQ,CAAC7D,MAAD,EAASmE,QAAT,EAAmBI,YAAnB,EAAiCH,eAAjC,CAAd;AACAN,0BAAoB,CAAC;AAAEW,YAAI,EAAE,SAAR;AAAmBC,eAAO,EAAEpE,CAAC,CAAC,OAAD;AAA7B,OAAD,CAApB;AACAF,YAAM;AACNG,gBAAU,CAACyD,IAAX,CAAgB,EAAhB;AACA,KALD,CAKE,OAAOW,KAAP,EAAc;AACfb,0BAAoB,CAAC;AAAEW,YAAI,EAAE,OAAR;AAAiBC,eAAO,EAAEC;AAA1B,OAAD,CAApB;AACA;AACD,GApBoC,CAArC;AAsBA,sBACC,oBAAC,IAAD;AAAM,iBAAa,EAAC;AAApB,kBACC,oBAAC,IAAD,qBACC,oBAAC,IAAD,CAAM,MAAN;AAAa,SAAK,EAAE7E;AAApB,kBACC,oBAAC,WAAD,qBACC,oBAAC,MAAD;AAAQ,WAAO,EAAEiE;AAAjB,kBACC,oBAAC,IAAD;AAAM,QAAI,EAAC;AAAX,IADD,OACuBzD,CAAC,CAAC,MAAD,CADxB,CADD,eAIC,oBAAC,MAAD;AAAQ,WAAO,MAAf;AAAgB,OAAG,EAAC,MAApB;AAA2B,YAAQ,EAAE,CAArC;AAAwC,YAAQ,EAAE,CAAC2C,iBAAD,IAAsB,CAACgB,OAAzE;AAAkF,WAAO,EAAEC;AAA3F,KACE5D,CAAC,CAAC,MAAD,CADH,CAJD,CADD,CADD,eAWC,oBAAC,IAAD,CAAM,2BAAN,qBACC,oBAAC,UAAD;AAAY,KAAC,EAAC,MAAd;AAAqB,aAAS,EAAC,QAA/B;AAAwC,YAAQ,EAAC,MAAjD;AAAwD,MAAE,EAAC,MAA3D;AAAkE,gBAAY,EAAC;AAA/E,KAAyFD,KAAzF,gBACC,oBAAC,KAAD,qBACC,oBAAC,KAAD,CAAO,KAAP,QAAcC,CAAC,CAAC,MAAD,CAAf,MADD,eAEC,oBAAC,KAAD,CAAO,GAAP,qBACC,oBAAC,SAAD;AAAW,eAAW,EAAEA,CAAC,CAAC,MAAD,CAAzB;AAAmC,YAAQ,EAAE,CAA7C;AAAgD,SAAK,EAAE4B,IAAvD;AAA6D,YAAQ,EAAEiB,UAAvE;AAAmF,SAAK,EAAEF,iBAAiB,IAAIM;AAA/G,IADD,CAFD,CADD,eAOC,oBAAC,KAAD,qBACC,oBAAC,KAAD,CAAO,KAAP,QAAcjD,CAAC,CAAC,YAAD,CAAf,MADD,eAEC,oBAAC,KAAD,CAAO,GAAP,qBACC,oBAAC,MAAD;AACC,WAAO,EAAEqC,cADV;AAEC,SAAK,EAAEO,UAFR;AAGC,SAAK,EAAED,iBAAiB,IAAIS,eAH7B;AAIC,eAAW,EAAEpD,CAAC,CAAC,kBAAD,CAJf;AAKC,YAAQ,EAAE8C,gBALX;AAMC,YAAQ,EAAE;AANX,IADD,CAFD,CAPD,eAoBC,oBAAC,KAAD,qBACC,oBAAC,KAAD,CAAO,KAAP,QAAc9C,CAAC,CAAC,aAAD,CAAf,MADD,eAEC,oBAAC,KAAD,CAAO,GAAP,qBACC,oBAAC,4BAAD;AACC,aAAS,MADV;AAEC,UAAM,EAAEK,iBAFT;AAGC,aAAS,EAAEC,oBAHZ;AAIC,WAAO,EAAEkB,uBAJV;AAKC,SAAK,EAAEe,WALR;AAMC,SAAK,EAAEI,iBAAiB,IAAIU,eAN7B;AAOC,YAAQ,EAAC,MAPV;AAQC,eAAW,EAAErD,CAAC,CAAC,kBAAD,CARf;AASC,YAAQ,EAAE+C,iBATX;AAUC,YAAQ,EAAE,CAVX;AAWC,cAAU,EACT1B,gBAAgB,KAAKlC,eAAe,CAACmF,OAArC,GACG,MAAM,CAAE,CADX,GAEIC,KAAD,IAAWnD,mBAAmB,CAACmD,KAAD,EAAQC,IAAI,CAACC,GAAL,CAAS,EAAT,EAAalD,gBAAb,CAAR;AAdnC,IADD,CAFD,CApBD,eA0CC,oBAAC,KAAD,qBACC,oBAAC,KAAD,CAAO,KAAP,QAAcvB,CAAC,CAAC,UAAD,CAAf,MADD,eAEC,oBAAC,KAAD,CAAO,GAAP,qBACC,oBAAC,4BAAD;AACC,aAAS,MADV;AAEC,UAAM,EAAEE,cAFT;AAGC,aAAS,EAAEC,iBAHZ;AAIC,WAAO,EAAEa,aAJV;AAKC,SAAK,EAAEe,QALR;AAMC,SAAK,EAAEY,iBAAiB,IAAIW,iBAN7B;AAOC,YAAQ,EAAC,MAPV;AAQC,eAAW,EAAEtD,CAAC,CAAC,kBAAD,CARf;AASC,YAAQ,EAAEgD,cATX;AAUC,YAAQ,EAAE,CAVX;AAWC,cAAU,EACTlC,aAAa,KAAK3B,eAAe,CAACmF,OAAlC,GAA4C,MAAM,CAAE,CAApD,GAAwDC,KAAD,IAAW5D,gBAAgB,CAAC4D,KAAD,EAAQC,IAAI,CAACC,GAAL,CAAS,EAAT,EAAavD,aAAb,CAAR;AAZpF,IADD,CAFD,CA1CD,CADD,CAXD,CADD,CADD;AAiFA;;AAzNDvD,MAAM,CAAC+G,aAAP,CA2NenF,QA3Nf,E","file":"dynamic/ee/client/omnichannel/units/UnitEdit.js","sourcesContent":["import { Field, TextInput, Button, PaginatedMultiSelectFiltered, Select, ButtonGroup, Icon, FieldGroup } from '@rocket.chat/fuselage';\nimport { useMutableCallback, useDebouncedValue } from '@rocket.chat/fuselage-hooks';\nimport React, { useMemo, useState } from 'react';\n\nimport Page from '../../../../client/components/Page';\nimport { useRoute } from '../../../../client/contexts/RouterContext';\nimport { useMethod } from '../../../../client/contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../../client/contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../../client/contexts/TranslationContext';\nimport { useRecordList } from '../../../../client/hooks/lists/useRecordList';\nimport { AsyncStatePhase } from '../../../../client/hooks/useAsyncState';\nimport { useForm } from '../../../../client/hooks/useForm';\nimport { useDepartmentsByUnitsList } from '../../../../client/views/hooks/useDepartmentsByUnitsList';\nimport { useMonitorsList } from '../../../../client/views/hooks/useMonitorsList';\n\nfunction UnitEdit({ title, data, unitId, isNew, unitMonitors, unitDepartments, reload, ...props }) {\n\tconst t = useTranslation();\n\tconst unitsRoute = useRoute('omnichannel-units');\n\tconst [monitorsFilter, setMonitorsFilter] = useState('');\n\n\tconst debouncedMonitorsFilter = useDebouncedValue(monitorsFilter, 500);\n\n\tconst [departmentsFilter, setDepartmentsFilter] = useState('');\n\n\tconst debouncedDepartmentsFilter = useDebouncedValue(departmentsFilter, 500);\n\n\tconst { itemsList: monitorsList, loadMoreItems: loadMoreMonitors } = useMonitorsList(\n\t\tuseMemo(() => ({ filter: debouncedMonitorsFilter }), [debouncedMonitorsFilter]),\n\t);\n\n\tconst { phase: monitorsPhase, items: monitorsItems, itemCount: monitorsTotal } = useRecordList(monitorsList);\n\n\tconst { itemsList: departmentsList, loadMoreItems: loadMoreDepartments } = useDepartmentsByUnitsList(\n\t\tuseMemo(() => ({ filter: debouncedDepartmentsFilter, unitId }), [debouncedDepartmentsFilter, unitId]),\n\t);\n\n\tconst { phase: departmentsPhase, items: departmentsItems, itemCount: departmentsTotal } = useRecordList(departmentsList);\n\n\tconst departmentsSortedByName = departmentsItems.sort((a, b) => {\n\t\tif (a.name > b.name) {\n\t\t\treturn 1;\n\t\t}\n\t\tif (a.name < b.name) {\n\t\t\treturn -1;\n\t\t}\n\n\t\treturn 0;\n\t});\n\n\tconst unit = data || {};\n\n\tconst currUnitMonitors = useMemo(\n\t\t() =>\n\t\t\tunitMonitors && unitMonitors.monitors\n\t\t\t\t? unitMonitors.monitors.map(({ monitorId, username }) => ({\n\t\t\t\t\t\tvalue: monitorId,\n\t\t\t\t\t\tlabel: username,\n\t\t\t\t  }))\n\t\t\t\t: [],\n\t\t[unitMonitors],\n\t);\n\tconst visibilityOpts = [\n\t\t['public', t('Public')],\n\t\t['private', t('Private')],\n\t];\n\n\tconst currUnitDepartments = useMemo(\n\t\t() =>\n\t\t\tunitDepartments && unitDepartments.departments && unitId\n\t\t\t\t? unitDepartments.departments.map(({ _id, name }) => ({\n\t\t\t\t\t\tvalue: _id,\n\t\t\t\t\t\tlabel: name,\n\t\t\t\t  }))\n\t\t\t\t: [],\n\t\t[unitDepartments, unitId],\n\t);\n\n\tconst { values, handlers, hasUnsavedChanges } = useForm({\n\t\tname: unit.name,\n\t\tvisibility: unit.visibility,\n\t\tdepartments: currUnitDepartments,\n\t\tmonitors: currUnitMonitors,\n\t});\n\n\tconst { handleName, handleVisibility, handleDepartments, handleMonitors } = handlers;\n\tconst { name, visibility, departments, monitors } = values;\n\n\tconst nameError = useMemo(() => (!name || name.length === 0 ? t('The_field_is_required', t('name')) : undefined), [name, t]);\n\tconst visibilityError = useMemo(\n\t\t() => (!visibility || visibility.length === 0 ? t('The_field_is_required', t('description')) : undefined),\n\t\t[visibility, t],\n\t);\n\tconst departmentError = useMemo(\n\t\t() => (!departments || departments.length === 0 ? t('The_field_is_required', t('departments')) : undefined),\n\t\t[departments, t],\n\t);\n\tconst unitMonitorsError = useMemo(\n\t\t() => (!monitors || monitors.length === 0 ? t('The_field_is_required', t('monitors')) : undefined),\n\t\t[monitors, t],\n\t);\n\n\tconst saveUnit = useMethod('livechat:saveUnit');\n\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst handleReturn = useMutableCallback(() => {\n\t\tunitsRoute.push({});\n\t});\n\n\tconst canSave = useMemo(\n\t\t() => !nameError && !visibilityError && !departmentError && !unitMonitorsError,\n\t\t[nameError, visibilityError, departmentError, unitMonitorsError],\n\t);\n\n\tconst handleSave = useMutableCallback(async () => {\n\t\tconst unitData = { name, visibility };\n\t\tconst departmentsData = departments.map((department) => ({ departmentId: department.value }));\n\t\tconst monitorsData = monitors.map((monitor) => ({\n\t\t\tmonitorId: monitor.value,\n\t\t\tusername: monitor.label,\n\t\t}));\n\n\t\tif (!canSave) {\n\t\t\treturn dispatchToastMessage({ type: 'error', message: t('The_field_is_required') });\n\t\t}\n\n\t\ttry {\n\t\t\tawait saveUnit(unitId, unitData, monitorsData, departmentsData);\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Saved') });\n\t\t\treload();\n\t\t\tunitsRoute.push({});\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\treturn (\n\t\t<Page flexDirection='row'>\n\t\t\t<Page>\n\t\t\t\t<Page.Header title={title}>\n\t\t\t\t\t<ButtonGroup>\n\t\t\t\t\t\t<Button onClick={handleReturn}>\n\t\t\t\t\t\t\t<Icon name='back' /> {t('Back')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button primary mie='none' flexGrow={1} disabled={!hasUnsavedChanges || !canSave} onClick={handleSave}>\n\t\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Page.Header>\n\t\t\t\t<Page.ScrollableContentWithShadow>\n\t\t\t\t\t<FieldGroup w='full' alignSelf='center' maxWidth='x600' is='form' autoComplete='off' {...props}>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Field.Label>{t('Name')}*</Field.Label>\n\t\t\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t\t\t<TextInput placeholder={t('Name')} flexGrow={1} value={name} onChange={handleName} error={hasUnsavedChanges && nameError} />\n\t\t\t\t\t\t\t</Field.Row>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Field.Label>{t('Visibility')}*</Field.Label>\n\t\t\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\t\t\toptions={visibilityOpts}\n\t\t\t\t\t\t\t\t\tvalue={visibility}\n\t\t\t\t\t\t\t\t\terror={hasUnsavedChanges && visibilityError}\n\t\t\t\t\t\t\t\t\tplaceholder={t('Select_an_option')}\n\t\t\t\t\t\t\t\t\tonChange={handleVisibility}\n\t\t\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Field.Row>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Field.Label>{t('Departments')}*</Field.Label>\n\t\t\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t\t\t<PaginatedMultiSelectFiltered\n\t\t\t\t\t\t\t\t\twithTitle\n\t\t\t\t\t\t\t\t\tfilter={departmentsFilter}\n\t\t\t\t\t\t\t\t\tsetFilter={setDepartmentsFilter}\n\t\t\t\t\t\t\t\t\toptions={departmentsSortedByName}\n\t\t\t\t\t\t\t\t\tvalue={departments}\n\t\t\t\t\t\t\t\t\terror={hasUnsavedChanges && departmentError}\n\t\t\t\t\t\t\t\t\tmaxWidth='100%'\n\t\t\t\t\t\t\t\t\tplaceholder={t('Select_an_option')}\n\t\t\t\t\t\t\t\t\tonChange={handleDepartments}\n\t\t\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\t\t\tendReached={\n\t\t\t\t\t\t\t\t\t\tdepartmentsPhase === AsyncStatePhase.LOADING\n\t\t\t\t\t\t\t\t\t\t\t? () => {}\n\t\t\t\t\t\t\t\t\t\t\t: (start) => loadMoreDepartments(start, Math.min(50, departmentsTotal))\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Field.Row>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Field.Label>{t('Monitors')}*</Field.Label>\n\t\t\t\t\t\t\t<Field.Row>\n\t\t\t\t\t\t\t\t<PaginatedMultiSelectFiltered\n\t\t\t\t\t\t\t\t\twithTitle\n\t\t\t\t\t\t\t\t\tfilter={monitorsFilter}\n\t\t\t\t\t\t\t\t\tsetFilter={setMonitorsFilter}\n\t\t\t\t\t\t\t\t\toptions={monitorsItems}\n\t\t\t\t\t\t\t\t\tvalue={monitors}\n\t\t\t\t\t\t\t\t\terror={hasUnsavedChanges && unitMonitorsError}\n\t\t\t\t\t\t\t\t\tmaxWidth='100%'\n\t\t\t\t\t\t\t\t\tplaceholder={t('Select_an_option')}\n\t\t\t\t\t\t\t\t\tonChange={handleMonitors}\n\t\t\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\t\t\tendReached={\n\t\t\t\t\t\t\t\t\t\tmonitorsPhase === AsyncStatePhase.LOADING ? () => {} : (start) => loadMoreMonitors(start, Math.min(50, monitorsTotal))\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Field.Row>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t</FieldGroup>\n\t\t\t\t</Page.ScrollableContentWithShadow>\n\t\t\t</Page>\n\t\t</Page>\n\t);\n}\n\nexport default UnitEdit;\n"]}