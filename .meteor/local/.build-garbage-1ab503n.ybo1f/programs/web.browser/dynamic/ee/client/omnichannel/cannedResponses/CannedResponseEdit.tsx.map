{"version":3,"sources":["meteor://ðŸ’»app/ee/client/omnichannel/cannedResponses/CannedResponseEdit.tsx"],"names":[],"mappings":"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","file":"dynamic/ee/client/omnichannel/cannedResponses/CannedResponseEdit.tsx","sourcesContent":["import { Button, ButtonGroup, Icon, FieldGroup } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport React, { FC, memo, useState, useMemo, useEffect, useCallback } from 'react';\n\nimport Page from '../../../../client/components/Page';\nimport { usePermission } from '../../../../client/contexts/AuthorizationContext';\nimport { useRoute } from '../../../../client/contexts/RouterContext';\nimport { useEndpoint } from '../../../../client/contexts/ServerContext';\nimport { useToastMessageDispatch } from '../../../../client/contexts/ToastMessagesContext';\nimport { useTranslation } from '../../../../client/contexts/TranslationContext';\nimport { useForm } from '../../../../client/hooks/useForm';\nimport { ILivechatDepartment } from '../../../../definition/ILivechatDepartment';\nimport { IOmnichannelCannedResponse } from '../../../../definition/IOmnichannelCannedResponse';\nimport { Serialized } from '../../../../definition/Serialized';\nimport CannedResponseForm from './components/cannedResponseForm';\n\nconst CannedResponseEdit: FC<{\n\tdata?: {\n\t\tcannedResponse: Serialized<IOmnichannelCannedResponse>;\n\t};\n\treload: () => void;\n\ttotalDataReload: () => void;\n\tisNew?: boolean;\n\tdepartmentData?: {\n\t\tdepartment: Serialized<ILivechatDepartment>;\n\t};\n}> = ({ data, reload, totalDataReload, isNew = false, departmentData = {} }) => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst Route = useRoute('omnichannel-canned-responses');\n\n\tconst handleReturn = useMutableCallback(() =>\n\t\tRoute.push({\n\t\t\tcontext: '',\n\t\t}),\n\t);\n\n\tconst saveCannedResponse = useEndpoint('POST', 'canned-responses');\n\n\tconst hasManagerPermission = usePermission('view-all-canned-responses');\n\tconst hasMonitorPermission = usePermission('save-department-canned-responses');\n\n\tconst form = useForm({\n\t\t_id: data?.cannedResponse ? data.cannedResponse._id : '',\n\t\tshortcut: data ? data.cannedResponse.shortcut : '',\n\t\ttext: data ? data.cannedResponse.text : '',\n\t\ttags:\n\t\t\tdata?.cannedResponse?.tags && Array.isArray(data.cannedResponse.tags)\n\t\t\t\t? data.cannedResponse.tags.map((tag) => ({ label: tag, value: tag }))\n\t\t\t\t: [],\n\t\tscope: data ? data.cannedResponse.scope : 'user',\n\t\tdepartmentId: data?.cannedResponse?.departmentId\n\t\t\t? { value: data.cannedResponse.departmentId, label: departmentData?.department?.name }\n\t\t\t: '',\n\t});\n\n\tconst { values, handlers, hasUnsavedChanges } = form;\n\n\tconst [errors, setErrors] = useState<any>({});\n\tconst [radioDescription, setRadioDescription] = useState<string>(t('Canned_Response_Sharing_Private_Description'));\n\tconst [preview, setPreview] = useState(false);\n\n\tconst listErrors = useMemo(() => {\n\t\tconst empty: any = {};\n\n\t\tfor (const [key, value] of Object.entries(values)) {\n\t\t\tif (['shortcut', 'text'].includes(key) && !value) {\n\t\t\t\tempty[key] = t('Field_required');\n\t\t\t}\n\t\t}\n\n\t\tif (values.scope === 'department' && !values.departmentId) {\n\t\t\tempty.departmentId = t('Field_required');\n\t\t}\n\n\t\treturn empty;\n\t}, [t, values]);\n\n\tuseEffect(() => {\n\t\tsetErrors(listErrors);\n\t}, [values.shortcut, values.text, values.departmentId, listErrors]);\n\n\tconst radioHandlers = {\n\t\tsetPublic: (): void => {\n\t\t\thandlers.handleScope('global');\n\t\t\thandlers.handleDepartmentId('');\n\t\t\tsetRadioDescription(t('Canned_Response_Sharing_Public_Description'));\n\t\t},\n\t\tsetDepartment: (): void => {\n\t\t\thandlers.handleScope('department');\n\t\t\tsetRadioDescription(t('Canned_Response_Sharing_Department_Description'));\n\t\t},\n\t\tsetPrivate: (): void => {\n\t\t\thandlers.handleScope('user');\n\t\t\thandlers.handleDepartmentId('');\n\t\t\tsetRadioDescription(t('Canned_Response_Sharing_Private_Description'));\n\t\t},\n\t};\n\n\tconst onSave = useCallback(async (): Promise<void> => {\n\t\ttry {\n\t\t\tconst { _id, shortcut, text, scope, tags, departmentId } = values as {\n\t\t\t\t_id: string;\n\t\t\t\tshortcut: string;\n\t\t\t\ttext: string;\n\t\t\t\tscope: string;\n\t\t\t\ttags: any;\n\t\t\t\tdepartmentId: { value: string; label: string };\n\t\t\t};\n\t\t\tconst mappedTags = tags.map((tag: string | { value: string; label: string }) => (typeof tag === 'object' ? tag?.value : tag));\n\t\t\tawait saveCannedResponse({\n\t\t\t\t...(_id && { _id }),\n\t\t\t\tshortcut,\n\t\t\t\ttext,\n\t\t\t\tscope,\n\t\t\t\t...(mappedTags.length > 0 && { tags: mappedTags }),\n\t\t\t\t...(departmentId && { departmentId: departmentId.value }),\n\t\t\t});\n\t\t\tdispatchToastMessage({\n\t\t\t\ttype: 'success',\n\t\t\t\tmessage: t(_id ? 'Canned_Response_Updated' : 'Canned_Response_Created'),\n\t\t\t});\n\t\t\tRoute.push({\n\t\t\t\tcontext: '',\n\t\t\t});\n\t\t\treload();\n\t\t\ttotalDataReload();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error as Error });\n\t\t}\n\t}, [values, saveCannedResponse, dispatchToastMessage, t, Route, reload, totalDataReload]);\n\n\tconst onPreview = (): void => {\n\t\tsetPreview(!preview);\n\t};\n\n\tconst { shortcut, text, scope, departmentId } = values;\n\n\tconst checkDepartment = scope !== 'department' || (scope === 'department' && departmentId);\n\n\tconst canSave = shortcut && text && checkDepartment;\n\n\treturn (\n\t\t<Page>\n\t\t\t<Page.Header title={isNew ? t('New_CannedResponse') : t('Edit_CannedResponse')}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t<Button onClick={handleReturn}>\n\t\t\t\t\t\t<Icon name='back' /> {t('Back')}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button primary mie='none' flexGrow={1} disabled={!hasUnsavedChanges || !canSave} onClick={onSave}>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Header>\n\t\t\t<Page.ScrollableContentWithShadow fontScale='p2'>\n\t\t\t\t<FieldGroup w='full' alignSelf='center' maxWidth='x600' is='form' autoComplete='off'>\n\t\t\t\t\t<CannedResponseForm\n\t\t\t\t\t\tisManager={hasManagerPermission}\n\t\t\t\t\t\tisMonitor={hasMonitorPermission}\n\t\t\t\t\t\tvalues={values}\n\t\t\t\t\t\thandlers={handlers}\n\t\t\t\t\t\terrors={errors}\n\t\t\t\t\t\tradioHandlers={radioHandlers}\n\t\t\t\t\t\tradioDescription={radioDescription}\n\t\t\t\t\t\tonPreview={onPreview}\n\t\t\t\t\t\tpreviewState={preview}\n\t\t\t\t\t></CannedResponseForm>\n\t\t\t\t</FieldGroup>\n\t\t\t</Page.ScrollableContentWithShadow>\n\t\t</Page>\n\t);\n};\n\nexport default memo(CannedResponseEdit);\n"]}