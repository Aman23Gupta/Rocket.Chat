{"version":3,"sources":["meteor://ðŸ’»app/ee/client/views/admin/engagementDashboard/users/UsersByTimeOfTheDaySection.tsx"],"names":[],"mappings":";;;;;;;;AAAA;;AAAS,YAAmB,sCAAnB,EAAyC;AAAA;AAAA;AAAA;;AAAA,CAAzC,EAAyC,CAAzC;AAAT;AAAS,MAAmB,KAAnB,CAAyB,eAAzB,EAAyC;AAAA;AAAA;AAAA;;AAAA,CAAzC,EAAyC,CAAzC;AAAyC;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAiBlD,MAAM,0BAA0B,GAAG,QAAgE;AAAA,MAA/D;AAAE;AAAF,GAA+D;AAClG,QAAM,CAAC,MAAD,EAAS,mBAAT,IAAgC,sBAAsB,CAAC,aAAD,EAAgB,cAAhB,EAAgC,cAAhC,CAA5D;AAEA,QAAM,GAAG,GAAG,QAAQ,KAAK,KAAzB;AAEA,QAAM;AAAE;AAAF,MAAW,sBAAsB,CAAC;AAAE,UAAF;AAAU;AAAV,GAAD,CAAvC;AAEA,QAAM,CAAC,GAAG,cAAc,EAAxB;AAEA,QAAM,CAAC,KAAD,EAAQ,MAAR,IAAkB,OAAO,CAAC,MAAK;AACpC,QAAI,CAAC,IAAL,EAAW;AACV,aAAO,EAAP;AACA;;AAED,UAAM,KAAK,GAAG,KAAK,CAAC,IAAN,CACb;AACC,YAAM,EAAE,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,GAAN,CAAN,CAAiB,IAAjB,CAAsB,IAAI,CAAC,KAA3B,EAAkC,MAAlC,IAA4C,CAA/C,GAAmD,MAAM,CAAC,IAAI,CAAC,GAAN,CAAN,CAAiB,IAAjB,CAAsB,IAAI,CAAC,KAA3B,EAAkC,MAAlC,IAA4C;AAD3G,KADa,EAIb,CAAC,CAAD,EAAI,CAAJ,KACC,GAAG,GACA,MAAM,CAAC,GAAP,CAAW,IAAI,CAAC,KAAhB,EAAuB,KAAvB,CAA6B,KAA7B,EAAoC,GAApC,CAAwC,CAAxC,EAA2C,MAA3C,CADA,GAEA,MAAM,CAAC,IAAI,CAAC,KAAN,CAAN,CACC,KADD,CACO,KADP,EAEC,GAFD,CAEK,CAAC,GAAG,CAFT,EAEY,MAFZ,CAPS,CAAd;AAYA,UAAM,MAAM,GAAG,KAAK,CAAC,IAAN,CACd;AAAE,YAAM,EAAE;AAAV,KADc,EAEd,CAAC,CAAD,EAAI,IAAJ;AAEE,UAAI,EAAE,MAAM,CAAC,IAAD;AAFd,OAGK,KAAK,CAAC,GAAN,CAAW,IAAD,KAAW;AAAE,OAAC,IAAI,CAAC,WAAL,EAAD,GAAsB;AAAxB,KAAX,CAAV,EAAmD,MAAnD,CAA0D,CAAC,GAAD,EAAM,IAAN,qCAAqB,GAArB,GAA6B,IAA7B,CAA1D,EAAgG,EAAhG,CAHL,CAFc,CAAf;AASA,UAAM,cAAc,GAAG,MAAM,GAAG,SAAT,KAAuB,EAA9C;;AAEA,SAAK,MAAM;AAAE,WAAF;AAAS,UAAT;AAAe,SAAf;AAAoB,WAApB;AAA2B;AAA3B,KAAX,IAAgD,IAAI,CAAC,IAArD,EAA2D;AAC1D,YAAM,IAAI,GAAG,GAAG,GAAG,MAAM,CAAC,GAAP,CAAW,CAAC,IAAD,EAAO,KAAK,GAAG,CAAf,EAAkB,GAAlB,EAAuB,IAAvB,CAAX,CAAH,GAA8C,MAAM,CAAC,CAAC,IAAD,EAAO,KAAK,GAAG,CAAf,EAAkB,GAAlB,EAAuB,IAAvB,CAAD,CAAN,CAAqC,GAArC,CAAyC,cAAzC,EAAyD,OAAzD,CAA9D;;AAEA,UAAI,GAAG,IAAK,CAAC,IAAI,CAAC,MAAL,CAAY,IAAI,CAAC,GAAjB,CAAD,IAA0B,CAAC,IAAI,CAAC,KAAL,GAAa,OAAb,CAAqB,KAArB,EAA4B,MAA5B,CAAmC,IAAI,CAAC,KAAxC,CAAvC,EAAwF;AACvF,cAAM,CAAC,IAAI,CAAC,IAAL,EAAD,CAAN,CAAoB,IAAI,CAAC,KAAL,CAAW,KAAX,EAAkB,WAAlB,EAApB,KAAwD,KAAxD;AACA;AACD;;AAED,WAAO,CAAC,KAAK,CAAC,GAAN,CAAW,IAAD,IAAU,IAAI,CAAC,WAAL,EAApB,CAAD,EAA0C,MAA1C,CAAP;AACA,GArC8B,EAqC5B,CAAC,IAAD,EAAO,GAAP,CArC4B,CAA/B;AAuCA,sBACC,oBAAC,OAAD;AACC,SAAK,EAAE,CAAC,CAAC,sBAAD,CADT;AAEC,UAAM,eACL,uDACC,oBAAC,cAAD,EAAoB,mBAApB,CADD,eAEC,oBAAC,kBAAD;AACC,oBAAc,6CAAsC,IAAtC,aAAsC,IAAtC,uBAAsC,IAAI,CAAE,KAA5C,kBAAyD,IAAzD,aAAyD,IAAzD,uBAAyD,IAAI,CAAE,GAA/D,CADf;AAEC,aAAO,EAAE,CAAC,MAAD,EAAS,OAAT,CAFV;AAGC,mBAAa,EAAE,CAAC,CAAC,IAHlB;AAIC,mBAAa,EAAE;AAAA;;AAAA,eACd,IADc,aACd,IADc,qCACd,IAAI,CAAE,IADQ,iEACd,WACG,GADH,CACO;AAAA,cAAC;AAAE,iBAAF;AAAS,gBAAT;AAAe,eAAf;AAAoB,iBAApB;AAA2B;AAA3B,WAAD;AAAA,iBAAwC;AAC7C,gBAAI,EAAE,MAAM,CAAC,CAAC,IAAD,EAAO,KAAK,GAAG,CAAf,EAAkB,GAAlB,EAAuB,IAAvB,EAA6B,CAA7B,EAAgC,CAAhC,EAAmC,CAAnC,CAAD,CADiC;AAE7C;AAF6C,WAAxC;AAAA,SADP,CADc,0EACd,eAKG,IALH,CAKQ,CAAC,CAAD,EAAI,CAAJ,KAAU,CAAC,CAAC,IAAF,CAAO,IAAP,CAAY,CAAC,CAAC,IAAd,CALlB,CADc,wDACd,oBAMG,GANH,CAMO;AAAA,cAAC;AAAE,gBAAF;AAAQ;AAAR,WAAD;AAAA,iBAAqB,CAAC,IAAI,CAAC,WAAL,EAAD,EAAqB,KAArB,CAArB;AAAA,SANP,CADc;AAAA;AAJhB,MAFD;AAHF,KAsBE,MAAM,gBACN,oBAAC,GAAD;AAAK,WAAO,EAAC,MAAb;AAAoB,SAAK,EAAE;AAAE,YAAM,EAAE;AAAV;AAA3B,kBACC,oBAAC,IAAD,CAAM,IAAN;AAAW,SAAK,EAAC,SAAjB;AAA2B,QAAI,EAAE,CAAjC;AAAoC,UAAM,EAAE;AAA5C,kBACC,oBAAC,GAAD;AAAK,SAAK,EAAE;AAAE,cAAQ,EAAE;AAAZ;AAAZ,kBACC,oBAAC,GAAD;AACC,SAAK,EAAE;AACN,cAAQ,EAAE,UADJ;AAEN,WAAK,EAAE,MAFD;AAGN,YAAM,EAAE;AAHF;AADR,kBAOC,oBAAC,iBAAD;AACC,QAAI,EAAE,MADP;AAEC,WAAO,EAAC,MAFT;AAGC,QAAI,EAAE,KAHP;AAIC,WAAO,EAAE,CAJV;AAKC,UAAM,EAAE;AACP;AACA,UAAI,EAAE,EAFC;AAGP,YAAM,EAAE;AAHD,KALT;AAUC,UAAM,EAAE,CACP;AACA,UAAM,CAAC,IAFA,EAGP,MAAM,CAAC,IAHA,EAIP,MAAM,CAAC,IAJA,EAKP,MAAM,CAAC,IALA,EAMP,MAAM,CAAC,IANA,EAOP,MAAM,CAAC,IAPA,EAQP,MAAM,CAAC,IARA,CAVT;AAoBC,eAAW,EAAE,CApBd;AAqBC,gBAAY,EAAE,KArBf;AAsBC,WAAO,EAAE,IAtBV;AAuBC,aAAS,EAAE,IAvBZ;AAwBC,cAAU,EAAE;AACX;AACA,cAAQ,EAAE,CAFC;AAGX,iBAAW,EAAE,CAHF;AAIX,kBAAY,EAAE,CAJH;AAKX,YAAM,EAAG,SAAD,IAAwB,MAAK,SAAL,SAAK,WAAL,iBAAK,CAAE,MAAP,MAAkB,CAAlB,GAAsB,MAAM,CAAC,SAAD,CAAN,CAAkB,MAAlB,CAAyB,MAAzB,CAAtB,GAAyD;AAL9E,KAxBb;AA+BC,YAAQ,EAAE;AACT;AACA,cAAQ,EAAE,CAFD;AAGT,iBAAW,EAAE,CAHJ;AAIT,kBAAY,EAAE,CAJL;AAKT,YAAM,EAAG,IAAD,IACP,MAAM,GACJ,GADF,CACM;AAAE,YAAI,EAAE,QAAQ,CAAC,IAAD,EAAO,EAAP,CAAhB;AAA4B,cAAM,EAAE,CAApC;AAAuC,cAAM,EAAE;AAA/C,OADN,EAEE,MAFF,CAES,IAFT;AANQ,KA/BX;AAyCC,eAAW,EAAC,MAzCb;AA0CC,WAAO,EAAE,KAAK,IAAI,KAAK,CAAC,MAAN,IAAgB,CA1CnC;AA2CC,mBAAe,EAAE,EA3ClB;AA4CC,iBAAa,EAAE,EA5ChB;AA6CC,SAAK,EAAE;AACN;AACA,UAAI,EAAE;AACL,aAAK,EAAE;AACN,cAAI,EAAE;AACL,gBAAI,EAAE,MAAM,CAAC,IADR;AAEL,sBAAU,EACT,4LAHI;AAIL,oBAAQ,EAAE,EAJL;AAKL,qBAAS,EAAE,QALN;AAML,sBAAU,EAAE,GANP;AAOL,yBAAa,EAAE,OAPV;AAQL,sBAAU,EAAE;AARP;AADA;AADF,OAFA;AAgBN,aAAO,EAAE;AACR,iBAAS,EAAE;AACV,yBAAe,EAAE,MAAM,CAAC,IADd;AAEV,mBAAS,EAAE,yEAFD;AAGV,sBAAY,EAAE;AAHJ;AADH;AAhBH,KA7CR;AAqEC,WAAO,EAAE;AAAA,UAAC;AAAE;AAAF,OAAD;AAAA,0BACR,oBAAC,GAAD;AAAK,iBAAS,EAAC,KAAf;AAAqB,aAAK,EAAC;AAA3B,SACE,CAAC,CAAC,aAAD,EAAgB;AAAE;AAAF,OAAhB,CADH,CADQ;AAAA;AArEV,IAPD,CADD,CADD,CADD,CADM,gBA2FN,oBAAC,QAAD;AAAU,WAAO,EAAC,MAAlB;AAAyB,UAAM,EAAE;AAAjC,IAjHF,CADD;AAsHA,CAtKD;;AAjBA,OAAO,aAAP,CAyLe,0BAzLf,E","file":"dynamic/ee/client/views/admin/engagementDashboard/users/UsersByTimeOfTheDaySection.tsx","sourcesContent":["import { ResponsiveHeatMap } from '@nivo/heatmap';\nimport { Box, Flex, Skeleton } from '@rocket.chat/fuselage';\nimport colors from '@rocket.chat/fuselage-tokens/colors.json';\nimport moment from 'moment';\nimport React, { ReactElement, useMemo } from 'react';\n\nimport { useTranslation } from '../../../../../../client/contexts/TranslationContext';\nimport Section from '../Section';\nimport DownloadDataButton from '../data/DownloadDataButton';\nimport PeriodSelector from '../data/PeriodSelector';\nimport { usePeriodSelectorState } from '../data/usePeriodSelectorState';\nimport { useUsersByTimeOfTheDay } from './useUsersByTimeOfTheDay';\n\ntype UsersByTimeOfTheDaySectionProps = {\n\ttimezone: 'utc' | 'local';\n};\n\nconst UsersByTimeOfTheDaySection = ({ timezone }: UsersByTimeOfTheDaySectionProps): ReactElement => {\n\tconst [period, periodSelectorProps] = usePeriodSelectorState('last 7 days', 'last 30 days', 'last 90 days');\n\n\tconst utc = timezone === 'utc';\n\n\tconst { data } = useUsersByTimeOfTheDay({ period, utc });\n\n\tconst t = useTranslation();\n\n\tconst [dates, values] = useMemo(() => {\n\t\tif (!data) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst dates = Array.from(\n\t\t\t{\n\t\t\t\tlength: utc ? moment(data.end).diff(data.start, 'days') + 1 : moment(data.end).diff(data.start, 'days') - 1,\n\t\t\t},\n\t\t\t(_, i) =>\n\t\t\t\tutc\n\t\t\t\t\t? moment.utc(data.start).endOf('day').add(i, 'days')\n\t\t\t\t\t: moment(data.start)\n\t\t\t\t\t\t\t.endOf('day')\n\t\t\t\t\t\t\t.add(i + 1, 'days'),\n\t\t);\n\n\t\tconst values = Array.from(\n\t\t\t{ length: 24 },\n\t\t\t(_, hour) =>\n\t\t\t\t({\n\t\t\t\t\thour: String(hour),\n\t\t\t\t\t...dates.map((date) => ({ [date.toISOString()]: 0 })).reduce((obj, elem) => ({ ...obj, ...elem }), {}),\n\t\t\t\t} as { [date: string]: number } & { hour: string }),\n\t\t);\n\n\t\tconst timezoneOffset = moment().utcOffset() / 60;\n\n\t\tfor (const { users, hour, day, month, year } of data.week) {\n\t\t\tconst date = utc ? moment.utc([year, month - 1, day, hour]) : moment([year, month - 1, day, hour]).add(timezoneOffset, 'hours');\n\n\t\t\tif (utc || (!date.isSame(data.end) && !date.clone().startOf('day').isSame(data.start))) {\n\t\t\t\tvalues[date.hour()][date.endOf('day').toISOString()] += users;\n\t\t\t}\n\t\t}\n\n\t\treturn [dates.map((date) => date.toISOString()), values];\n\t}, [data, utc]);\n\n\treturn (\n\t\t<Section\n\t\t\ttitle={t('Users_by_time_of_day')}\n\t\t\tfilter={\n\t\t\t\t<>\n\t\t\t\t\t<PeriodSelector {...periodSelectorProps} />\n\t\t\t\t\t<DownloadDataButton\n\t\t\t\t\t\tattachmentName={`UsersByTimeOfTheDaySection_start_${data?.start}_end_${data?.end}`}\n\t\t\t\t\t\theaders={['Date', 'Users']}\n\t\t\t\t\t\tdataAvailable={!!data}\n\t\t\t\t\t\tdataExtractor={(): unknown[][] | undefined =>\n\t\t\t\t\t\t\tdata?.week\n\t\t\t\t\t\t\t\t?.map(({ users, hour, day, month, year }) => ({\n\t\t\t\t\t\t\t\t\tdate: moment([year, month - 1, day, hour, 0, 0, 0]),\n\t\t\t\t\t\t\t\t\tusers,\n\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t?.sort((a, b) => a.date.diff(b.date))\n\t\t\t\t\t\t\t\t?.map(({ date, users }) => [date.toISOString(), users])\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t}\n\t\t>\n\t\t\t{values ? (\n\t\t\t\t<Box display='flex' style={{ height: 696 }}>\n\t\t\t\t\t<Flex.Item align='stretch' grow={1} shrink={0}>\n\t\t\t\t\t\t<Box style={{ position: 'relative' }}>\n\t\t\t\t\t\t\t<Box\n\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\t\t\t\twidth: '100%',\n\t\t\t\t\t\t\t\t\theight: '100%',\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<ResponsiveHeatMap\n\t\t\t\t\t\t\t\t\tdata={values}\n\t\t\t\t\t\t\t\t\tindexBy='hour'\n\t\t\t\t\t\t\t\t\tkeys={dates}\n\t\t\t\t\t\t\t\t\tpadding={4}\n\t\t\t\t\t\t\t\t\tmargin={{\n\t\t\t\t\t\t\t\t\t\t// TODO: Get it from theme\n\t\t\t\t\t\t\t\t\t\tleft: 60,\n\t\t\t\t\t\t\t\t\t\tbottom: 20,\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tcolors={[\n\t\t\t\t\t\t\t\t\t\t// TODO: Get it from theme\n\t\t\t\t\t\t\t\t\t\tcolors.b100,\n\t\t\t\t\t\t\t\t\t\tcolors.b200,\n\t\t\t\t\t\t\t\t\t\tcolors.b300,\n\t\t\t\t\t\t\t\t\t\tcolors.b400,\n\t\t\t\t\t\t\t\t\t\tcolors.b500,\n\t\t\t\t\t\t\t\t\t\tcolors.b600,\n\t\t\t\t\t\t\t\t\t\tcolors.b700,\n\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t\tcellOpacity={1}\n\t\t\t\t\t\t\t\t\tenableLabels={false}\n\t\t\t\t\t\t\t\t\taxisTop={null}\n\t\t\t\t\t\t\t\t\taxisRight={null}\n\t\t\t\t\t\t\t\t\taxisBottom={{\n\t\t\t\t\t\t\t\t\t\t// TODO: Get it from theme\n\t\t\t\t\t\t\t\t\t\ttickSize: 0,\n\t\t\t\t\t\t\t\t\t\ttickPadding: 4,\n\t\t\t\t\t\t\t\t\t\ttickRotation: 0,\n\t\t\t\t\t\t\t\t\t\tformat: (isoString): string => (dates?.length === 7 ? moment(isoString).format('dddd') : ''),\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\taxisLeft={{\n\t\t\t\t\t\t\t\t\t\t// TODO: Get it from theme\n\t\t\t\t\t\t\t\t\t\ttickSize: 0,\n\t\t\t\t\t\t\t\t\t\ttickPadding: 4,\n\t\t\t\t\t\t\t\t\t\ttickRotation: 0,\n\t\t\t\t\t\t\t\t\t\tformat: (hour): string =>\n\t\t\t\t\t\t\t\t\t\t\tmoment()\n\t\t\t\t\t\t\t\t\t\t\t\t.set({ hour: parseInt(hour, 10), minute: 0, second: 0 })\n\t\t\t\t\t\t\t\t\t\t\t\t.format('LT'),\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\thoverTarget='cell'\n\t\t\t\t\t\t\t\t\tanimate={dates && dates.length <= 7}\n\t\t\t\t\t\t\t\t\tmotionStiffness={90}\n\t\t\t\t\t\t\t\t\tmotionDamping={15}\n\t\t\t\t\t\t\t\t\ttheme={{\n\t\t\t\t\t\t\t\t\t\t// TODO: Get it from theme\n\t\t\t\t\t\t\t\t\t\taxis: {\n\t\t\t\t\t\t\t\t\t\t\tticks: {\n\t\t\t\t\t\t\t\t\t\t\t\ttext: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill: colors.n600,\n\t\t\t\t\t\t\t\t\t\t\t\t\tfontFamily:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'Inter, -apple-system, system-ui, \"Segoe UI\", Roboto, Oxygen, Ubuntu, Cantarell, \"Helvetica Neue\", \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Meiryo UI\", Arial, sans-serif',\n\t\t\t\t\t\t\t\t\t\t\t\t\tfontSize: 10,\n\t\t\t\t\t\t\t\t\t\t\t\t\tfontStyle: 'normal',\n\t\t\t\t\t\t\t\t\t\t\t\t\tfontWeight: 600,\n\t\t\t\t\t\t\t\t\t\t\t\t\tletterSpacing: '0.2px',\n\t\t\t\t\t\t\t\t\t\t\t\t\tlineHeight: '12px',\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\t\t\tcontainer: {\n\t\t\t\t\t\t\t\t\t\t\t\tbackgroundColor: colors.n900,\n\t\t\t\t\t\t\t\t\t\t\t\tboxShadow: '0px 0px 12px rgba(47, 52, 61, 0.12), 0px 0px 2px rgba(47, 52, 61, 0.08)',\n\t\t\t\t\t\t\t\t\t\t\t\tborderRadius: 2,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ttooltip={({ value }): ReactElement => (\n\t\t\t\t\t\t\t\t\t\t<Box fontScale='p1m' color='alternative'>\n\t\t\t\t\t\t\t\t\t\t\t{t('Value_users', { value })}\n\t\t\t\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Flex.Item>\n\t\t\t\t</Box>\n\t\t\t) : (\n\t\t\t\t<Skeleton variant='rect' height={696} />\n\t\t\t)}\n\t\t</Section>\n\t);\n};\n\nexport default UsersByTimeOfTheDaySection;\n"]}